
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>XRSession.requestAnimationFrame - Web APIs - W3cubDocs</title>
  
  <meta name="description" content=" Experimental&#58; This is an experimental technologyCheck the Browser compatibility table carefully before using this in production. ">
  <meta name="keywords" content="xrsession, requestanimationframe, method, web, apis, dom">
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/dom/xrsession/requestanimationframe.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-c8f743fc70bb84079c3cf4b71f5f99835529659c30689b2fd6193651a680f383ef1d96896f8966c7ca8a0160ffd557685bb8ad12820ec6002d60143812238086.css">
  <script type="text/javascript" src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js"></script>
  <script src="/json/dom.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/dom/" class="_nav-link" title="" style="margin-left:0;">Web APIs</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _mdn">
				
				
<header><h1>XRSession: requestAnimationFrame() method</h1></header><div class="section-content">
<div class="notecard experimental" id="sect1"><p><strong>Experimental:</strong> <strong>This is an <a href="https://developer.mozilla.org/en-US/docs/MDN/Writing_guidelines/Experimental_deprecated_obsolete#experimental">experimental technology</a></strong><br>Check the <a href="#browser_compatibility">Browser compatibility table</a> carefully before using this in production.</p></div> <p> The <a href="../xrsession"><code>XRSession</code></a> method <code>requestAnimationFrame()</code>, much like the <a href="../window"><code>Window</code></a> method of the same name, schedules a callback to be executed the next time the browser is ready to paint the session's virtual environment to the XR display. The specified callback is executed once before the next repaint; if you wish for it to be executed for the following repaint, you must call <code>requestAnimationFrame()</code> again. This can be done from within the callback itself. </p> <p> The callback takes two parameters as inputs: an <a href="../xrframe"><code>XRFrame</code></a> describing the state of all tracked objects for the session, and a timestamp you can use to compute any animation updates needed. </p> <p> You can cancel a previously scheduled animation by calling <a href="cancelanimationframe"><code>cancelAnimationFrame()</code></a>. </p> <div class="notecard note" id="sect2"> <p> <strong>Note:</strong> Despite the obvious similarities between these methods and the global <a href="../window/requestanimationframe"><code>requestAnimationFrame()</code></a> function provided by the <code>Window</code> interface, you <em>must not</em> treat these as interchangeable. There is <em>no</em> guarantee that the latter will work at all while an immersive XR session is underway. </p> </div>
</div>
<h2 id="syntax">Syntax</h2>
<div class="section-content"><div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="8Zab3uFyuFTD9nPOL/xp/0PiezWTstL0JUlMej23b/c=" data-language="js"><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animationFrameCallback<span class="token punctuation">)</span>
</pre>
</div></div>
<h3 id="parameters">Parameters</h3>
<div class="section-content"><dl> <dt id="animationframecallback"><a href="#animationframecallback"><code>animationFrameCallback</code></a></dt> <dd> <p> A function which is called before the next repaint in order to allow you to update and render the XR scene based on elapsed time, animation, user input changes, and so forth. The callback receives as input two parameters: </p> <dl> <dt id="time"><a href="#time"><code>time</code></a></dt> <dd> <p> A <a href="../domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> indicating the time offset at which the updated viewer state was received from the WebXR device. </p> </dd> <dt id="xrframe"><a href="#xrframe"><code>xrFrame</code></a></dt> <dd> <p> An <a href="../xrframe"><code>XRFrame</code></a> object describing the state of the objects being tracked by the session. This can be used to obtain the poses of the viewer and the scene itself, as well as other information needed to render a frame of an AR or VR scene. </p> </dd> </dl> </dd> </dl></div>
<h3 id="return_value">Return value</h3>
<div class="section-content"><p> An integer value which serves as a unique, non-zero ID or handle you may pass to <a href="cancelanimationframe"><code>cancelAnimationFrame()</code></a> if you need to remove the pending animation frame request. </p></div>
<h2 id="examples">Examples</h2>
<div class="section-content">
<p> The following example requests <code>XRSession</code> with "inline" mode so that it can be displayed in an HTML element (without the need for a separate AR or VR device). </p> <div class="notecard note" id="sect3"> <p> <strong>Note:</strong> A real application should check that the device and the User Agent support WebXR API at all and then that they both support the desired session type via <a href="../xrsystem/issessionsupported"><code>XRSystem.isSessionSupported()</code></a>. </p> </div> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="rpFTsXRWkPScYTMNVu3pF8STzPmV8HaU+D8i9GPeujg=" data-language="js"><span class="token comment">// Obtain XR object</span>
<span class="token keyword">const</span> <span class="token constant">XR</span> <span class="token operator">=</span> navigator<span class="token punctuation">.</span>xr<span class="token punctuation">;</span>

<span class="token comment">// Request a new XRSession</span>
<span class="token constant">XR</span><span class="token punctuation">.</span><span class="token function">requestSession</span><span class="token punctuation">(</span><span class="token string">"inline"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">xrSession</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  xrSession<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> xrFrame</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> viewer <span class="token operator">=</span> xrFrame<span class="token punctuation">.</span><span class="token function">getViewerPose</span><span class="token punctuation">(</span>xrReferenceSpace<span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>xrWebGLLayer<span class="token punctuation">.</span>framebuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> xrView <span class="token keyword">of</span> viewer<span class="token punctuation">.</span>views<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> xrViewport <span class="token operator">=</span> xrWebGLLayer<span class="token punctuation">.</span><span class="token function">getViewport</span><span class="token punctuation">(</span>xrView<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span>
        xrViewport<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
        xrViewport<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
        xrViewport<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
        xrViewport<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// WebGL draw calls will now be rendered into the appropriate viewport.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
</div> <p> The following example was taken directly from the spec draft. This example demonstrates a design pattern that ensures seamless transition between non-immersive animations created via <a href="../window/requestanimationframe"><code>Window.requestAnimationFrame</code></a> and immersive XR animations. </p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="d3tyW9i1dSUJFHk6pfsU4N+D13tiyqXMB3ut/vJD4UY=" data-language="js"><span class="token keyword">let</span> xrSession <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">onWindowAnimationFrame</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>onWindowAnimationFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// This may be called while an immersive session is running on some devices,</span>
  <span class="token comment">// such as a desktop with a tethered headset. To prevent two loops from</span>
  <span class="token comment">// rendering in parallel, skip drawing in this one until the session ends.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>xrSession<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">renderFrame</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// The window animation loop can be started immediately upon the page loading.</span>
window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>onWindowAnimationFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">onXRAnimationFrame</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> xrFrame</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  xrSession<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>onXRAnimationFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">renderFrame</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> xrFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">renderFrame</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> xrFrame</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Shared rendering logic.</span>
<span class="token punctuation">}</span>

<span class="token comment">// Assumed to be called by a user gesture event elsewhere in code.</span>
<span class="token keyword">function</span> <span class="token function">startXRSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  navigator<span class="token punctuation">.</span>xr<span class="token punctuation">.</span><span class="token function">requestSession</span><span class="token punctuation">(</span><span class="token string">"immersive-vr"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">session</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    xrSession <span class="token operator">=</span> session<span class="token punctuation">;</span>
    xrSession<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"end"</span><span class="token punctuation">,</span> onXRSessionEnded<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Do necessary session setup here.</span>
    <span class="token comment">// Begin the session's animation loop.</span>
    xrSession<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>onXRAnimationFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">onXRSessionEnded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  xrSession <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre>
</div>
</div>
<h2 id="specifications">Specifications</h2>
<div class="_table"><table class="standard-table">
<thead><tr><th scope="col">Specification</th></tr></thead>
<tbody><tr><td><a href="https://immersive-web.github.io/webxr/#dom-xrsession-requestanimationframe">WebXR Device API <br><small># dom-xrsession-requestanimationframe</small></a></td></tr></tbody>
</table></div>
<h2 id="browser_compatibility">Browser compatibility</h2>
<div class="_table"><table>
<thead>
<tr id="bct-browser-type">
<th></th>
<th colspan="6">Desktop</th>
<th colspan="6">Mobile</th>
</tr>
<tr id="bct-browsers">
<th></th>
<th>Chrome</th>
<th>Edge</th>
<th>Firefox</th>
<th>Internet Explorer</th>
<th>Opera</th>
<th>Safari</th>
<th>WebView Android</th>
<th>Chrome Android</th>
<th>Firefox for Android</th>
<th>Opera Android</th>
<th>Safari on IOS</th>
<th>Samsung Internet</th>
</tr>
</thead>
<tbody><tr>
<th><code>requestAnimationFrame</code></th>
<td class="bc-supports-yes">79</td>
<td class="bc-supports-yes">79</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">66</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">79</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">57</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">11.2</td>
</tr></tbody>
</table></div>
<h2 id="see_also">See also</h2>
<div class="section-content"><ul> <li><a href="../window/requestanimationframe"><code>Window.requestAnimationFrame()</code></a></li> <li><a href="cancelanimationframe"><code>XRSession.cancelAnimationFrame()</code></a></li> </ul></div>
<div class="_attribution">
  <p class="_attribution-p">
    © 2005–2023 MDN contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/XRSession/requestAnimationFrame" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/XRSession/requestAnimationFrame</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
