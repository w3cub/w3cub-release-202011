
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Web Audio API&#58; Simple Synth - Web APIs - W3cubDocs</title>
  
  <meta name="description" content="This article presents the code and working demo of a video keyboard you can play using the mouse. The keyboard allows you to switch among the &hellip;">
  <meta name="keywords" content="example, and, tutorial, simple, synth, keyboard, web, audio, api, apis, dom">
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/dom/web_audio_api/simple_synth.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-9c7b0d969c0ce639a6c01c2badcdd81667c7c66206aa3d0fccc5cb0585fb1b912dab72ea882101d18010680927514b4b77b107282db8f756fbf63301fe9c88b0.css">
  <script type="text/javascript" src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js"></script>
  <script src="/json/dom.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/dom/" class="_nav-link" title="" style="margin-left:0;">Web APIs</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _mdn">
				
				
<h1>Example and tutorial: Simple synth keyboard</h1>
<div class="section-content">
<p>This article presents the code and working demo of a video keyboard you can play using the mouse. The keyboard allows you to switch among the standard waveforms as well as one custom waveform, and you can control the main gain using a volume slider beneath the keyboard. This example makes use of the following Web API interfaces: <a href="../audiocontext"><code>AudioContext</code></a>, <a href="../oscillatornode"><code>OscillatorNode</code></a>, <a href="../periodicwave"><code>PeriodicWave</code></a>, and <a href="../gainnode"><code>GainNode</code></a>.</p> <p>Because <a href="../oscillatornode"><code>OscillatorNode</code></a> is based on <a href="../audioscheduledsourcenode"><code>AudioScheduledSourceNode</code></a>, this is to some extent an example for that as well.</p>
</div>
<h2 id="the_video_keyboard">The video keyboard</h2>

<h3 id="html">HTML</h3>
<div class="section-content">
<p>There are three primary components to the display for our virtual keyboard. The first is the musical keyboard itself. We draw this in a pair of nested <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/div"><code>&lt;div&gt;</code></a> elements so that we can make the keyboard horizontally scrollable if all the keys don't fit on the screen, without having them wrap around.</p> <h4 id="the_keyboard">The keyboard</h4> <p>First, we create space to build the keyboard into. We will be programmatically constructing the keyboard, because doing so gives us the flexibility to configure each key as we determine the appropriate data for the corresponding note. In our case, we get each key's frequency from a table, but it could be calculated algorithmically as well.</p> <div class="code-example"><pre data-language="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>keyboard<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</pre></div> <p>The <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/div"><code>&lt;div&gt;</code></a> named <code>"container"</code> is the scrollable box that lets the keyboard be scrolled horizontally if it's too wide for the available space. The keys themselves will be inserted into the block of class <code>"keyboard"</code>.</p> <h4 id="the_settings_bar">The settings bar</h4> <p>Beneath the keyboard, we'll put some controls for configuring the layer. For now, we will have two controls: one to set the main volume and another to select what periodic waveform to use when generating notes.</p> <h5 id="the_volume_control">The volume control</h5> <p>First we create the <code>&lt;div&gt;</code> to contain the settings bar, so it can be styled as needed. Then we establish a box that will be presented on the left side of the bar and place a label and an <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input"><code>&lt;input&gt;</code></a> element of type <code>"range"</code>. The range element will typically be presented as a slider control; we configure it to allow any value between 0.0 and 1.0, stepping by 0.01 each position.</p> <div class="code-example"><pre data-language="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>settingsBar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>left<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>Volume: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span>
      <span class="token attr-name">min</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.0<span class="token punctuation">"</span></span>
      <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.0<span class="token punctuation">"</span></span>
      <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.01<span class="token punctuation">"</span></span>
      <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.5<span class="token punctuation">"</span></span>
      <span class="token attr-name">list</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>volumes<span class="token punctuation">"</span></span>
      <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>volume<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>datalist</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>volumes<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.0<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Mute<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.0<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>datalist</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</pre></div> <p>We specify a default value of 0.5, and we provide a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/datalist"><code>&lt;datalist&gt;</code></a> element which is connected to the range using the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes#name"><code>name</code></a> attribute to find an option list whose ID matches; in this case, the data set is named <code>"volume"</code>. This lets us provide a set of common values and special strings which the browser may optionally choose to display in some fashion; we provide names for the values 0.0 ("Mute") and 1.0 ("100%").</p> <h5 id="the_waveform_picker">The waveform picker</h5> <p>On the right side of the settings bar, we place a label and a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/select"><code>&lt;select&gt;</code></a> element named <code>"waveform"</code> whose options correspond to the available waveforms.</p> <div class="code-example"><pre data-language="html">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>right<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>Current waveform: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>waveform<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sine<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Sine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>square<span class="token punctuation">"</span></span> <span class="token attr-name">selected</span><span class="token punctuation">&gt;</span></span>Square<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sawtooth<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Sawtooth<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>triangle<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Triangle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>custom<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Custom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</pre></div>
</div>
<h3 id="css">CSS</h3>
<div class="section-content"><div class="code-example"><pre data-language="css"><span class="token selector">.container</span> <span class="token punctuation">{</span>
  <span class="token property">overflow-x</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
  <span class="token property">overflow-y</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 660px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 110px<span class="token punctuation">;</span>
  <span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.keyboard</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.key</span> <span class="token punctuation">{</span>
  <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
  <span class="token property">font</span><span class="token punctuation">:</span> 16px <span class="token string">"Open Sans"</span><span class="token punctuation">,</span> <span class="token string">"Lucida Grande"</span><span class="token punctuation">,</span> <span class="token string">"Arial"</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid black<span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 80px<span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">box-shadow</span><span class="token punctuation">:</span> 2px 2px darkgray<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> 3px<span class="token punctuation">;</span>
  <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">-moz-user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">-webkit-user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">-ms-user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.key div</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.key div sub</span> <span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.key:hover</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #eef<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.key:active,
.active</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #000<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.octave</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 0 6px 0 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.settingsBar</span> <span class="token punctuation">{</span>
  <span class="token property">padding-top</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>
  <span class="token property">font</span><span class="token punctuation">:</span> 14px <span class="token string">"Open Sans"</span><span class="token punctuation">,</span> <span class="token string">"Lucida Grande"</span><span class="token punctuation">,</span> <span class="token string">"Arial"</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
  <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.left</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> table-cell<span class="token punctuation">;</span>
  <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.left span,
.left input</span> <span class="token punctuation">{</span>
  <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.right</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> table-cell<span class="token punctuation">;</span>
  <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.right span</span> <span class="token punctuation">{</span>
  <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.right input</span> <span class="token punctuation">{</span>
  <span class="token property">vertical-align</span><span class="token punctuation">:</span> baseline<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre></div></div>
<h3 id="javascript">JavaScript</h3>
<div class="section-content">
<p>The JavaScript code begins by initializing a number of variables.</p> <div class="code-example"><pre data-language="js"><span class="token keyword">const</span> audioContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> oscList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> mainGainNode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</pre></div> <ol> <li>
<code>audioContext</code> is set to reference the global <a href="../audiocontext"><code>AudioContext</code></a> object (or <code>webkitAudioContext</code> if necessary).</li> <li>
<code>oscList</code> is set up to be ready to contain a list of all currently-playing oscillators. It starts off empty, since there are none playing yet.</li> <li>
<code>mainGainNode</code> is set to null; during the setup process, it will be configured to contain a <a href="../gainnode"><code>GainNode</code></a> which all playing oscillators will connect to and play through to allow the overall volume to be controlled using a single slider control.</li> </ol> <div class="code-example"><pre data-language="js"><span class="token keyword">const</span> keyboard <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".keyboard"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> wavePicker <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"select[name='waveform']"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> volumeControl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"input[name='volume']"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div> <p>References to elements we'll need access to are obtained:</p> <ul> <li>
<code>keyboard</code> is the container element into which the keys will be placed.</li> <li>
<code>wavePicker</code> is the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/select"><code>&lt;select&gt;</code></a> element used to choose the waveform to use for the notes.</li> <li>
<code>volumeControl</code> is the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input"><code>&lt;input&gt;</code></a> element (of type <code>"range"</code>) used to control the main audio volume.</li> </ul> <div class="code-example"><pre data-language="js"><span class="token keyword">let</span> noteFreq <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> customWaveform <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> sineTerms <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> cosineTerms <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</pre></div> <p>Finally, global variables that will be used when constructing waveforms are created:</p> <ul> <li>
<code>noteFreq</code> will be an array of arrays; each array represents one octave, each of which contains one entry for each note in that octave. The value for each is the frequency, in Hertz, of the note's tone.</li> <li>
<code>customWaveform</code> will be set up as a <a href="../periodicwave"><code>PeriodicWave</code></a> describing the waveform to use when the user selects "Custom" from the waveform picker.</li> <li>
<code>sineTerms</code> and <code>cosineTerms</code> will be used to store the data for generating the waveform; each will contain an array that's generated when the user chooses "Custom".</li> </ul>
</div>
<h3 id="creating_the_note_table">Creating the note table</h3>
<div class="section-content">
<p>The <code>createNoteTable()</code> function builds the array <code>noteFreq</code> to contain an array of objects representing each octave. Each octave, in turn, has one named property for each note in that octave; the property's name is the note's name (such as "C#" to represent C-sharp), and the value is the frequency, in Hertz, of that note.</p> <div class="code-example"><pre data-language="js"><span class="token keyword">function</span> <span class="token function">createNoteTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> noteFreq <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    noteFreq<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  noteFreq<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"A"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">27.500000000000000</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"A#"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">29.135235094880619</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"B"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">30.867706328507756</span><span class="token punctuation">;</span>

  noteFreq<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">32.703195662574829</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"C#"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">34.647828872109012</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"D"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">36.708095989675945</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"D#"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">38.890872965260113</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"E"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">41.203444614108741</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"F"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">43.653528929125485</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"F#"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">46.249302838954299</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"G"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">48.999429497718661</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"G#"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">51.913087197493142</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"A"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">55.000000000000000</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"A#"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">58.270470189761239</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"B"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">61.735412657015513</span><span class="token punctuation">;</span>
  <span class="token comment">// …</span>
</pre></div> <p>Several octaves not shown for brevity.</p>  <div class="code-example"><pre data-language="js">  noteFreq<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2093.004522404789077</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"C#"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2217.461047814976769</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"D"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2349.318143339260482</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"D#"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2489.015869776647285</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"E"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2637.020455302959437</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"F"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2793.825851464031075</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"F#"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2959.955381693075191</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"G"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3135.963487853994352</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"G#"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3322.437580639561108</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"A"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3520.000000000000000</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"A#"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3729.310092144719331</span><span class="token punctuation">;</span>
  noteFreq<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"B"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3951.066410048992894</span><span class="token punctuation">;</span>

  noteFreq<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4186.009044809578154</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> noteFreq<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre></div> <p>The result is an array, <code>noteFreq</code>, with an object for each octave. Each octave object has named properties in it where the property name is the name of the note (such as "C#" to represent C-sharp) and the property's value is the note's frequency in Hertz. In part, the resulting object looks like this:</p> <figure class="table-container"><div class="_table"><table class="standard-table"> <tbody> <tr> <th scope="row">Octave</th> <td colspan="8">Notes</td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <th scope="row">0</th> <td>"A" ⇒ 27.5</td> <td>"A#" ⇒ 29.14</td> <td>"B" ⇒ 30.87</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <th scope="row">1</th> <td>"C" ⇒ 32.70</td> <td>"C#" ⇒ 34.65</td> <td>"D" ⇒ 36.71</td> <td>"D#" ⇒ 38.89</td> <td>"E" ⇒ 41.20</td> <td>"F" ⇒ 43.65</td> <td>"F#" ⇒ 46.25</td> <td>"G" ⇒ 49</td> <td>"G#" ⇒ 51.9</td> <td>"A" ⇒ 55</td> <td>"A#" ⇒ 58.27</td> <td>"B" ⇒ 61.74</td> </tr> <tr> <th scope="row">2</th> <td colspan="12">. . .</td> </tr> </tbody> </table></div></figure> <p>With this table in place, we can find out the frequency for a given note in a particular octave quite easily. If we want the frequency for the note G# in octave 1, we use <code>noteFreq[1]["G#"]</code> and get the value 51.9 as a result.</p> <div class="notecard note" id="sect1"> <p><strong>Note:</strong> The values in the example table above have been rounded to two decimal places.</p> </div> 
</div>
<h3 id="building_the_keyboard">Building the keyboard</h3>
<div class="section-content">
<p>The <code>setup()</code> function is responsible for building the keyboard and preparing the app to play music.</p> <div class="code-example"><pre data-language="js"><span class="token keyword">function</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  noteFreq <span class="token operator">=</span> <span class="token function">createNoteTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  volumeControl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"change"</span><span class="token punctuation">,</span> changeVolume<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  mainGainNode <span class="token operator">=</span> audioContext<span class="token punctuation">.</span><span class="token function">createGain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mainGainNode<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>audioContext<span class="token punctuation">.</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
  mainGainNode<span class="token punctuation">.</span>gain<span class="token punctuation">.</span>value <span class="token operator">=</span> volumeControl<span class="token punctuation">.</span>value<span class="token punctuation">;</span>

  <span class="token comment">// Create the keys; skip any that are sharp or flat; for</span>
  <span class="token comment">// our purposes we don't need them. Each octave is inserted</span>
  <span class="token comment">// into a &lt;div&gt; of class "octave".</span>

  noteFreq<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">keys<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> keyList <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> octaveElem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    octaveElem<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">"octave"</span><span class="token punctuation">;</span>

    keyList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        octaveElem<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">createKey</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> idx<span class="token punctuation">,</span> key<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    keyboard<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>octaveElem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  document
    <span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"div[data-note='B'][data-octave='5']"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  sineTerms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cosineTerms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>sineTerms<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  customWaveform <span class="token operator">=</span> audioContext<span class="token punctuation">.</span><span class="token function">createPeriodicWave</span><span class="token punctuation">(</span>cosineTerms<span class="token punctuation">,</span> sineTerms<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    oscList<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div> <ol> <li>The table which maps note names and octaves to their frequencies is created by calling <code>createNoteTable()</code>.</li> <li>An event handler is established (by calling our old friend <a href="../eventtarget/addeventlistener"><code>addEventListener()</code></a> to handle <a href="../htmlelement/change_event"><code>change</code></a> events on the main gain control. This will update the main gain node's volume to the new value of the control.</li> <li>Next, we iterate over each octave in the note frequencies table. For each octave, we use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries"><code>Object.entries()</code></a> to get a list of the notes in that octave.</li> <li>Create a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/div"><code>&lt;div&gt;</code></a> to contain that octave's notes (so we can have a small bit of space drawn between octaves), and set its class name to "octave"</li> <li>For each key in the octave, we check to see if the note's name has more than one character. We skip these, because we're leaving out the sharp notes in this example. If the note's name is only one character, then we call <code>createKey()</code>, specifying the note string, octave, and frequency. The returned element is appended to the octave element created in step 4.</li> <li>When each octave element has been built, it's appended to the keyboard.</li> <li>Once the keyboard has been constructed, we scroll the note "B" in octave 5 into view; this has the effect of ensuring that middle-C is visible along with its surrounding keys.</li> <li>Then a new custom waveform is built using <a href="../baseaudiocontext/createperiodicwave"><code>BaseAudioContext.createPeriodicWave()</code></a>. This waveform will be used any time the user selects "Custom" from the waveform picker control.</li> <li>Finally, the oscillator list is initialized to ensure that it's ready to receive information identifying which oscillators are associated with which keys.</li> </ol> <h4 id="creating_a_key">Creating a key</h4> <p>The <code>createKey()</code> function is called once for each key that we want to present in the virtual keyboard. It creates the elements that comprise the key and its label, adds some data attributes to the element for later use, and assigns event handlers for the events we care about.</p> <div class="code-example"><pre data-language="js"><span class="token keyword">function</span> <span class="token function">createKey</span><span class="token punctuation">(</span><span class="token parameter">note<span class="token punctuation">,</span> octave<span class="token punctuation">,</span> freq</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> keyElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> labelElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  keyElement<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">"key"</span><span class="token punctuation">;</span>
  keyElement<span class="token punctuation">.</span>dataset<span class="token punctuation">[</span><span class="token string">"octave"</span><span class="token punctuation">]</span> <span class="token operator">=</span> octave<span class="token punctuation">;</span>
  keyElement<span class="token punctuation">.</span>dataset<span class="token punctuation">[</span><span class="token string">"note"</span><span class="token punctuation">]</span> <span class="token operator">=</span> note<span class="token punctuation">;</span>
  keyElement<span class="token punctuation">.</span>dataset<span class="token punctuation">[</span><span class="token string">"frequency"</span><span class="token punctuation">]</span> <span class="token operator">=</span> freq<span class="token punctuation">;</span>

  labelElement<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>note<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;sub&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>octave<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/sub&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  keyElement<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>labelElement<span class="token punctuation">)</span><span class="token punctuation">;</span>

  keyElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousedown"</span><span class="token punctuation">,</span> notePressed<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  keyElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseup"</span><span class="token punctuation">,</span> noteReleased<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  keyElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseover"</span><span class="token punctuation">,</span> notePressed<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  keyElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseleave"</span><span class="token punctuation">,</span> noteReleased<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> keyElement<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre></div> <p>After creating the elements that will represent the key and its label, we configure the key's element by setting its class to "key" (which establishes its appearance). Then we add <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes#data-*"><code>data-*</code></a> attributes which contain the key's octave (attribute <code>data-octave</code>), string representing the note to play (attribute <code>data-note</code>), and frequency (attribute <code>data-frequency</code>) in Hertz. This will let us easily fetch that information as needed when handling events.</p>
</div>
<h3 id="making_music">Making music</h3>
<div class="section-content">
<h4 id="playing_a_tone">Playing a tone</h4> <p>The <code>playTone()</code> function's job is to play a tone at the given frequency. This will be used by the handler for events triggering keys on the keyboard to start playing the appropriate notes.</p> <div class="code-example"><pre data-language="js"><span class="token keyword">function</span> <span class="token function">playTone</span><span class="token punctuation">(</span><span class="token parameter">freq</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> osc <span class="token operator">=</span> audioContext<span class="token punctuation">.</span><span class="token function">createOscillator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  osc<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>mainGainNode<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> type <span class="token operator">=</span> wavePicker<span class="token punctuation">.</span>options<span class="token punctuation">[</span>wavePicker<span class="token punctuation">.</span>selectedIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">"custom"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    osc<span class="token punctuation">.</span><span class="token function">setPeriodicWave</span><span class="token punctuation">(</span>customWaveform<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    osc<span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  osc<span class="token punctuation">.</span>frequency<span class="token punctuation">.</span>value <span class="token operator">=</span> freq<span class="token punctuation">;</span>
  osc<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> osc<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre></div> <p><code>playTone()</code> begins by creating a new <a href="../oscillatornode"><code>OscillatorNode</code></a> by calling the <a href="../baseaudiocontext/createoscillator"><code>BaseAudioContext.createOscillator()</code></a> method. We then connect it to the main gain node by calling the new oscillator's <a href="../audionode/connect"><code>connect()</code></a> method;, which tells the oscillator where to send its output to. By doing this, changing the gain of the main gain node will affect the volume of all tones being generated.</p> <p>Then we get the type of waveform to use by checking the value of the waveform picker control in the settings bar. If the user has it set to <code>"custom"</code>, we call <a href="../oscillatornode/setperiodicwave"><code>OscillatorNode.setPeriodicWave()</code></a> to configure the oscillator to use our custom waveform. Doing this automatically sets the oscillator's <a href="../oscillatornode/type"><code>type</code></a> to <code>custom</code>. If any other waveform type is selected in the wave picker, we set the oscillator's type to the value of the picker; that value will be one of <code>sine</code>, <code>square</code>, <code>triangle</code>, and <code>sawtooth</code>.</p> <p>The oscillator's frequency is set to the value specified in the <code>freq</code> parameter by setting the value of the <a href="../oscillatornode/frequency"><code>OscillatorNode.frequency</code></a> <a href="../audioparam"><code>AudioParam</code></a> object. Then, at last, the oscillator is started up so that it begins to produce sound by calling the oscillator's inherited <a href="../audioscheduledsourcenode/start"><code>AudioScheduledSourceNode.start()</code></a> method.</p> <h4 id="playing_a_note">Playing a note</h4> <p>When the <a href="../element/mousedown_event"><code>mousedown</code></a> or <a href="../element/mouseover_event"><code>mouseover</code></a> event occurs on a key, we want to start playing the corresponding note. The <code>notePressed()</code> function is used as the event handler for these events.</p> <div class="code-example"><pre data-language="js"><span class="token keyword">function</span> <span class="token function">notePressed</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>buttons <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dataset <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>dataset<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dataset<span class="token punctuation">[</span><span class="token string">"pressed"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> octave <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>dataset<span class="token punctuation">[</span><span class="token string">"octave"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      oscList<span class="token punctuation">[</span>octave<span class="token punctuation">]</span><span class="token punctuation">[</span>dataset<span class="token punctuation">[</span><span class="token string">"note"</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">playTone</span><span class="token punctuation">(</span>dataset<span class="token punctuation">[</span><span class="token string">"frequency"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      dataset<span class="token punctuation">[</span><span class="token string">"pressed"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"yes"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></div> <p>We start by checking whether the primary mouse button is pressed, for two reasons. First, we want to only allow the primary mouse button to trigger notes playing. Second, and more importantly, we are using this to handle <a href="../element/mouseover_event"><code>mouseover</code></a> for cases where the user is dragging from note to note, and we only want to start playing the note if the mouse is pressed when it enters the element.</p> <p>If the mouse button is in fact down, we get the pressed key's <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes#dataset"><code>dataset</code></a> attribute; this makes it easy to access the custom data attributes on the element. We look for a <code>data-pressed</code> attribute; if there isn't one (which indicates that the note isn't already playing), we call <code>playTone()</code> to start playing the note, passing in the value of the element's <code>data-frequency</code> attribute. The returned oscillator is stored into <code>oscList</code> for future reference, and <code>data-pressed</code> is set to <code>yes</code> to indicate that the note is playing so we don't start it again next time this is called.</p> <h4 id="stopping_a_tone">Stopping a tone</h4> <p>The <code>noteReleased()</code> function is the event handler called when the user releases the mouse button or moves the mouse out of the key that's currently playing.</p> <div class="code-example"><pre data-language="js"><span class="token keyword">function</span> <span class="token function">noteReleased</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dataset <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>dataset<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>dataset <span class="token operator">&amp;&amp;</span> dataset<span class="token punctuation">[</span><span class="token string">"pressed"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> octave <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>dataset<span class="token punctuation">[</span><span class="token string">"octave"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    oscList<span class="token punctuation">[</span>octave<span class="token punctuation">]</span><span class="token punctuation">[</span>dataset<span class="token punctuation">[</span><span class="token string">"note"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span> oscList<span class="token punctuation">[</span>octave<span class="token punctuation">]</span><span class="token punctuation">[</span>dataset<span class="token punctuation">[</span><span class="token string">"note"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span> dataset<span class="token punctuation">[</span><span class="token string">"pressed"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></div> <p><code>noteReleased()</code> uses the <code>data-octave</code> and <code>data-note</code> custom attributes to look up the key's oscillator, then calls the oscillator's inherited <a href="../audioscheduledsourcenode/stop"><code>stop()</code></a> method to stop playing the note. Finally, the <code>oscList</code> entry for the note is cleared and the <code>data-pressed</code> attribute is removed from the key element (as identified by <a href="../event/target"><code>event.target</code></a>), to indicate that the note is not currently playing.</p> <h4 id="changing_the_main_volume">Changing the main volume</h4> <p>The volume slider in the settings bar provides a simple interface to change the gain value on the main gain node, thereby changing the loudness of all playing notes. The <code>changeVolume()</code> method is the handler for the <a href="../htmlelement/change_event"><code>change</code></a> event on the slider.</p> <div class="code-example"><pre data-language="js"><span class="token keyword">function</span> <span class="token function">changeVolume</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  mainGainNode<span class="token punctuation">.</span>gain<span class="token punctuation">.</span>value <span class="token operator">=</span> volumeControl<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre></div> <p>This sets the value of the main gain node's <code>gain</code> <a href="../audioparam"><code>AudioParam</code></a> to the slider's new value.</p> <h4 id="keyboard_support">Keyboard support</h4> <p>The code below adds <a href="../element/keydown_event"><code>keydown</code></a> and <a href="../element/keyup_event"><code>keyup</code></a> event listeners to handle keyboard input. The <code>keydown</code> event handler calls <code>notePressed()</code> to start playing the note corresponding to the key that was pressed, and the <code>keyup</code> event handler calls <code>noteReleased()</code> to stop playing the note corresponding to the key that was released.</p> <div class="code-example"><pre data-language="js"><span class="token keyword">const</span> synthKeys <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".key"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> keyCodes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">"Space"</span><span class="token punctuation">,</span>
  <span class="token string">"ShiftLeft"</span><span class="token punctuation">,</span> <span class="token string">"KeyZ"</span><span class="token punctuation">,</span> <span class="token string">"KeyX"</span><span class="token punctuation">,</span> <span class="token string">"KeyC"</span><span class="token punctuation">,</span> <span class="token string">"KeyV"</span><span class="token punctuation">,</span> <span class="token string">"KeyB"</span><span class="token punctuation">,</span> <span class="token string">"KeyN"</span><span class="token punctuation">,</span> <span class="token string">"KeyM"</span><span class="token punctuation">,</span> <span class="token string">"Comma"</span><span class="token punctuation">,</span> <span class="token string">"Period"</span><span class="token punctuation">,</span> <span class="token string">"Slash"</span><span class="token punctuation">,</span> <span class="token string">"ShiftRight"</span><span class="token punctuation">,</span>
  <span class="token string">"KeyA"</span><span class="token punctuation">,</span> <span class="token string">"KeyS"</span><span class="token punctuation">,</span> <span class="token string">"KeyD"</span><span class="token punctuation">,</span> <span class="token string">"KeyF"</span><span class="token punctuation">,</span> <span class="token string">"KeyG"</span><span class="token punctuation">,</span> <span class="token string">"KeyH"</span><span class="token punctuation">,</span> <span class="token string">"KeyJ"</span><span class="token punctuation">,</span> <span class="token string">"KeyK"</span><span class="token punctuation">,</span> <span class="token string">"KeyL"</span><span class="token punctuation">,</span> <span class="token string">"Semicolon"</span><span class="token punctuation">,</span> <span class="token string">"Quote"</span><span class="token punctuation">,</span> <span class="token string">"Enter"</span><span class="token punctuation">,</span>
  <span class="token string">"Tab"</span><span class="token punctuation">,</span> <span class="token string">"KeyQ"</span><span class="token punctuation">,</span> <span class="token string">"KeyW"</span><span class="token punctuation">,</span> <span class="token string">"KeyE"</span><span class="token punctuation">,</span> <span class="token string">"KeyR"</span><span class="token punctuation">,</span> <span class="token string">"KeyT"</span><span class="token punctuation">,</span> <span class="token string">"KeyY"</span><span class="token punctuation">,</span> <span class="token string">"KeyU"</span><span class="token punctuation">,</span> <span class="token string">"KeyI"</span><span class="token punctuation">,</span> <span class="token string">"KeyO"</span><span class="token punctuation">,</span> <span class="token string">"KeyP"</span><span class="token punctuation">,</span> <span class="token string">"BracketLeft"</span><span class="token punctuation">,</span> <span class="token string">"BracketRight"</span><span class="token punctuation">,</span>
  <span class="token string">"Digit1"</span><span class="token punctuation">,</span> <span class="token string">"Digit2"</span><span class="token punctuation">,</span> <span class="token string">"Digit3"</span><span class="token punctuation">,</span> <span class="token string">"Digit4"</span><span class="token punctuation">,</span> <span class="token string">"Digit5"</span><span class="token punctuation">,</span> <span class="token string">"Digit6"</span><span class="token punctuation">,</span> <span class="token string">"Digit7"</span><span class="token punctuation">,</span> <span class="token string">"Digit8"</span><span class="token punctuation">,</span> <span class="token string">"Digit9"</span><span class="token punctuation">,</span> <span class="token string">"Digit0"</span><span class="token punctuation">,</span> <span class="token string">"Minus"</span><span class="token punctuation">,</span> <span class="token string">"Equal"</span><span class="token punctuation">,</span> <span class="token string">"Backspace"</span><span class="token punctuation">,</span>
  <span class="token string">"Escape"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">keyNote</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> elKey <span class="token operator">=</span> synthKeys<span class="token punctuation">[</span>keyCodes<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>elKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"keydown"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      elKey<span class="token punctuation">.</span>tabIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      elKey<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      elKey<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"active"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">notePressed</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">buttons</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">target</span><span class="token operator">:</span> elKey <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      elKey<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"active"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">noteReleased</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">buttons</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">target</span><span class="token operator">:</span> elKey <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"keydown"</span><span class="token punctuation">,</span> keyNote<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"keyup"</span><span class="token punctuation">,</span> keyNote<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div>
</div>
<h3 id="result">Result</h3>
<div class="section-content">
<p>Put all together, the result is a simple but working point-and-click musical keyboard:</p>
<iframe class="sample-code-frame" title="The video keyboard sample" id="frame_the_video_keyboard" width="680" height="200" src="https://live-samples.mdn.mozilla.net/en-US/docs/Web/API/Web_Audio_API/Simple_synth/_sample_.the_video_keyboard.html" loading="lazy"></iframe>
</div>
<h2 id="see_also">See also</h2>
<div class="section-content"><ul> <li><a href="../web_audio_api">Web Audio API</a></li> <li><a href="../oscillatornode"><code>OscillatorNode</code></a></li> <li><a href="../gainnode"><code>GainNode</code></a></li> <li><a href="../audiocontext"><code>AudioContext</code></a></li> </ul></div>
<div class="_attribution">
  <p class="_attribution-p">
    © 2005–2023 MDN contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Simple_synth" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Simple_synth</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
