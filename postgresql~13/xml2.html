
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Xml2 - PostgreSQL 13 - W3cubDocs</title>
  
  <meta name="description" content=" The xml2 module provides XPath querying and XSLT functionality. ">
  <meta name="keywords" content="f, xml, postgresql, postgresql~13">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/postgresql~13/xml2.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/postgresql~13.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/postgresql~13/" class="_nav-link" title="" style="margin-left:0;">PostgreSQL 13</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _postgres">
				
				
<h1>F.45. xml2</h1>    <div class="toc"> <dl class="toc"> <dt><a href="xml2#id-1.11.7.54.4">F.45.1. Deprecation Notice</a></dt> <dt><a href="xml2#id-1.11.7.54.5">F.45.2. Description of Functions</a></dt> <dt><a href="xml2#id-1.11.7.54.6">F.45.3. <code class="literal">xpath_table</code></a></dt> <dt><a href="xml2#id-1.11.7.54.7">F.45.4. XSLT Functions</a></dt> <dt><a href="xml2#id-1.11.7.54.8">F.45.5. Author</a></dt> </dl> </div> <p>The <code class="filename">xml2</code> module provides XPath querying and XSLT functionality.</p> <div class="sect2" id="id-1.11.7.54.4">    <h2 class="title">F.45.1. Deprecation Notice</h2>    <p>From PostgreSQL 8.3 on, there is XML-related functionality based on the SQL/XML standard in the core server. That functionality covers XML syntax checking and XPath queries, which is what this module does, and more, but the API is not at all compatible. It is planned that this module will be removed in a future version of PostgreSQL in favor of the newer standard API, so you are encouraged to try converting your applications. If you find that some of the functionality of this module is not available in an adequate form with the newer API, please explain your issue to <code class="email">&lt;<a class="email" href="mailto:pgsql-hackers@lists.postgresql.org">pgsql-hackers@lists.postgresql.org</a>&gt;</code> so that the deficiency can be addressed.</p> </div> <div class="sect2" id="id-1.11.7.54.5">    <h2 class="title">F.45.2. Description of Functions</h2>    <p><a class="xref" href="xml2#XML2-FUNCTIONS-TABLE" title="Table F.34. xml2 Functions">Table F.34</a> shows the functions provided by this module. These functions provide straightforward XML parsing and XPath queries.</p> <div class="table" id="XML2-FUNCTIONS-TABLE"> <p class="title"><strong>Table F.34. <code class="filename">xml2</code> Functions</strong></p> <div class="table-contents"> <table class="table" summary="xml2 Functions"> <colgroup> <col> </colgroup> <thead> <tr> <th class="func_table_entry"> <p class="func_signature">Function</p> <p>Description</p> </th> </tr> </thead> <tbody> <tr> <td class="func_table_entry"> <p class="func_signature"><code class="function">xml_valid</code> ( <em class="parameter"><code>document</code></em> <code class="type">text</code> ) → <code class="returnvalue">boolean</code></p> <p>Parses the given document and returns true if the document is well-formed XML. (Note: this is an alias for the standard PostgreSQL function <code class="function">xml_is_well_formed()</code>. The name <code class="function">xml_valid()</code> is technically incorrect since validity and well-formedness have different meanings in XML.)</p> </td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature"><code class="function">xpath_string</code> ( <em class="parameter"><code>document</code></em> <code class="type">text</code>, <em class="parameter"><code>query</code></em> <code class="type">text</code> ) → <code class="returnvalue">text</code></p> <p>Evaluates the XPath query on the supplied document, and casts the result to <code class="type">text</code>.</p> </td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature"><code class="function">xpath_number</code> ( <em class="parameter"><code>document</code></em> <code class="type">text</code>, <em class="parameter"><code>query</code></em> <code class="type">text</code> ) → <code class="returnvalue">real</code></p> <p>Evaluates the XPath query on the supplied document, and casts the result to <code class="type">real</code>.</p> </td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature"><code class="function">xpath_bool</code> ( <em class="parameter"><code>document</code></em> <code class="type">text</code>, <em class="parameter"><code>query</code></em> <code class="type">text</code> ) → <code class="returnvalue">boolean</code></p> <p>Evaluates the XPath query on the supplied document, and casts the result to <code class="type">boolean</code>.</p> </td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature"><code class="function">xpath_nodeset</code> ( <em class="parameter"><code>document</code></em> <code class="type">text</code>, <em class="parameter"><code>query</code></em> <code class="type">text</code>, <em class="parameter"><code>toptag</code></em> <code class="type">text</code>, <em class="parameter"><code>itemtag</code></em> <code class="type">text</code> ) → <code class="returnvalue">text</code></p> <p>Evaluates the query on the document and wraps the result in XML tags. If the result is multivalued, the output will look like:</p> <pre data-language="sql">
&lt;toptag&gt;
&lt;itemtag&gt;Value 1 which could be an XML fragment&lt;/itemtag&gt;
&lt;itemtag&gt;Value 2....&lt;/itemtag&gt;
&lt;/toptag&gt;
</pre> <p>If either <em class="parameter"><code>toptag</code></em> or <em class="parameter"><code>itemtag</code></em> is an empty string, the relevant tag is omitted.</p> </td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature"><code class="function">xpath_nodeset</code> ( <em class="parameter"><code>document</code></em> <code class="type">text</code>, <em class="parameter"><code>query</code></em> <code class="type">text</code>, <em class="parameter"><code>itemtag</code></em> <code class="type">text</code> ) → <code class="returnvalue">text</code></p> <p>Like <code class="function">xpath_nodeset(document, query, toptag, itemtag)</code> but result omits <em class="parameter"><code>toptag</code></em>.</p> </td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature"><code class="function">xpath_nodeset</code> ( <em class="parameter"><code>document</code></em> <code class="type">text</code>, <em class="parameter"><code>query</code></em> <code class="type">text</code> ) → <code class="returnvalue">text</code></p> <p>Like <code class="function">xpath_nodeset(document, query, toptag, itemtag)</code> but result omits both tags.</p> </td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature"><code class="function">xpath_list</code> ( <em class="parameter"><code>document</code></em> <code class="type">text</code>, <em class="parameter"><code>query</code></em> <code class="type">text</code>, <em class="parameter"><code>separator</code></em> <code class="type">text</code> ) → <code class="returnvalue">text</code></p> <p>Evaluates the query on the document and returns multiple values separated by the specified separator, for example <code class="literal">Value 1,Value 2,Value 3</code> if <em class="parameter"><code>separator</code></em> is <code class="literal">,</code>.</p> </td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature"><code class="function">xpath_list</code> ( <em class="parameter"><code>document</code></em> <code class="type">text</code>, <em class="parameter"><code>query</code></em> <code class="type">text</code> ) → <code class="returnvalue">text</code></p> <p>This is a wrapper for the above function that uses <code class="literal">,</code> as the separator.</p> </td> </tr> </tbody> </table> </div> </div> </div> <div class="sect2" id="id-1.11.7.54.6.2">    <h2 class="title">F.45.3. <code class="literal">xpath_table</code>
</h2>    <pre data-language="sql">
xpath_table(text key, text document, text relation, text xpaths, text criteria) returns setof record
</pre> <p><code class="function">xpath_table</code> is a table function that evaluates a set of XPath queries on each of a set of documents and returns the results as a table. The primary key field from the original document table is returned as the first column of the result so that the result set can readily be used in joins. The parameters are described in <a class="xref" href="xml2#XML2-XPATH-TABLE-PARAMETERS" title="Table F.35. xpath_table Parameters">Table F.35</a>.</p> <div class="table" id="XML2-XPATH-TABLE-PARAMETERS"> <p class="title"><strong>Table F.35. <code class="function">xpath_table</code> Parameters</strong></p> <div class="table-contents"> <table class="table" summary="xpath_table Parameters"> <colgroup> <col class="col1"> <col class="col2"> </colgroup> <thead> <tr> <th>Parameter</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><em class="parameter"><code>key</code></em></td> <td> <p>the name of the <span class="quote">“<span class="quote">key</span>”</span> field — this is just a field to be used as the first column of the output table, i.e., it identifies the record from which each output row came (see note below about multiple values)</p> </td> </tr> <tr> <td><em class="parameter"><code>document</code></em></td> <td> <p>the name of the field containing the XML document</p> </td> </tr> <tr> <td><em class="parameter"><code>relation</code></em></td> <td> <p>the name of the table or view containing the documents</p> </td> </tr> <tr> <td><em class="parameter"><code>xpaths</code></em></td> <td> <p>one or more XPath expressions, separated by <code class="literal">|</code></p> </td> </tr> <tr> <td><em class="parameter"><code>criteria</code></em></td> <td> <p>the contents of the WHERE clause. This cannot be omitted, so use <code class="literal">true</code> or <code class="literal">1=1</code> if you want to process all the rows in the relation</p> </td> </tr> </tbody> </table> </div> </div> <p>These parameters (except the XPath strings) are just substituted into a plain SQL SELECT statement, so you have some flexibility — the statement is</p> <p><code class="literal">SELECT &lt;key&gt;, &lt;document&gt; FROM &lt;relation&gt; WHERE &lt;criteria&gt;</code></p> <p>so those parameters can be <span class="emphasis"><em>anything</em></span> valid in those particular locations. The result from this SELECT needs to return exactly two columns (which it will unless you try to list multiple fields for key or document). Beware that this simplistic approach requires that you validate any user-supplied values to avoid SQL injection attacks.</p> <p>The function has to be used in a <code class="literal">FROM</code> expression, with an <code class="literal">AS</code> clause to specify the output columns; for example</p> <pre data-language="sql">
SELECT * FROM
xpath_table('article_id',
            'article_xml',
            'articles',
            '/article/author|/article/pages|/article/title',
            'date_entered &gt; ''2003-01-01'' ')
AS t(article_id integer, author text, page_count integer, title text);
</pre> <p>The <code class="literal">AS</code> clause defines the names and types of the columns in the output table. The first is the <span class="quote">“<span class="quote">key</span>”</span> field and the rest correspond to the XPath queries. If there are more XPath queries than result columns, the extra queries will be ignored. If there are more result columns than XPath queries, the extra columns will be NULL.</p> <p>Notice that this example defines the <code class="structname">page_count</code> result column as an integer. The function deals internally with string representations, so when you say you want an integer in the output, it will take the string representation of the XPath result and use PostgreSQL input functions to transform it into an integer (or whatever type the <code class="type">AS</code> clause requests). An error will result if it can't do this — for example if the result is empty — so you may wish to just stick to <code class="type">text</code> as the column type if you think your data has any problems.</p> <p>The calling <code class="command">SELECT</code> statement doesn't necessarily have to be just <code class="literal">SELECT *</code> — it can reference the output columns by name or join them to other tables. The function produces a virtual table with which you can perform any operation you wish (e.g., aggregation, joining, sorting etc). So we could also have:</p> <pre data-language="sql">
SELECT t.title, p.fullname, p.email
FROM xpath_table('article_id', 'article_xml', 'articles',
                 '/article/title|/article/author/@id',
                 'xpath_string(article_xml,''/article/@date'') &gt; ''2003-03-20'' ')
       AS t(article_id integer, title text, author_id integer),
     tblPeopleInfo AS p
WHERE t.author_id = p.person_id;
</pre> <p>as a more complicated example. Of course, you could wrap all of this in a view for convenience.</p> <div class="sect3" id="id-1.11.7.54.6.12">    <h3 class="title">F.45.3.1. Multivalued Results</h3>    <p>The <code class="function">xpath_table</code> function assumes that the results of each XPath query might be multivalued, so the number of rows returned by the function may not be the same as the number of input documents. The first row returned contains the first result from each query, the second row the second result from each query. If one of the queries has fewer values than the others, null values will be returned instead.</p> <p>In some cases, a user will know that a given XPath query will return only a single result (perhaps a unique document identifier) — if used alongside an XPath query returning multiple results, the single-valued result will appear only on the first row of the result. The solution to this is to use the key field as part of a join against a simpler XPath query. As an example:</p> <pre data-language="sql">
CREATE TABLE test (
    id int PRIMARY KEY,
    xml text
);

INSERT INTO test VALUES (1, '&lt;doc num="C1"&gt;
&lt;line num="L1"&gt;&lt;a&gt;1&lt;/a&gt;&lt;b&gt;2&lt;/b&gt;&lt;c&gt;3&lt;/c&gt;&lt;/line&gt;
&lt;line num="L2"&gt;&lt;a&gt;11&lt;/a&gt;&lt;b&gt;22&lt;/b&gt;&lt;c&gt;33&lt;/c&gt;&lt;/line&gt;
&lt;/doc&gt;');

INSERT INTO test VALUES (2, '&lt;doc num="C2"&gt;
&lt;line num="L1"&gt;&lt;a&gt;111&lt;/a&gt;&lt;b&gt;222&lt;/b&gt;&lt;c&gt;333&lt;/c&gt;&lt;/line&gt;
&lt;line num="L2"&gt;&lt;a&gt;111&lt;/a&gt;&lt;b&gt;222&lt;/b&gt;&lt;c&gt;333&lt;/c&gt;&lt;/line&gt;
&lt;/doc&gt;');

SELECT * FROM
  xpath_table('id','xml','test',
              '/doc/@num|/doc/line/@num|/doc/line/a|/doc/line/b|/doc/line/c',
              'true')
  AS t(id int, doc_num varchar(10), line_num varchar(10), val1 int, val2 int, val3 int)
WHERE id = 1 ORDER BY doc_num, line_num

 id | doc_num | line_num | val1 | val2 | val3
----+---------+----------+------+------+------
  1 | C1      | L1       |    1 |    2 |    3
  1 |         | L2       |   11 |   22 |   33
</pre> <p>To get <code class="literal">doc_num</code> on every line, the solution is to use two invocations of <code class="function">xpath_table</code> and join the results:</p> <pre data-language="sql">
SELECT t.*,i.doc_num FROM
  xpath_table('id', 'xml', 'test',
              '/doc/line/@num|/doc/line/a|/doc/line/b|/doc/line/c',
              'true')
    AS t(id int, line_num varchar(10), val1 int, val2 int, val3 int),
  xpath_table('id', 'xml', 'test', '/doc/@num', 'true')
    AS i(id int, doc_num varchar(10))
WHERE i.id=t.id AND i.id=1
ORDER BY doc_num, line_num;

 id | line_num | val1 | val2 | val3 | doc_num
----+----------+------+------+------+---------
  1 | L1       |    1 |    2 |    3 | C1
  1 | L2       |   11 |   22 |   33 | C1
(2 rows)
</pre> </div> </div> <div class="sect2" id="id-1.11.7.54.7">    <h2 class="title">F.45.4. XSLT Functions</h2>    <p>The following functions are available if libxslt is installed:</p> <div class="sect3" id="id-1.11.7.54.7.3.2">    <h3 class="title">F.45.4.1. <code class="literal">xslt_process</code>
</h3>    <pre data-language="sql">
xslt_process(text document, text stylesheet, text paramlist) returns text
</pre> <p>This function applies the XSL stylesheet to the document and returns the transformed result. The <code class="literal">paramlist</code> is a list of parameter assignments to be used in the transformation, specified in the form <code class="literal">a=1,b=2</code>. Note that the parameter parsing is very simple-minded: parameter values cannot contain commas!</p> <p>There is also a two-parameter version of <code class="function">xslt_process</code> which does not pass any parameters to the transformation.</p> </div> </div> <div class="sect2" id="id-1.11.7.54.8">    <h2 class="title">F.45.5. Author</h2>    <p>John Gray <code class="email">&lt;<a class="email" href="mailto:jgray@azuli.co.uk">jgray@azuli.co.uk</a>&gt;</code></p> <p>Development of this module was sponsored by Torchbox Ltd. (www.torchbox.com). It has the same BSD license as PostgreSQL.</p> </div>  <div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter">  <table summary="Navigation footer"> <tr> <td width="40%" align="left">
<a accesskey="p" href="uuid-ossp" title="F.44. uuid-ossp">Prev</a> </td> <td width="20%" align="center"><a accesskey="u" href="https://www.postgresql.org/docs/13/contrib.html" title="Appendix F. Additional Supplied Modules">Up</a></td> <td width="40%" align="right"> <a accesskey="n" href="https://www.postgresql.org/docs/13/contrib-prog.html" title="Appendix G. Additional Supplied Programs">Next</a>
</td> </tr> <tr> <td width="40%" align="left">F.44. uuid-ossp </td> <td width="20%" align="center"><a accesskey="h" href="https://www.postgresql.org/docs/13/index.html" title="PostgreSQL 13.1 Documentation">Home</a></td> <td width="40%" align="right"> Appendix G. Additional Supplied Programs</td> </tr> </table> </div>
<div class="_attribution">
  <p class="_attribution-p">
    © 1996–2020 The PostgreSQL Global Development Group<br>Licensed under the PostgreSQL License.<br>
    <a href="https://www.postgresql.org/docs/13/xml2.html" class="_attribution-link">https://www.postgresql.org/docs/13/xml2.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
