
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Msacc - Erlang 21 - W3cubDocs</title>
  
  <meta name="description" content=" msacc ">
  <meta name="keywords" content="msacc, erlang, erlang~21">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/erlang~21/lib/runtime_tools-1.13/doc/html/msacc.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/erlang~21.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/erlang~21/" class="_nav-link" title="" style="margin-left:0;">Erlang 21</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _erlang">
				
				
<h1>msacc</h1> <h2><span onmouseover="document.getElementById('ghlink-module-id77711').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-id77711').style.visibility = 'hidden';" id="module">Module</span></h2> <p class="REFBODY module-body">msacc</p> <h2><span onmouseover="document.getElementById('ghlink-module-summary-id77715').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-summary-id77715').style.visibility = 'hidden';" id="module-summary">Module Summary</span></h2> <p class="REFBODY module-summary-body">Convenience functions for microstate accounting</p> <h2><span onmouseover="document.getElementById('ghlink-description-id77719').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-description-id77719').style.visibility = 'hidden';" id="description">Description</span></h2> 
<p>This module implements some convenience functions for analyzing microstate accounting data. For details about how to use the basic api and what the different states represent see <code><span class="code">erlang:statistics(microstate_accounting)</span></code>.</p>  <p id="msacc_print_example"><strong>Basic Scenario</strong></p> <pre data-language="erlang">1&gt; msacc:start(1000).
ok
2&gt; msacc:print().
Average thread real-time    : 1000513 us
Accumulated system run-time :    2213 us
Average scheduler run-time  :    1076 us

        Thread      aux check_io emulator       gc    other     port    sleep

Stats per thread:
     async( 0)    0.00%    0.00%    0.00%    0.00%    0.00%    0.00%  100.00%
     async( 1)    0.00%    0.00%    0.00%    0.00%    0.00%    0.00%  100.00%
       aux( 1)    0.00%    0.00%    0.00%    0.00%    0.00%    0.00%   99.99%
 scheduler( 1)    0.00%    0.03%    0.13%    0.00%    0.01%    0.00%   99.82%
 scheduler( 2)    0.00%    0.00%    0.00%    0.00%    0.03%    0.00%   99.97%

Stats per type:
         async    0.00%    0.00%    0.00%    0.00%    0.00%    0.00%  100.00%
           aux    0.00%    0.00%    0.00%    0.00%    0.00%    0.00%   99.99%
     scheduler    0.00%    0.02%    0.06%    0.00%    0.02%    0.00%   99.89%
ok
</pre> <p>This first command enables microstate accounting for 1000 milliseconds. See <code><a href="#start-0"><span class="code">start/0</span></a></code>, <code><a href="#stop-0"><span class="code">stop/0</span></a></code>, <code><a href="#reset-0"><span class="code">reset/0</span></a></code> and <code><a href="#start-1"><span class="code">start/1</span></a></code> for more details. The second command prints the statistics gathered during that time. First three general statistics are printed.</p> <dl> <dt><strong>Average real-time</strong></dt> <dd>The average time spent collecting data in the threads. This should be close to the time which data was collected. </dd> <dt><strong>System run-time</strong></dt> <dd>The total run-time of all threads in the system. This is what you get if you call <code class="code">msacc:stats(total_runtime,Stats).</code> </dd> <dt><strong>Average scheduler run-time</strong></dt> <dd>The average run-time for the schedulers. This is the average amount of time the schedulers did not sleep.</dd> </dl> <p>Then one column per state is printed with a the percentage of time this thread spent in the state out of it's own real-time. After the thread specific time, the accumulated time for each type of thread is printed in a similar format.</p> <p>Since we have the average real-time and the percentage spent in each state we can easily calculate the time spent in each state by multiplying <code class="code">Average thread real-time</code> with <code class="code">Thread state %</code>, i.e. to get the time Scheduler 1 spent in the emulator state we do <code class="code">1000513us * 0.13% = 1300us</code>.</p>  <h2><span onmouseover="document.getElementById('ghlink-data-types-id77854').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-data-types-id77854').style.visibility = 'hidden';" id="data-types">Data Types</span></h2> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-msacc_data').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-msacc_data').style.visibility = 'hidden';">  <code>msacc_data() = [<span id="type-msacc_data"><a href="#type-msacc_data_thread">msacc_data_thread()</a></span>]</code><br> </div>  </div> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-msacc_data_thread').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-msacc_data_thread').style.visibility = 'hidden';">  <code>msacc_data_thread() = <br id="type-msacc_data_thread">    #{'$type' := msacc_data,<br>      type := <span><a href="#type-msacc_type">msacc_type()</a></span>,<br>      id := <span><a href="#type-msacc_id">msacc_id()</a></span>,<br>      counters := <span><a href="#type-msacc_data_counters">msacc_data_counters()</a></span>}</code><br> </div>  </div> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-msacc_data_counters').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-msacc_data_counters').style.visibility = 'hidden';">  <code>msacc_data_counters() = #{<span id="type-msacc_data_counters"><a href="#type-msacc_state">msacc_state()</a></span> =&gt; integer() &gt;= 0}</code><br> </div> <div class="data-type-desc">

<p>A map containing the different microstate accounting states and the number of microseconds spent in it.</p>
</div> </div> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-msacc_stats').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-msacc_stats').style.visibility = 'hidden';">  <code>msacc_stats() = [<span id="type-msacc_stats"><a href="#type-msacc_stats_thread">msacc_stats_thread()</a></span>]</code><br> </div>  </div> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-msacc_stats_thread').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-msacc_stats_thread').style.visibility = 'hidden';">  <code>msacc_stats_thread() = <br id="type-msacc_stats_thread">    #{'$type' := msacc_stats,<br>      type := <span><a href="#type-msacc_type">msacc_type()</a></span>,<br>      id := <span><a href="#type-msacc_id">msacc_id()</a></span>,<br>      system := float(),<br>      counters := <span><a href="#type-msacc_stats_counters">msacc_stats_counters()</a></span>}</code><br> </div> <div class="data-type-desc">

<p>A map containing information about a specific thread. The percentages in the map can be either run-time or real-time depending on if <code class="code">runtime</code> or <code class="code">realtime</code> was requested from <code><a href="#stats-2">stats/2</a></code>. <code class="code">system</code> is the percentage of total system time for this specific thread.</p>
</div> </div> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-msacc_stats_counters').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-msacc_stats_counters').style.visibility = 'hidden';">  <code>msacc_stats_counters() = <br id="type-msacc_stats_counters">    #{<span><a href="#type-msacc_state">msacc_state()</a></span> =&gt; #{thread := float(), system := float()}}</code><br> </div> <div class="data-type-desc">

<p>A map containing the different microstate accounting states. Each value in the map contains another map with the percentage of time that this thread has spent in the specific state. Both the percentage of <code class="code">system</code> time and the time for that specific <code class="code">thread</code> is part of the map.</p>
</div> </div> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-msacc_type').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-msacc_type').style.visibility = 'hidden';">  <code>msacc_type() = <br id="type-msacc_type">    aux |<br>    async |<br>    dirty_cpu_scheduler |<br>    dirty_io_scheduler |<br>    poll |<br>    scheduler</code><br> </div>  </div> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-msacc_id').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-msacc_id').style.visibility = 'hidden';">  <code id="type-msacc_id">msacc_id() = integer() &gt;= 0</code><br> </div>  </div> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-msacc_state').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-msacc_state').style.visibility = 'hidden';">  <code>msacc_state() = <br id="type-msacc_state">    alloc |<br>    aux |<br>    bif |<br>    busy_wait |<br>    check_io |<br>    emulator |<br>    ets |<br>    gc |<br>    gc_fullsweep |<br>    nif |<br>    other |<br>    port |<br>    send |<br>    sleep |<br>    timers</code><br> </div> <div class="data-type-desc">

<p>The different states that a thread can be in. See <code>erlang:statistics(microstate_accounting)</code> for details. </p>
</div> </div> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-msacc_print_options').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-msacc_print_options').style.visibility = 'hidden';">  <code id="type-msacc_print_options">msacc_print_options() = #{system =&gt; boolean()}</code><br> </div> <div class="data-type-desc">

<p>The different options that can be given to <code><a href="#print-2"><span class="code">print/2</span></a></code>. </p>
</div> </div> <h2><span onmouseover="document.getElementById('ghlink-exports-id78034').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-exports-id78034').style.visibility = 'hidden';" id="exports">Exports</span></h2> <div class="exports-body"> 
<div onmouseover="document.getElementById('ghlink-available-0-id88913').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-available-0-id88913').style.visibility = 'hidden';"> available() -&gt; boolean()</div> 
<p>This function checks whether microstate accounting is available or not.</p>  
<div onmouseover="document.getElementById('ghlink-start-0-id88963').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-start-0-id88963').style.visibility = 'hidden';"> start() -&gt; boolean()</div> 
<p>Start microstate accounting. Returns whether it was previously enabled or disabled.</p>  
<div onmouseover="document.getElementById('ghlink-start-1-id89004').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-start-1-id89004').style.visibility = 'hidden';"> start(Time) -&gt; true</div> <h2 class="func-types-title">Types</h2>   
<p>Resets all counters and then starts microstate accounting for the given milliseconds.</p>  
<div onmouseover="document.getElementById('ghlink-stop-0-id89006').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-stop-0-id89006').style.visibility = 'hidden';"> stop() -&gt; boolean()</div> 
<p>Stop microstate accounting. Returns whether is was previously enabled or disabled.</p>  
<div onmouseover="document.getElementById('ghlink-reset-0-id89104').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-reset-0-id89104').style.visibility = 'hidden';"> reset() -&gt; boolean()</div> 
<p>Reset microstate accounting counters. Returns whether is was enabled or disabled.</p>  
<div onmouseover="document.getElementById('ghlink-print-0-id89143').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-print-0-id89143').style.visibility = 'hidden';"> print() -&gt; ok</div> 
<p> Prints the current microstate accounting to standard out. Same as <code><a href="#print-1"><span class="code">msacc:print(msacc:stats(),#{}).</span></a></code> </p>  
<div onmouseover="document.getElementById('ghlink-print-1-id89193').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-print-1-id89193').style.visibility = 'hidden';"> print(DataOrStats) -&gt; ok</div> <h2 class="func-types-title">Types</h2>   
<p>Print the given microstate statistics values to stdout. Same as <code><a href="#print-1"><span class="code">msacc:print(DataOrStats,#{}).</span></a></code> </p>  
<div onmouseover="document.getElementById('ghlink-print-2-id89219').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-print-2-id89219').style.visibility = 'hidden';"> print(DataOrStats, Options) -&gt; ok</div> <h2 class="func-types-title">Types</h2>    
<p>Print the given microstate statistics values to standard out. With many states this can be quite verbose. See the top of this reference manual for a brief description of what the fields mean.</p> <p>It is possible to print more specific types of statistics by first manipulating the <code class="code">DataOrStats</code> using <code><a href="#stats-2"><span class="code">stats/2</span></a></code>. For instance if you want to print the percentage of run-time for each thread you can do:</p> <pre data-language="erlang">msacc:print(msacc:stats(runtime,msacc:stats())).</pre> <p>If you want to only print run-time per thread type you can do:</p> <pre data-language="erlang">msacc:print(msacc:stats(type,msacc:stats(runtime,msacc:stats()))).</pre> <p><strong>Options</strong></p> <dl> <dt><strong><code class="code">system</code></strong></dt> <dd>Print percentage of time spent in each state out of system time as well as thread time. Default: false.</dd> </dl>  
<div onmouseover="document.getElementById('ghlink-print-3-id89455').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-print-3-id89455').style.visibility = 'hidden';"> print(FileOrDevice, DataOrStats, Options) -&gt; ok</div> <h2 class="func-types-title">Types</h2>     
<p>Print the given microstate statistics values to the given file or device. The other arguments behave the same way as for <code><a href="#print-2"><span class="code">print/2</span></a></code>.</p>  
<div onmouseover="document.getElementById('ghlink-stats-0-id89444').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-stats-0-id89444').style.visibility = 'hidden';"> stats() -&gt; <code><a href="#type-msacc_data">msacc_data()</a></code> </div> 
<p>Returns a runtime system independent version of the microstate statistics data presented by <code><span class="code">erlang:statistics(microstate_accounting)</span></code>. All counters have been normalized to be in microsecond resolution.</p>  
<div onmouseover="document.getElementById('ghlink-stats-2-id89517').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-stats-2-id89517').style.visibility = 'hidden';"> stats(Analysis, Stats) -&gt; integer() &gt;= 0</div> <h2 class="func-types-title">Types</h2>    
<p>Returns the system time for the given microstate statistics values. System time is the accumulated time of all threads.</p> <dl> <dt><strong><code class="code">realtime</code></strong></dt> <dd>Returns all time recorded for all threads.</dd> <dt><strong><code class="code">runtime</code></strong></dt> <dd>Returns all time spent doing work for all threads, i.e. all time not spent in the <code class="code">sleep</code> state.</dd> </dl>  
<div onmouseover="document.getElementById('ghlink-stats-2-id89781').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-stats-2-id89781').style.visibility = 'hidden';"> stats(Analysis, Stats) -&gt; <code><a href="#type-msacc_stats">msacc_stats()</a></code> </div> <h2 class="func-types-title">Types</h2>    
<p>Returns fractions of real-time or run-time spent in the various threads from the given microstate statistics values.</p>  
<div onmouseover="document.getElementById('ghlink-stats-2-id89776').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-stats-2-id89776').style.visibility = 'hidden';"> stats(Analysis, StatsOrData) -&gt; <code><a href="#type-msacc_data">msacc_data()</a></code> | <code><a href="#type-msacc_stats">msacc_stats()</a></code> </div> <h2 class="func-types-title">Types</h2>    
<p>Returns a list of microstate statistics values where the values for all threads of the same type has been merged.</p>  
<div onmouseover="document.getElementById('ghlink-to_file-1-id89515').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-to_file-1-id89515').style.visibility = 'hidden';"> to_file(Filename) -&gt; ok | {error, <code>file:posix()</code>}</div> <h2 class="func-types-title">Types</h2>   
<p>Dumps the current microstate statistics counters to a file that can be parsed with <code>file:consult/1</code>.</p>  
<div onmouseover="document.getElementById('ghlink-from_file-1-id89981').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-from_file-1-id89981').style.visibility = 'hidden';"> from_file(Filename) -&gt; <code><a href="#type-msacc_data">msacc_data()</a></code> </div> <h2 class="func-types-title">Types</h2>   
<p>Read a file dump produced by <code><a href="#to_file-1">to_file(Filename)</a></code>.</p>  </div>
<div class="_attribution">
  <p class="_attribution-p">
    © 2010–2017 Ericsson AB<br>Licensed under the Apache License, Version 2.0.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
