
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Nearest Positive Definite Matrix - R - W3cubDocs</title>
  
  <meta name="description" content=" Compute the nearest positive definite matrix to an approximate one, typically a correlation or variance-covariance matrix. ">
  <meta name="keywords" content="nearest, positive, definite, matrix, r">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/r/library/matrix/html/nearpd.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/r.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/r/" class="_nav-link" title="" style="margin-left:0;">R</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _simple">
				
				
<h2>
<code>nearPD</code> Nearest Positive Definite Matrix</h2> <h3>Description</h3> <p>Compute the nearest positive definite matrix to an approximate one, typically a correlation or variance-covariance matrix. </p> <h3>Usage</h3> <pre data-language="r">
nearPD(x, corr = FALSE, keepDiag = FALSE, base.matrix = FALSE,
       do2eigen = TRUE, doSym = FALSE,
       doDykstra = TRUE, only.values = FALSE,
       ensureSymmetry = !isSymmetric(x),
       eig.tol = 1e-06, conv.tol = 1e-07, posd.tol = 1e-08,
       maxit = 100, conv.norm.type = "I", trace = FALSE)
</pre> <h3>Arguments</h3> <table summary="R argblock"> <tr valign="top">
<td><code>x</code></td> <td> <p>numeric <i>n * n</i> approximately positive definite matrix, typically an approximation to a correlation or covariance matrix. If <code>x</code> is not symmetric (and <code>ensureSymmetry</code> is not false), <code><a href="symmpart">symmpart</a>(x)</code> is used.</p> </td>
</tr> <tr valign="top">
<td><code>corr</code></td> <td> <p>logical indicating if the matrix should be a <em>correlation</em> matrix.</p> </td>
</tr> <tr valign="top">
<td><code>keepDiag</code></td> <td> <p>logical, generalizing <code>corr</code>: if <code>TRUE</code>, the resulting matrix should have the same diagonal (<code><a href="../../base/html/diag">diag</a>(x)</code>) as the input matrix.</p> </td>
</tr> <tr valign="top">
<td><code>base.matrix</code></td> <td> <p>logical indicating if the resulting <code>mat</code> component should be a <span class="pkg">base</span> <code><a href="../../base/html/matrix">matrix</a></code> or (by default) a <code><a href="matrix-class">Matrix</a></code> of class <code><a href="dpomatrix-class">dpoMatrix</a></code>.</p> </td>
</tr> <tr valign="top">
<td><code>do2eigen</code></td> <td> <p>logical indicating if a <code><a href="../../sfsmisc/html/posdefify">posdefify</a>()</code> eigen step should be applied to the result of the Higham algorithm.</p> </td>
</tr> <tr valign="top">
<td><code>doSym</code></td> <td> <p>logical indicating if <code>X &lt;- (X + t(X))/2</code> should be done, after <code>X &lt;- tcrossprod(Qd, Q)</code>; some doubt if this is necessary.</p> </td>
</tr> <tr valign="top">
<td><code>doDykstra</code></td> <td> <p>logical indicating if Dykstra's correction should be used; true by default. If false, the algorithm is basically the direct fixpoint iteration <i>Y(k) = P_U(P_S(Y(k-1)))</i>.</p> </td>
</tr> <tr valign="top">
<td><code>only.values</code></td> <td> <p>logical; if <code>TRUE</code>, the result is just the vector of eigenvalues of the approximating matrix.</p> </td>
</tr> <tr valign="top">
<td><code>ensureSymmetry</code></td> <td> <p>logical; by default, <code><a href="symmpart">symmpart</a>(x)</code> is used whenever <code><a href="../../base/html/issymmetric">isSymmetric</a>(x)</code> is not true. The user can explicitly set this to <code>TRUE</code> or <code>FALSE</code>, saving the symmetry test. <em>Beware</em> however that setting it <code>FALSE</code> for an <b>a</b>symmetric input <code>x</code>, is typically nonsense!</p> </td>
</tr> <tr valign="top">
<td><code>eig.tol</code></td> <td> <p>defines relative positiveness of eigenvalues compared to largest one, <i>λ_1</i>. Eigenvalues <i>λ_k</i> are treated as if zero when <i>λ_k / λ_1 ≤ eig.tol</i>.</p> </td>
</tr> <tr valign="top">
<td><code>conv.tol</code></td> <td> <p>convergence tolerance for Higham algorithm.</p> </td>
</tr> <tr valign="top">
<td><code>posd.tol</code></td> <td> <p>tolerance for enforcing positive definiteness (in the final <code>posdefify</code> step when <code>do2eigen</code> is <code>TRUE</code>).</p> </td>
</tr> <tr valign="top">
<td><code>maxit</code></td> <td> <p>maximum number of iterations allowed.</p> </td>
</tr> <tr valign="top">
<td><code>conv.norm.type</code></td> <td> <p>convergence norm type (<code><a href="norm">norm</a>(*,
      type)</code>) used for Higham algorithm. The default is <code>"I"</code> (infinity), for reasons of speed (and back compatibility); using <code>"F"</code> is more in line with Higham's proposal.</p> </td>
</tr> <tr valign="top">
<td><code>trace</code></td> <td> <p>logical or integer specifying if convergence monitoring should be traced.</p> </td>
</tr> </table> <h3>Details</h3> <p>This implements the algorithm of Higham (2002), and then (if <code>do2eigen</code> is true) forces positive definiteness using code from <code><a href="../../sfsmisc/html/posdefify">posdefify</a></code>. The algorithm of Knol and ten Berge (1989) (not implemented here) is more general in that it allows constraints to (1) fix some rows (and columns) of the matrix and (2) force the smallest eigenvalue to have a certain value. </p> <p>Note that setting <code>corr = TRUE</code> just sets <code>diag(.) &lt;- 1</code> within the algorithm. </p> <p>Higham (2002) uses Dykstra's correction, but the version by Jens Oehlschlaegel did not use it (accidentally), and still gave reasonable results; this simplification, now only used if <code>doDykstra = FALSE</code>, was active in <code>nearPD()</code> up to Matrix version 0.999375-40. </p> <h3>Value</h3> <p>If <code>only.values = TRUE</code>, a numeric vector of eigenvalues of the approximating matrix; Otherwise, as by default, an S3 object of <code><a href="../../base/html/class">class</a></code> <code>"nearPD"</code>, basically a list with components </p> <table summary="R valueblock"> <tr valign="top">
<td><code>mat</code></td> <td> <p>a matrix of class <code><a href="dpomatrix-class">dpoMatrix</a></code>, the computed positive-definite matrix.</p> </td>
</tr> <tr valign="top">
<td><code>eigenvalues</code></td> <td> <p>numeric vector of eigenvalues of <code>mat</code>.</p> </td>
</tr> <tr valign="top">
<td><code>corr</code></td> <td> <p>logical, just the argument <code>corr</code>.</p> </td>
</tr> <tr valign="top">
<td><code>normF</code></td> <td> <p>the Frobenius norm (<code><a href="norm">norm</a>(x-X, "F")</code>) of the difference between the original and the resulting matrix.</p> </td>
</tr> <tr valign="top">
<td><code>iterations</code></td> <td> <p>number of iterations needed.</p> </td>
</tr> <tr valign="top">
<td><code>converged</code></td> <td> <p>logical indicating if iterations converged.</p> </td>
</tr> </table> <h3>Author(s)</h3> <p>Jens Oehlschlaegel donated a first version. Subsequent changes by the Matrix package authors. </p> <h3>References</h3> <p>Cheng, Sheung Hun and Higham, Nick (1998) A Modified Cholesky Algorithm Based on a Symmetric Indefinite Factorization; <em>SIAM J. Matrix Anal.\ Appl.</em>, <b>19</b>, 1097–1110. </p> <p>Knol DL, ten Berge JMF (1989) Least-squares approximation of an improper correlation matrix by a proper one. <em>Psychometrika</em> <b>54</b>, 53–61. </p> <p>Higham, Nick (2002) Computing the nearest correlation matrix - a problem from finance; <em>IMA Journal of Numerical Analysis</em> <b>22</b>, 329–343. </p> <h3>See Also</h3> <p>A first version of this (with non-optional <code>corr=TRUE</code>) has been available as <code><a href="../../sfsmisc/html/nearcor">nearcor</a>()</code>; and more simple versions with a similar purpose <code><a href="../../sfsmisc/html/posdefify">posdefify</a>()</code>, both from package <span class="pkg">sfsmisc</span>. </p> <h3>Examples</h3> <pre data-language="r">
 ## Higham(2002), p.334f - simple example
 A &lt;- matrix(1, 3,3); A[1,3] &lt;- A[3,1] &lt;- 0
 n.A &lt;- nearPD(A, corr=TRUE, do2eigen=FALSE)
 n.A[c("mat", "normF")]
 n.A.m &lt;- nearPD(A, corr=TRUE, do2eigen=FALSE, base.matrix=TRUE)$mat
 stopifnot(exprs = {                           #=--------------
   all.equal(n.A$mat[1,2], 0.760689917)
   all.equal(n.A$normF, 0.52779033, tolerance=1e-9)
   all.equal(n.A.m, unname(as.matrix(n.A$mat)), tolerance = 1e-15)# seen rel.d.= 1.46e-16
 })
 set.seed(27)
 m &lt;- matrix(round(rnorm(25),2), 5, 5)
 m &lt;- m + t(m)
 diag(m) &lt;- pmax(0, diag(m)) + 1
 (m &lt;- round(cov2cor(m), 2))

 str(near.m &lt;- nearPD(m, trace = TRUE))
 round(near.m$mat, 2)
 norm(m - near.m$mat) # 1.102 / 1.08

 if(require("sfsmisc")) {
    m2 &lt;- posdefify(m) # a simpler approach
    norm(m - m2)  # 1.185, i.e., slightly "less near"
 }

 round(nearPD(m, only.values=TRUE), 9)

## A longer example, extended from Jens' original,
## showing the effects of some of the options:

pr &lt;- Matrix(c(1,     0.477, 0.644, 0.478, 0.651, 0.826,
               0.477, 1,     0.516, 0.233, 0.682, 0.75,
               0.644, 0.516, 1,     0.599, 0.581, 0.742,
               0.478, 0.233, 0.599, 1,     0.741, 0.8,
               0.651, 0.682, 0.581, 0.741, 1,     0.798,
               0.826, 0.75,  0.742, 0.8,   0.798, 1),
             nrow = 6, ncol = 6)

nc.  &lt;- nearPD(pr, conv.tol = 1e-7) # default
nc.$iterations  # 2
nc.1 &lt;- nearPD(pr, conv.tol = 1e-7, corr = TRUE)
nc.1$iterations # 11 / 12 (!)
ncr   &lt;- nearPD(pr, conv.tol = 1e-15)
str(ncr)# still 2 iterations
ncr.1 &lt;- nearPD(pr, conv.tol = 1e-15, corr = TRUE)
ncr.1 $ iterations # 27 / 30 !

ncF &lt;- nearPD(pr, conv.tol = 1e-15, conv.norm = "F")
stopifnot(all.equal(ncr, ncF))# norm type does not matter at all in this example

## But indeed, the 'corr = TRUE' constraint did ensure a better solution;
## cov2cor() does not just fix it up equivalently :
norm(pr - cov2cor(ncr$mat)) # = 0.09994
norm(pr -       ncr.1$mat)  # = 0.08746 / 0.08805

### 3) a real data example from a 'systemfit' model (3 eq.):
(load(system.file("external", "symW.rda", package="Matrix"))) # "symW"
dim(symW) #  24 x 24
class(symW)# "dsCMatrix": sparse symmetric
if(dev.interactive())  image(symW)
EV &lt;- eigen(symW, only=TRUE)$values
summary(EV) ## looking more closely {EV sorted decreasingly}:
tail(EV)# all 6 are negative
EV2 &lt;- eigen(sWpos &lt;- nearPD(symW)$mat, only=TRUE)$values
stopifnot(EV2 &gt; 0)
if(require("sfsmisc")) {
       plot(pmax(1e-3,EV), EV2, type="o", log="xy", xaxt="n",yaxt="n")
       eaxis(1); eaxis(2)
} else plot(pmax(1e-3,EV), EV2, type="o", log="xy")
abline(0,1, col="red3",lty=2)

</pre>
<div class="_attribution">
  <p class="_attribution-p">
    Copyright (©) 1999–2012 R Foundation for Statistical Computing.<br>Licensed under the <a href="https://www.gnu.org/copyleft/gpl.html">GNU General Public License</a>.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
