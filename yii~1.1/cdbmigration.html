
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>CDbMigration - Yii 1.1 - W3cubDocs</title>
  
  <meta name="description" content="Returns the currently active database connection. By default, the &#39;db&#39; application component will be returned and activated. You can call &hellip;">
  <meta name="keywords" content="cdbmigration, yii, yii~1.1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/yii~1.1/cdbmigration.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/yii~1.1.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/yii~1.1/" class="_nav-link" title="" style="margin-left:0;">Yii 1.1</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _yii">
				
				
<h1>CDbMigration</h1>  <table class="summaryTable docClass"> <colgroup> <col class="col-name"> <col class="col-value"> </colgroup> <tr> <th>Package</th> <td><a href="index#system.db">system.db</a></td> </tr> <tr> <th>Inheritance</th> <td>abstract class CDbMigration » <a href="ccomponent">CComponent</a>
</td> </tr> <tr> <th>Since</th> <td>1.1.6</td> </tr> <tr> <th>Source Code</th> <td><a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php">framework/db/CDbMigration.php</a></td> </tr> </table> <div id="classDescription"> CDbMigration is the base class for representing a database migration. <br><br> CDbMigration is designed to be used together with the "yiic migrate" command. <br><br> Each child class of CDbMigration represents an individual database migration which is identified by the child class name. <br><br> Within each migration, the <a href="cdbmigration#up">up</a> method contains the logic for "upgrading" the database used in an application; while the <a href="cdbmigration#down">down</a> method contains "downgrading" logic. The "yiic migrate" command manages all available migrations in an application. <br><br> By overriding <a href="cdbmigration#safeUp">safeUp</a> or <a href="cdbmigration#safeDown">safeDown</a> methods instead of <a href="cdbmigration#up">up</a> and <a href="cdbmigration#down">down</a> the migration logic will be wrapped with a DB transaction. <br><br> CDbMigration provides a set of convenient methods for manipulating database data and schema. For example, the <a href="cdbmigration#insert">insert</a> method can be used to easily insert a row of data into a database table; the <a href="cdbmigration#createTable">createTable</a> method can be used to create a database table. Compared with the same methods in <a href="cdbcommand">CDbCommand</a>, these methods will display extra information showing the method parameters and execution time, which may be useful when applying migrations.</div>  <div class="summary docProperty"> <h2>Public Properties</h2>  <table class="summaryTable"> <colgroup> <col class="col-property"> <col class="col-type"> <col class="col-description"> <col class="col-defined"> </colgroup> <tr> <th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Defined By</th> </tr> <tr id="dbConnection"> <td><a href="cdbmigration#dbConnection-detail">dbConnection</a></td> <td><a href="cdbconnection">CDbConnection</a></td> <td>Returns the currently active database connection.</td> <td>CDbMigration</td> </tr> </table> </div>  <div class="summary docMethod"> <h2>Public Methods</h2>  <table class="summaryTable"> <colgroup> <col class="col-method"> <col class="col-description"> <col class="col-defined"> </colgroup> <tr> <th>Method</th>
<th>Description</th>
<th>Defined By</th> </tr> <tr class="inherited" id="__call"> <td><a href="ccomponent#__call-detail">__call()</a></td> <td>Calls the named method which is not a class method.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="__get"> <td><a href="ccomponent#__get-detail">__get()</a></td> <td>Returns a property value, an event handler list or a behavior based on its name.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="__isset"> <td><a href="ccomponent#__isset-detail">__isset()</a></td> <td>Checks if a property value is null.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="__set"> <td><a href="ccomponent#__set-detail">__set()</a></td> <td>Sets value of a component property.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="__unset"> <td><a href="ccomponent#__unset-detail">__unset()</a></td> <td>Sets a component property to be null.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr id="addColumn"> <td><a href="cdbmigration#addColumn-detail">addColumn()</a></td> <td>Builds and executes a SQL statement for adding a new DB column.</td> <td>CDbMigration</td> </tr> <tr id="addForeignKey"> <td><a href="cdbmigration#addForeignKey-detail">addForeignKey()</a></td> <td>Builds a SQL statement for adding a foreign key constraint to an existing table.</td> <td>CDbMigration</td> </tr> <tr id="addPrimaryKey"> <td><a href="cdbmigration#addPrimaryKey-detail">addPrimaryKey()</a></td> <td>Builds and executes a SQL statement for creating a primary key, supports composite primary keys.</td> <td>CDbMigration</td> </tr> <tr id="alterColumn"> <td><a href="cdbmigration#alterColumn-detail">alterColumn()</a></td> <td>Builds and executes a SQL statement for changing the definition of a column.</td> <td>CDbMigration</td> </tr> <tr class="inherited" id="asa"> <td><a href="ccomponent#asa-detail">asa()</a></td> <td>Returns the named behavior object.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="attachBehavior"> <td><a href="ccomponent#attachBehavior-detail">attachBehavior()</a></td> <td>Attaches a behavior to this component.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="attachBehaviors"> <td><a href="ccomponent#attachBehaviors-detail">attachBehaviors()</a></td> <td>Attaches a list of behaviors to the component.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="attachEventHandler"> <td><a href="ccomponent#attachEventHandler-detail">attachEventHandler()</a></td> <td>Attaches an event handler to an event.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="canGetProperty"> <td><a href="ccomponent#canGetProperty-detail">canGetProperty()</a></td> <td>Determines whether a property can be read.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="canSetProperty"> <td><a href="ccomponent#canSetProperty-detail">canSetProperty()</a></td> <td>Determines whether a property can be set.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr id="createIndex"> <td><a href="cdbmigration#createIndex-detail">createIndex()</a></td> <td>Builds and executes a SQL statement for creating a new index.</td> <td>CDbMigration</td> </tr> <tr id="createTable"> <td><a href="cdbmigration#createTable-detail">createTable()</a></td> <td>Builds and executes a SQL statement for creating a new DB table.</td> <td>CDbMigration</td> </tr> <tr id="delete"> <td><a href="cdbmigration#delete-detail">delete()</a></td> <td>Creates and executes a DELETE SQL statement.</td> <td>CDbMigration</td> </tr> <tr class="inherited" id="detachBehavior"> <td><a href="ccomponent#detachBehavior-detail">detachBehavior()</a></td> <td>Detaches a behavior from the component.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="detachBehaviors"> <td><a href="ccomponent#detachBehaviors-detail">detachBehaviors()</a></td> <td>Detaches all behaviors from the component.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="detachEventHandler"> <td><a href="ccomponent#detachEventHandler-detail">detachEventHandler()</a></td> <td>Detaches an existing event handler.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="disableBehavior"> <td><a href="ccomponent#disableBehavior-detail">disableBehavior()</a></td> <td>Disables an attached behavior.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="disableBehaviors"> <td><a href="ccomponent#disableBehaviors-detail">disableBehaviors()</a></td> <td>Disables all behaviors attached to this component.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr id="down"> <td><a href="cdbmigration#down-detail">down()</a></td> <td>This method contains the logic to be executed when removing this migration.</td> <td>CDbMigration</td> </tr> <tr id="dropColumn"> <td><a href="cdbmigration#dropColumn-detail">dropColumn()</a></td> <td>Builds and executes a SQL statement for dropping a DB column.</td> <td>CDbMigration</td> </tr> <tr id="dropForeignKey"> <td><a href="cdbmigration#dropForeignKey-detail">dropForeignKey()</a></td> <td>Builds a SQL statement for dropping a foreign key constraint.</td> <td>CDbMigration</td> </tr> <tr id="dropIndex"> <td><a href="cdbmigration#dropIndex-detail">dropIndex()</a></td> <td>Builds and executes a SQL statement for dropping an index.</td> <td>CDbMigration</td> </tr> <tr id="dropPrimaryKey"> <td><a href="cdbmigration#dropPrimaryKey-detail">dropPrimaryKey()</a></td> <td>Builds and executes a SQL statement for removing a primary key, supports composite primary keys.</td> <td>CDbMigration</td> </tr> <tr id="dropTable"> <td><a href="cdbmigration#dropTable-detail">dropTable()</a></td> <td>Builds and executes a SQL statement for dropping a DB table.</td> <td>CDbMigration</td> </tr> <tr class="inherited" id="enableBehavior"> <td><a href="ccomponent#enableBehavior-detail">enableBehavior()</a></td> <td>Enables an attached behavior.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="enableBehaviors"> <td><a href="ccomponent#enableBehaviors-detail">enableBehaviors()</a></td> <td>Enables all behaviors attached to this component.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="evaluateExpression"> <td><a href="ccomponent#evaluateExpression-detail">evaluateExpression()</a></td> <td>Evaluates a PHP expression or callback under the context of this component.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr id="execute"> <td><a href="cdbmigration#execute-detail">execute()</a></td> <td>Executes a SQL statement.</td> <td>CDbMigration</td> </tr> <tr id="getDbConnection"> <td><a href="cdbmigration#getDbConnection-detail">getDbConnection()</a></td> <td>Returns the currently active database connection.</td> <td>CDbMigration</td> </tr> <tr class="inherited" id="getEventHandlers"> <td><a href="ccomponent#getEventHandlers-detail">getEventHandlers()</a></td> <td>Returns the list of attached event handlers for an event.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="hasEvent"> <td><a href="ccomponent#hasEvent-detail">hasEvent()</a></td> <td>Determines whether an event is defined.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="hasEventHandler"> <td><a href="ccomponent#hasEventHandler-detail">hasEventHandler()</a></td> <td>Checks whether the named event has attached handlers.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="hasProperty"> <td><a href="ccomponent#hasProperty-detail">hasProperty()</a></td> <td>Determines whether a property is defined.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr id="insert"> <td><a href="cdbmigration#insert-detail">insert()</a></td> <td>Creates and executes an INSERT SQL statement.</td> <td>CDbMigration</td> </tr> <tr id="insertMultiple"> <td><a href="cdbmigration#insertMultiple-detail">insertMultiple()</a></td> <td>Creates and executes an INSERT SQL statement with multiple data.</td> <td>CDbMigration</td> </tr> <tr class="inherited" id="raiseEvent"> <td><a href="ccomponent#raiseEvent-detail">raiseEvent()</a></td> <td>Raises an event.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr id="refreshTableSchema"> <td><a href="cdbmigration#refreshTableSchema-detail">refreshTableSchema()</a></td> <td>Refreshed schema cache for a table</td> <td>CDbMigration</td> </tr> <tr id="renameColumn"> <td><a href="cdbmigration#renameColumn-detail">renameColumn()</a></td> <td>Builds and executes a SQL statement for renaming a column.</td> <td>CDbMigration</td> </tr> <tr id="renameTable"> <td><a href="cdbmigration#renameTable-detail">renameTable()</a></td> <td>Builds and executes a SQL statement for renaming a DB table.</td> <td>CDbMigration</td> </tr> <tr id="safeDown"> <td><a href="cdbmigration#safeDown-detail">safeDown()</a></td> <td>This method contains the logic to be executed when removing this migration.</td> <td>CDbMigration</td> </tr> <tr id="safeUp"> <td><a href="cdbmigration#safeUp-detail">safeUp()</a></td> <td>This method contains the logic to be executed when applying this migration.</td> <td>CDbMigration</td> </tr> <tr id="setDbConnection"> <td><a href="cdbmigration#setDbConnection-detail">setDbConnection()</a></td> <td>Sets the currently active database connection.</td> <td>CDbMigration</td> </tr> <tr id="truncateTable"> <td><a href="cdbmigration#truncateTable-detail">truncateTable()</a></td> <td>Builds and executes a SQL statement for truncating a DB table.</td> <td>CDbMigration</td> </tr> <tr id="up"> <td><a href="cdbmigration#up-detail">up()</a></td> <td>This method contains the logic to be executed when applying this migration.</td> <td>CDbMigration</td> </tr> <tr id="update"> <td><a href="cdbmigration#update-detail">update()</a></td> <td>Creates and executes an UPDATE SQL statement.</td> <td>CDbMigration</td> </tr> </table> </div>  <h2>Property Details</h2> <h3 class="detailHeader" id="dbConnection-detail"> dbConnection<span class="detailHeaderTag"> property </span> </h3> <pre class="signature">public <a href="cdbconnection">CDbConnection</a> <a href="cdbmigration#getDbConnection"><b>getDbConnection</b></a>()<br>public void <a href="cdbmigration#setDbConnection"><b>setDbConnection</b></a>(<a href="cdbconnection">CDbConnection</a> $db)</pre> <p>Returns the currently active database connection. By default, the 'db' application component will be returned and activated. You can call <a href="cdbmigration#setDbConnection">setDbConnection</a> to switch to a different database connection. Methods such as <a href="cdbmigration#insert">insert</a>, <a href="cdbmigration#createTable">createTable</a> will use this database connection to perform DB queries.</p> <h2>Method Details</h2> <h3 class="detailHeader" id="addColumn-detail"> addColumn() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>addColumn</b>(string $table, string $column, string $type)</pre> </td></tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table that the new column will be added to. The table name will be properly quoted by the method.</td> </tr> <tr> <td class="paramNameCol">$column</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the name of the new column. The name will be properly quoted by the method.</td> </tr> <tr> <td class="paramNameCol">$type</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the column type. The getColumnType method will be invoked to convert abstract column type (if any) into the physical one. Anything that is not recognized as abstract type will be kept in the generated SQL. For example, 'string' will be turned into 'varchar(255)', while 'string not null' will become 'varchar(255) not null'.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L299">framework/db/CDbMigration.php#299</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">addColumn</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$column</span><span style="color: #007700">, </span><span style="color: #0000BB">$type</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; add column </span><span style="color: #0000BB">$column</span><span style="color: #0000BB">$type</span><span style="color: #DD0000"> to table </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">addColumn</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$column</span><span style="color: #007700">, </span><span style="color: #0000BB">$type</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Builds and executes a SQL statement for adding a new DB column.</p> <h3 class="detailHeader" id="addForeignKey-detail"> addForeignKey() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>addForeignKey</b>(string $name, string $table, string|array $columns, string $refTable, string|array $refColumns, string $delete=NULL, string $update=NULL)</pre> </td></tr> <tr> <td class="paramNameCol">$name</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the name of the foreign key constraint.</td> </tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table that the foreign key constraint will be added to.</td> </tr> <tr> <td class="paramNameCol">$columns</td> <td class="paramTypeCol">string|array</td> <td class="paramDescCol">the name of the column to that the constraint will be added on. If there are multiple columns, separate them with commas or pass as an array of column names.</td> </tr> <tr> <td class="paramNameCol">$refTable</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table that the foreign key references to.</td> </tr> <tr> <td class="paramNameCol">$refColumns</td> <td class="paramTypeCol">string|array</td> <td class="paramDescCol">the name of the column that the foreign key references to. If there are multiple columns, separate them with commas or pass as an array of column names.</td> </tr> <tr> <td class="paramNameCol">$delete</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the ON DELETE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL</td> </tr> <tr> <td class="paramNameCol">$update</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the ON UPDATE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L361">framework/db/CDbMigration.php#361</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">addForeignKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">, </span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$columns</span><span style="color: #007700">, </span><span style="color: #0000BB">$refTable</span><span style="color: #007700">, </span><span style="color: #0000BB">$refColumns</span><span style="color: #007700">, </span><span style="color: #0000BB">$delete</span><span style="color: #007700">=</span><span style="color: #0000BB">null</span><span style="color: #007700">, </span><span style="color: #0000BB">$update</span><span style="color: #007700">=</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; add foreign key </span><span style="color: #0000BB">$name</span><span style="color: #DD0000">: </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> ("</span><span style="color: #007700">.(</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$columns</span><span style="color: #007700">) ? </span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">','</span><span style="color: #007700">, </span><span style="color: #0000BB">$columns</span><span style="color: #007700">) : </span><span style="color: #0000BB">$columns</span><span style="color: #007700">).<br>         </span><span style="color: #DD0000">") references </span><span style="color: #0000BB">$refTable</span><span style="color: #DD0000"> ("</span><span style="color: #007700">.(</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$refColumns</span><span style="color: #007700">) ? </span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">','</span><span style="color: #007700">, </span><span style="color: #0000BB">$refColumns</span><span style="color: #007700">) : </span><span style="color: #0000BB">$refColumns</span><span style="color: #007700">).</span><span style="color: #DD0000">") ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">addForeignKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">, </span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$columns</span><span style="color: #007700">, </span><span style="color: #0000BB">$refTable</span><span style="color: #007700">, </span><span style="color: #0000BB">$refColumns</span><span style="color: #007700">, </span><span style="color: #0000BB">$delete</span><span style="color: #007700">, </span><span style="color: #0000BB">$update</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Builds a SQL statement for adding a foreign key constraint to an existing table. The method will properly quote the table and column names.</p> <h3 class="detailHeader" id="addPrimaryKey-detail"> addPrimaryKey() <span class="detailHeaderTag"> method (available since v1.1.13) </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>addPrimaryKey</b>(string $name, string $table, string|array $columns)</pre> </td></tr> <tr> <td class="paramNameCol">$name</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">name of the primary key constraint to add</td> </tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">name of the table to add primary key to</td> </tr> <tr> <td class="paramNameCol">$columns</td> <td class="paramTypeCol">string|array</td> <td class="paramDescCol">comma separated string or array of columns that the primary key will consist of. Array value can be passed since 1.1.14.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L433">framework/db/CDbMigration.php#433</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">addPrimaryKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">,</span><span style="color: #0000BB">$table</span><span style="color: #007700">,</span><span style="color: #0000BB">$columns</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; alter table </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> add constraint </span><span style="color: #0000BB">$name</span><span style="color: #DD0000"> primary key ("</span><span style="color: #007700">.(</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$columns</span><span style="color: #007700">) ? </span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">','</span><span style="color: #007700">, </span><span style="color: #0000BB">$columns</span><span style="color: #007700">) : </span><span style="color: #0000BB">$columns</span><span style="color: #007700">).</span><span style="color: #DD0000">") ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">addPrimaryKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">,</span><span style="color: #0000BB">$table</span><span style="color: #007700">,</span><span style="color: #0000BB">$columns</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Builds and executes a SQL statement for creating a primary key, supports composite primary keys.</p> <h3 class="detailHeader" id="alterColumn-detail"> alterColumn() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>alterColumn</b>(string $table, string $column, string $type)</pre> </td></tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table whose column is to be changed. The table name will be properly quoted by the method.</td> </tr> <tr> <td class="paramNameCol">$column</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the name of the column to be changed. The name will be properly quoted by the method.</td> </tr> <tr> <td class="paramNameCol">$type</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the new column type. The getColumnType method will be invoked to convert abstract column type (if any) into the physical one. Anything that is not recognized as abstract type will be kept in the generated SQL. For example, 'string' will be turned into 'varchar(255)', while 'string not null' will become 'varchar(255) not null'.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L342">framework/db/CDbMigration.php#342</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">alterColumn</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$column</span><span style="color: #007700">, </span><span style="color: #0000BB">$type</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; alter column </span><span style="color: #0000BB">$column</span><span style="color: #DD0000"> in table </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> to </span><span style="color: #0000BB">$type</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">alterColumn</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$column</span><span style="color: #007700">, </span><span style="color: #0000BB">$type</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Builds and executes a SQL statement for changing the definition of a column.</p> <h3 class="detailHeader" id="createIndex-detail"> createIndex() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>createIndex</b>(string $name, string $table, string|array $columns, boolean $unique=false)</pre> </td></tr> <tr> <td class="paramNameCol">$name</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the name of the index. The name will be properly quoted by the method.</td> </tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table that the new index will be created for. The table name will be properly quoted by the method.</td> </tr> <tr> <td class="paramNameCol">$columns</td> <td class="paramTypeCol">string|array</td> <td class="paramDescCol">the column(s) that should be included in the index. If there are multiple columns, please separate them by commas or pass as an array of column names. Each column name will be properly quoted by the method, unless a parenthesis is found in the name.</td> </tr> <tr> <td class="paramNameCol">$unique</td> <td class="paramTypeCol">boolean</td> <td class="paramDescCol">whether to add UNIQUE constraint on the created index.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L391">framework/db/CDbMigration.php#391</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">createIndex</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">, </span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$columns</span><span style="color: #007700">, </span><span style="color: #0000BB">$unique</span><span style="color: #007700">=</span><span style="color: #0000BB">false</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; create"</span><span style="color: #007700">.(</span><span style="color: #0000BB">$unique </span><span style="color: #007700">? </span><span style="color: #DD0000">' unique'</span><span style="color: #007700">:</span><span style="color: #DD0000">''</span><span style="color: #007700">).</span><span style="color: #DD0000">" index </span><span style="color: #0000BB">$name</span><span style="color: #DD0000"> on </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> ("</span><span style="color: #007700">.(</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$columns</span><span style="color: #007700">) ? </span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">','</span><span style="color: #007700">, </span><span style="color: #0000BB">$columns</span><span style="color: #007700">) : </span><span style="color: #0000BB">$columns</span><span style="color: #007700">).</span><span style="color: #DD0000">") ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createIndex</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">, </span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$columns</span><span style="color: #007700">, </span><span style="color: #0000BB">$unique</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Builds and executes a SQL statement for creating a new index.</p> <h3 class="detailHeader" id="createTable-detail"> createTable() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>createTable</b>(string $table, array $columns, string $options=NULL)</pre> </td></tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the name of the table to be created. The name will be properly quoted by the method.</td> </tr> <tr> <td class="paramNameCol">$columns</td> <td class="paramTypeCol">array</td> <td class="paramDescCol">the columns (name=&gt;definition) in the new table.</td> </tr> <tr> <td class="paramNameCol">$options</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">additional SQL fragment that will be appended to the generated SQL.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L246">framework/db/CDbMigration.php#246</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">createTable</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$columns</span><span style="color: #007700">, </span><span style="color: #0000BB">$options</span><span style="color: #007700">=</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; create table </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createTable</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$columns</span><span style="color: #007700">, </span><span style="color: #0000BB">$options</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Builds and executes a SQL statement for creating a new DB table. <br><br> The columns in the new table should be specified as name-definition pairs (e.g. 'name'=&gt;'string'), where name stands for a column name which will be properly quoted by the method, and definition stands for the column type which can contain an abstract DB type. The getColumnType method will be invoked to convert any abstract type into a physical one. <br><br> If a column is specified with definition only (e.g. 'PRIMARY KEY (name, type)'), it will be directly inserted into the generated SQL.</p> <h3 class="detailHeader" id="delete-detail"> delete() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>delete</b>(string $table, mixed $conditions='', array $params=array ( ))</pre> </td></tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table where the data will be deleted from.</td> </tr> <tr> <td class="paramNameCol">$conditions</td> <td class="paramTypeCol">mixed</td> <td class="paramDescCol">the conditions that will be put in the WHERE part. Please refer to <a href="cdbcommand#where">CDbCommand::where</a> on how to specify conditions.</td> </tr> <tr> <td class="paramNameCol">$params</td> <td class="paramTypeCol">array</td> <td class="paramDescCol">the parameters to be bound to the query.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L223">framework/db/CDbMigration.php#223</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">delete</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$conditions</span><span style="color: #007700">=</span><span style="color: #DD0000">''</span><span style="color: #007700">, </span><span style="color: #0000BB">$params</span><span style="color: #007700">=array())<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; delete from </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">delete</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$conditions</span><span style="color: #007700">, </span><span style="color: #0000BB">$params</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Creates and executes a DELETE SQL statement.</p> <h3 class="detailHeader" id="down-detail"> down() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public boolean <b>down</b>()</pre> </td></tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">boolean</td> <td class="paramDescCol">Returning false means, the migration will not be applied.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L74">framework/db/CDbMigration.php#74</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">down</span><span style="color: #007700">()<br>{<br>    </span><span style="color: #0000BB">$transaction</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">beginTransaction</span><span style="color: #007700">();<br>    try<br>    {<br>        if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">safeDown</span><span style="color: #007700">()===</span><span style="color: #0000BB">false</span><span style="color: #007700">)<br>        {<br>            </span><span style="color: #0000BB">$transaction</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">rollback</span><span style="color: #007700">();<br>            return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br>        }<br>        </span><span style="color: #0000BB">$transaction</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">commit</span><span style="color: #007700">();<br>    }<br>    catch(</span><span style="color: #0000BB">Exception $e</span><span style="color: #007700">)<br>    {<br>        echo </span><span style="color: #DD0000">"Exception: "</span><span style="color: #007700">.</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">().</span><span style="color: #DD0000">' ('</span><span style="color: #007700">.</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getFile</span><span style="color: #007700">().</span><span style="color: #DD0000">':'</span><span style="color: #007700">.</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLine</span><span style="color: #007700">().</span><span style="color: #DD0000">")\n"</span><span style="color: #007700">;<br>        echo </span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getTraceAsString</span><span style="color: #007700">().</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>        </span><span style="color: #0000BB">$transaction</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">rollback</span><span style="color: #007700">();<br>        return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br>    }<br>}</span></pre> </div> <p>This method contains the logic to be executed when removing this migration. Child classes may override this method if the corresponding migrations can be removed.</p> <h3 class="detailHeader" id="dropColumn-detail"> dropColumn() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>dropColumn</b>(string $table, string $column)</pre> </td></tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table whose column is to be dropped. The name will be properly quoted by the method.</td> </tr> <tr> <td class="paramNameCol">$column</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the name of the column to be dropped. The name will be properly quoted by the method.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L312">framework/db/CDbMigration.php#312</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">dropColumn</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$column</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; drop column </span><span style="color: #0000BB">$column</span><span style="color: #DD0000"> from table </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">dropColumn</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$column</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Builds and executes a SQL statement for dropping a DB column.</p> <h3 class="detailHeader" id="dropForeignKey-detail"> dropForeignKey() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>dropForeignKey</b>(string $name, string $table)</pre> </td></tr> <tr> <td class="paramNameCol">$name</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the name of the foreign key constraint to be dropped. The name will be properly quoted by the method.</td> </tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table whose foreign is to be dropped. The name will be properly quoted by the method.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L375">framework/db/CDbMigration.php#375</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">dropForeignKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">, </span><span style="color: #0000BB">$table</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; drop foreign key </span><span style="color: #0000BB">$name</span><span style="color: #DD0000"> from table </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">dropForeignKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">, </span><span style="color: #0000BB">$table</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Builds a SQL statement for dropping a foreign key constraint.</p> <h3 class="detailHeader" id="dropIndex-detail"> dropIndex() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>dropIndex</b>(string $name, string $table)</pre> </td></tr> <tr> <td class="paramNameCol">$name</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the name of the index to be dropped. The name will be properly quoted by the method.</td> </tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table whose index is to be dropped. The name will be properly quoted by the method.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L404">framework/db/CDbMigration.php#404</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">dropIndex</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">, </span><span style="color: #0000BB">$table</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; drop index </span><span style="color: #0000BB">$name</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">dropIndex</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">, </span><span style="color: #0000BB">$table</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Builds and executes a SQL statement for dropping an index.</p> <h3 class="detailHeader" id="dropPrimaryKey-detail"> dropPrimaryKey() <span class="detailHeaderTag"> method (available since v1.1.13) </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>dropPrimaryKey</b>(string $name, string $table)</pre> </td></tr> <tr> <td class="paramNameCol">$name</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">name of the constraint to remove</td> </tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">name of the table to remove primary key from</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L447">framework/db/CDbMigration.php#447</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">dropPrimaryKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">,</span><span style="color: #0000BB">$table</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; alter table </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> drop primary key </span><span style="color: #0000BB">$name</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">dropPrimaryKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">,</span><span style="color: #0000BB">$table</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Builds and executes a SQL statement for removing a primary key, supports composite primary keys.</p> <h3 class="detailHeader" id="dropTable-detail"> dropTable() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>dropTable</b>(string $table)</pre> </td></tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table to be dropped. The name will be properly quoted by the method.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L271">framework/db/CDbMigration.php#271</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">dropTable</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; drop table </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">dropTable</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Builds and executes a SQL statement for dropping a DB table.</p> <h3 class="detailHeader" id="execute-detail"> execute() <span class="detailHeaderTag"> method (available since v1.1.7) </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>execute</b>(string $sql, array $params=array ( ))</pre> </td></tr> <tr> <td class="paramNameCol">$sql</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the SQL statement to be executed</td> </tr> <tr> <td class="paramNameCol">$params</td> <td class="paramTypeCol">array</td> <td class="paramDescCol">input parameters (name=&gt;value) for the SQL execution. See <a href="cdbcommand#execute">CDbCommand::execute</a> for more details.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L160">framework/db/CDbMigration.php#160</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">, </span><span style="color: #0000BB">$params</span><span style="color: #007700">=array())<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; execute SQL: </span><span style="color: #0000BB">$sql</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$params</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Executes a SQL statement. This method executes the specified SQL statement using <a href="cdbmigration#dbConnection">dbConnection</a>.</p> <h3 class="detailHeader" id="getDbConnection-detail"> getDbConnection() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public <a href="cdbconnection">CDbConnection</a> <b>getDbConnection</b>()</pre> </td></tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol"><a href="cdbconnection">CDbConnection</a></td> <td class="paramDescCol">the currently active database connection</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L132">framework/db/CDbMigration.php#132</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()<br>{<br>    if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_db</span><span style="color: #007700">===</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>    {<br>        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_db</span><span style="color: #007700">=</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getComponent</span><span style="color: #007700">(</span><span style="color: #DD0000">'db'</span><span style="color: #007700">);<br>        if(!</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_db </span><span style="color: #007700">instanceof </span><span style="color: #0000BB">CDbConnection</span><span style="color: #007700">)<br>            throw new </span><span style="color: #0000BB">CException</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">t</span><span style="color: #007700">(</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">, </span><span style="color: #DD0000">'The "db" application component must be configured to be a CDbConnection object.'</span><span style="color: #007700">));<br>    }<br>    return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_db</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Returns the currently active database connection. By default, the 'db' application component will be returned and activated. You can call <a href="cdbmigration#setDbConnection">setDbConnection</a> to switch to a different database connection. Methods such as <a href="cdbmigration#insert">insert</a>, <a href="cdbmigration#createTable">createTable</a> will use this database connection to perform DB queries.</p> <h3 class="detailHeader" id="insert-detail"> insert() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>insert</b>(string $table, array $columns)</pre> </td></tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table that new rows will be inserted into.</td> </tr> <tr> <td class="paramNameCol">$columns</td> <td class="paramTypeCol">array</td> <td class="paramDescCol">the column data (name=&gt;value) to be inserted into the table.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L174">framework/db/CDbMigration.php#174</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">insert</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$columns</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; insert into </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">insert</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$columns</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Creates and executes an INSERT SQL statement. The method will properly escape the column names, and bind the values to be inserted.</p> <h3 class="detailHeader" id="insertMultiple-detail"> insertMultiple() <span class="detailHeaderTag"> method (available since v1.1.16) </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>insertMultiple</b>(string $table, array $data)</pre> </td></tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table that new rows will be inserted into.</td> </tr> <tr> <td class="paramNameCol">$data</td> <td class="paramTypeCol">array</td> <td class="paramDescCol">an array of various column data (name=&gt;value) to be inserted into the table.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L189">framework/db/CDbMigration.php#189</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">insertMultiple</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; insert into </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$builder</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getSchema</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getCommandBuilder</span><span style="color: #007700">();<br>    </span><span style="color: #0000BB">$command</span><span style="color: #007700">=</span><span style="color: #0000BB">$builder</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createMultipleInsertCommand</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">,</span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Creates and executes an INSERT SQL statement with multiple data. The method will properly escape the column names, and bind the values to be inserted.</p> <h3 class="detailHeader" id="refreshTableSchema-detail"> refreshTableSchema() <span class="detailHeaderTag"> method (available since v1.1.9) </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>refreshTableSchema</b>(string $table)</pre> </td></tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">name of the table to refresh</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L417">framework/db/CDbMigration.php#417</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">refreshTableSchema</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; refresh table </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> schema cache ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getSchema</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getTable</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">,</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Refreshed schema cache for a table</p> <h3 class="detailHeader" id="renameColumn-detail"> renameColumn() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>renameColumn</b>(string $table, string $name, string $newName)</pre> </td></tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table whose column is to be renamed. The name will be properly quoted by the method.</td> </tr> <tr> <td class="paramNameCol">$name</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the old name of the column. The name will be properly quoted by the method.</td> </tr> <tr> <td class="paramNameCol">$newName</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the new name of the column. The name will be properly quoted by the method.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L326">framework/db/CDbMigration.php#326</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">renameColumn</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$name</span><span style="color: #007700">, </span><span style="color: #0000BB">$newName</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; rename column </span><span style="color: #0000BB">$name</span><span style="color: #DD0000"> in table </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> to </span><span style="color: #0000BB">$newName</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">renameColumn</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$name</span><span style="color: #007700">, </span><span style="color: #0000BB">$newName</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Builds and executes a SQL statement for renaming a column.</p> <h3 class="detailHeader" id="renameTable-detail"> renameTable() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>renameTable</b>(string $table, string $newName)</pre> </td></tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table to be renamed. The name will be properly quoted by the method.</td> </tr> <tr> <td class="paramNameCol">$newName</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the new table name. The name will be properly quoted by the method.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L259">framework/db/CDbMigration.php#259</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">renameTable</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$newName</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; rename table </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> to </span><span style="color: #0000BB">$newName</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">renameTable</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$newName</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Builds and executes a SQL statement for renaming a DB table.</p> <h3 class="detailHeader" id="safeDown-detail"> safeDown() <span class="detailHeaderTag"> method (available since v1.1.7) </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public boolean <b>safeDown</b>()</pre> </td></tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">boolean</td> <td class="paramDescCol">Returning false means, the migration will not be applied and the transaction will be rolled back.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L119">framework/db/CDbMigration.php#119</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">safeDown</span><span style="color: #007700">()<br>{<br>}</span></pre> </div> <p>This method contains the logic to be executed when removing this migration. This method differs from <a href="cdbmigration#down">down</a> in that the DB logic implemented here will be enclosed within a DB transaction. Child classes may implement this method instead of <a href="cdbmigration#up">up</a> if the DB logic needs to be within a transaction.</p> <h3 class="detailHeader" id="safeUp-detail"> safeUp() <span class="detailHeaderTag"> method (available since v1.1.7) </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public boolean <b>safeUp</b>()</pre> </td></tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">boolean</td> <td class="paramDescCol">Returning false means, the migration will not be applied and the transaction will be rolled back.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L105">framework/db/CDbMigration.php#105</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">safeUp</span><span style="color: #007700">()<br>{<br>}</span></pre> </div> <p>This method contains the logic to be executed when applying this migration. This method differs from <a href="cdbmigration#up">up</a> in that the DB logic implemented here will be enclosed within a DB transaction. Child classes may implement this method instead of <a href="cdbmigration#up">up</a> if the DB logic needs to be within a transaction.</p> <h3 class="detailHeader" id="setDbConnection-detail"> setDbConnection() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>setDbConnection</b>(<a href="cdbconnection">CDbConnection</a> $db)</pre> </td></tr> <tr> <td class="paramNameCol">$db</td> <td class="paramTypeCol"><a href="cdbconnection">CDbConnection</a></td> <td class="paramDescCol">the database connection component</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L148">framework/db/CDbMigration.php#148</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">setDbConnection</span><span style="color: #007700">(</span><span style="color: #0000BB">$db</span><span style="color: #007700">)<br>{<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_db</span><span style="color: #007700">=</span><span style="color: #0000BB">$db</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Sets the currently active database connection. The database connection will be used by the methods such as <a href="cdbmigration#insert">insert</a>, <a href="cdbmigration#createTable">createTable</a>.</p> <h3 class="detailHeader" id="truncateTable-detail"> truncateTable() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>truncateTable</b>(string $table)</pre> </td></tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table to be truncated. The name will be properly quoted by the method.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L283">framework/db/CDbMigration.php#283</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">truncateTable</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">)<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; truncate table </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">truncateTable</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Builds and executes a SQL statement for truncating a DB table.</p> <h3 class="detailHeader" id="up-detail"> up() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public boolean <b>up</b>()</pre> </td></tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">boolean</td> <td class="paramDescCol">Returning false means, the migration will not be applied.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L48">framework/db/CDbMigration.php#48</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">up</span><span style="color: #007700">()<br>{<br>    </span><span style="color: #0000BB">$transaction</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">beginTransaction</span><span style="color: #007700">();<br>    try<br>    {<br>        if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">safeUp</span><span style="color: #007700">()===</span><span style="color: #0000BB">false</span><span style="color: #007700">)<br>        {<br>            </span><span style="color: #0000BB">$transaction</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">rollback</span><span style="color: #007700">();<br>            return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br>        }<br>        </span><span style="color: #0000BB">$transaction</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">commit</span><span style="color: #007700">();<br>    }<br>    catch(</span><span style="color: #0000BB">Exception $e</span><span style="color: #007700">)<br>    {<br>        echo </span><span style="color: #DD0000">"Exception: "</span><span style="color: #007700">.</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">().</span><span style="color: #DD0000">' ('</span><span style="color: #007700">.</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getFile</span><span style="color: #007700">().</span><span style="color: #DD0000">':'</span><span style="color: #007700">.</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLine</span><span style="color: #007700">().</span><span style="color: #DD0000">")\n"</span><span style="color: #007700">;<br>        echo </span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getTraceAsString</span><span style="color: #007700">().</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>        </span><span style="color: #0000BB">$transaction</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">rollback</span><span style="color: #007700">();<br>        return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br>    }<br>}</span></pre> </div> <p>This method contains the logic to be executed when applying this migration. Child classes may implement this method to provide actual migration logic.</p> <h3 class="detailHeader" id="update-detail"> update() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>update</b>(string $table, array $columns, mixed $conditions='', array $params=array ( ))</pre> </td></tr> <tr> <td class="paramNameCol">$table</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the table to be updated.</td> </tr> <tr> <td class="paramNameCol">$columns</td> <td class="paramTypeCol">array</td> <td class="paramDescCol">the column data (name=&gt;value) to be updated.</td> </tr> <tr> <td class="paramNameCol">$conditions</td> <td class="paramTypeCol">mixed</td> <td class="paramDescCol">the conditions that will be put in the WHERE part. Please refer to <a href="cdbcommand#where">CDbCommand::where</a> on how to specify conditions.</td> </tr> <tr> <td class="paramNameCol">$params</td> <td class="paramTypeCol">array</td> <td class="paramDescCol">the parameters to be bound to the query.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/db/CDbMigration.php#L208">framework/db/CDbMigration.php#208</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">update</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$columns</span><span style="color: #007700">, </span><span style="color: #0000BB">$conditions</span><span style="color: #007700">=</span><span style="color: #DD0000">''</span><span style="color: #007700">, </span><span style="color: #0000BB">$params</span><span style="color: #007700">=array())<br>{<br>    echo </span><span style="color: #DD0000">"    &gt; update </span><span style="color: #0000BB">$table</span><span style="color: #DD0000"> ..."</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$time</span><span style="color: #007700">=</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDbConnection</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">update</span><span style="color: #007700">(</span><span style="color: #0000BB">$table</span><span style="color: #007700">, </span><span style="color: #0000BB">$columns</span><span style="color: #007700">, </span><span style="color: #0000BB">$conditions</span><span style="color: #007700">, </span><span style="color: #0000BB">$params</span><span style="color: #007700">);<br>    echo </span><span style="color: #DD0000">" done (time: "</span><span style="color: #007700">.</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%.3f'</span><span style="color: #007700">, </span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)-</span><span style="color: #0000BB">$time</span><span style="color: #007700">).</span><span style="color: #DD0000">"s)\n"</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Creates and executes an UPDATE SQL statement. The method will properly escape the column names and bind the values to be updated.</p>
<div class="_attribution">
  <p class="_attribution-p">
    © 2008–2017 by Yii Software LLC<br>Licensed under the three clause BSD license.<br>
    <a href="http://www.yiiframework.com/doc/api/1.1/CDbMigration" class="_attribution-link">http://www.yiiframework.com/doc/api/1.1/CDbMigration</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
