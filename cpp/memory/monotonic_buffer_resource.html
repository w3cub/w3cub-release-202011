
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Std&#58;&#58;pmr&#58;&#58;monotonic_buffer_resource - C++ - W3cubDocs</title>
  
  <meta name="description" content="The class std&#58;&#58;pmr&#58;&#58;monotonic_buffer_resource is a special-purpose memory resource class that releases the allocated memory only &hellip;">
  <meta name="keywords" content="std, pmr, monotonic, buffer, resource, c++, cpp">
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/cpp/memory/monotonic_buffer_resource.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-1810d67ab7e57be09d8247710d2feb6954566959eb82322d1fee3a0c9156f56974b78ebaa9928774f00767342bbe58b0799d91fcc336b92b319170b196f9b64b.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/cpp.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/cpp/" class="_nav-link" title="" style="margin-left:0;">C++</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _c">
				
				
<h1 id="firstHeading" class="firstHeading">std::pmr::monotonic_buffer_resource</h1>            <table class="t-dcl-begin"> <tr class="t-dsc-header"> <th> Defined in header <code><a href="../header/memory_resource" title="cpp/header/memory resource">&lt;memory_resource&gt;</a></code> </th> <th> </th> <th> </th> </tr> <tr class="t-dcl t-since-cxx17"> <td> <pre data-language="cpp">class monotonic_buffer_resource : public std::pmr::memory_resource;</pre>
</td> <td class="t-dcl-nopad"> </td> <td> <span class="t-mark-rev t-since-cxx17">(since C++17)</span> </td> </tr>  </table> <p>The class <code>std::pmr::monotonic_buffer_resource</code> is a special-purpose memory resource class that releases the allocated memory only when the resource is destroyed. It is intended for very fast memory allocations in situations where memory is used to build up a few objects and then is released all at once.</p>
<p><code>monotonic_buffer_resource</code> can be constructed with an initial buffer. If there is no initial buffer, or if the buffer is exhausted, additional buffers are obtained from an <i>upstream memory resource</i> supplied at construction. The size of buffers obtained follows a geometric progression.</p>
<p><code>monotonic_buffer_resource</code> is not thread-safe.</p>
<h3 id="Member_functions"> Member functions</h3> <table class="t-dsc-begin"> <tr class="t-dsc"> <td> <div><a href="monotonic_buffer_resource/monotonic_buffer_resource" title="cpp/memory/monotonic buffer resource/monotonic buffer resource"> <span class="t-lines"><span>(constructor)</span></span></a></div> </td> <td> Constructs a <code>monotonic_buffer_resource</code> <br> <span class="t-mark">(public member function)</span>  </td>
</tr> <tr class="t-dsc"> <td> <div><a href="monotonic_buffer_resource/~monotonic_buffer_resource" title="cpp/memory/monotonic buffer resource/~monotonic buffer resource"> <span class="t-lines"><span>(destructor)</span></span></a></div>
<div><span class="t-lines"><span><span class="t-cmark">[virtual]</span></span></span></div> </td> <td> Destroys a <code>monotonic_buffer_resource</code>, releasing all allocated memory <br> <span class="t-mark">(virtual public member function)</span>  </td>
</tr> <tr class="t-dsc"> <td> <div><span class="t-lines"><span>operator=</span></span></div>
<div><span class="t-lines"><span><span class="t-cmark">[deleted]</span></span></span></div> </td> <td> Copy assignment operator is deleted. <code>monotonic_buffer_resource</code> is not copy assignable <br> <span class="t-mark">(public member function)</span>  </td>
</tr> <tr> <td colspan="2"> <h5 id="Public_member_functions">  Public member functions </h5> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="monotonic_buffer_resource/release" title="cpp/memory/monotonic buffer resource/release"> <span class="t-lines"><span>release</span></span></a></div> </td> <td> Release all allocated memory <br> <span class="t-mark">(public member function)</span>  </td>
</tr> <tr class="t-dsc"> <td> <div><a href="monotonic_buffer_resource/upstream_resource" title="cpp/memory/monotonic buffer resource/upstream resource"> <span class="t-lines"><span>upstream_resource</span></span></a></div> </td> <td> Returns a pointer to the upstream memory resource <br> <span class="t-mark">(public member function)</span>  </td>
</tr> <tr> <td colspan="2"> <h5 id="Protected_member_functions">  Protected member functions </h5> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="monotonic_buffer_resource/do_allocate" title="cpp/memory/monotonic buffer resource/do allocate"> <span class="t-lines"><span>do_allocate</span></span></a></div>
<div><span class="t-lines"><span><span class="t-cmark">[virtual]</span></span></span></div> </td> <td> Allocate memory <br> <span class="t-mark">(virtual protected member function)</span>  </td>
</tr> <tr class="t-dsc"> <td> <div><a href="monotonic_buffer_resource/do_deallocate" title="cpp/memory/monotonic buffer resource/do deallocate"> <span class="t-lines"><span>do_deallocate</span></span></a></div>
<div><span class="t-lines"><span><span class="t-cmark">[virtual]</span></span></span></div> </td> <td> No-op <br> <span class="t-mark">(virtual protected member function)</span>  </td>
</tr> <tr class="t-dsc"> <td> <div><a href="monotonic_buffer_resource/do_is_equal" title="cpp/memory/monotonic buffer resource/do is equal"> <span class="t-lines"><span>do_is_equal</span></span></a></div>
<div><span class="t-lines"><span><span class="t-cmark">[virtual]</span></span></span></div> </td> <td> Compare for equality with another <code><a href="memory_resource" title="cpp/memory/memory resource">std::pmr::memory_resource</a></code> <br> <span class="t-mark">(virtual protected member function)</span>  </td>
</tr> </table> <h3 id="Example"> Example</h3> <p>The program measures the time of creating huge double-linked lists using the following allocators:</p>
<ul>
<li> default standard allocator, </li>
<li> default <code>pmr</code> allocator, </li>
<li> <code>pmr</code> allocator with monotonic resource but without explicit memory buffer, </li>
<li> <code>pmr</code> allocator with monotonic resource and external memory buffer (on stack). </li>
</ul> <div class="t-example"> <div class="cpp source-cpp"><pre data-language="cpp">#include &lt;list&gt;
#include &lt;array&gt;
#include &lt;chrono&gt;
#include &lt;cstddef&gt;
#include &lt;iomanip&gt;
#include &lt;iostream&gt;
#include &lt;memory_resource&gt;
 
template &lt;typename Func&gt;
auto benchmark(Func test_func, int iterations) {
    const auto start = std::chrono::system_clock::now();
    while (iterations-- &gt; 0) { test_func(); }
    const auto stop = std::chrono::system_clock::now();
    const auto secs = std::chrono::duration&lt;double&gt;(stop - start);
    return secs.count();
}
 
int main()
{
    constexpr int iterations{100};
    constexpr int total_nodes{2'00'000};
 
    auto default_std_alloc = [total_nodes] {
        std::list&lt;int&gt; list;
        for (int i{}; i != total_nodes; ++i) { list.push_back(i); }
    };
 
    auto default_pmr_alloc = [total_nodes] {
        std::pmr::list&lt;int&gt; list;
        for (int i{}; i != total_nodes; ++i) { list.push_back(i); }
    };
 
    auto pmr_alloc_no_buf = [total_nodes] {
        std::pmr::monotonic_buffer_resource mbr;
        std::pmr::polymorphic_allocator&lt;int&gt; pa{&amp;mbr};
        std::pmr::list&lt;int&gt; list{pa};
        for (int i{}; i != total_nodes; ++i) { list.push_back(i); }
    };
 
    auto pmr_alloc_and_buf = [total_nodes] {
        std::array&lt;std::byte, total_nodes * 32&gt; buffer; // enough to fit in all nodes
        std::pmr::monotonic_buffer_resource mbr{buffer.data(), buffer.size()};
        std::pmr::polymorphic_allocator&lt;int&gt; pa{&amp;mbr};
        std::pmr::list&lt;int&gt; list{pa};
        for (int i{}; i != total_nodes; ++i) { list.push_back(i); }
    };
 
    const double t1 = benchmark(default_std_alloc, iterations);
    const double t2 = benchmark(default_pmr_alloc, iterations);
    const double t3 = benchmark(pmr_alloc_no_buf , iterations);
    const double t4 = benchmark(pmr_alloc_and_buf, iterations);
 
    std::cout &lt;&lt; std::fixed &lt;&lt; std::setprecision(3)
              &lt;&lt; "t1 (default std alloc): " &lt;&lt; t1 &lt;&lt; " sec; t1/t1: " &lt;&lt; t1/t1 &lt;&lt; '\n'
              &lt;&lt; "t2 (default pmr alloc): " &lt;&lt; t2 &lt;&lt; " sec; t1/t2: " &lt;&lt; t1/t2 &lt;&lt; '\n'
              &lt;&lt; "t3 (pmr alloc  no buf): " &lt;&lt; t3 &lt;&lt; " sec; t1/t3: " &lt;&lt; t1/t3 &lt;&lt; '\n'
              &lt;&lt; "t4 (pmr alloc and buf): " &lt;&lt; t4 &lt;&lt; " sec; t1/t4: " &lt;&lt; t1/t4 &lt;&lt; '\n';
}</pre></div> <p>Possible output:</p>
<div class="text source-text"><pre data-language="c">t1 (default std alloc): 0.720 sec; t1/t1: 1.000
t2 (default pmr alloc): 0.915 sec; t1/t2: 0.787
t3 (pmr alloc  no buf): 0.370 sec; t1/t3: 1.945
t4 (pmr alloc and buf): 0.247 sec; t1/t4: 2.914</pre></div> </div>           <div class="_attribution">
  <p class="_attribution-p">
    Â© cppreference.com<br>Licensed under the Creative Commons Attribution-ShareAlike Unported License v3.0.<br>
    <a href="https://en.cppreference.com/w/cpp/memory/monotonic_buffer_resource" class="_attribution-link">https://en.cppreference.com/w/cpp/memory/monotonic_buffer_resource</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
