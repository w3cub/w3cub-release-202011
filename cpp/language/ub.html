
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Undefined Behavior - C++ - W3cubDocs</title>
  
  <meta name="description" content=" Renders the entire program meaningless if certain rules of the language are violated. ">
  <meta name="keywords" content="undefined, behavior, c++, cpp">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/cpp/language/ub.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/cpp.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/cpp/" class="_nav-link" title="" style="margin-left:0;">C++</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _c">
				
				
<h1 id="firstHeading" class="firstHeading">Undefined behavior</h1>            <p>Renders the entire program meaningless if certain rules of the language are violated.</p>
<h3 id="Explanation">Explanation</h3> <p>The C++ standard precisely defines the <a href="as_if" title="cpp/language/as if">observable behavior</a> of every C++ program that does not fall into one of the following classes:</p>
<ul>
<li> <i>ill-formed</i> - the program has syntax errors or diagnosable semantic errors. A conforming C++ compiler is required to issue a diagnostic, even if it defines a language extension that assigns meaning to such code (such as with variable-length arrays). The text of the standard uses <i>shall</i>, <i>shall not</i>, and <i>ill-formed</i> to indicate these requirements. </li>
<li> <i>ill-formed no diagnostic required</i> - the program has semantic errors which may not be diagnosable in general case (e.g. violations of the <a href="definition" title="cpp/language/definition">ODR</a> or other errors that are only detectable at link time). The behavior is undefined if such program is executed. </li>
<li> <i>implementation-defined behavior</i> - the behavior of the program varies between implementations, and the conforming implementation must document the effects of each behavior. For example, the type of <code><a href="../types/size_t" title="cpp/types/size t">std::size_t</a></code> or the number of bits in a byte, or the text of <code><a href="../memory/new/bad_alloc" title="cpp/memory/new/bad alloc">std::bad_alloc::what</a></code>. A subset of implementation-defined behavior is <i>locale-specific behavior</i>, which depends on the implementation-supplied <a href="../locale" title="cpp/locale">locale</a>. </li>
<li> <i>unspecified behavior</i> - the behavior of the program varies between implementations and the conforming implementation is not required to document the effects of each behavior. For example, <a href="eval_order" title="cpp/language/eval order">order of evaluation</a>, whether identical <a href="string_literal" title="cpp/language/string literal">string literals</a> are distinct, the amount of array allocation overhead, etc. Each unspecified behavior results in one of a set of valid results. </li>
<li> <i>undefined behavior</i> - there are no restrictions on the behavior of the program. Examples of undefined behavior are memory accesses outside of array bounds, signed integer overflow, null pointer dereference, modification of the same scalar <a href="eval_order" title="cpp/language/eval order">more than once</a> in an expression without sequence points, access to an object through a pointer of a different type, etc. Compilers are not required to diagnose undefined behavior (although many simple situations are diagnosed), and the compiled program is not required to do anything meaningful. </li>
</ul> <h3 id="UB_and_optimization">UB and optimization</h3> <p>Because correct C++ programs are free of undefined behavior, compilers may produce unexpected results when a program that actually has UB is compiled with optimization enabled:</p>
<p>For example,</p>
<h4 id="Signed_overflow">Signed overflow</h4> <div class="cpp source-cpp"><pre data-language="cpp">int foo(int x) {
    return x+1 &gt; x; // either true or UB due to signed overflow
}</pre></div> <p>may be compiled as (<a rel="nofollow" class="external text" href="https://godbolt.org/z/y4vIi1">demo</a>).</p>
<div class="cpp source-cpp"><pre data-language="cpp">foo(int):
        movl    $1, %eax
        ret</pre></div> <h4 id="Access_out_of_bounds">Access out of bounds</h4> <div class="cpp source-cpp"><pre data-language="cpp">int table[4] = {};
bool exists_in_table(int v)
{
    // return true in one of the first 4 iterations or UB due to out-of-bounds access
    for (int i = 0; i &lt;= 4; i++) {
        if (table[i] == v) return true;
    }
    return false;
}</pre></div> <p>May be compiled as (<a rel="nofollow" class="external text" href="https://godbolt.org/z/e2bC84">demo</a>).</p>
<div class="cpp source-cpp"><pre data-language="cpp">exists_in_table(int):
        movl    $1, %eax
        ret</pre></div> <h4 id="Uninitialized_scalar">Uninitialized scalar</h4> <div class="cpp source-cpp"><pre data-language="cpp">std::size_t f(int x)
{
    std::size_t a;
    if(x) // either x nonzero or UB
        a = 42;
    return a; 
}</pre></div> <p>May be compiled as (<a rel="nofollow" class="external text" href="https://godbolt.org/z/QYZvsl">demo</a>).</p>
<div class="cpp source-cpp"><pre data-language="cpp">f(int):
        mov     eax, 42
        ret</pre></div> <div class="t-example">
<p>the output shown was observed on an older version of gcc.</p>
<div class="cpp source-cpp"><pre data-language="cpp">bool p; // uninitialized local variable
if(p) // UB access to uninitialized scalar
    std::puts("p is true");
if(!p) // UB access to uninitialized scalar
    std::puts("p is false");</pre></div> <p>Possible output:</p>
<div class="text source-text"><pre data-language="c">p is true
p is false</pre></div> </div> <h4 id="Invalid_scalar">Invalid scalar</h4> <div class="cpp source-cpp"><pre data-language="cpp">int f() {
  bool b = true;
  unsigned char* p = reinterpret_cast&lt;unsigned char*&gt;(&amp;b);
  *p = 10;
  // reading from b is now UB
  return b == 0;
}</pre></div> <p>May be compiled as (<a rel="nofollow" class="external text" href="https://gcc.godbolt.org/z/6itUO1">demo</a>).</p>
<div class="cpp source-cpp"><pre data-language="cpp">f():
        movl    $11, %eax
        ret</pre></div> <h4 id="Null_pointer_dereference">Null pointer dereference</h4> <div class="cpp source-cpp"><pre data-language="cpp">int foo(int* p) {
    int x = *p;
    if(!p) return x; // Either UB above or this branch is never taken
    else return 0;
}
int bar() {
    int* p = nullptr;
    return *p;        // Unconditional UB
}</pre></div> <p>may be compiled as (<a rel="nofollow" class="external text" href="https://godbolt.org/z/kzr8VJ">foo with gcc, bar with clang</a>).</p>
<div class="cpp source-cpp"><pre data-language="cpp">foo(int*):
        xorl    %eax, %eax
        ret
bar():
        retq</pre></div> <h4 id="Access_to_pointer_passed_to_realloc">Access to pointer passed to realloc</h4> <div class="t-example">
<p>Choose clang to observe the output shown.</p>
<div class="cpp source-cpp"><pre data-language="cpp">#include &lt;iostream&gt;
#include &lt;cstdlib&gt;
int main() {
    int *p = (int*)std::malloc(sizeof(int));
    int *q = (int*)std::realloc(p, sizeof(int));
    *p = 1; // UB access to a pointer that was passed to realloc
    *q = 2;
    if (p == q) // UB access to a pointer that was passed to realloc
        std::cout &lt;&lt; *p &lt;&lt; *q &lt;&lt; '\n';
}</pre></div> <p>Possible output:</p>
<div class="text source-text"><pre data-language="c">12</pre></div> </div> <h4 id="Infinite_loop_without_side-effects">Infinite loop without side-effects</h4> <div class="t-example">
<p>Choose clang to observe the output shown.</p>
<div class="cpp source-cpp"><pre data-language="cpp">#include &lt;iostream&gt;
 
int fermat() {
  const int MAX = 1000;
  int a=1,b=1,c=1;
  // Endless loop with no side effects is UB
  while (1) {
    if (((a*a*a) == ((b*b*b)+(c*c*c)))) return 1;
    a++;
    if (a&gt;MAX) { a=1; b++; }
    if (b&gt;MAX) { b=1; c++; }
    if (c&gt;MAX) { c=1;}
  }
  return 0;
}
 
int main() {
  if (fermat())
    std::cout &lt;&lt; "Fermat's Last Theorem has been disproved.\n";
  else
    std::cout &lt;&lt; "Fermat's Last Theorem has not been disproved.\n";
}</pre></div> <p>Possible output:</p>
<div class="text source-text"><pre data-language="c">Fermat's Last Theorem has been disproved.</pre></div> </div> <h3 id="External_links">External links</h3> <ul>
<li> <a rel="nofollow" class="external text" href="http://blog.llvm.org/2011/05/what-every-c-programmer-should-know.html">What Every C Programmer Should Know About Undefined Behavior #1/3</a> </li>
<li> <a rel="nofollow" class="external text" href="http://blog.llvm.org/2011/05/what-every-c-programmer-should-know_14.html">What Every C Programmer Should Know About Undefined Behavior #2/3</a> </li>
<li> <a rel="nofollow" class="external text" href="http://blog.llvm.org/2011/05/what-every-c-programmer-should-know_21.html">What Every C Programmer Should Know About Undefined Behavior #3/3</a> </li>
<li> <a rel="nofollow" class="external text" href="http://blogs.msdn.com/b/oldnewthing/archive/2014/06/27/10537746.aspx">Undefined behavior can result in time travel (among other things, but time travel is the funkiest)</a> </li>
<li> <a rel="nofollow" class="external text" href="http://www.cs.utah.edu/~regehr/papers/overflow12.pdf">Understanding Integer Overflow in C/C++</a> </li>
<li> <a rel="nofollow" class="external text" href="http://kukuruku.co/hub/cpp/undefined-behavior-and-fermats-last-theorem">Undefined Behavior and Fermat’s Last Theorem</a> </li>
<li> <a rel="nofollow" class="external text" href="http://lwn.net/Articles/342330/">Fun with NULL pointers, part 1</a> (local exploit in Linux 2.6.30 caused by UB due to null pointer dereference) </li>
</ul> <h3 id="See_also">See also</h3>           <div class="_attribution">
  <p class="_attribution-p">
    © cppreference.com<br>Licensed under the Creative Commons Attribution-ShareAlike Unported License v3.0.<br>
    <a href="http://en.cppreference.com/w/cpp/language/ub" class="_attribution-link">http://en.cppreference.com/w/cpp/language/ub</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
