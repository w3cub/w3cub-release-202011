
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>java.lang.instrument - OpenJDK 21 - W3cubDocs</title>
  
  <meta name="description" content="The class files that comprise an agent are packaged into a JAR file, either with the application in an executable JAR, or more commonly, as a &hellip;">
  <meta name="keywords" content="package, java, lang, instrument, openjdk, openjdk~21">
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/openjdk~21/java.instrument/java/lang/instrument/package-summary.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-c8f743fc70bb84079c3cf4b71f5f99835529659c30689b2fd6193651a680f383ef1d96896f8966c7ca8a0160ffd557685bb8ad12820ec6002d60143812238086.css">
  <script type="text/javascript" src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js"></script>
  <script src="/json/openjdk~21.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/openjdk~21/" class="_nav-link" title="" style="margin-left:0;">OpenJDK 21</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _openjdk">
				
				
<h1 title="Package java.lang.instrument" class="title">Package java.lang.instrument</h1>  <div class="package-signature">package <span class="element-name">java.lang.instrument</span>
</div> <section class="package-description" id="package-description"> <div class="block">Provides services that allow Java programming language agents to instrument programs running on the Java Virtual Machine (JVM). The mechanism for instrumentation is modification of the bytecodes of methods. <p> The class files that comprise an agent are packaged into a JAR file, either with the application in an executable JAR, or more commonly, as a separate JAR file called an <em>agent JAR</em>. An attribute in the main manifest of the JAR file identifies one of the class files in the JAR file as the <em>agent class</em>. The agent class defines a special method that the JVM invokes to <em>start</em> the agent. </p>
<p> Agents that are packaged with an application in an executable JAR are started at JVM statup time. Agents that are packaged into an agent JAR file may be started at JVM startup time via a command line option, or where an implementation supports it, started in a running JVM. </p>
<p> Agents can transform classes in arbitrary ways at load time, transform modules, or transform the bytecode of methods of already loaded classes. Developers or administrators that deploy agents, deploy applications that package an agent with the application, or use tools that load agents into a running application, are responsible for verifying the trustworthiness of each agent including the content and structure of the agent JAR file. </p>
<h2 id="starting-an-agent-heading">Starting an agent</h2> <h3 id="starting-an-agent-packaged-with-an-application-in-an-executable-jar-file-heading">Starting an agent packaged with an application in an executable JAR file</h3> <p> The <a href="https://docs.oracle.com/en/java/javase/21/docs/specs/jar/jar.html">JAR File Specification</a> defines manifest attributes for standalone applications that are packaged as <em>executable JAR files</em>. If an implementation supports a mechanism to start an application as an executable JAR, then the main manifest of the JAR file can include the <code>Launcher-Agent-Class</code> attribute to specify the binary name of the Java agent class that is packaged with the application. If the attribute is present then the JVM starts the agent by loading the agent class and invoking its <code>agentmain</code> method. The method is invoked before the application <code>main</code> method is invoked. The <code>agentmain</code> method has one of two possible signatures. The JVM first attempts to invoke the following method on the agent class: </p>
<blockquote><code>
     public static void agentmain(String agentArgs, Instrumentation inst)
 </code></blockquote> <p> If the agent class does not define this method then the JVM will attempt to invoke: </p>
<blockquote><code>
     public static void agentmain(String agentArgs)
 </code></blockquote> <p> The value of the <code>agentArgs</code> parameter is always the empty string. In the first method, the <code>inst</code> parameter is an <a href="instrumentation" title="interface in java.lang.instrument"><code>Instrumentation</code></a> object that the agent can use to instrument code. </p>
<p> The <code>agentmain</code> method should do any necessary initialization required to start the agent and return. If the agent cannot be started, for example the agent class cannot be loaded, the agent class does not define a conformant <code>agentmain</code> method, or the <code>agentmain</code> method throws an uncaught exception or error, the JVM will abort before the application <code>main</code> method is invoked. </p>
<h3 id="starting-an-agent-from-the-command-line-interface-heading">Starting an agent from the command-line interface</h3> <p> Where an implementation provides a means to start agents from the command-line interface, an agent JAR is specified via the following command line option: </p>
<blockquote><code>
     -javaagent:&lt;jarpath&gt;[=&lt;options&gt;]
 </code></blockquote> where <i><code>&lt;jarpath&gt;</code></i> is the path to the agent JAR file and <i><code>&lt;options&gt;</code></i> is the agent options. <p> The main manifest of the agent JAR file must contain the attribute <code>
 Premain-Class</code>. The value of this attribute is the binary name of the agent class in the JAR file. The JVM starts the agent by loading the agent class and invoking its <code>premain</code> method. The method is invoked before the application <code>main</code> method is invoked. The <code>premain</code> method has one of two possible signatures. The JVM first attempts to invoke the following method on the agent class: </p>
<blockquote><code>
     public static void premain(String agentArgs, Instrumentation inst)
 </code></blockquote> <p> If the agent class does not define this method then the JVM will attempt to invoke: </p>
<blockquote><code>
     public static void premain(String agentArgs)
 </code></blockquote> <p> The agent is passed its agent options via the <code>agentArgs</code> parameter. The agent options are passed as a single string, any additional parsing should be performed by the agent itself. In the first method, the <code>inst</code> parameter is an <a href="instrumentation" title="interface in java.lang.instrument"><code>Instrumentation</code></a> object that the agent can use to instrument code. </p>
<p> If the agent cannot be started, for example the agent class cannot be loaded, the agent class does not define a conformant <code>premain</code> method, or the <code>
 premain</code> method throws an uncaught exception or error, the JVM will abort before the application <code>main</code> method is invoked. </p>
<p> An implementation is not required to provide a way to start agents from the command-line interface. When it does, then it supports the <code>-javaagent</code> option as specified above. The <code>-javaagent</code> option may be used multiple times on the same command-line, thus starting multiple agents. The <code>premain</code> methods will be called in the order that the agents are specified on the command line. More than one agent may use the same <i><code>&lt;jarpath&gt;</code></i>. </p>
<p> The agent class may also have an <code>agentmain</code> method for use when the agent is started after in a running JVM (see below). When the agent is started using a command-line option, the <code>agentmain</code> method is not invoked. </p>
<h3 id="starting-an-agent-in-a-running-jvm-heading">Starting an agent in a running JVM</h3> <p> An implementation may provide a mechanism to start agents in a running JVM (meaning after JVM startup). The details as to how this is initiated are implementation specific but typically the application has already started, and its <code>main</code> method has already been invoked. Where an implementation supports starting an agent in a running JVM, the following applies: </p>
<ol> <li><p> The agent class must be packaged into an agent JAR file. The main manifest of the agent JAR file must contain the attribute <code>Agent-Class</code>. The value of this attribute is the binary name of the agent class in the JAR file. </p></li> <li><p> The agent class must define a public static <code>agentmain</code> method. </p></li> <li>
<p> The JVM prints a warning on the standard error stream for each agent that it attempts to start in a running JVM. If an agent was previously started (at JVM startup, or started in a running JVM), then it is implementation specific as to whether a warning is printed when attempting to start the same agent a second or subsequent time. Warnings can be disabled by means of an implementation-specific command line option. </p>
<p><b>Implementation Note:</b> For the HotSpot VM, the JVM option <code>-XX:+EnableDynamicAgentLoading</code> is used to opt-in to allow dynamic loading of agents into a running JVM. This option suppresses the warning to standard error when starting an agent in a running JVM. </p>
</li> </ol> <p> The JVM starts the agent by loading the agent class and invoking its <code>
 agentmain</code> method. The <code>agentmain</code> method has one of two possible signatures. The JVM first attempts to invoke the following method on the agent class: </p>
<blockquote><code>
     public static void agentmain(String agentArgs, Instrumentation inst)
 </code></blockquote> <p> If the agent class does not define this method then the JVM will attempt to invoke: </p>
<blockquote><code>
     public static void agentmain(String agentArgs)
 </code></blockquote> <p> The agent is passed its agent options via the <code>agentArgs</code> parameter. The agent options are passed as a single string, any additional parsing should be performed by the agent itself. In the first method, the <code>inst</code> parameter is an <a href="instrumentation" title="interface in java.lang.instrument"><code>Instrumentation</code></a> object that the agent can use to instrument code. </p>
<p> The <code>agentmain</code> method should do any necessary initialization required to start the agent. When startup is complete the method should return. If the agent cannot be started (for example, because the agent class cannot be loaded, or because the agent class does not have a conformant <code>agentmain</code> method), the JVM will not abort. If the <code>agentmain</code> method throws an uncaught exception it will be ignored (but may be logged by the JVM for troubleshooting purposes). </p>
<p> The agent class may also have a <code>premain</code> method for use when the agent is started using a command-line option. The <code>premain</code> method is not invoked when the agent is started in a running JVM. </p>
<h2 id="loading-agent-classes-and-the-modules-classes-available-to-the-agent-class-heading"> Loading agent classes and the modules/classes available to the agent class </h2> <p> Classes loaded from the agent JAR file are loaded by the <a href="../../../../java.base/java/lang/classloader#getSystemClassLoader()">system class loader</a> and are members of the system class loader's <a href="../../../../java.base/java/lang/classloader#getUnnamedModule()">unnamed module</a>. The system class loader typically defines the class containing the application <code>main</code> method too. </p>
<p> The classes visible to the agent class are the classes visible to the system class loader and minimally include: </p>
<ul> <li><p> The classes in packages exported by the modules in the <a href="../../../../java.base/java/lang/modulelayer#boot()">boot layer</a>. Whether the boot layer contains all platform modules or not will depend on the initial module or how the application was started. </p></li> <li><p> The classes that can be defined by the system class loader (typically the class path) to be members of its unnamed module. </p></li> <li><p> Any classes that the agent arranges to be defined by the bootstrap class loader to be members of its unnamed module. </p></li> </ul> <p> If agent classes need to link to classes in platform (or other) modules that are not in the boot layer then the application may need to be started in a way that ensures that these modules are in the boot layer. In the JDK implementation for example, the <code>--add-modules</code> command line option can be used to add modules to the set of root modules to resolve at startup. </p> <p> Supporting classes that the agent arranges to be loaded by the bootstrap class loader (by means of <a href="instrumentation#appendToBootstrapClassLoaderSearch(java.util.jar.JarFile)"><code>appendToBootstrapClassLoaderSearch</code></a> or the <code>Boot-Class-Path</code> attribute specified below), must link only to classes defined to the bootstrap class loader. There is no guarantee that all platform classes can be defined by the boot class loader. </p>
<p> If a custom system class loader is configured (by means of the system property <code>java.system.class.loader</code> as specified in the <a href="../../../../java.base/java/lang/classloader#getSystemClassLoader()"><code>getSystemClassLoader</code></a> method) then it must define the <code>appendToClassPathForInstrumentation</code> method as specified in <a href="instrumentation#appendToSystemClassLoaderSearch(java.util.jar.JarFile)"><code>appendToSystemClassLoaderSearch</code></a>. In other words, a custom system class loader must support the mechanism to add an agent JAR file to the system class loader search. </p>
<h2 id="jar-file-manifest-attributes-heading">JAR File Manifest Attributes</h2> <p> The following attributes in the main section of the application or agent JAR file manifest are defined for Java agents: </p>
<blockquote><dl> <dt><code>Launcher-Agent-Class</code></dt> <dd> If an implementation supports a mechanism to start an application in an executable JAR file, then this attribute, if present, specifies the binary name of the agent class that is packaged with the application. The agent is started by invoking the agent class <code>agentmain</code> method. It is invoked before the application <code>main</code> method is invoked. </dd> <dt><code>Premain-Class</code></dt> <dd> If an agent JAR is specified at JVM launch time, this attribute specifies the binary name of the agent class in the JAR file. The agent is started by invoking the agent class <code>premain</code> method. It is invoked before the application <code>main</code> method is invoked. If the attribute is not present the JVM will abort. </dd> <dt><code>Agent-Class</code></dt> <dd> If an implementation supports a mechanism to start an agent sometime after the JVM has started, then this attribute specifies the binary name of the Java agent class in the agent JAR file. The agent is started by invoking the agent class <code>agentmain</code> method. This attribute is required; if not present the agent will not be started. </dd> <dt><code>Boot-Class-Path</code></dt> <dd> A list of paths to be searched by the bootstrap class loader. Paths represent directories or libraries (commonly referred to as JAR or zip libraries on many platforms). These paths are searched by the bootstrap class loader after the platform specific mechanisms of locating a class have failed. Paths are searched in the order listed. Paths in the list are separated by one or more spaces. A path takes the syntax of the path component of a hierarchical URI. The path is absolute if it begins with a slash character ('/'), otherwise it is relative. A relative path is resolved against the absolute path of the agent JAR file. Malformed and non-existent paths are ignored. When an agent is started sometime after the JVM has started then paths that do not represent a JAR file are ignored. This attribute is optional. </dd> <dt><code>Can-Redefine-Classes</code></dt> <dd> Boolean (<code>true</code> or <code>false</code>, case irrelevant). Is the ability to redefine classes needed by this agent. Values other than <code>true</code> are considered <code>false</code>. This attribute is optional, the default is <code>
 false</code>. </dd> <dt><code>Can-Retransform-Classes</code></dt> <dd> Boolean (<code>true</code> or <code>false</code>, case irrelevant). Is the ability to retransform classes needed by this agent. Values other than <code>true</code> are considered <code>false</code>. This attribute is optional, the default is <code>false</code>. </dd> <dt><code>Can-Set-Native-Method-Prefix</code></dt> <dd> Boolean (<code>true</code> or <code>false</code>, case irrelevant). Is the ability to set native method prefix needed by this agent. Values other than <code>
 true</code> are considered <code>false</code>. This attribute is optional, the default is <code>false</code>. </dd> </dl></blockquote> <p> An agent JAR file may have both the <code>Premain-Class</code> and <code>
 Agent-Class</code> attributes present in the manifest. When the agent is started on the command-line using the <code>-javaagent</code> option then the <code>
 Premain-Class</code> attribute specifies the binary name of the agent class and the <code>
 Agent-Class</code> attribute is ignored. Similarly, if the agent is started sometime after the JVM has started, then the <code>Agent-Class</code> attribute specifies the binary name of the agent class (the value of <code>Premain-Class</code> attribute is ignored). </p>
<h2 id="instrumenting-code-in-modules-heading">Instrumenting code in modules</h2> <p> As an aid to agents that deploy supporting classes on the search path of the bootstrap class loader, or the search path of the class loader that loads the main agent class, the Java virtual machine arranges for the module of transformed classes to read the unnamed module of both class loaders.</p>
</div> <dl class="notes"> <dt>Since:</dt> <dd>1.5</dd> </dl> </section> <section class="summary"> <div class="summary-list"> <div> <div id="related-package-summary">  <table class="summary-table three-column-summary">    <div class="col-plain even-row-color"><a href="../../../../java.base/module-summary">java.base</a></div>   <tr>
<th>Module</th>
<th>Package</th>
<th>Description</th>
</tr>
<tr>
<td><a href="../../../../java.base/java/lang/package-summary">java.lang</a></td>
<td> <div class="block">Provides classes that are fundamental to the design of the Java programming language.</div> </td>
</tr>
</table> </div> </div> <div> <div id="class-summary">  <div id="class-summary.tabpanel" role="tabpanel"> <table class="summary-table two-column-summary" aria-labelledby="class-summary-tab0">               <tr>
<th>Class</th>
<th>Description</th>
</tr>
<tr>
<td><a href="classdefinition" title="class in java.lang.instrument">ClassDefinition</a></td>
<td> <div class="block">This class serves as a parameter block to the <code>Instrumentation.redefineClasses</code> method.</div> </td>
</tr>
<tr>
<td><a href="classfiletransformer" title="interface in java.lang.instrument">ClassFileTransformer</a></td>
<td> <div class="block">A transformer of class files.</div> </td>
</tr>
<tr>
<td><a href="illegalclassformatexception" title="class in java.lang.instrument">IllegalClassFormatException</a></td>
<td> <div class="block">Thrown by an implementation of <a href="classfiletransformer#transform(java.lang.ClassLoader,java.lang.String,java.lang.Class,java.security.ProtectionDomain,byte%5B%5D)"><code>ClassFileTransformer.transform</code></a> when its input parameters are invalid.</div> </td>
</tr>
<tr>
<td><a href="instrumentation" title="interface in java.lang.instrument">Instrumentation</a></td>
<td> <div class="block">This class provides services needed to instrument Java programming language code.</div> </td>
</tr>
<tr>
<td><a href="unmodifiableclassexception" title="class in java.lang.instrument">UnmodifiableClassException</a></td>
<td> <div class="block">Thrown by an implementation of <a href="instrumentation#redefineClasses(java.lang.instrument.ClassDefinition...)"><code>Instrumentation.redefineClasses</code></a> when one of the specified classes cannot be modified.</div> </td>
</tr>
<tr>
<td><a href="unmodifiablemoduleexception" title="class in java.lang.instrument">UnmodifiableModuleException</a></td>
<td> <div class="block">Thrown to indicate that a module cannot be modified.</div> </td>
</tr>
</table> </div> </div> </div> </div> </section><div class="_attribution">
  <p class="_attribution-p">
    Â© 1993, 2023, Oracle and/or its affiliates. All rights reserved.<br>Documentation extracted from Debian's OpenJDK Development Kit package.<br>Licensed under the GNU General Public License, version 2, with the Classpath Exception.<br>Various third party code in OpenJDK is licensed under different licenses (see Debian package).<br>Java and OpenJDK are trademarks or registered trademarks of Oracle and/or its affiliates.<br>
    <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.instrument/java/lang/instrument/package-summary.html" class="_attribution-link">https://docs.oracle.com/en/java/javase/21/docs/api/java.instrument/java/lang/instrument/package-summary.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
