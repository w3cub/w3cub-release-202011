
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>StructuredTaskScope - OpenJDK 21 - W3cubDocs</title>
  
  <meta name="description" content="The following example forks a collection of homogeneous subtasks, waits for all of them to complete with the join method, and uses the Subtask. &hellip;">
  <meta name="keywords" content="class, structuredtaskscope, t, openjdk, openjdk~21">
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/openjdk~21/java.base/java/util/concurrent/structuredtaskscope.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-c8f743fc70bb84079c3cf4b71f5f99835529659c30689b2fd6193651a680f383ef1d96896f8966c7ca8a0160ffd557685bb8ad12820ec6002d60143812238086.css">
  <script type="text/javascript" src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js"></script>
  <script src="/json/openjdk~21.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/openjdk~21/" class="_nav-link" title="" style="margin-left:0;">OpenJDK 21</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _openjdk">
				
				
<h1 title="Class StructuredTaskScope" class="title">Class StructuredTaskScope&lt;T&gt;</h1> <div class="inheritance" title="Inheritance Tree">
<a href="../../lang/object" title="class in java.lang">java.lang.Object</a> <div class="inheritance">java.util.concurrent.StructuredTaskScope&lt;T&gt;</div> </div> <section class="class-description" id="class-description"> <dl class="notes"> <dt>Type Parameters:</dt> <dd>
<code>T</code> - the result type of tasks executed in the task scope</dd> </dl> <dl class="notes"> <dt>All Implemented Interfaces:</dt> <dd><code><a href="../../lang/autocloseable" title="interface in java.lang">AutoCloseable</a></code></dd> </dl> <dl class="notes"> <dt>Direct Known Subclasses:</dt> <dd>
<code><a href="structuredtaskscope.shutdownonfailure" title="class in java.util.concurrent">StructuredTaskScope.ShutdownOnFailure</a><sup><a href="structuredtaskscope.shutdownonfailure#preview-java.util.concurrent.StructuredTaskScope.ShutdownOnFailure">PREVIEW</a></sup></code>, <code><a href="structuredtaskscope.shutdownonsuccess" title="class in java.util.concurrent">StructuredTaskScope.ShutdownOnSuccess</a><sup><a href="structuredtaskscope.shutdownonsuccess#preview-java.util.concurrent.StructuredTaskScope.ShutdownOnSuccess">PREVIEW</a></sup></code>
</dd> </dl>  <pre class="lang-java" data-language="java">public class StructuredTaskScope&lt;T&gt; extends Object implements AutoCloseable</pre> <div class="preview-block" id="preview-java.util.concurrent.StructuredTaskScope">
<span class="preview-label"><code>StructuredTaskScope</code> is a preview API of the Java platform.</span> <div class="preview-comment">Programs can only use <code>StructuredTaskScope</code> when preview features are enabled.</div> <div class="preview-comment">Preview features may be removed in a future release, or upgraded to permanent features of the Java platform.</div> </div> <div class="block">A basic API for <em>structured concurrency</em>. <code>StructuredTaskScope</code> supports cases where a task splits into several concurrent subtasks, and where the subtasks must complete before the main task continues. A <code>StructuredTaskScope</code> can be used to ensure that the lifetime of a concurrent operation is confined by a <em>syntax block</em>, just like that of a sequential operation in structured programming. <h2 id="basic-operation-heading">Basic operation</h2> A <code>StructuredTaskScope</code> is created with one of its public constructors. It defines the <a href="#fork(java.util.concurrent.Callable)"><code>fork</code></a> method to start a thread to execute a subtask, the <a href="#join()"><code>join</code></a> method to wait for all subtasks to finish, and the <a href="#close()"><code>close</code></a> method to close the task scope. The API is intended to be used with the <code>
 try-with-resources</code> statement. The intention is that code in the try <em>block</em> uses the <code>fork</code> method to fork threads to execute the subtasks, wait for the subtasks to finish with the <code>join</code> method, and then <em>process the results</em>. A call to the <code>fork</code> method returns a <a href="structuredtaskscope.subtask" title="interface in java.util.concurrent"><code>Subtask</code></a><sup><a href="structuredtaskscope.subtask#preview-java.util.concurrent.StructuredTaskScope.Subtask">PREVIEW</a></sup> to representing the <em>forked subtask</em>. Once <code>join</code> is called, the <code>Subtask</code> can be used to get the result completed successfully, or the exception if the subtask failed. <div class="snippet-container">
<button class="copy snippet-copy" aria-label="Copy snippet" onclick="copySnippet(this)"><span data-copied="Copied!">Copy</span><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KCjwhLS0KIENvcHlyaWdodCAoYykgMjAyMSwgT3JhY2xlIGFuZC9vciBpdHMgYWZmaWxpYXRlcy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KIERPIE5PVCBBTFRFUiBPUiBSRU1PVkUgQ09QWVJJR0hUIE5PVElDRVMgT1IgVEhJUyBGSUxFIEhFQURFUi4KCiBUaGlzIGNvZGUgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeSBpdAogdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2ZXJzaW9uIDIgb25seSwgYXMKIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLiAgT3JhY2xlIGRlc2lnbmF0ZXMgdGhpcwogcGFydGljdWxhciBmaWxlIGFzIHN1YmplY3QgdG8gdGhlICJDbGFzc3BhdGgiIGV4Y2VwdGlvbiBhcyBwcm92aWRlZAogYnkgT3JhY2xlIGluIHRoZSBMSUNFTlNFIGZpbGUgdGhhdCBhY2NvbXBhbmllZCB0aGlzIGNvZGUuCgogVGhpcyBjb2RlIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsIGJ1dCBXSVRIT1VUCiBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IKIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogdmVyc2lvbiAyIGZvciBtb3JlIGRldGFpbHMgKGEgY29weSBpcyBpbmNsdWRlZCBpbiB0aGUgTElDRU5TRSBmaWxlIHRoYXQKIGFjY29tcGFuaWVkIHRoaXMgY29kZSkuCgogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgdmVyc2lvbgogMiBhbG9uZyB3aXRoIHRoaXMgd29yazsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLAogSW5jLiwgNTEgRnJhbmtsaW4gU3QsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BIDAyMTEwLTEzMDEgVVNBLgoKIFBsZWFzZSBjb250YWN0IE9yYWNsZSwgNTAwIE9yYWNsZSBQYXJrd2F5LCBSZWR3b29kIFNob3JlcywgQ0EgOTQwNjUgVVNBCiBvciB2aXNpdCB3d3cub3JhY2xlLmNvbSBpZiB5b3UgbmVlZCBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIG9yIGhhdmUgYW55CiBxdWVzdGlvbnMuCi0tPgoKPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDM4MCA0NjAiIGZpbGw9IiM1MDUwNTAiPgogIDxwYXRoCiAgICAgZD0iTSAzNDYsOCBIIDEwOCBDIDkwLDggNzUsMjMgNzUsNDEgdiAzMTYgYyAwLDE4IDE1LDMzIDMzLDMzIGggMjM4IGMgMTgsMCAzMywtMTUgMzMsLTMzIFYgNDEgQyAzNzksMjMgMzY0LDggMzQ2LDggWiBtIC04LDM0NCBIIDExNiBjIC0yLDAgLTMsLTEgLTMsLTMgViA0OSBjIDAsLTIgMSwtMyAzLC0zIGggMjIyIGMgMiwwIDMsMSAzLDMgdiAzMDAgaCAxMGUtNCBjIDAsMiAtMSwzIC0zLDMgeiIvPgogIDxwYXRoCiAgICAgZD0ibSAyOTAsMzg5IHYgMjYgaCAxMGUtNCBjIDAsMiAtMSwzIC0zLDMgSCA0OSBjIC0yLDAgLTMsLTEgLTMsLTMgViA5OSBjIDAsLTIgMSwtMyAzLC0zIGggMjcgdiAwIGwgLTVlLTQsLTM4IEggNDEgQyAyMyw1OCA4LDczIDgsOTEgdiAzMzIgYyAxMGUtNCwxOCAxNSwzMyAzMywzMyBoIDI1NCBjIDE4LDAgMzMsLTE1IDMzLC0zMyB2IC0zNCIvPgo8L3N2Zz4K" alt="Copy snippet"></button> <pre class="lang-java" data-language="java"><code class="language-java">    Callable&lt;String&gt; task1 = ...
    Callable&lt;Integer&gt; task2 = ...

    try (var scope = new StructuredTaskScope&lt;Object&gt;()) {

        Subtask&lt;String&gt; subtask1 = scope.<span class="bold">fork</span>(task1);
        Subtask&lt;Integer&gt; subtask2 = scope.<span class="bold">fork</span>(task2);

        scope.<span class="bold">join</span>();

        ... process results/exceptions ...

    } // <span class="bold">close</span>
</code></pre> </div> <p> The following example forks a collection of homogeneous subtasks, waits for all of them to complete with the <code>join</code> method, and uses the <a href="structuredtaskscope.subtask.state" title="enum class in java.util.concurrent"><code>Subtask.State</code></a><sup><a href="structuredtaskscope.subtask.state#preview-java.util.concurrent.StructuredTaskScope.Subtask.State">PREVIEW</a></sup> to partition the subtasks into a set of the subtasks that completed successfully and another for the subtasks that failed. </p>
<div class="snippet-container">
<button class="copy snippet-copy" aria-label="Copy snippet" onclick="copySnippet(this)"><span data-copied="Copied!">Copy</span><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KCjwhLS0KIENvcHlyaWdodCAoYykgMjAyMSwgT3JhY2xlIGFuZC9vciBpdHMgYWZmaWxpYXRlcy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KIERPIE5PVCBBTFRFUiBPUiBSRU1PVkUgQ09QWVJJR0hUIE5PVElDRVMgT1IgVEhJUyBGSUxFIEhFQURFUi4KCiBUaGlzIGNvZGUgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeSBpdAogdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2ZXJzaW9uIDIgb25seSwgYXMKIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLiAgT3JhY2xlIGRlc2lnbmF0ZXMgdGhpcwogcGFydGljdWxhciBmaWxlIGFzIHN1YmplY3QgdG8gdGhlICJDbGFzc3BhdGgiIGV4Y2VwdGlvbiBhcyBwcm92aWRlZAogYnkgT3JhY2xlIGluIHRoZSBMSUNFTlNFIGZpbGUgdGhhdCBhY2NvbXBhbmllZCB0aGlzIGNvZGUuCgogVGhpcyBjb2RlIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsIGJ1dCBXSVRIT1VUCiBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IKIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogdmVyc2lvbiAyIGZvciBtb3JlIGRldGFpbHMgKGEgY29weSBpcyBpbmNsdWRlZCBpbiB0aGUgTElDRU5TRSBmaWxlIHRoYXQKIGFjY29tcGFuaWVkIHRoaXMgY29kZSkuCgogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgdmVyc2lvbgogMiBhbG9uZyB3aXRoIHRoaXMgd29yazsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLAogSW5jLiwgNTEgRnJhbmtsaW4gU3QsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BIDAyMTEwLTEzMDEgVVNBLgoKIFBsZWFzZSBjb250YWN0IE9yYWNsZSwgNTAwIE9yYWNsZSBQYXJrd2F5LCBSZWR3b29kIFNob3JlcywgQ0EgOTQwNjUgVVNBCiBvciB2aXNpdCB3d3cub3JhY2xlLmNvbSBpZiB5b3UgbmVlZCBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIG9yIGhhdmUgYW55CiBxdWVzdGlvbnMuCi0tPgoKPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDM4MCA0NjAiIGZpbGw9IiM1MDUwNTAiPgogIDxwYXRoCiAgICAgZD0iTSAzNDYsOCBIIDEwOCBDIDkwLDggNzUsMjMgNzUsNDEgdiAzMTYgYyAwLDE4IDE1LDMzIDMzLDMzIGggMjM4IGMgMTgsMCAzMywtMTUgMzMsLTMzIFYgNDEgQyAzNzksMjMgMzY0LDggMzQ2LDggWiBtIC04LDM0NCBIIDExNiBjIC0yLDAgLTMsLTEgLTMsLTMgViA0OSBjIDAsLTIgMSwtMyAzLC0zIGggMjIyIGMgMiwwIDMsMSAzLDMgdiAzMDAgaCAxMGUtNCBjIDAsMiAtMSwzIC0zLDMgeiIvPgogIDxwYXRoCiAgICAgZD0ibSAyOTAsMzg5IHYgMjYgaCAxMGUtNCBjIDAsMiAtMSwzIC0zLDMgSCA0OSBjIC0yLDAgLTMsLTEgLTMsLTMgViA5OSBjIDAsLTIgMSwtMyAzLC0zIGggMjcgdiAwIGwgLTVlLTQsLTM4IEggNDEgQyAyMyw1OCA4LDczIDgsOTEgdiAzMzIgYyAxMGUtNCwxOCAxNSwzMyAzMywzMyBoIDI1NCBjIDE4LDAgMzMsLTE1IDMzLC0zMyB2IC0zNCIvPgo8L3N2Zz4K" alt="Copy snippet"></button> <pre class="lang-java" data-language="java"><code class="language-java">    List&lt;Callable&lt;String&gt;&gt; callables = ...

    try (var scope = new StructuredTaskScope&lt;String&gt;()) {

        List&lt;Subtask&lt;String&gt;&gt; subtasks = callables.stream().map(scope::fork).toList();

        scope.join();

        Map&lt;Boolean, Set&lt;Subtask&lt;String&gt;&gt;&gt; map = subtasks.stream()
                .collect(Collectors.partitioningBy(h -&gt; h.state() == Subtask.State.SUCCESS,
                                                   Collectors.toSet()));

    } // close
</code></pre> </div> <p> To ensure correct usage, the <code>join</code> and <code>close</code> methods may only be invoked by the <em>owner</em> (the thread that opened/created the task scope), and the <code>close</code> method throws an exception after closing if the owner did not invoke the <code>join</code> method after forking. </p>
<p> <code>StructuredTaskScope</code> defines the <a href="#shutdown()"><code>shutdown</code></a> method to shut down a task scope without closing it. The <code>shutdown()</code> method <em>cancels</em> all unfinished subtasks by <a href="../../lang/thread#interrupt()">interrupting</a> the threads. It prevents new threads from starting in the task scope. If the owner is waiting in the <code>join</code> method then it will wakeup. </p>
<p> Shutdown is used for <em>short-circuiting</em> and allow subclasses to implement <em>policy</em> that does not require all subtasks to finish. </p>
<h2 id="subclasses-with-policies-for-common-cases-heading">Subclasses with policies for common cases</h2> Two subclasses of <code>StructuredTaskScope</code> are defined to implement policy for common cases: <ol> <li> <a href="structuredtaskscope.shutdownonsuccess" title="class in java.util.concurrent"><code>ShutdownOnSuccess</code></a><sup><a href="structuredtaskscope.shutdownonsuccess#preview-java.util.concurrent.StructuredTaskScope.ShutdownOnSuccess">PREVIEW</a></sup> captures the result of the first subtask to complete successfully. Once captured, it shuts down the task scope to interrupt unfinished threads and wakeup the owner. This class is intended for cases where the result of any subtask will do ("invoke any") and where there is no need to wait for results of other unfinished subtasks. It defines methods to get the first result or throw an exception if all subtasks fail. </li>
<li> <a href="structuredtaskscope.shutdownonfailure" title="class in java.util.concurrent"><code>ShutdownOnFailure</code></a><sup><a href="structuredtaskscope.shutdownonfailure#preview-java.util.concurrent.StructuredTaskScope.ShutdownOnFailure">PREVIEW</a></sup> captures the exception of the first subtask to fail. Once captured, it shuts down the task scope to interrupt unfinished threads and wakeup the owner. This class is intended for cases where the results of all subtasks are required ("invoke all"); if any subtask fails then the results of other unfinished subtasks are no longer needed. If defines methods to throw an exception if any of the subtasks fail. </li>
</ol> <p> The following are two examples that use the two classes. In both cases, a pair of subtasks are forked to fetch resources from two URL locations "left" and "right". The first example creates a ShutdownOnSuccess object to capture the result of the first subtask to complete successfully, cancelling the other by way of shutting down the task scope. The main task waits in <code>join</code> until either subtask completes with a result or both subtasks fail. It invokes <a href="structuredtaskscope.shutdownonsuccess#result(java.util.function.Function)"><code>result(Function)</code></a><sup><a href="structuredtaskscope.shutdownonsuccess#preview-java.util.concurrent.StructuredTaskScope.ShutdownOnSuccess">PREVIEW</a></sup> method to get the captured result. If both subtasks fail then this method throws a <code>WebApplicationException</code> with the exception from one of the subtasks as the cause. </p>
<div class="snippet-container">
<button class="copy snippet-copy" aria-label="Copy snippet" onclick="copySnippet(this)"><span data-copied="Copied!">Copy</span><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KCjwhLS0KIENvcHlyaWdodCAoYykgMjAyMSwgT3JhY2xlIGFuZC9vciBpdHMgYWZmaWxpYXRlcy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KIERPIE5PVCBBTFRFUiBPUiBSRU1PVkUgQ09QWVJJR0hUIE5PVElDRVMgT1IgVEhJUyBGSUxFIEhFQURFUi4KCiBUaGlzIGNvZGUgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeSBpdAogdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2ZXJzaW9uIDIgb25seSwgYXMKIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLiAgT3JhY2xlIGRlc2lnbmF0ZXMgdGhpcwogcGFydGljdWxhciBmaWxlIGFzIHN1YmplY3QgdG8gdGhlICJDbGFzc3BhdGgiIGV4Y2VwdGlvbiBhcyBwcm92aWRlZAogYnkgT3JhY2xlIGluIHRoZSBMSUNFTlNFIGZpbGUgdGhhdCBhY2NvbXBhbmllZCB0aGlzIGNvZGUuCgogVGhpcyBjb2RlIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsIGJ1dCBXSVRIT1VUCiBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IKIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogdmVyc2lvbiAyIGZvciBtb3JlIGRldGFpbHMgKGEgY29weSBpcyBpbmNsdWRlZCBpbiB0aGUgTElDRU5TRSBmaWxlIHRoYXQKIGFjY29tcGFuaWVkIHRoaXMgY29kZSkuCgogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgdmVyc2lvbgogMiBhbG9uZyB3aXRoIHRoaXMgd29yazsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLAogSW5jLiwgNTEgRnJhbmtsaW4gU3QsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BIDAyMTEwLTEzMDEgVVNBLgoKIFBsZWFzZSBjb250YWN0IE9yYWNsZSwgNTAwIE9yYWNsZSBQYXJrd2F5LCBSZWR3b29kIFNob3JlcywgQ0EgOTQwNjUgVVNBCiBvciB2aXNpdCB3d3cub3JhY2xlLmNvbSBpZiB5b3UgbmVlZCBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIG9yIGhhdmUgYW55CiBxdWVzdGlvbnMuCi0tPgoKPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDM4MCA0NjAiIGZpbGw9IiM1MDUwNTAiPgogIDxwYXRoCiAgICAgZD0iTSAzNDYsOCBIIDEwOCBDIDkwLDggNzUsMjMgNzUsNDEgdiAzMTYgYyAwLDE4IDE1LDMzIDMzLDMzIGggMjM4IGMgMTgsMCAzMywtMTUgMzMsLTMzIFYgNDEgQyAzNzksMjMgMzY0LDggMzQ2LDggWiBtIC04LDM0NCBIIDExNiBjIC0yLDAgLTMsLTEgLTMsLTMgViA0OSBjIDAsLTIgMSwtMyAzLC0zIGggMjIyIGMgMiwwIDMsMSAzLDMgdiAzMDAgaCAxMGUtNCBjIDAsMiAtMSwzIC0zLDMgeiIvPgogIDxwYXRoCiAgICAgZD0ibSAyOTAsMzg5IHYgMjYgaCAxMGUtNCBjIDAsMiAtMSwzIC0zLDMgSCA0OSBjIC0yLDAgLTMsLTEgLTMsLTMgViA5OSBjIDAsLTIgMSwtMyAzLC0zIGggMjcgdiAwIGwgLTVlLTQsLTM4IEggNDEgQyAyMyw1OCA4LDczIDgsOTEgdiAzMzIgYyAxMGUtNCwxOCAxNSwzMyAzMywzMyBoIDI1NCBjIDE4LDAgMzMsLTE1IDMzLC0zMyB2IC0zNCIvPgo8L3N2Zz4K" alt="Copy snippet"></button> <pre class="lang-java" data-language="java"><code class="language-java">    try (var scope = new StructuredTaskScope.ShutdownOnSuccess&lt;String&gt;()) {

        scope.fork(() -&gt; fetch(left));
        scope.fork(() -&gt; fetch(right));

        scope.join();

        String result = scope.<a href="structuredtaskscope.shutdownonsuccess#result()"><code>result</code></a>(e -&gt; new WebApplicationException(e));

        ...
    }
</code></pre> </div> The second example creates a ShutdownOnFailure object to capture the exception of the first subtask to fail, cancelling the other by way of shutting down the task scope. The main task waits in <a href="#joinUntil(java.time.Instant)"><code>joinUntil(Instant)</code></a> until both subtasks complete with a result, either fails, or a deadline is reached. It invokes <a href="structuredtaskscope.shutdownonfailure#throwIfFailed(java.util.function.Function)"><code>throwIfFailed(Function)</code></a><sup><a href="structuredtaskscope.shutdownonfailure#preview-java.util.concurrent.StructuredTaskScope.ShutdownOnFailure">PREVIEW</a></sup> to throw an exception if either subtask fails. This method is a no-op if both subtasks complete successfully. The example uses <a href="../function/supplier#get()"><code>Supplier.get()</code></a> to get the result of each subtask. Using <code>Supplier</code> instead of <code>Subtask</code> is preferred for common cases where the object returned by fork is only used to get the result of a subtask that completed successfully. <div class="snippet-container">
<button class="copy snippet-copy" aria-label="Copy snippet" onclick="copySnippet(this)"><span data-copied="Copied!">Copy</span><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KCjwhLS0KIENvcHlyaWdodCAoYykgMjAyMSwgT3JhY2xlIGFuZC9vciBpdHMgYWZmaWxpYXRlcy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KIERPIE5PVCBBTFRFUiBPUiBSRU1PVkUgQ09QWVJJR0hUIE5PVElDRVMgT1IgVEhJUyBGSUxFIEhFQURFUi4KCiBUaGlzIGNvZGUgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeSBpdAogdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2ZXJzaW9uIDIgb25seSwgYXMKIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLiAgT3JhY2xlIGRlc2lnbmF0ZXMgdGhpcwogcGFydGljdWxhciBmaWxlIGFzIHN1YmplY3QgdG8gdGhlICJDbGFzc3BhdGgiIGV4Y2VwdGlvbiBhcyBwcm92aWRlZAogYnkgT3JhY2xlIGluIHRoZSBMSUNFTlNFIGZpbGUgdGhhdCBhY2NvbXBhbmllZCB0aGlzIGNvZGUuCgogVGhpcyBjb2RlIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsIGJ1dCBXSVRIT1VUCiBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IKIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogdmVyc2lvbiAyIGZvciBtb3JlIGRldGFpbHMgKGEgY29weSBpcyBpbmNsdWRlZCBpbiB0aGUgTElDRU5TRSBmaWxlIHRoYXQKIGFjY29tcGFuaWVkIHRoaXMgY29kZSkuCgogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgdmVyc2lvbgogMiBhbG9uZyB3aXRoIHRoaXMgd29yazsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLAogSW5jLiwgNTEgRnJhbmtsaW4gU3QsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BIDAyMTEwLTEzMDEgVVNBLgoKIFBsZWFzZSBjb250YWN0IE9yYWNsZSwgNTAwIE9yYWNsZSBQYXJrd2F5LCBSZWR3b29kIFNob3JlcywgQ0EgOTQwNjUgVVNBCiBvciB2aXNpdCB3d3cub3JhY2xlLmNvbSBpZiB5b3UgbmVlZCBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIG9yIGhhdmUgYW55CiBxdWVzdGlvbnMuCi0tPgoKPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDM4MCA0NjAiIGZpbGw9IiM1MDUwNTAiPgogIDxwYXRoCiAgICAgZD0iTSAzNDYsOCBIIDEwOCBDIDkwLDggNzUsMjMgNzUsNDEgdiAzMTYgYyAwLDE4IDE1LDMzIDMzLDMzIGggMjM4IGMgMTgsMCAzMywtMTUgMzMsLTMzIFYgNDEgQyAzNzksMjMgMzY0LDggMzQ2LDggWiBtIC04LDM0NCBIIDExNiBjIC0yLDAgLTMsLTEgLTMsLTMgViA0OSBjIDAsLTIgMSwtMyAzLC0zIGggMjIyIGMgMiwwIDMsMSAzLDMgdiAzMDAgaCAxMGUtNCBjIDAsMiAtMSwzIC0zLDMgeiIvPgogIDxwYXRoCiAgICAgZD0ibSAyOTAsMzg5IHYgMjYgaCAxMGUtNCBjIDAsMiAtMSwzIC0zLDMgSCA0OSBjIC0yLDAgLTMsLTEgLTMsLTMgViA5OSBjIDAsLTIgMSwtMyAzLC0zIGggMjcgdiAwIGwgLTVlLTQsLTM4IEggNDEgQyAyMyw1OCA4LDczIDgsOTEgdiAzMzIgYyAxMGUtNCwxOCAxNSwzMyAzMywzMyBoIDI1NCBjIDE4LDAgMzMsLTE1IDMzLC0zMyB2IC0zNCIvPgo8L3N2Zz4K" alt="Copy snippet"></button> <pre class="lang-java" data-language="java"><code class="language-java">   Instant deadline = ...

   try (var scope = new StructuredTaskScope.ShutdownOnFailure()) {

        Supplier&lt;String&gt; supplier1 = scope.fork(() -&gt; query(left));
        Supplier&lt;String&gt; supplier2 = scope.fork(() -&gt; query(right));

        scope.joinUntil(deadline);

        scope.<a href="structuredtaskscope.shutdownonfailure#throwIfFailed()"><code>throwIfFailed</code></a>(e -&gt; new WebApplicationException(e));

        // both subtasks completed successfully
        String result = Stream.of(supplier1, supplier2)
                .map(Supplier::get)
                .collect(Collectors.joining(", ", "{ ", " }"));

        ...
    }
</code></pre> </div> <h2 id="extending-structuredtaskscope-heading">Extending StructuredTaskScope</h2> <code>StructuredTaskScope</code> can be extended, and the <a href="#handleComplete(java.util.concurrent.StructuredTaskScope.Subtask)"><code>handleComplete</code></a> method overridden, to implement policies other than those implemented by <code>ShutdownOnSuccess</code> and <code>ShutdownOnFailure</code>. A subclass may, for example, collect the results of subtasks that complete successfully and ignore subtasks that fail. It may collect exceptions when subtasks fail. It may invoke the <a href="#shutdown()"><code>shutdown</code></a> method to shut down and cause <a href="#join()"><code>join</code></a> to wakeup when some condition arises. <p> A subclass will typically define methods to make available results, state, or other outcome to code that executes after the <code>join</code> method. A subclass that collects results and ignores subtasks that fail may define a method that returns the results. A subclass that implements a policy to shut down when a subtask fails may define a method to get the exception of the first subtask to fail. </p>
<p> The following is an example of a simple <code>StructuredTaskScope</code> implementation that collects homogenous subtasks that complete successfully. It defines the method "<code>completedSuccessfully()</code>" that the main task can invoke after it joins. </p>
<div class="snippet-container">
<button class="copy snippet-copy" aria-label="Copy snippet" onclick="copySnippet(this)"><span data-copied="Copied!">Copy</span><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KCjwhLS0KIENvcHlyaWdodCAoYykgMjAyMSwgT3JhY2xlIGFuZC9vciBpdHMgYWZmaWxpYXRlcy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KIERPIE5PVCBBTFRFUiBPUiBSRU1PVkUgQ09QWVJJR0hUIE5PVElDRVMgT1IgVEhJUyBGSUxFIEhFQURFUi4KCiBUaGlzIGNvZGUgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeSBpdAogdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2ZXJzaW9uIDIgb25seSwgYXMKIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLiAgT3JhY2xlIGRlc2lnbmF0ZXMgdGhpcwogcGFydGljdWxhciBmaWxlIGFzIHN1YmplY3QgdG8gdGhlICJDbGFzc3BhdGgiIGV4Y2VwdGlvbiBhcyBwcm92aWRlZAogYnkgT3JhY2xlIGluIHRoZSBMSUNFTlNFIGZpbGUgdGhhdCBhY2NvbXBhbmllZCB0aGlzIGNvZGUuCgogVGhpcyBjb2RlIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsIGJ1dCBXSVRIT1VUCiBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IKIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogdmVyc2lvbiAyIGZvciBtb3JlIGRldGFpbHMgKGEgY29weSBpcyBpbmNsdWRlZCBpbiB0aGUgTElDRU5TRSBmaWxlIHRoYXQKIGFjY29tcGFuaWVkIHRoaXMgY29kZSkuCgogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgdmVyc2lvbgogMiBhbG9uZyB3aXRoIHRoaXMgd29yazsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLAogSW5jLiwgNTEgRnJhbmtsaW4gU3QsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BIDAyMTEwLTEzMDEgVVNBLgoKIFBsZWFzZSBjb250YWN0IE9yYWNsZSwgNTAwIE9yYWNsZSBQYXJrd2F5LCBSZWR3b29kIFNob3JlcywgQ0EgOTQwNjUgVVNBCiBvciB2aXNpdCB3d3cub3JhY2xlLmNvbSBpZiB5b3UgbmVlZCBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIG9yIGhhdmUgYW55CiBxdWVzdGlvbnMuCi0tPgoKPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDM4MCA0NjAiIGZpbGw9IiM1MDUwNTAiPgogIDxwYXRoCiAgICAgZD0iTSAzNDYsOCBIIDEwOCBDIDkwLDggNzUsMjMgNzUsNDEgdiAzMTYgYyAwLDE4IDE1LDMzIDMzLDMzIGggMjM4IGMgMTgsMCAzMywtMTUgMzMsLTMzIFYgNDEgQyAzNzksMjMgMzY0LDggMzQ2LDggWiBtIC04LDM0NCBIIDExNiBjIC0yLDAgLTMsLTEgLTMsLTMgViA0OSBjIDAsLTIgMSwtMyAzLC0zIGggMjIyIGMgMiwwIDMsMSAzLDMgdiAzMDAgaCAxMGUtNCBjIDAsMiAtMSwzIC0zLDMgeiIvPgogIDxwYXRoCiAgICAgZD0ibSAyOTAsMzg5IHYgMjYgaCAxMGUtNCBjIDAsMiAtMSwzIC0zLDMgSCA0OSBjIC0yLDAgLTMsLTEgLTMsLTMgViA5OSBjIDAsLTIgMSwtMyAzLC0zIGggMjcgdiAwIGwgLTVlLTQsLTM4IEggNDEgQyAyMyw1OCA4LDczIDgsOTEgdiAzMzIgYyAxMGUtNCwxOCAxNSwzMyAzMywzMyBoIDI1NCBjIDE4LDAgMzMsLTE1IDMzLC0zMyB2IC0zNCIvPgo8L3N2Zz4K" alt="Copy snippet"></button> <pre class="lang-java" data-language="java"><code class="language-java">    class CollectingScope&lt;T&gt; extends StructuredTaskScope&lt;T&gt; {
        private final Queue&lt;Subtask&lt;? extends T&gt;&gt; subtasks = new LinkedTransferQueue&lt;&gt;();

        @Override
        protected void handleComplete(Subtask&lt;? extends T&gt; subtask) {
            if (subtask.state() == Subtask.State.SUCCESS) {
                subtasks.add(subtask);
            }
        }

        @Override
        public CollectingScope&lt;T&gt; join() throws InterruptedException {
            super.join();
            return this;
        }

        public Stream&lt;Subtask&lt;? extends T&gt;&gt; completedSuccessfully() {
            super.<a href="#ensureOwnerAndJoined()"><code>ensureOwnerAndJoined</code></a>();
            return subtasks.stream();
        }
    }
</code></pre> </div> <p> The implementations of the <code>completedSuccessfully()</code> method in the example invokes <a href="#ensureOwnerAndJoined()"><code>ensureOwnerAndJoined()</code></a> to ensure that the method can only be invoked by the owner thread and only after it has joined. </p>
<h2><a id="TreeStructure">Tree structure</a></h2> Task scopes form a tree where parent-child relations are established implicitly when opening a new task scope: <ul> <li> A parent-child relation is established when a thread started in a task scope opens its own task scope. A thread started in task scope "A" that opens task scope "B" establishes a parent-child relation where task scope "A" is the parent of task scope "B". </li>
<li> A parent-child relation is established with nesting. If a thread opens task scope "B", then opens task scope "C" (before it closes "B"), then the enclosing task scope "B" is the parent of the nested task scope "C". </li>
</ul> The <i>descendants</i> of a task scope are the child task scopes that it is a parent of, plus the descendants of the child task scopes, recursively. <p> The tree structure supports: </p>
<ul> <li> Inheritance of <a href="../../lang/scopedvalue" title="class in java.lang">scoped values</a><sup><a href="../../lang/scopedvalue#preview-java.lang.ScopedValue">PREVIEW</a></sup> across threads. </li>
<li> Confinement checks. The phrase "threads contained in the task scope" in method descriptions means threads started in the task scope or descendant scopes. </li>
</ul> <p> The following example demonstrates the inheritance of a scoped value. A scoped value <code>USERNAME</code> is bound to the value "<code>duke</code>". A <code>StructuredTaskScope</code> is created and its <code>fork</code> method invoked to start a thread to execute <code>
 childTask</code>. The thread inherits the scoped value <em>bindings</em> captured when creating the task scope. The code in <code>childTask</code> uses the value of the scoped value and so reads the value "<code>duke</code>". </p>
<div class="snippet-container">
<button class="copy snippet-copy" aria-label="Copy snippet" onclick="copySnippet(this)"><span data-copied="Copied!">Copy</span><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KCjwhLS0KIENvcHlyaWdodCAoYykgMjAyMSwgT3JhY2xlIGFuZC9vciBpdHMgYWZmaWxpYXRlcy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KIERPIE5PVCBBTFRFUiBPUiBSRU1PVkUgQ09QWVJJR0hUIE5PVElDRVMgT1IgVEhJUyBGSUxFIEhFQURFUi4KCiBUaGlzIGNvZGUgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeSBpdAogdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2ZXJzaW9uIDIgb25seSwgYXMKIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLiAgT3JhY2xlIGRlc2lnbmF0ZXMgdGhpcwogcGFydGljdWxhciBmaWxlIGFzIHN1YmplY3QgdG8gdGhlICJDbGFzc3BhdGgiIGV4Y2VwdGlvbiBhcyBwcm92aWRlZAogYnkgT3JhY2xlIGluIHRoZSBMSUNFTlNFIGZpbGUgdGhhdCBhY2NvbXBhbmllZCB0aGlzIGNvZGUuCgogVGhpcyBjb2RlIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsIGJ1dCBXSVRIT1VUCiBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IKIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogdmVyc2lvbiAyIGZvciBtb3JlIGRldGFpbHMgKGEgY29weSBpcyBpbmNsdWRlZCBpbiB0aGUgTElDRU5TRSBmaWxlIHRoYXQKIGFjY29tcGFuaWVkIHRoaXMgY29kZSkuCgogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgdmVyc2lvbgogMiBhbG9uZyB3aXRoIHRoaXMgd29yazsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLAogSW5jLiwgNTEgRnJhbmtsaW4gU3QsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BIDAyMTEwLTEzMDEgVVNBLgoKIFBsZWFzZSBjb250YWN0IE9yYWNsZSwgNTAwIE9yYWNsZSBQYXJrd2F5LCBSZWR3b29kIFNob3JlcywgQ0EgOTQwNjUgVVNBCiBvciB2aXNpdCB3d3cub3JhY2xlLmNvbSBpZiB5b3UgbmVlZCBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIG9yIGhhdmUgYW55CiBxdWVzdGlvbnMuCi0tPgoKPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDM4MCA0NjAiIGZpbGw9IiM1MDUwNTAiPgogIDxwYXRoCiAgICAgZD0iTSAzNDYsOCBIIDEwOCBDIDkwLDggNzUsMjMgNzUsNDEgdiAzMTYgYyAwLDE4IDE1LDMzIDMzLDMzIGggMjM4IGMgMTgsMCAzMywtMTUgMzMsLTMzIFYgNDEgQyAzNzksMjMgMzY0LDggMzQ2LDggWiBtIC04LDM0NCBIIDExNiBjIC0yLDAgLTMsLTEgLTMsLTMgViA0OSBjIDAsLTIgMSwtMyAzLC0zIGggMjIyIGMgMiwwIDMsMSAzLDMgdiAzMDAgaCAxMGUtNCBjIDAsMiAtMSwzIC0zLDMgeiIvPgogIDxwYXRoCiAgICAgZD0ibSAyOTAsMzg5IHYgMjYgaCAxMGUtNCBjIDAsMiAtMSwzIC0zLDMgSCA0OSBjIC0yLDAgLTMsLTEgLTMsLTMgViA5OSBjIDAsLTIgMSwtMyAzLC0zIGggMjcgdiAwIGwgLTVlLTQsLTM4IEggNDEgQyAyMyw1OCA4LDczIDgsOTEgdiAzMzIgYyAxMGUtNCwxOCAxNSwzMyAzMywzMyBoIDI1NCBjIDE4LDAgMzMsLTE1IDMzLC0zMyB2IC0zNCIvPgo8L3N2Zz4K" alt="Copy snippet"></button> <pre class="lang-java" data-language="java"><code class="language-java">    private static final ScopedValue&lt;String&gt; USERNAME = ScopedValue.newInstance();

    ScopedValue.<a href="../../lang/scopedvalue#runWhere(java.lang.ScopedValue,T,java.lang.Runnable)"><code>runWhere</code></a>(USERNAME, "duke", () -&gt; {
        try (var scope = new StructuredTaskScope&lt;String&gt;()) {

            scope.<span class="bold">fork</span>(() -&gt; childTask());
            ...
         }
    });

    ...

    String childTask() {
        String name = USERNAME.<a href="../../lang/scopedvalue#get()"><code>get</code></a>();   // "duke"
        ...
    }
</code></pre> </div> <p> <code>StructuredTaskScope</code> does not define APIs that exposes the tree structure at this time. </p>
<p> Unless otherwise specified, passing a <code>null</code> argument to a constructor or method in this class will cause a <a href="../../lang/nullpointerexception" title="class in java.lang"><code>NullPointerException</code></a> to be thrown. </p>
<h2 id="memory-consistency-effects-heading">Memory consistency effects</h2> <p> Actions in the owner thread of, or a thread contained in, the task scope prior to <a href="#fork(java.util.concurrent.Callable)">forking</a> of a subtask <a href="package-summary#MemoryVisibility"> <i>happen-before</i></a> any actions taken by that subtask, which in turn <i>happen-before</i> the subtask result is <a href="structuredtaskscope.subtask#get()">retrieved</a><sup><a href="structuredtaskscope.subtask#preview-java.util.concurrent.StructuredTaskScope.Subtask">PREVIEW</a></sup> or <i>happen-before</i> any actions taken in a thread after <a href="#join()">joining</a> of the task scope.</p>
</div> <dl class="notes">
<dt>See <i>Java Language Specification</i>:</dt> <dd> <a href="https://docs.oracle.com/javase/specs/jls/se21/html/jls-17.html#jls-17.4.5">17.4.5 Happens-before Order</a><br>
</dd> <dt>Since:</dt> <dd>21</dd> </dl> </section> <section class="summary"> <section class="nested-class-summary" id="nested-class-summary"> <h2>Nested Class Summary</h2>  <table class="summary-table three-column-summary">             <tr>
<th>Modifier and Type</th>
<th>Class</th>
<th>Description</th>
</tr>
<tr>
<td><code>static final class </code></td>
<td><code><a href="structuredtaskscope.shutdownonfailure" class="type-name-link" title="class in java.util.concurrent">StructuredTaskScope.ShutdownOnFailure</a><sup><a href="structuredtaskscope.shutdownonfailure#preview-java.util.concurrent.StructuredTaskScope.ShutdownOnFailure">PREVIEW</a></sup></code></td>
<td> <div class="block"><span class="preview-label">Preview.</span></div> <div class="block">A <code>StructuredTaskScope</code> that captures the exception of the first subtask to <a href="structuredtaskscope.subtask.state#FAILED">fail</a><sup><a href="structuredtaskscope.subtask.state#preview-java.util.concurrent.StructuredTaskScope.Subtask.State">PREVIEW</a></sup>.</div> </td>
</tr>
<tr>
<td><code>static final class </code></td>
<td><code><a href="structuredtaskscope.shutdownonsuccess" class="type-name-link" title="class in java.util.concurrent">StructuredTaskScope.ShutdownOnSuccess</a><sup><a href="structuredtaskscope.shutdownonsuccess#preview-java.util.concurrent.StructuredTaskScope.ShutdownOnSuccess">PREVIEW</a></sup>&lt;<a href="structuredtaskscope.shutdownonsuccess" title="type parameter in StructuredTaskScope.ShutdownOnSuccess">T</a>&gt;</code></td>
<td> <div class="block"><span class="preview-label">Preview.</span></div> <div class="block">A <code>StructuredTaskScope</code> that captures the result of the first subtask to complete <a href="structuredtaskscope.subtask.state#SUCCESS">successfully</a><sup><a href="structuredtaskscope.subtask.state#preview-java.util.concurrent.StructuredTaskScope.Subtask.State">PREVIEW</a></sup>.</div> </td>
</tr>
<tr>
<td><code>static interface </code></td>
<td><code><a href="structuredtaskscope.subtask" class="type-name-link" title="interface in java.util.concurrent">StructuredTaskScope.Subtask</a><sup><a href="structuredtaskscope.subtask#preview-java.util.concurrent.StructuredTaskScope.Subtask">PREVIEW</a></sup>&lt;<a href="structuredtaskscope.subtask" title="type parameter in StructuredTaskScope.Subtask">T</a>&gt;</code></td>
<td> <div class="block"><span class="preview-label">Preview.</span></div> <div class="block">Represents a subtask forked with <a href="#fork(java.util.concurrent.Callable)"><code>fork(Callable)</code></a>.</div> </td>
</tr>
</table> </section><section class="constructor-summary" id="constructor-summary"> <h2>Constructor Summary</h2>  <table class="summary-table two-column-summary">       <tr>
<th>Constructor</th>
<th>Description</th>
</tr>
<tr>
<td><code><a href="#%3Cinit%3E()" class="member-name-link">StructuredTaskScope</a>()</code></td>
<td> <div class="block">Creates an unnamed structured task scope that creates virtual threads.</div> </td>
</tr>
<tr>
<td><code><a href="#%3Cinit%3E(java.lang.String,java.util.concurrent.ThreadFactory)" class="member-name-link">StructuredTaskScope</a><wbr>(<a href="../../lang/string" title="class in java.lang">String</a> name,
 <a href="threadfactory" title="interface in java.util.concurrent">ThreadFactory</a> factory)</wbr></code></td>
<td> <div class="block">Creates a structured task scope with the given name and thread factory.</div> </td>
</tr>
</table> </section><section class="method-summary" id="method-summary"> <h2>Method Summary</h2> <div id="method-summary-table">  <div id="method-summary-table.tabpanel" role="tabpanel"> <table class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">                            <tr>
<th>Modifier and Type</th>
<th>Method</th>
<th>Description</th>
</tr>
<tr>
<td><code>void</code></td>
<td><code><a href="#close()" class="member-name-link">close</a>()</code></td>
<td> <div class="block">Closes this task scope.</div> </td>
</tr>
<tr>
<td><code>protected final void</code></td>
<td><code><a href="#ensureOwnerAndJoined()" class="member-name-link">ensureOwnerAndJoined</a>()</code></td>
<td> <div class="block">Ensures that the current thread is the owner of this task scope and that it joined (with <a href="#join()"><code>join()</code></a> or <a href="#joinUntil(java.time.Instant)"><code>joinUntil(Instant)</code></a>) after <a href="#fork(java.util.concurrent.Callable)">forking</a> subtasks.</div> </td>
</tr>
<tr>
<td><code>&lt;U extends <a href="structuredtaskscope" title="type parameter in StructuredTaskScope">T</a>&gt;<br><a href="structuredtaskscope.subtask" title="interface in java.util.concurrent">StructuredTaskScope.Subtask</a><sup><a href="structuredtaskscope.subtask#preview-java.util.concurrent.StructuredTaskScope.Subtask">PREVIEW</a></sup><wbr>&lt;U&gt;</wbr></code></td>
<td><code><a href="#fork(java.util.concurrent.Callable)" class="member-name-link">fork</a><wbr>(<a href="callable" title="interface in java.util.concurrent">Callable</a>&lt;? extends U&gt; task)</wbr></code></td>
<td> <div class="block">Starts a new thread in this task scope to execute a value-returning task, thus creating a <em>subtask</em> of this task scope.</div> </td>
</tr>
<tr>
<td><code>protected void</code></td>
<td><code><a href="#handleComplete(java.util.concurrent.StructuredTaskScope.Subtask)" class="member-name-link">handleComplete</a><wbr>(<a href="structuredtaskscope.subtask" title="interface in java.util.concurrent">StructuredTaskScope.Subtask</a><sup><a href="structuredtaskscope.subtask#preview-java.util.concurrent.StructuredTaskScope.Subtask">PREVIEW</a></sup>&lt;? extends <a href="structuredtaskscope" title="type parameter in StructuredTaskScope">T</a>&gt; subtask)</wbr></code></td>
<td> <div class="block">Invoked by a subtask when it completes successfully or fails in this task scope.</div> </td>
</tr>
<tr>
<td><code>final boolean</code></td>
<td><code><a href="#isShutdown()" class="member-name-link">isShutdown</a>()</code></td>
<td> <div class="block">Returns true if this task scope is shutdown, otherwise false.</div> </td>
</tr>
<tr>
<td><code><a href="structuredtaskscope" title="class in java.util.concurrent">StructuredTaskScope</a><sup><a href="#preview-java.util.concurrent.StructuredTaskScope">PREVIEW</a></sup><wbr>&lt;<a href="structuredtaskscope" title="type parameter in StructuredTaskScope">T</a>&gt;</wbr></code></td>
<td><code><a href="#join()" class="member-name-link">join</a>()</code></td>
<td> <div class="block">Wait for all subtasks started in this task scope to finish or the task scope to shut down.</div> </td>
</tr>
<tr>
<td><code><a href="structuredtaskscope" title="class in java.util.concurrent">StructuredTaskScope</a><sup><a href="#preview-java.util.concurrent.StructuredTaskScope">PREVIEW</a></sup><wbr>&lt;<a href="structuredtaskscope" title="type parameter in StructuredTaskScope">T</a>&gt;</wbr></code></td>
<td><code><a href="#joinUntil(java.time.Instant)" class="member-name-link">joinUntil</a><wbr>(<a href="../../time/instant" title="class in java.time">Instant</a> deadline)</wbr></code></td>
<td> <div class="block">Wait for all subtasks started in this task scope to finish or the task scope to shut down, up to the given deadline.</div> </td>
</tr>
<tr>
<td><code>void</code></td>
<td><code><a href="#shutdown()" class="member-name-link">shutdown</a>()</code></td>
<td> <div class="block">Shut down this task scope without closing it.</div> </td>
</tr>
</table> </div> </div> <div class="inherited-list"> <h3 id="methods-inherited-from-class-java.lang.Object">Methods declared in class java.lang.<a href="../../lang/object" title="class in java.lang">Object</a>
</h3> <code><a href="../../lang/object#clone()">clone</a>, <a href="../../lang/object#equals(java.lang.Object)">equals</a>, <a href="../../lang/object#finalize()">finalize</a>, <a href="../../lang/object#getClass()">getClass</a>, <a href="../../lang/object#hashCode()">hashCode</a>, <a href="../../lang/object#notify()">notify</a>, <a href="../../lang/object#notifyAll()">notifyAll</a>, <a href="../../lang/object#toString()">toString</a>, <a href="../../lang/object#wait()">wait</a>, <a href="../../lang/object#wait(long)">wait</a>, <a href="../../lang/object#wait(long,int)">wait</a></code>
</div> </section> </section> <section class="details"> <section class="constructor-details" id="constructor-detail"> <h2>Constructor Details</h2>  </section><section class="detail" id="&lt;init&gt;(java.lang.String,java.util.concurrent.ThreadFactory)"> <h3>StructuredTaskScope</h3> <pre class="lang-java" data-language="java">public StructuredTaskScope(String name, ThreadFactory factory)</pre> <div class="block">Creates a structured task scope with the given name and thread factory. The task scope is optionally named for the purposes of monitoring and management. The thread factory is used to <a href="threadfactory#newThread(java.lang.Runnable)"><code>create</code></a> threads when subtasks are <a href="#fork(java.util.concurrent.Callable)">forked</a>. The task scope is owned by the current thread. <p> Construction captures the current thread's <a href="../../lang/scopedvalue" title="class in java.lang">scoped value</a><sup><a href="../../lang/scopedvalue#preview-java.lang.ScopedValue">PREVIEW</a></sup> bindings for inheritance by threads started in the task scope. The <a href="#TreeStructure">Tree Structure</a> section in the class description details how parent-child relations are established implicitly for the purpose of inheritance of scoped value bindings.</p>
</div> <dl class="notes"> <dt>Parameters:</dt> <dd>
<code>name</code> - the name of the task scope, can be null</dd> <dd>
<code>factory</code> - the thread factory</dd> </dl> </section><section class="detail" id="&lt;init&gt;()"> <h3>StructuredTaskScope</h3> <pre class="lang-java" data-language="java">public StructuredTaskScope()</pre> <div class="block">Creates an unnamed structured task scope that creates virtual threads. The task scope is owned by the current thread.</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>This constructor is equivalent to invoking the 2-arg constructor with a name of <code>null</code> and a thread factory that creates virtual threads.</dd> </dl> </section><section class="method-details" id="method-detail"> <h2>Method Details</h2>  </section><section class="detail" id="ensureOwnerAndJoined()"> <h3>ensureOwnerAndJoined</h3> <pre class="lang-java" data-language="java">protected final void ensureOwnerAndJoined()</pre> <div class="block">Ensures that the current thread is the owner of this task scope and that it joined (with <a href="#join()"><code>join()</code></a> or <a href="#joinUntil(java.time.Instant)"><code>joinUntil(Instant)</code></a>) after <a href="#fork(java.util.concurrent.Callable)">forking</a> subtasks.</div> <dl class="notes"> <dt>API Note:</dt> <dd>This method can be used by subclasses that define methods to make available results, state, or other outcome to code intended to execute after the join method.</dd> <dt>Throws:</dt> <dd>
<code><a href="../../lang/wrongthreadexception" title="class in java.lang">WrongThreadException</a></code> - if the current thread is not the task scope owner</dd> <dd>
<code><a href="../../lang/illegalstateexception" title="class in java.lang">IllegalStateException</a></code> - if the task scope is open and task scope owner did not join after forking</dd> </dl> </section><section class="detail" id="handleComplete(java.util.concurrent.StructuredTaskScope.Subtask)"> <h3>handleComplete</h3> <pre class="lang-java" data-language="java">protected void handleComplete(StructuredTaskScope.SubtaskPREVIEW&lt;? extends T&gt; subtask)</pre> <div class="block">Invoked by a subtask when it completes successfully or fails in this task scope. This method is not invoked if a subtask completes after the task scope is <a href="#shutdown()">shut down</a>.</div> <dl class="notes"> <dt>API Note:</dt> <dd>The <code>handleComplete</code> method should be thread safe. It may be invoked by several threads concurrently.</dd> <dt>Implementation Requirements:</dt> <dd>The default implementation throws <code>NullPointerException</code> if the subtask is <code>null</code>. It throws <a href="../../lang/illegalargumentexception" title="class in java.lang"><code>IllegalArgumentException</code></a> if the subtask has not completed.</dd> <dt>Parameters:</dt> <dd>
<code>subtask</code> - the subtask</dd> <dt>Throws:</dt> <dd>
<code><a href="../../lang/illegalargumentexception" title="class in java.lang">IllegalArgumentException</a></code> - if called with a subtask that has not completed</dd> </dl> </section><section class="detail" id="fork(java.util.concurrent.Callable)"> <h3>fork</h3> <pre class="lang-java" data-language="java">public &lt;U extends T&gt; StructuredTaskScope.SubtaskPREVIEW&lt;U&gt; fork(Callable&lt;? extends U&gt; task)</pre> <div class="block">Starts a new thread in this task scope to execute a value-returning task, thus creating a <em>subtask</em> of this task scope. <p> The value-returning task is provided to this method as a <a href="callable" title="interface in java.util.concurrent"><code>Callable</code></a>, the thread executes the task's <a href="callable#call()"><code>call</code></a> method. The thread is created with the task scope's <a href="threadfactory" title="interface in java.util.concurrent"><code>ThreadFactory</code></a>. It inherits the current thread's <a href="../../lang/scopedvalue" title="class in java.lang">scoped value</a><sup><a href="../../lang/scopedvalue#preview-java.lang.ScopedValue">PREVIEW</a></sup> bindings. The bindings must match the bindings captured when the task scope was created. </p>
<p> This method returns a <a href="structuredtaskscope.subtask" title="interface in java.util.concurrent"><code>Subtask</code></a><sup><a href="structuredtaskscope.subtask#preview-java.util.concurrent.StructuredTaskScope.Subtask">PREVIEW</a></sup> to represent the <em>forked subtask</em>. The <code>Subtask</code> object can be used to obtain the result when the subtask completes successfully, or the exception when the subtask fails. To ensure correct usage, the <a href="structuredtaskscope.subtask#get()"><code>get()</code></a><sup><a href="structuredtaskscope.subtask#preview-java.util.concurrent.StructuredTaskScope.Subtask">PREVIEW</a></sup> and <a href="structuredtaskscope.subtask#exception()"><code>exception()</code></a><sup><a href="structuredtaskscope.subtask#preview-java.util.concurrent.StructuredTaskScope.Subtask">PREVIEW</a></sup> methods may only be called by the task scope owner after it has waited for all threads to finish with the <a href="#join()"><code>join</code></a> or <a href="#joinUntil(java.time.Instant)"><code>joinUntil(Instant)</code></a> methods. When the subtask completes, the thread invokes the <a href="#handleComplete(java.util.concurrent.StructuredTaskScope.Subtask)"><code>handleComplete</code></a> method to consume the completed subtask. If the task scope is <a href="#shutdown()">shut down</a> before the subtask completes then the <code>handleComplete</code> method will not be invoked. </p>
<p> If this task scope is <a href="#shutdown()">shutdown</a> (or in the process of shutting down) then the subtask will not run and the <code>handleComplete</code> method will not be invoked. </p>
<p> This method may only be invoked by the task scope owner or threads contained in the task scope.</p>
</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>This method may be overridden for customization purposes, wrapping tasks for example. If overridden, the subclass must invoke <code>super.fork</code> to start a new thread in this task scope.</dd> <dt>Type Parameters:</dt> <dd>
<code>U</code> - the result type</dd> <dt>Parameters:</dt> <dd>
<code>task</code> - the value-returning task for the thread to execute</dd> <dt>Returns:</dt> <dd>the subtask</dd> <dt>Throws:</dt> <dd>
<code><a href="../../lang/illegalstateexception" title="class in java.lang">IllegalStateException</a></code> - if this task scope is closed</dd> <dd>
<code><a href="../../lang/wrongthreadexception" title="class in java.lang">WrongThreadException</a></code> - if the current thread is not the task scope owner or a thread contained in the task scope</dd> <dd>
<code><a href="structureviolationexception" title="class in java.util.concurrent">StructureViolationException</a><sup><a href="structureviolationexception#preview-java.util.concurrent.StructureViolationException">PREVIEW</a></sup></code> - if the current scoped value bindings are not the same as when the task scope was created</dd> <dd>
<code><a href="rejectedexecutionexception" title="class in java.util.concurrent">RejectedExecutionException</a></code> - if the thread factory rejected creating a thread to run the subtask</dd> </dl> </section><section class="detail" id="join()"> <h3>join</h3> <pre class="lang-java" data-language="java">public StructuredTaskScopePREVIEW&lt;T&gt; join() throws InterruptedException</pre> <div class="block">Wait for all subtasks started in this task scope to finish or the task scope to shut down. <p> This method waits for all subtasks by waiting for all threads <a href="#fork(java.util.concurrent.Callable)">started</a> in this task scope to finish execution. It stops waiting when all threads finish, the task scope is <a href="#shutdown()">shut down</a>, or the current thread is <a href="../../lang/thread#interrupt()">interrupted</a>. </p>
<p> This method may only be invoked by the task scope owner.</p>
</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>This method may be overridden for customization purposes or to return a more specific return type. If overridden, the subclass must invoke <code>
 super.join</code> to ensure that the method waits for threads in this task scope to finish.</dd> <dt>Returns:</dt> <dd>this task scope</dd> <dt>Throws:</dt> <dd>
<code><a href="../../lang/illegalstateexception" title="class in java.lang">IllegalStateException</a></code> - if this task scope is closed</dd> <dd>
<code><a href="../../lang/wrongthreadexception" title="class in java.lang">WrongThreadException</a></code> - if the current thread is not the task scope owner</dd> <dd>
<code><a href="../../lang/interruptedexception" title="class in java.lang">InterruptedException</a></code> - if interrupted while waiting</dd> </dl> </section><section class="detail" id="joinUntil(java.time.Instant)"> <h3>joinUntil</h3> <pre class="lang-java" data-language="java">public StructuredTaskScopePREVIEW&lt;T&gt; joinUntil(Instant deadline) throws InterruptedException, TimeoutException</pre> <div class="block">Wait for all subtasks started in this task scope to finish or the task scope to shut down, up to the given deadline. <p> This method waits for all subtasks by waiting for all threads <a href="#fork(java.util.concurrent.Callable)">started</a> in this task scope to finish execution. It stops waiting when all threads finish, the task scope is <a href="#shutdown()">shut down</a>, the deadline is reached, or the current thread is <a href="../../lang/thread#interrupt()">interrupted</a>. </p>
<p> This method may only be invoked by the task scope owner.</p>
</div> <dl class="notes"> <dt>Implementation Requirements:</dt> <dd>This method may be overridden for customization purposes or to return a more specific return type. If overridden, the subclass must invoke <code>
 super.joinUntil</code> to ensure that the method waits for threads in this task scope to finish.</dd> <dt>Parameters:</dt> <dd>
<code>deadline</code> - the deadline</dd> <dt>Returns:</dt> <dd>this task scope</dd> <dt>Throws:</dt> <dd>
<code><a href="../../lang/illegalstateexception" title="class in java.lang">IllegalStateException</a></code> - if this task scope is closed</dd> <dd>
<code><a href="../../lang/wrongthreadexception" title="class in java.lang">WrongThreadException</a></code> - if the current thread is not the task scope owner</dd> <dd>
<code><a href="../../lang/interruptedexception" title="class in java.lang">InterruptedException</a></code> - if interrupted while waiting</dd> <dd>
<code><a href="timeoutexception" title="class in java.util.concurrent">TimeoutException</a></code> - if the deadline is reached while waiting</dd> </dl> </section><section class="detail" id="shutdown()"> <h3>shutdown</h3> <pre class="lang-java" data-language="java">public void shutdown()</pre> <div class="block">Shut down this task scope without closing it. Shutting down a task scope prevents new threads from starting, interrupts all unfinished threads, and causes the <a href="#join()"><code>join</code></a> method to wakeup. Shutdown is useful for cases where the results of unfinished subtasks are no longer needed. It will typically be called by the <a href="#handleComplete(java.util.concurrent.StructuredTaskScope.Subtask)"><code>handleComplete(Subtask)</code></a> implementation of a subclass that implements a policy to discard unfinished tasks once some outcome is reached. <p> More specifically, this method: </p>
<ul> <li> <a href="../../lang/thread#interrupt()">Interrupts</a> all unfinished threads in the task scope (except the current thread). </li>
<li> Wakes up the task scope owner if it is waiting in <a href="#join()"><code>join()</code></a> or <a href="#joinUntil(java.time.Instant)"><code>joinUntil(Instant)</code></a>. If the task scope owner is not waiting then its next call to <code>join</code> or <code>joinUntil</code> will return immediately. </li>
</ul> <p> This method may only be invoked by the task scope owner or threads contained in the task scope.</p>
</div> <dl class="notes"> <dt>API Note:</dt> <dd>There may be threads that have not finished because they are executing code that did not respond (or respond promptly) to thread interrupt. This method does not wait for these threads. When the owner invokes the <a href="#close()"><code>close</code></a> method to close the task scope then it will wait for the remaining threads to finish.</dd> <dt>Implementation Requirements:</dt> <dd>This method may be overridden for customization purposes. If overridden, the subclass must invoke <code>super.shutdown</code> to ensure that the method shuts down the task scope.</dd> <dt>Throws:</dt> <dd>
<code><a href="../../lang/illegalstateexception" title="class in java.lang">IllegalStateException</a></code> - if this task scope is closed</dd> <dd>
<code><a href="../../lang/wrongthreadexception" title="class in java.lang">WrongThreadException</a></code> - if the current thread is not the task scope owner or a thread contained in the task scope</dd> <dt>See Also:</dt> <dd> <ul class="tag-list"> <li><a href="#isShutdown()"><code>isShutdown()</code></a></li> </ul> </dd> </dl> </section><section class="detail" id="isShutdown()"> <h3>isShutdown</h3> <pre class="lang-java" data-language="java">public final boolean isShutdown()</pre> <div class="block">Returns true if this task scope is shutdown, otherwise false.</div> <dl class="notes"> <dt>Returns:</dt> <dd>true if this task scope is shutdown, otherwise false</dd> <dt>See Also:</dt> <dd> <ul class="tag-list"> <li><a href="#shutdown()"><code>shutdown()</code></a></li> </ul> </dd> </dl> </section><section class="detail" id="close()"> <h3>close</h3> <pre class="lang-java" data-language="java">public void close()</pre> <div class="block">Closes this task scope. <p> This method first shuts down the task scope (as if by invoking the <a href="#shutdown()"><code>shutdown</code></a> method). It then waits for the threads executing any unfinished tasks to finish. If interrupted, this method will continue to wait for the threads to finish before completing with the interrupt status set. </p>
<p> This method may only be invoked by the task scope owner. If the task scope is already closed then the task scope owner invoking this method has no effect. </p>
<p> A <code>StructuredTaskScope</code> is intended to be used in a <em>structured manner</em>. If this method is called to close a task scope before nested task scopes are closed then it closes the underlying construct of each nested task scope (in the reverse order that they were created in), closes this task scope, and then throws <a href="structureviolationexception" title="class in java.util.concurrent"><code>StructureViolationException</code></a><sup><a href="structureviolationexception#preview-java.util.concurrent.StructureViolationException">PREVIEW</a></sup>. Similarly, if this method is called to close a task scope while executing with <a href="../../lang/scopedvalue" title="class in java.lang">scoped value</a><sup><a href="../../lang/scopedvalue#preview-java.lang.ScopedValue">PREVIEW</a></sup> bindings, and the task scope was created before the scoped values were bound, then <code>StructureViolationException</code> is thrown after closing the task scope. If a thread terminates without first closing task scopes that it owns then termination will cause the underlying construct of each of its open tasks scopes to be closed. Closing is performed in the reverse order that the task scopes were created in. Thread termination may therefore be delayed when the task scope owner has to wait for threads forked in these task scopes to finish.</p>
</div> <dl class="notes"> <dt>Specified by:</dt> <dd>
<code><a href="../../lang/autocloseable#close()">close</a></code> in interface <code><a href="../../lang/autocloseable" title="interface in java.lang">AutoCloseable</a></code>
</dd> <dt>Implementation Requirements:</dt> <dd>This method may be overridden for customization purposes. If overridden, the subclass must invoke <code>super.close</code> to close the task scope.</dd> <dt>Throws:</dt> <dd>
<code><a href="../../lang/illegalstateexception" title="class in java.lang">IllegalStateException</a></code> - thrown after closing the task scope if the task scope owner did not attempt to join after forking</dd> <dd>
<code><a href="../../lang/wrongthreadexception" title="class in java.lang">WrongThreadException</a></code> - if the current thread is not the task scope owner</dd> <dd>
<code><a href="structureviolationexception" title="class in java.util.concurrent">StructureViolationException</a><sup><a href="structureviolationexception#preview-java.util.concurrent.StructureViolationException">PREVIEW</a></sup></code> - if a structure violation was detected</dd> </dl> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    © 1993, 2023, Oracle and/or its affiliates. All rights reserved.<br>Documentation extracted from Debian's OpenJDK Development Kit package.<br>Licensed under the GNU General Public License, version 2, with the Classpath Exception.<br>Various third party code in OpenJDK is licensed under different licenses (see Debian package).<br>Java and OpenJDK are trademarks or registered trademarks of Oracle and/or its affiliates.<br>
    <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/StructuredTaskScope.html" class="_attribution-link">https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/StructuredTaskScope.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
