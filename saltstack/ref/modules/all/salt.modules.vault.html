
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>modules.vault - SaltStack - W3cubDocs</title>
  
  <meta name="description" content=" Functions to interact with Hashicorp Vault. ">
  <meta name="keywords" content="salt, modules, vault, module, saltstack">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/saltstack/ref/modules/all/salt.modules.vault.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/saltstack.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/saltstack/" class="_nav-link" title="" style="margin-left:0;">SaltStack</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _simple">
				
				
<h1>salt.modules.vault module</h1> <p>Functions to interact with Hashicorp Vault.</p> <table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body"> <tbody valign="top"> <tr class="field-odd field">
<th class="field-name">maintainer:</th>
<td class="field-body">SaltStack</td> </tr> <tr class="field-even field">
<th class="field-name">maturity:</th>
<td class="field-body">new</td> </tr> <tr class="field-odd field">
<th class="field-name">platform:</th>
<td class="field-body">all</td> </tr> <tr class="field-even field">
<th class="field-name">note:</th>
<td class="field-body">If you see the following error, you'll need to upgrade <code class="docutils literal notranslate"><span class="pre">requests</span></code> to atleast 2.4.2</td> </tr> </tbody> </table> <pre class="highlight-text notranslate" data-language="text">&lt;timestamp&gt; [salt.pillar][CRITICAL][14337] Pillar render error: Failed to load ext_pillar vault: {'error': "request() got an unexpected keyword argument 'json'"}</pre> <table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body"> <tbody valign="top"> <tr class="field-odd field">
<th class="field-name">configuration:</th>
<td class="field-body">
<p class="first">The salt-master must be configured to allow peer-runner configuration, as well as configuration for the module.</p> <p>Add this segment to the master configuration file, or /etc/salt/master.d/vault.conf:</p> <pre class="highlight-yaml notranslate" data-language="yaml">vault:
    url: https://vault.service.domain:8200
    verify: /etc/ssl/certs/ca-certificates.crt
    role_name: minion_role
    auth:
        method: approle
        role_id: 11111111-2222-3333-4444-1111111111111
        secret_id: 11111111-1111-1111-1111-1111111111111
    policies:
        - saltstack/minions
        - saltstack/minion/{minion}
        .. more policies
    keys:
        - n63/TbrQuL3xaIW7ZZpuXj/tIfnK1/MbVxO4vT3wYD2A
        - S9OwCvMRhErEA4NVVELYBs6w/Me6+urgUr24xGK44Uy3
        - F1j4b7JKq850NS6Kboiy5laJ0xY8dWJvB3fcwA+SraYl
        - 1cYtvjKJNDVam9c7HNqJUfINk4PYyAXIpjkpN/sIuzPv
        - 3pPK5X6vGtwLhNOFv1U2elahECz3HpRUfNXJFYLw6lid</pre> <dl class="docutils"> <dt>url</dt> <dd>
<p class="first last">Url to your Vault installation. Required.</p> </dd> <dt>verify</dt> <dd>
<p class="first">For details please see <a class="reference external" href="http://docs.python-requests.org/en/master/user/advanced/#ssl-cert-verification">http://docs.python-requests.org/en/master/user/advanced/#ssl-cert-verification</a></p> <div class="last versionadded"> <p><span class="versionmodified">New in version 2018.3.0.</span></p> </div> </dd> <dt>role_name</dt> <dd>
<p class="first">Role name for minion tokens created. If omitted, minion tokens will be created without any role, thus being able to inherit any master token policy (including token creation capabilities). Optional.</p> <p class="last">For details please see: <a class="reference external" href="https://www.vaultproject.io/api/auth/token/index.html#create-token">https://www.vaultproject.io/api/auth/token/index.html#create-token</a> Example configuration: <a class="reference external" href="https://www.nomadproject.io/docs/vault-integration/index.html#vault-token-role-configuration">https://www.nomadproject.io/docs/vault-integration/index.html#vault-token-role-configuration</a></p> </dd> <dt>auth</dt> <dd>
<p class="first">Currently only token and approle auth types are supported. Required.</p> <p>Approle is the preferred way to authenticate with Vault as it provide some advanced options to control authentication process. Please visit Vault documentation for more info: <a class="reference external" href="https://www.vaultproject.io/docs/auth/approle.html">https://www.vaultproject.io/docs/auth/approle.html</a></p> <p>The token must be able to create tokens with the policies that should be assigned to minions.</p> <p>You can still use the token auth via a OS environment variable via this config example:</p> <p class="last">And then export the VAULT_TOKEN variable in your OS:</p> </dd> <dt>policies</dt> <dd>
<p class="first">Policies that are assigned to minions when requesting a token. These can either be static, eg saltstack/minions, or templated, eg <code class="docutils literal notranslate"><span class="pre">saltstack/minion/{minion}</span></code>. <code class="docutils literal notranslate"><span class="pre">{minion}</span></code> is shorthand for grains[id]. Grains are also available, for example like this: <code class="docutils literal notranslate"><span class="pre">my-policies/{grains[os]}</span></code></p> <p>If a template contains a grain which evaluates to a list, it will be expanded into multiple policies. For example, given the template <code class="docutils literal notranslate"><span class="pre">saltstack/by-role/{grains[roles]}</span></code>, and a minion having these grains:</p> <p>The minion will have the policies <code class="docutils literal notranslate"><span class="pre">saltstack/by-role/web</span></code> and <code class="docutils literal notranslate"><span class="pre">saltstack/by-role/database</span></code>. Note however that list members which do not have simple string representations, such as dictionaries or objects, do not work and will throw an exception. Strings and numbers are examples of types which work well.</p> <p class="last">Optional. If policies is not configured, <code class="docutils literal notranslate"><span class="pre">saltstack/minions</span></code> and <code class="docutils literal notranslate"><span class="pre">saltstack/{minion}</span></code> are used as defaults.</p> </dd> <dt>keys</dt> <dd>
<p class="first last">List of keys to use to unseal vault server with the vault.unseal runner.</p> </dd> </dl> <p>Add this segment to the master configuration file, or /etc/salt/master.d/peer_run.conf:</p> <div class="last highlight-yaml notranslate">
<div class="highlight"><pre><span class="nt">peer_run</span><span class="p">:</span>
    <span class="nt">.*</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">vault.generate_token</span>
</pre></div> </div> </td> </tr> </tbody> </table> <dl class="function"> <h3 id="salt.modules.vault.delete_secret"> salt.modules.vault.delete_secret(path)</h3> <dd>
<p>Delete secret at the path in vault. The vault policy used must allow this.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' vault.delete_secret "secret/my/secret"</pre> </dd>
</dl> <dl class="function"> <h3 id="salt.modules.vault.list_secrets"> salt.modules.vault.list_secrets(path)</h3> <dd>
<p>List secret keys at the path in vault. The vault policy used must allow this. The path should end with a trailing slash.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' vault.list_secrets "secret/my/"</pre> </dd>
</dl> <dl class="function"> <h3 id="salt.modules.vault.read_secret"> salt.modules.vault.read_secret(path, key=None)</h3> <dd>
<p>Return the value of key at path in vault, or entire secret</p> <p>Jinja Example:</p> <pre class="highlight-jinja notranslate" data-language="jinja">my-secret: {{ salt['vault'].read_secret('secret/my/secret', 'some-key') }}</pre> <pre class="highlight-jinja notranslate" data-language="jinja">{% set supersecret = salt['vault'].read_secret('secret/my/secret') %}
secrets:
    first: {{ supersecret.first }}
    second: {{ supersecret.second }}</pre> </dd>
</dl> <dl class="function"> <h3 id="salt.modules.vault.write_raw"> salt.modules.vault.write_raw(path, raw)</h3> <dd>
<p>Set raw data at the path in vault. The vault policy used must allow this.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' vault.write_raw "secret/my/secret" '{"user":"foo","password": "bar"}'</pre> </dd>
</dl> <dl class="function"> <h3 id="salt.modules.vault.write_secret"> salt.modules.vault.write_secret(path, **kwargs)</h3> <dd>
<p>Set secret at the path in vault. The vault policy used must allow this.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' vault.write_secret "secret/my/secret" user="foo" password="bar"</pre> </dd>
</dl>
<div class="_attribution">
  <p class="_attribution-p">
    Â© 2019 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltstack.com/en/latest/ref/modules/all/salt.modules.vault.html" class="_attribution-link">https://docs.saltstack.com/en/latest/ref/modules/all/salt.modules.vault.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
