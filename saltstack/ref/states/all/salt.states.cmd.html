
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>states.cmd - SaltStack - W3cubDocs</title>
  
  <meta name="description" content=" The cmd state module manages the enforcement of executed commands, this state can tell a command to run under certain circumstances. ">
  <meta name="keywords" content="salt, states, cmd, saltstack">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/saltstack/ref/states/all/salt.states.cmd.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/saltstack.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/saltstack/" class="_nav-link" title="" style="margin-left:0;">SaltStack</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _simple">
				
				
<h1>salt.states.cmd</h1> <div class="section" id="execution-of-arbitrary-commands"> <h2>Execution of arbitrary commands</h2> <p>The cmd state module manages the enforcement of executed commands, this state can tell a command to run under certain circumstances.</p> <p>A simple example to execute a command:</p> <pre class="highlight-yaml notranslate" data-language="yaml"># Store the current date in a file
'date &gt; /tmp/salt-run':
  cmd.run</pre> <p>Only run if another execution failed, in this case truncate syslog if there is no disk space:</p> <pre class="highlight-yaml notranslate" data-language="yaml">'&gt; /var/log/messages/:
  cmd.run:
    - unless: echo 'foo' &gt; /tmp/.test &amp;&amp; rm -f /tmp/.test</pre> <p>Only run if the file specified by <code class="docutils literal notranslate"><span class="pre">creates</span></code> does not exist, in this case touch /tmp/foo if it does not exist:</p> <pre class="highlight-yaml notranslate" data-language="yaml">touch /tmp/foo:
  cmd.run:
    - creates: /tmp/foo</pre> <p><code class="docutils literal notranslate"><span class="pre">creates</span></code> also accepts a list of files:</p> <pre class="highlight-yaml notranslate" data-language="yaml">"echo 'foo' | tee /tmp/bar &gt; /tmp/baz":
  cmd.run:
    - creates:
      - /tmp/bar
      - /tmp/baz</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">The <code class="docutils literal notranslate"><span class="pre">creates</span></code> option was added to version 2014.7.0</p> </div> <p>Sometimes when running a command that starts up a daemon, the init script doesn't return properly which causes Salt to wait indefinitely for a response. In situations like this try the following:</p> <pre class="highlight-yaml notranslate" data-language="yaml">run_installer:
  cmd.run:
    - name: /tmp/installer.bin &gt; /dev/null 2&gt;&amp;1</pre> <p>Salt determines whether the <code class="docutils literal notranslate"><span class="pre">cmd</span></code> state is successfully enforced based on the exit code returned by the command. If the command returns a zero exit code, then salt determines that the state was successfully enforced. If the script returns a non-zero exit code, then salt determines that it failed to successfully enforce the state. If a command returns a non-zero exit code but you wish to treat this as a success, then you must place the command in a script and explicitly set the exit code of the script to zero.</p> <p>Please note that the success or failure of the state is not affected by whether a state change occurred nor the stateful argument.</p> <p>When executing a command or script, the state (i.e., changed or not) of the command is unknown to Salt's state system. Therefore, by default, the <code class="docutils literal notranslate"><span class="pre">cmd</span></code> state assumes that any command execution results in a changed state.</p> <p>This means that if a <code class="docutils literal notranslate"><span class="pre">cmd</span></code> state is watched by another state then the state that's watching will always be executed due to the <cite>changed</cite> state in the <code class="docutils literal notranslate"><span class="pre">cmd</span></code> state.</p> <div class="section" id="using-the-stateful-argument"> <h3>Using the "Stateful" Argument</h3> <p>Many state functions in this module now also accept a <code class="docutils literal notranslate"><span class="pre">stateful</span></code> argument. If <code class="docutils literal notranslate"><span class="pre">stateful</span></code> is specified to be true then it is assumed that the command or script will determine its own state and communicate it back by following a simple protocol described below:</p> <ol class="arabic"> <li>
<p class="first"><strong>If there's nothing in the stdout of the command, then assume no changes.</strong> Otherwise, the stdout must be either in JSON or its <cite>last</cite> non-empty line must be a string of key=value pairs delimited by spaces (no spaces on either side of <code class="docutils literal notranslate"><span class="pre">=</span></code>).</p> </li> <li>
<p class="first"><strong>If it's JSON then it must be a JSON object (e.g., {}).</strong> If it's key=value pairs then quoting may be used to include spaces. (Python's shlex module is used to parse the key=value string)</p> <p>Two special keys or attributes are recognized in the output:</p> <pre class="highlight-default notranslate" data-language="default">changed: bool (i.e., 'yes', 'no', 'true', 'false', case-insensitive)
comment: str  (i.e., any string)</pre> <p>So, only if <code class="docutils literal notranslate"><span class="pre">changed</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> then assume the command execution has changed the state, and any other key values or attributes in the output will be set as part of the changes.</p> </li> <li>
<p class="first"><strong>If there's a comment then it will be used as the comment of the state.</strong></p> <p>Here's an example of how one might write a shell script for use with a stateful command:</p> <pre class="highlight-bash notranslate" data-language="bash">#!/bin/bash
#
echo "Working hard..."

# writing the state line
echo  # an empty line here so the next line will be the last.
echo "changed=yes comment='something has changed' whatever=123"</pre> <p>And an example SLS file using this module:</p> <pre class="highlight-yaml notranslate" data-language="yaml">Run myscript:
  cmd.run:
    - name: /path/to/myscript
    - cwd: /
    - stateful: True

Run only if myscript changed something:
  cmd.run:
    - name: echo hello
    - cwd: /
    - onchanges:
        - cmd: Run myscript</pre> <p>Note that if the second <code class="docutils literal notranslate"><span class="pre">cmd.run</span></code> state also specifies <code class="docutils literal notranslate"><span class="pre">stateful:</span> <span class="pre">True</span></code> it can then be watched by some other states as well.</p> </li> <li>
<p class="first"><strong>The stateful argument can optionally include a test_name parameter.</strong></p> <p>This is used to specify a command to run in test mode. This command should return stateful data for changes that would be made by the command in the name parameter.</p> <div class="versionadded"> <p><span class="versionmodified">New in version 2015.2.0.</span></p> </div> <pre class="highlight-yaml notranslate" data-language="yaml">Run myscript:
  cmd.run:
    - name: /path/to/myscript
    - cwd: /
    - stateful:
      - test_name: /path/to/myscript test

Run masterscript:
  cmd.script:
    - name: masterscript
    - source: salt://path/to/masterscript
    - cwd: /
    - stateful:
      - test_name: masterscript test</pre> </li> </ol> </div> <div class="section" id="should-i-use-cmd-run-or-cmd-wait"> <h3>Should I use <a class="reference internal" href="#salt.states.cmd.run" title="salt.states.cmd.run"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cmd.run</span></code></a> or <a class="reference internal" href="#salt.states.cmd.wait" title="salt.states.cmd.wait"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cmd.wait</span></code></a>?</h3> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Use <a class="reference internal" href="#salt.states.cmd.run" title="salt.states.cmd.run"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cmd.run</span></code></a> together with <a class="reference internal" href="https://docs.saltstack.com/en/latest/ref/states/requisites.html#requisites-onchanges"><span class="std std-ref">onchanges</span></a> instead of <a class="reference internal" href="#salt.states.cmd.wait" title="salt.states.cmd.wait"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cmd.wait</span></code></a>.</p> </div> <p>These two states are often confused. The important thing to remember about them is that <a class="reference internal" href="#salt.states.cmd.run" title="salt.states.cmd.run"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cmd.run</span></code></a> states are run each time the SLS file that contains them is applied. If it is more desirable to have a command that only runs after some other state changes, then <a class="reference internal" href="#salt.states.cmd.wait" title="salt.states.cmd.wait"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cmd.wait</span></code></a> does just that. <a class="reference internal" href="#salt.states.cmd.wait" title="salt.states.cmd.wait"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cmd.wait</span></code></a> is designed to <a class="reference internal" href="https://docs.saltstack.com/en/latest/ref/states/requisites.html#requisites-watch"><span class="std std-ref">watch</span></a> other states, and is executed when the state it is watching changes. Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/usr/local/bin/postinstall.sh:
  cmd.wait:
    - watch:
      - pkg: mycustompkg
  file.managed:
    - source: salt://utils/scripts/postinstall.sh

mycustompkg:
  pkg.installed:
    - require:
      - file: /usr/local/bin/postinstall.sh</pre> <p><code class="docutils literal notranslate"><span class="pre">cmd.wait</span></code> itself does not do anything; all functionality is inside its <code class="docutils literal notranslate"><span class="pre">mod_watch</span></code> function, which is called by <code class="docutils literal notranslate"><span class="pre">watch</span></code> on changes.</p> <p>The preferred format is using the <a class="reference internal" href="https://docs.saltstack.com/en/latest/ref/states/requisites.html#requisites-onchanges"><span class="std std-ref">onchanges Requisite</span></a>, which works on <code class="docutils literal notranslate"><span class="pre">cmd.run</span></code> as well as on any other state. The example would then look as follows:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/usr/local/bin/postinstall.sh:
  cmd.run:
    - onchanges:
      - pkg: mycustompkg
  file.managed:
    - source: salt://utils/scripts/postinstall.sh

mycustompkg:
  pkg.installed:
    - require:
      - file: /usr/local/bin/postinstall.sh</pre> </div> <div class="section" id="how-do-i-create-an-environment-from-a-pillar-map"> <h3>How do I create an environment from a pillar map?</h3> <p>The map that comes from a pillar can be directly consumed by the env option! To use it, one may pass it like this. Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">printenv:
  cmd.run:
    - env: {{ salt['pillar.get']('example:key', {}) }}</pre> <dl class="function"> <h3 id="salt.states.cmd.call"> salt.states.cmd.call(name, func, args=(), kws=None, onlyif=None, unless=None, creates=None, output_loglevel='debug', hide_output=False, use_vt=False, **kwargs)</h3> <dd>
<p>Invoke a pre-defined Python function with arguments specified in the state declaration. This function is mainly used by the <a class="reference internal" href="../../renderers/all/salt.renderers.pydsl#module-salt.renderers.pydsl" title="salt.renderers.pydsl"><code class="xref py py-mod docutils literal notranslate"><span class="pre">salt.renderers.pydsl</span></code></a> renderer.</p> <p>The interpretation of <code class="docutils literal notranslate"><span class="pre">onlyif</span></code> and <code class="docutils literal notranslate"><span class="pre">unless</span></code> arguments are identical to those of <a class="reference internal" href="#salt.states.cmd.run" title="salt.states.cmd.run"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cmd.run</span></code></a>, and all other arguments(<code class="docutils literal notranslate"><span class="pre">cwd</span></code>, <code class="docutils literal notranslate"><span class="pre">runas</span></code>, ...) allowed by <a class="reference internal" href="#salt.states.cmd.run" title="salt.states.cmd.run"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cmd.run</span></code></a> are allowed here, except that their effects apply only to the commands specified in <cite>onlyif</cite> and <cite>unless</cite> rather than to the function to be invoked.</p> <p>In addition, the <code class="docutils literal notranslate"><span class="pre">stateful</span></code> argument has no effects here.</p> <p>The return value of the invoked function will be interpreted as follows.</p> <p>If it's a dictionary then it will be passed through to the state system, which expects it to have the usual structure returned by any salt state function.</p> <p>Otherwise, the return value (denoted as <code class="docutils literal notranslate"><span class="pre">result</span></code> in the code below) is expected to be a JSON serializable object, and this dictionary is returned:</p> <pre class="highlight-python notranslate" data-language="python">{
    'name': name
    'changes': {'retval': result},
    'result': True if result is None else bool(result),
    'comment': result if isinstance(result, six.string_types) else ''
}</pre> </dd>
</dl> <dl class="function"> <h3 id="salt.states.cmd.mod_run_check"> salt.states.cmd.mod_run_check(cmd_kwargs, onlyif, unless, creates)</h3> <dd>
<p>Execute the onlyif and unless logic. Return a result dict if: * onlyif failed (onlyif != 0) * unless succeeded (unless == 0) else return True</p> </dd>
</dl> <dl class="function"> <h3 id="salt.states.cmd.mod_watch"> salt.states.cmd.mod_watch(name, **kwargs)</h3> <dd>
<p>Execute a cmd function based on a watch call</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p>This state exists to support special handling of the <code class="docutils literal notranslate"><span class="pre">watch</span></code> <a class="reference internal" href="https://docs.saltstack.com/en/latest/ref/states/requisites.html#requisites"><span class="std std-ref">requisite</span></a>. It should not be called directly.</p> <p class="last">Parameters for this function should be set by the state being triggered.</p> </div> </dd>
</dl> <dl class="function"> <h3 id="salt.states.cmd.run"> salt.states.cmd.run(name, onlyif=None, unless=None, creates=None, cwd=None, runas=None, shell=None, env=None, prepend_path=None, stateful=False, umask=None, output_loglevel='debug', hide_output=False, timeout=None, ignore_timeout=False, use_vt=False, success_retcodes=None, **kwargs)</h3> <dd>
<p>Run a command if certain circumstances are met. Use <code class="docutils literal notranslate"><span class="pre">cmd.wait</span></code> if you want to use the <code class="docutils literal notranslate"><span class="pre">watch</span></code> requisite.</p> <dl class="docutils"> <dt>name</dt> <dd>The command to execute, remember that the command will execute with the path and permissions of the salt-minion.</dd> <dt>onlyif</dt> <dd>A command to run as a check, run the named command only if the command passed to the <code class="docutils literal notranslate"><span class="pre">onlyif</span></code> option returns a zero exit status</dd> <dt>unless</dt> <dd>A command to run as a check, only run the named command if the command passed to the <code class="docutils literal notranslate"><span class="pre">unless</span></code> option returns a non-zero exit status</dd> <dt>cwd</dt> <dd>The current working directory to execute the command in, defaults to /root</dd> <dt>runas</dt> <dd>The user name to run the command as</dd> <dt>shell</dt> <dd>The shell to use for execution, defaults to the shell grain</dd> <dt>env</dt> <dd>
<p class="first">A list of environment variables to be set prior to execution. Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">script-foo:
  cmd.run:
    - env:
      - BATCH: 'yes'</pre> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">The above illustrates a common PyYAML pitfall, that <strong>yes</strong>, <strong>no</strong>, <strong>on</strong>, <strong>off</strong>, <strong>true</strong>, and <strong>false</strong> are all loaded as boolean <code class="docutils literal notranslate"><span class="pre">True</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span></code> values, and must be enclosed in quotes to be used as strings. More info on this (and other) PyYAML idiosyncrasies can be found <a class="reference internal" href="https://docs.saltstack.com/en/latest/topics/troubleshooting/yaml_idiosyncrasies.html#yaml-idiosyncrasies"><span class="std std-ref">here</span></a>.</p> </div> <p>Variables as values are not evaluated. So $PATH in the following example is a literal '$PATH':</p> <pre class="highlight-yaml notranslate" data-language="yaml">script-bar:
  cmd.run:
    - env: "PATH=/some/path:$PATH"</pre> <p>One can still use the existing $PATH by using a bit of Jinja:</p> <div class="last highlight-jinja notranslate">
<div class="highlight"><pre><span class="cp">{%</span> <span class="k">set</span> <span class="nv">current_path</span> <span class="o">=</span> <span class="nv">salt</span><span class="o">[</span><span class="s1">'environ.get'</span><span class="o">](</span><span class="s1">'PATH'</span><span class="o">,</span> <span class="s1">'/bin:/usr/bin'</span><span class="o">)</span> <span class="cp">%}</span>

<span class="x">mycommand:</span>
<span class="x">  cmd.run:</span>
<span class="x">    - name: ls -l /</span>
<span class="x">    - env:</span>
<span class="x">      - PATH: </span><span class="cp">{{</span> <span class="o">[</span><span class="nv">current_path</span><span class="o">,</span> <span class="s1">'/my/special/bin'</span><span class="o">]|</span><span class="nf">join</span><span class="o">(</span><span class="s1">':'</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div> </div> </dd> <dt>prepend_path</dt> <dd>
<p class="first">$PATH segment to prepend (trailing ':' not necessary) to $PATH. This is an easier alternative to the Jinja workaround.</p> <div class="last versionadded"> <p><span class="versionmodified">New in version 2018.3.0.</span></p> </div> </dd> <dt>stateful</dt> <dd>The command being executed is expected to return data about executing a state. For more information, see the <a class="reference internal" href="#stateful-argument"><span class="std std-ref">Using the "Stateful" Argument</span></a> section.</dd> <dt>umask</dt> <dd>The umask (in octal) to use when running the command.</dd> <dt>output_loglevel <span class="classifier-delimiter">:</span> <span class="classifier">debug</span>
</dt> <dd>
<p class="first">Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="last admonition note"> <p class="first admonition-title">Note</p> <p class="last">The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </dd> <dt>hide_output <span class="classifier-delimiter">:</span> <span class="classifier">False</span>
</dt> <dd>
<p class="first">Suppress stdout and stderr in the state's results.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">This is separate from <code class="docutils literal notranslate"><span class="pre">output_loglevel</span></code>, which only handles how Salt logs to the minion log.</p> </div> <div class="last versionadded"> <p><span class="versionmodified">New in version 2018.3.0.</span></p> </div> </dd> <dt>quiet</dt> <dd>
<p class="first">This option no longer has any functionality and will be removed, please set <code class="docutils literal notranslate"><span class="pre">output_loglevel</span></code> to <code class="docutils literal notranslate"><span class="pre">quiet</span></code> to suppress logging of the command.</p> <div class="last deprecated"> <p><span class="versionmodified">Deprecated since version 2014.1.0.</span></p> </div> </dd> <dt>timeout</dt> <dd>If the command has not terminated after timeout seconds, send the subprocess sigterm, and if sigterm is ignored, follow up with sigkill</dd> <dt>ignore_timeout</dt> <dd>
<p class="first">Ignore the timeout of commands, which is useful for running nohup processes.</p> <div class="last versionadded"> <p><span class="versionmodified">New in version 2015.8.0.</span></p> </div> </dd> <dt>creates</dt> <dd>
<p class="first">Only run if the file or files specified by <code class="docutils literal notranslate"><span class="pre">creates</span></code> do not exist.</p> <div class="last versionadded"> <p><span class="versionmodified">New in version 2014.7.0.</span></p> </div> </dd> <dt>use_vt <span class="classifier-delimiter">:</span> <span class="classifier">False</span>
</dt> <dd>Use VT utils (saltstack) to stream the command output more interactively to the console and the logs. This is experimental.</dd> <dt>bg <span class="classifier-delimiter">:</span> <span class="classifier">False</span>
</dt> <dd>
<p class="first">If <code class="docutils literal notranslate"><span class="pre">True</span></code>, run command in background and do not await or deliver its results.</p> <div class="last versionadded"> <p><span class="versionmodified">New in version 2016.3.6.</span></p> </div> </dd> <dt>success_retcodes: This parameter will be allow a list of</dt> <dd>
<blockquote class="first"> <div>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</div>
</blockquote> <div class="last versionadded"> <p><span class="versionmodified">New in version 2019.2.0.</span></p> </div> </dd> </dl> <div class="admonition note"> <p class="first admonition-title">Note</p> <p>cmd.run supports the usage of <code class="docutils literal notranslate"><span class="pre">reload_modules</span></code>. This functionality allows you to force Salt to reload all modules. You should only use <code class="docutils literal notranslate"><span class="pre">reload_modules</span></code> if your cmd.run does some sort of installation (such as <code class="docutils literal notranslate"><span class="pre">pip</span></code>), if you do not reload the modules future items in your state which rely on the software being installed will fail.</p> <div class="last highlight-yaml notranslate">
<div class="highlight"><pre><span class="nt">getpip</span><span class="p">:</span>
  <span class="nt">cmd.run</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/bin/python /usr/local/sbin/get-pip.py</span>
    <span class="p p-Indicator">-</span> <span class="nt">unless</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">which pip</span>
    <span class="p p-Indicator">-</span> <span class="nt">require</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">pkg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
      <span class="p p-Indicator">-</span> <span class="nt">file</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/local/sbin/get-pip.py</span>
    <span class="p p-Indicator">-</span> <span class="nt">reload_modules</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div> </div> </div> </dd>
</dl> <dl class="function"> <h3 id="salt.states.cmd.script"> salt.states.cmd.script(name, source=None, template=None, onlyif=None, unless=None, creates=None, cwd=None, runas=None, shell=None, env=None, stateful=False, umask=None, timeout=None, use_vt=False, output_loglevel='debug', hide_output=False, defaults=None, context=None, success_retcodes=None, **kwargs)</h3> <dd>
<p>Download a script and execute it with specified arguments.</p> <dl class="docutils"> <dt>source</dt> <dd>The location of the script to download. If the file is located on the master in the directory named spam, and is called eggs, the source string is salt://spam/eggs</dd> <dt>template</dt> <dd>If this setting is applied then the named templating engine will be used to render the downloaded file. Currently jinja, mako, and wempy are supported</dd> <dt>name</dt> <dd>Either "cmd arg1 arg2 arg3..." (cmd is not used) or a source "salt://...".</dd> <dt>onlyif</dt> <dd>Run the named command only if the command passed to the <code class="docutils literal notranslate"><span class="pre">onlyif</span></code> option returns true</dd> <dt>unless</dt> <dd>Run the named command only if the command passed to the <code class="docutils literal notranslate"><span class="pre">unless</span></code> option returns false</dd> <dt>cwd</dt> <dd>The current working directory to execute the command in, defaults to /root</dd> <dt>runas</dt> <dd>The name of the user to run the command as</dd> <dt>shell</dt> <dd>The shell to use for execution. The default is set in grains['shell']</dd> <dt>env</dt> <dd>
<p class="first">A list of environment variables to be set prior to execution. Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">salt://scripts/foo.sh:
  cmd.script:
    - env:
      - BATCH: 'yes'</pre> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">The above illustrates a common PyYAML pitfall, that <strong>yes</strong>, <strong>no</strong>, <strong>on</strong>, <strong>off</strong>, <strong>true</strong>, and <strong>false</strong> are all loaded as boolean <code class="docutils literal notranslate"><span class="pre">True</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span></code> values, and must be enclosed in quotes to be used as strings. More info on this (and other) PyYAML idiosyncrasies can be found <a class="reference internal" href="https://docs.saltstack.com/en/latest/topics/troubleshooting/yaml_idiosyncrasies.html#yaml-idiosyncrasies"><span class="std std-ref">here</span></a>.</p> </div> <p>Variables as values are not evaluated. So $PATH in the following example is a literal '$PATH':</p> <pre class="highlight-yaml notranslate" data-language="yaml">salt://scripts/bar.sh:
  cmd.script:
    - env: "PATH=/some/path:$PATH"</pre> <p>One can still use the existing $PATH by using a bit of Jinja:</p> <div class="last highlight-jinja notranslate">
<div class="highlight"><pre><span class="cp">{%</span> <span class="k">set</span> <span class="nv">current_path</span> <span class="o">=</span> <span class="nv">salt</span><span class="o">[</span><span class="s1">'environ.get'</span><span class="o">](</span><span class="s1">'PATH'</span><span class="o">,</span> <span class="s1">'/bin:/usr/bin'</span><span class="o">)</span> <span class="cp">%}</span>

<span class="x">mycommand:</span>
<span class="x">  cmd.run:</span>
<span class="x">    - name: ls -l /</span>
<span class="x">    - env:</span>
<span class="x">      - PATH: </span><span class="cp">{{</span> <span class="o">[</span><span class="nv">current_path</span><span class="o">,</span> <span class="s1">'/my/special/bin'</span><span class="o">]|</span><span class="nf">join</span><span class="o">(</span><span class="s1">':'</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div> </div> </dd> <dt>saltenv <span class="classifier-delimiter">:</span> <span class="classifier"><code class="docutils literal notranslate"><span class="pre">base</span></code></span>
</dt> <dd>The Salt environment to use</dd> <dt>umask</dt> <dd>The umask (in octal) to use when running the command.</dd> <dt>stateful</dt> <dd>The command being executed is expected to return data about executing a state. For more information, see the <a class="reference internal" href="#stateful-argument"><span class="std std-ref">Using the "Stateful" Argument</span></a> section.</dd> <dt>timeout</dt> <dd>If the command has not terminated after timeout seconds, send the subprocess sigterm, and if sigterm is ignored, follow up with sigkill</dd> <dt>args</dt> <dd>String of command line args to pass to the script. Only used if no args are specified as part of the <cite>name</cite> argument. To pass a string containing spaces in YAML, you will need to doubly-quote it: "arg1 'arg two' arg3"</dd> <dt>creates</dt> <dd>
<p class="first">Only run if the file or files specified by <code class="docutils literal notranslate"><span class="pre">creates</span></code> do not exist.</p> <div class="last versionadded"> <p><span class="versionmodified">New in version 2014.7.0.</span></p> </div> </dd> <dt>use_vt</dt> <dd>Use VT utils (saltstack) to stream the command output more interactively to the console and the logs. This is experimental.</dd> <dt>context</dt> <dd>
<div class="first versionadded"> <p><span class="versionmodified">New in version 2016.3.0.</span></p> </div> <p class="last">Overrides default context variables passed to the template.</p> </dd> <dt>defaults</dt> <dd>
<div class="first versionadded"> <p><span class="versionmodified">New in version 2016.3.0.</span></p> </div> <p class="last">Default context passed to the template.</p> </dd> <dt>output_loglevel <span class="classifier-delimiter">:</span> <span class="classifier">debug</span>
</dt> <dd>
<p class="first">Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="last admonition note"> <p class="first admonition-title">Note</p> <p class="last">The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </dd> <dt>hide_output <span class="classifier-delimiter">:</span> <span class="classifier">False</span>
</dt> <dd>
<p class="first">Suppress stdout and stderr in the state's results.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">This is separate from <code class="docutils literal notranslate"><span class="pre">output_loglevel</span></code>, which only handles how Salt logs to the minion log.</p> </div> <div class="last versionadded"> <p><span class="versionmodified">New in version 2018.3.0.</span></p> </div> </dd> <dt>success_retcodes: This parameter will be allow a list of</dt> <dd>
<blockquote class="first"> <div>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</div>
</blockquote> <div class="last versionadded"> <p><span class="versionmodified">New in version 2019.2.0.</span></p> </div> </dd> </dl> </dd>
</dl> <dl class="function"> <h3 id="salt.states.cmd.wait"> salt.states.cmd.wait(name, onlyif=None, unless=None, creates=None, cwd=None, runas=None, shell=None, env=(), stateful=False, umask=None, output_loglevel='debug', hide_output=False, use_vt=False, success_retcodes=None, **kwargs)</h3> <dd>
<p>Run the given command only if the watch statement calls it.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Use <a class="reference internal" href="#salt.states.cmd.run" title="salt.states.cmd.run"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cmd.run</span></code></a> together with <code class="xref py py-mod docutils literal notranslate"><span class="pre">onchanges</span></code> instead of <a class="reference internal" href="#salt.states.cmd.wait" title="salt.states.cmd.wait"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cmd.wait</span></code></a>.</p> </div> <dl class="docutils"> <dt>name</dt> <dd>The command to execute, remember that the command will execute with the path and permissions of the salt-minion.</dd> <dt>onlyif</dt> <dd>A command to run as a check, run the named command only if the command passed to the <code class="docutils literal notranslate"><span class="pre">onlyif</span></code> option returns true</dd> <dt>unless</dt> <dd>A command to run as a check, only run the named command if the command passed to the <code class="docutils literal notranslate"><span class="pre">unless</span></code> option returns false</dd> <dt>cwd</dt> <dd>The current working directory to execute the command in, defaults to /root</dd> <dt>runas</dt> <dd>The user name to run the command as</dd> <dt>shell</dt> <dd>The shell to use for execution, defaults to /bin/sh</dd> <dt>env</dt> <dd>
<p class="first">A list of environment variables to be set prior to execution. Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">script-foo:
  cmd.wait:
    - env:
      - BATCH: 'yes'</pre> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">The above illustrates a common PyYAML pitfall, that <strong>yes</strong>, <strong>no</strong>, <strong>on</strong>, <strong>off</strong>, <strong>true</strong>, and <strong>false</strong> are all loaded as boolean <code class="docutils literal notranslate"><span class="pre">True</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span></code> values, and must be enclosed in quotes to be used as strings. More info on this (and other) PyYAML idiosyncrasies can be found <a class="reference internal" href="https://docs.saltstack.com/en/latest/topics/troubleshooting/yaml_idiosyncrasies.html#yaml-idiosyncrasies"><span class="std std-ref">here</span></a>.</p> </div> <p>Variables as values are not evaluated. So $PATH in the following example is a literal '$PATH':</p> <pre class="highlight-yaml notranslate" data-language="yaml">script-bar:
  cmd.wait:
    - env: "PATH=/some/path:$PATH"</pre> <p>One can still use the existing $PATH by using a bit of Jinja:</p> <div class="last highlight-jinja notranslate">
<div class="highlight"><pre><span class="cp">{%</span> <span class="k">set</span> <span class="nv">current_path</span> <span class="o">=</span> <span class="nv">salt</span><span class="o">[</span><span class="s1">'environ.get'</span><span class="o">](</span><span class="s1">'PATH'</span><span class="o">,</span> <span class="s1">'/bin:/usr/bin'</span><span class="o">)</span> <span class="cp">%}</span>

<span class="x">mycommand:</span>
<span class="x">  cmd.run:</span>
<span class="x">    - name: ls -l /</span>
<span class="x">    - env:</span>
<span class="x">      - PATH: </span><span class="cp">{{</span> <span class="o">[</span><span class="nv">current_path</span><span class="o">,</span> <span class="s1">'/my/special/bin'</span><span class="o">]|</span><span class="nf">join</span><span class="o">(</span><span class="s1">':'</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div> </div> </dd> <dt>umask</dt> <dd>The umask (in octal) to use when running the command.</dd> <dt>stateful</dt> <dd>The command being executed is expected to return data about executing a state. For more information, see the <a class="reference internal" href="#stateful-argument"><span class="std std-ref">Using the "Stateful" Argument</span></a> section.</dd> <dt>creates</dt> <dd>
<p class="first">Only run if the file or files specified by <code class="docutils literal notranslate"><span class="pre">creates</span></code> do not exist.</p> <div class="last versionadded"> <p><span class="versionmodified">New in version 2014.7.0.</span></p> </div> </dd> <dt>output_loglevel <span class="classifier-delimiter">:</span> <span class="classifier">debug</span>
</dt> <dd>
<p class="first">Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="last admonition note"> <p class="first admonition-title">Note</p> <p class="last">The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </dd> <dt>hide_output <span class="classifier-delimiter">:</span> <span class="classifier">False</span>
</dt> <dd>
<p class="first">Suppress stdout and stderr in the state's results.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">This is separate from <code class="docutils literal notranslate"><span class="pre">output_loglevel</span></code>, which only handles how Salt logs to the minion log.</p> </div> <div class="last versionadded"> <p><span class="versionmodified">New in version 2018.3.0.</span></p> </div> </dd> <dt>use_vt</dt> <dd>Use VT utils (saltstack) to stream the command output more interactively to the console and the logs. This is experimental.</dd> <dt>success_retcodes: This parameter will be allow a list of</dt> <dd>
<blockquote class="first"> <div>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</div>
</blockquote> <div class="last versionadded"> <p><span class="versionmodified">New in version 2019.2.0.</span></p> </div> </dd> </dl> </dd>
</dl> <dl class="function"> <h3 id="salt.states.cmd.wait_call"> salt.states.cmd.wait_call(name, func, args=(), kws=None, onlyif=None, unless=None, creates=None, stateful=False, use_vt=False, output_loglevel='debug', hide_output=False, **kwargs)</h3> 
</dl> <dl class="function"> <h3 id="salt.states.cmd.wait_script"> salt.states.cmd.wait_script(name, source=None, template=None, onlyif=None, unless=None, cwd=None, runas=None, shell=None, env=None, stateful=False, umask=None, use_vt=False, output_loglevel='debug', hide_output=False, **kwargs)</h3> <dd>
<p>Download a script from a remote source and execute it only if a watch statement calls it.</p> <dl class="docutils"> <dt>source</dt> <dd>The source script being downloaded to the minion, this source script is hosted on the salt master server. If the file is located on the master in the directory named spam, and is called eggs, the source string is salt://spam/eggs</dd> <dt>template</dt> <dd>If this setting is applied then the named templating engine will be used to render the downloaded file, currently jinja, mako, and wempy are supported</dd> <dt>name</dt> <dd>The command to execute, remember that the command will execute with the path and permissions of the salt-minion.</dd> <dt>onlyif</dt> <dd>A command to run as a check, run the named command only if the command passed to the <code class="docutils literal notranslate"><span class="pre">onlyif</span></code> option returns true</dd> <dt>unless</dt> <dd>A command to run as a check, only run the named command if the command passed to the <code class="docutils literal notranslate"><span class="pre">unless</span></code> option returns false</dd> <dt>cwd</dt> <dd>The current working directory to execute the command in, defaults to /root</dd> <dt>runas</dt> <dd>The user name to run the command as</dd> <dt>shell</dt> <dd>The shell to use for execution, defaults to the shell grain</dd> <dt>env</dt> <dd>
<p class="first">A list of environment variables to be set prior to execution. Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">salt://scripts/foo.sh:
  cmd.wait_script:
    - env:
      - BATCH: 'yes'</pre> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">The above illustrates a common PyYAML pitfall, that <strong>yes</strong>, <strong>no</strong>, <strong>on</strong>, <strong>off</strong>, <strong>true</strong>, and <strong>false</strong> are all loaded as boolean <code class="docutils literal notranslate"><span class="pre">True</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span></code> values, and must be enclosed in quotes to be used as strings. More info on this (and other) PyYAML idiosyncrasies can be found <a class="reference internal" href="https://docs.saltstack.com/en/latest/topics/troubleshooting/yaml_idiosyncrasies.html#yaml-idiosyncrasies"><span class="std std-ref">here</span></a>.</p> </div> <p>Variables as values are not evaluated. So $PATH in the following example is a literal '$PATH':</p> <pre class="highlight-yaml notranslate" data-language="yaml">salt://scripts/bar.sh:
  cmd.wait_script:
    - env: "PATH=/some/path:$PATH"</pre> <p>One can still use the existing $PATH by using a bit of Jinja:</p> <div class="last highlight-jinja notranslate">
<div class="highlight"><pre><span class="cp">{%</span> <span class="k">set</span> <span class="nv">current_path</span> <span class="o">=</span> <span class="nv">salt</span><span class="o">[</span><span class="s1">'environ.get'</span><span class="o">](</span><span class="s1">'PATH'</span><span class="o">,</span> <span class="s1">'/bin:/usr/bin'</span><span class="o">)</span> <span class="cp">%}</span>

<span class="x">mycommand:</span>
<span class="x">  cmd.run:</span>
<span class="x">    - name: ls -l /</span>
<span class="x">    - env:</span>
<span class="x">      - PATH: </span><span class="cp">{{</span> <span class="o">[</span><span class="nv">current_path</span><span class="o">,</span> <span class="s1">'/my/special/bin'</span><span class="o">]|</span><span class="nf">join</span><span class="o">(</span><span class="s1">':'</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div> </div> </dd> <dt>umask</dt> <dd>The umask (in octal) to use when running the command.</dd> <dt>stateful</dt> <dd>The command being executed is expected to return data about executing a state. For more information, see the <a class="reference internal" href="#stateful-argument"><span class="std std-ref">Using the "Stateful" Argument</span></a> section.</dd> <dt>use_vt</dt> <dd>Use VT utils (saltstack) to stream the command output more interactively to the console and the logs. This is experimental.</dd> <dt>output_loglevel <span class="classifier-delimiter">:</span> <span class="classifier">debug</span>
</dt> <dd>
<p class="first">Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="last admonition note"> <p class="first admonition-title">Note</p> <p class="last">The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </dd> <dt>hide_output <span class="classifier-delimiter">:</span> <span class="classifier">False</span>
</dt> <dd>
<p class="first">Suppress stdout and stderr in the state's results.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">This is separate from <code class="docutils literal notranslate"><span class="pre">output_loglevel</span></code>, which only handles how Salt logs to the minion log.</p> </div> <div class="last versionadded"> <p><span class="versionmodified">New in version 2018.3.0.</span></p> </div> </dd> <dt>success_retcodes: This parameter will be allow a list of</dt> <dd>
<blockquote class="first"> <div>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</div>
</blockquote> <div class="last versionadded"> <p><span class="versionmodified">New in version 2019.2.0.</span></p> </div> </dd> </dl> </dd>
</dl> </div> </div>
<div class="_attribution">
  <p class="_attribution-p">
    Â© 2019 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltstack.com/en/latest/ref/states/all/salt.states.cmd.html" class="_attribution-link">https://docs.saltstack.com/en/latest/ref/states/all/salt.states.cmd.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
