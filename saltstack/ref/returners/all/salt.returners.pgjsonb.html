
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>returners.pgjsonb - SaltStack - W3cubDocs</title>
  
  <meta name="description" content=" Return data to a PostgreSQL server with json data stored in Pg&#39;s jsonb data type ">
  <meta name="keywords" content="salt, returners, pgjsonb, saltstack">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/saltstack/ref/returners/all/salt.returners.pgjsonb.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/saltstack.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/saltstack/" class="_nav-link" title="" style="margin-left:0;">SaltStack</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _simple">
				
				
<h1>salt.returners.pgjsonb</h1> <p>Return data to a PostgreSQL server with json data stored in Pg's jsonb data type</p> <table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body"> <tbody valign="top"> <tr class="field-odd field">
<th class="field-name">maintainer:</th>
<td class="field-body">Dave Boucha &lt;<a class="reference external" href="mailto:dave%40saltstack.com">dave<span>@</span>saltstack<span>.</span>com</a>&gt;, Seth House &lt;<a class="reference external" href="mailto:shouse%40saltstack.com">shouse<span>@</span>saltstack<span>.</span>com</a>&gt;, C. R. Oldham &lt;<a class="reference external" href="mailto:cr%40saltstack.com">cr<span>@</span>saltstack<span>.</span>com</a>&gt;</td> </tr> <tr class="field-even field">
<th class="field-name">maturity:</th>
<td class="field-body">Stable</td> </tr> <tr class="field-odd field">
<th class="field-name">depends:</th>
<td class="field-body">python-psycopg2</td> </tr> <tr class="field-even field">
<th class="field-name">platform:</th>
<td class="field-body">all</td> </tr> </tbody> </table> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">There are three PostgreSQL returners. Any can function as an external <a class="reference internal" href="https://docs.saltstack.com/en/latest/topics/jobs/external_cache.html#external-job-cache"><span class="std std-ref">master job cache</span></a>. but each has different features. SaltStack recommends <a class="reference internal" href="#module-salt.returners.pgjsonb" title="salt.returners.pgjsonb"><code class="xref py py-mod docutils literal notranslate"><span class="pre">returners.pgjsonb</span></code></a> if you are working with a version of PostgreSQL that has the appropriate native binary JSON types. Otherwise, review <a class="reference internal" href="salt.returners.postgres#module-salt.returners.postgres" title="salt.returners.postgres"><code class="xref py py-mod docutils literal notranslate"><span class="pre">returners.postgres</span></code></a> and <a class="reference internal" href="salt.returners.postgres_local_cache#module-salt.returners.postgres_local_cache" title="salt.returners.postgres_local_cache"><code class="xref py py-mod docutils literal notranslate"><span class="pre">returners.postgres_local_cache</span></code></a> to see which module best suits your particular needs.</p> </div> <p>To enable this returner, the minion will need the python client for PostgreSQL installed and the following values configured in the minion or master config. These are the defaults:</p> <pre class="highlight-yaml notranslate" data-language="yaml">returner.pgjsonb.host: 'salt'
returner.pgjsonb.user: 'salt'
returner.pgjsonb.pass: 'salt'
returner.pgjsonb.db: 'salt'
returner.pgjsonb.port: 5432</pre> <p>SSL is optional. The defaults are set to None. If you do not want to use SSL, either exclude these options or set them to None.</p> <pre class="highlight-yaml notranslate" data-language="yaml">returner.pgjsonb.sslmode: None
returner.pgjsonb.sslcert: None
returner.pgjsonb.sslkey: None
returner.pgjsonb.sslrootcert: None
returner.pgjsonb.sslcrl: None</pre> <div class="versionadded"> <p><span class="versionmodified">New in version 2017.5.0.</span></p> </div> <p>Alternative configuration values can be used by prefacing the configuration with <cite>alternative.</cite>. Any values not found in the alternative configuration will be pulled from the default location. As stated above, SSL configuration is optional. The following ssl options are simply for illustration purposes:</p> <pre class="highlight-yaml notranslate" data-language="yaml">alternative.pgjsonb.host: 'salt'
alternative.pgjsonb.user: 'salt'
alternative.pgjsonb.pass: 'salt'
alternative.pgjsonb.db: 'salt'
alternative.pgjsonb.port: 5432
alternative.pgjsonb.ssl_ca: '/etc/pki/mysql/certs/localhost.pem'
alternative.pgjsonb.ssl_cert: '/etc/pki/mysql/certs/localhost.crt'
alternative.pgjsonb.ssl_key: '/etc/pki/mysql/certs/localhost.key'</pre> <p>Should you wish the returner data to be cleaned out every so often, set <code class="docutils literal notranslate"><span class="pre">keep_jobs</span></code> to the number of hours for the jobs to live in the tables. Setting it to <code class="docutils literal notranslate"><span class="pre">0</span></code> or leaving it unset will cause the data to stay in the tables.</p> <p>Should you wish to archive jobs in a different table for later processing, set <code class="docutils literal notranslate"><span class="pre">archive_jobs</span></code> to True. Salt will create 3 archive tables;</p> <ul class="simple"> <li><code class="docutils literal notranslate"><span class="pre">jids_archive</span></code></li> <li><code class="docutils literal notranslate"><span class="pre">salt_returns_archive</span></code></li> <li><code class="docutils literal notranslate"><span class="pre">salt_events_archive</span></code></li> </ul> <p>and move the contents of <code class="docutils literal notranslate"><span class="pre">jids</span></code>, <code class="docutils literal notranslate"><span class="pre">salt_returns</span></code>, and <code class="docutils literal notranslate"><span class="pre">salt_events</span></code> that are more than <code class="docutils literal notranslate"><span class="pre">keep_jobs</span></code> hours old to these tables.</p> <div class="versionadded"> <p><span class="versionmodified">New in version 2019.2.0.</span></p> </div> <p>Use the following Pg database schema:</p> <pre class="highlight-sql notranslate" data-language="sql">CREATE DATABASE  salt
  WITH ENCODING 'utf-8';

--
-- Table structure for table `jids`
--
DROP TABLE IF EXISTS jids;
CREATE TABLE jids (
   jid varchar(255) NOT NULL primary key,
   load jsonb NOT NULL
);
CREATE INDEX idx_jids_jsonb on jids
       USING gin (load)
       WITH (fastupdate=on);

--
-- Table structure for table `salt_returns`
--

DROP TABLE IF EXISTS salt_returns;
CREATE TABLE salt_returns (
  fun varchar(50) NOT NULL,
  jid varchar(255) NOT NULL,
  return jsonb NOT NULL,
  id varchar(255) NOT NULL,
  success varchar(10) NOT NULL,
  full_ret jsonb NOT NULL,
  alter_time TIMESTAMP WITH TIME ZONE DEFAULT NOW());

CREATE INDEX idx_salt_returns_id ON salt_returns (id);
CREATE INDEX idx_salt_returns_jid ON salt_returns (jid);
CREATE INDEX idx_salt_returns_fun ON salt_returns (fun);
CREATE INDEX idx_salt_returns_return ON salt_returns
    USING gin (return) with (fastupdate=on);
CREATE INDEX idx_salt_returns_full_ret ON salt_returns
    USING gin (full_ret) with (fastupdate=on);

--
-- Table structure for table `salt_events`
--

DROP TABLE IF EXISTS salt_events;
DROP SEQUENCE IF EXISTS seq_salt_events_id;
CREATE SEQUENCE seq_salt_events_id;
CREATE TABLE salt_events (
    id BIGINT NOT NULL UNIQUE DEFAULT nextval('seq_salt_events_id'),
    tag varchar(255) NOT NULL,
    data jsonb NOT NULL,
    alter_time TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    master_id varchar(255) NOT NULL);

CREATE INDEX idx_salt_events_tag on
    salt_events (tag);
CREATE INDEX idx_salt_events_data ON salt_events
    USING gin (data) with (fastupdate=on);</pre> <p>Required python modules: Psycopg2</p> <p>To use this returner, append '--return pgjsonb' to the salt command.</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' test.ping --return pgjsonb</pre> <p>To use the alternative configuration, append '--return_config alternative' to the salt command.</p> <div class="versionadded"> <p><span class="versionmodified">New in version 2015.5.0.</span></p> </div> <pre class="highlight-bash notranslate" data-language="bash">salt '*' test.ping --return pgjsonb --return_config alternative</pre> <p>To override individual configuration items, append --return_kwargs '{"key:": "value"}' to the salt command.</p> <div class="versionadded"> <p><span class="versionmodified">New in version 2016.3.0.</span></p> </div> <pre class="highlight-bash notranslate" data-language="bash">salt '*' test.ping --return pgjsonb --return_kwargs '{"db": "another-salt"}'</pre> <dl class="function"> <h3 id="salt.returners.pgjsonb.clean_old_jobs"> salt.returners.pgjsonb.clean_old_jobs()</h3> <dd>
<p>Called in the master's event loop every loop_interval. Archives and/or deletes the events and job details from the database. :return:</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.pgjsonb.event_return"> salt.returners.pgjsonb.event_return(events)</h3> <dd>
<p>Return event to Pg server</p> <p>Requires that configuration be enabled via 'event_return' option in master config.</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.pgjsonb.get_fun"> salt.returners.pgjsonb.get_fun(fun)</h3> <dd>
<p>Return a dict of the last function called for all minions</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.pgjsonb.get_jid"> salt.returners.pgjsonb.get_jid(jid)</h3> <dd>
<p>Return the information returned when the specified job id was executed</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.pgjsonb.get_jids"> salt.returners.pgjsonb.get_jids()</h3> <dd>
<p>Return a list of all job ids</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.pgjsonb.get_load"> salt.returners.pgjsonb.get_load(jid)</h3> <dd>
<p>Return the load data that marks a specified jid</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.pgjsonb.get_minions"> salt.returners.pgjsonb.get_minions()</h3> <dd>
<p>Return a list of minions</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.pgjsonb.prep_jid"> salt.returners.pgjsonb.prep_jid(nocache=False, passed_jid=None)</h3> <dd>
<p>Do any work necessary to prepare a JID, including sending a custom id</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.pgjsonb.returner"> salt.returners.pgjsonb.returner(ret)</h3> <dd>
<p>Return data to a Pg server</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.pgjsonb.save_load"> salt.returners.pgjsonb.save_load(jid, load, minions=None)</h3> <dd>
<p>Save the load to the specified jid id</p> </dd>
</dl>
<div class="_attribution">
  <p class="_attribution-p">
    Â© 2019 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltstack.com/en/latest/ref/returners/all/salt.returners.pgjsonb.html" class="_attribution-link">https://docs.saltstack.com/en/latest/ref/returners/all/salt.returners.pgjsonb.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
