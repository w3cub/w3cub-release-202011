
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>ActiveRecord&#58;&#58;Persistence&#58;&#58;ClassMethods - Ruby on Rails 6.0 - W3cubDocs</title>
  
  <meta name="description" content="Creates an object (or multiple objects) and saves it to the database, if validations pass. The resulting object is returned whether the object was &hellip;">
  <meta name="keywords" content="module, activerecord, persistence, classmethods, ruby, on, rails, rails~6.0">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/rails~6.0/activerecord/persistence/classmethods.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/rails~6.0.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/rails~6.0/" class="_nav-link" title="" style="margin-left:0;">Ruby on Rails 6.0</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _rdoc">
				
				
<h1 id="module-ActiveRecord::Persistence::ClassMethods" class="module"> module ActiveRecord::Persistence::ClassMethods </h1>  <section id="5Buntitled-5D" class="documentation-section"> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-create"> <span class="method-name">create</span><span class="method-args">(attributes = nil, &amp;block)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="create-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/persistence.rb, line 33
def create(attributes = nil, &amp;block)
  if attributes.is_a?(Array)
    attributes.collect { |attr| create(attr, &amp;block) }
  else
    object = new(attributes, &amp;block)
    object.save
    object
  end
end</pre> </div> <p>Creates an object (or multiple objects) and saves it to the database, if validations pass. The resulting object is returned whether the object was saved successfully to the database or not.</p> <p>The <code>attributes</code> parameter can be either a <a href="../../hash">Hash</a> or an <a href="../../array">Array</a> of Hashes. These Hashes describe the attributes on the objects that are to be created.</p> <h4 id="method-i-create-label-Examples">Examples</h4> <pre class="ruby" data-language="ruby"># Create a single new object
User.create(first_name: 'Jamie')

# Create an Array of new objects
User.create([{ first_name: 'Jamie' }, { first_name: 'Jeremy' }])

# Create a single object and pass it into a block to set other attributes.
User.create(first_name: 'Jamie') do |u|
  u.is_admin = false
end

# Creating an Array of new objects using a block, where the block is executed for each object:
User.create([{ first_name: 'Jamie' }, { first_name: 'Jeremy' }]) do |u|
  u.is_admin = false
end
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-create-21"> <span class="method-name">create!</span><span class="method-args">(attributes = nil, &amp;block)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="create-21-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/persistence.rb, line 50
def create!(attributes = nil, &amp;block)
  if attributes.is_a?(Array)
    attributes.collect { |attr| create!(attr, &amp;block) }
  else
    object = new(attributes, &amp;block)
    object.save!
    object
  end
end</pre> </div> <p>Creates an object (or multiple objects) and saves it to the database, if validations pass. Raises a <a href="../recordinvalid">RecordInvalid</a> error if validations fail, unlike Base#create.</p> <p>The <code>attributes</code> parameter can be either a <a href="../../hash">Hash</a> or an <a href="../../array">Array</a> of Hashes. These describe which attributes to be created on the object, or multiple objects when given an <a href="../../array">Array</a> of Hashes.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-delete"> <span class="method-name">delete</span><span class="method-args">(id_or_array)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="delete-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/persistence.rb, line 351
def delete(id_or_array)
  delete_by(primary_key =&gt; id_or_array)
end</pre> </div> <p>Deletes the row with a primary key matching the <code>id</code> argument, using an SQL <code>DELETE</code> statement, and returns the number of rows deleted. Active Record objects are not instantiated, so the object's callbacks are not executed, including any <code>:dependent</code> association options.</p> <p>You can delete multiple rows at once by passing an <a href="../../array">Array</a> of <code>id</code>s.</p> <p>Note: Although it is often much faster than the alternative, <a href="classmethods#method-i-destroy">destroy</a>, skipping callbacks might bypass business logic in your application that ensures referential integrity or performs other essential jobs.</p> <h4 id="method-i-delete-label-Examples">Examples</h4> <pre class="ruby" data-language="ruby"># Delete a single row
Todo.delete(1)

# Delete multiple rows
Todo.delete([2,3,4])
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-destroy"> <span class="method-name">destroy</span><span class="method-args">(id)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="destroy-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/persistence.rb, line 325
def destroy(id)
  if id.is_a?(Array)
    find(id).each(&amp;:destroy)
  else
    find(id).destroy
  end
end</pre> </div> <p>Destroy an object (or multiple objects) that has the given id. The object is instantiated first, therefore all callbacks and filters are fired off before the object is deleted. This method is less efficient than <a href="classmethods#method-i-delete">delete</a> but allows cleanup methods and other actions to be run.</p> <p>This essentially finds the object (or multiple objects) with the given id, creates a new object from the attributes, and then calls destroy on it.</p> <h4 id="method-i-destroy-label-Parameters">Parameters</h4> <ul><li> <p><code>id</code> - This should be the id or an array of ids to be destroyed.</p> </li></ul> <h4 id="method-i-destroy-label-Examples">Examples</h4> <pre class="ruby" data-language="ruby"># Destroy a single object
Todo.destroy(1)

# Destroy multiple objects
todos = [1,2,3]
Todo.destroy(todos)
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-insert"> <span class="method-name">insert</span><span class="method-args">(attributes, returning: nil, unique_by: nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="insert-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/persistence.rb, line 66
def insert(attributes, returning: nil, unique_by: nil)
  insert_all([ attributes ], returning: returning, unique_by: unique_by)
end</pre> </div> <p>Inserts a single record into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record's type casting and serialization.</p> <p>See <code>ActiveRecord::Persistence#insert_all</code> for documentation.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-insert-21"> <span class="method-name">insert!</span><span class="method-args">(attributes, returning: nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="insert-21-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/persistence.rb, line 133
def insert!(attributes, returning: nil)
  insert_all!([ attributes ], returning: returning)
end</pre> </div> <p>Inserts a single record into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record's type casting and serialization.</p> <p>See <code>ActiveRecord::Persistence#insert_all!</code> for more.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-insert_all"> <span class="method-name">insert_all</span><span class="method-args">(attributes, returning: nil, unique_by: nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="insert_all-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/persistence.rb, line 123
def insert_all(attributes, returning: nil, unique_by: nil)
  InsertAll.new(self, attributes, on_duplicate: :skip, returning: returning, unique_by: unique_by).execute
end</pre> </div> <p>Inserts multiple records into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record's type casting and serialization.</p> <p>The <code>attributes</code> parameter is an <a href="../../array">Array</a> of Hashes. Every <a href="../../hash">Hash</a> determines the attributes for a single row and must have the same keys.</p> <p>Rows are considered to be unique by every unique index on the table. Any duplicate rows are skipped. Override with <code>:unique_by</code> (see below).</p> <p>Returns an <code>ActiveRecord::Result</code> with its contents based on <code>:returning</code> (see below).</p> <h4 id="method-i-insert_all-label-Options">Options</h4> <dl class="rdoc-list label-list">
<dt>:returning </dt>
<dd> <p>(PostgreSQL only) An array of attributes to return for all successfully inserted records, which by default is the primary key. Pass <code>returning: %w[ id name ]</code> for both id and name or <code>returning: false</code> to omit the underlying <code>RETURNING</code> SQL clause entirely.</p> </dd>
<dt>:unique_by </dt>
<dd> <p>(PostgreSQL and SQLite only) By default rows are considered to be unique by every unique index on the table. Any duplicate rows are skipped.</p> <p>To skip rows according to just one unique index pass <code>:unique_by</code>.</p> <p>Consider a Book model where no duplicate ISBNs make sense, but if any row has an existing id, or is not unique by another unique index, <code>ActiveRecord::RecordNotUnique</code> is raised.</p> <p>Unique indexes can be identified by columns or name:</p> <pre>unique_by: :isbn
unique_by: %i[ author_id name ]
unique_by: :index_books_on_isbn</pre> </dd>
</dl> <p>Because it relies on the index information from the database <code>:unique_by</code> is recommended to be paired with Active Record's schema_cache.</p> <h4 id="method-i-insert_all-label-Example">Example</h4> <pre class="ruby" data-language="ruby"># Insert records and skip inserting any duplicates.
# Here "Eloquent Ruby" is skipped because its id is not unique.

Book.insert_all([
  { id: 1, title: "Rework", author: "David" },
  { id: 1, title: "Eloquent Ruby", author: "Russ" }
])
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-insert_all-21"> <span class="method-name">insert_all!</span><span class="method-args">(attributes, returning: nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="insert_all-21-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/persistence.rb, line 177
def insert_all!(attributes, returning: nil)
  InsertAll.new(self, attributes, on_duplicate: :raise, returning: returning).execute
end</pre> </div> <p>Inserts multiple records into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record's type casting and serialization.</p> <p>The <code>attributes</code> parameter is an <a href="../../array">Array</a> of Hashes. Every <a href="../../hash">Hash</a> determines the attributes for a single row and must have the same keys.</p> <p>Raises <code>ActiveRecord::RecordNotUnique</code> if any rows violate a unique index on the table. In that case, no rows are inserted.</p> <p>To skip duplicate rows, see <code>ActiveRecord::Persistence#insert_all</code>. To replace them, see <code>ActiveRecord::Persistence#upsert_all</code>.</p> <p>Returns an <code>ActiveRecord::Result</code> with its contents based on <code>:returning</code> (see below).</p> <h4 id="method-i-insert_all-21-label-Options">Options</h4> <dl class="rdoc-list label-list">
<dt>:returning </dt>
<dd> <p>(PostgreSQL only) An array of attributes to return for all successfully inserted records, which by default is the primary key. Pass <code>returning: %w[ id name ]</code> for both id and name or <code>returning: false</code> to omit the underlying <code>RETURNING</code> SQL clause entirely.</p> </dd>
</dl> <h4 id="method-i-insert_all-21-label-Examples">Examples</h4> <pre class="ruby" data-language="ruby"># Insert multiple records
Book.insert_all!([
  { title: "Rework", author: "David" },
  { title: "Eloquent Ruby", author: "Russ" }
])

# Raises ActiveRecord::RecordNotUnique because "Eloquent Ruby"
# does not have a unique id.
Book.insert_all!([
  { id: 1, title: "Rework", author: "David" },
  { id: 1, title: "Eloquent Ruby", author: "Russ" }
])
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-instantiate"> <span class="method-name">instantiate</span><span class="method-args">(attributes, column_types = {}, &amp;block)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="instantiate-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/persistence.rb, line 256
def instantiate(attributes, column_types = {}, &amp;block)
  klass = discriminate_class_for_record(attributes)
  instantiate_instance_of(klass, attributes, column_types, &amp;block)
end</pre> </div> <p>Given an attributes hash, <code>instantiate</code> returns a new instance of the appropriate class. Accepts only keys as strings.</p> <p>For example, <code>Post.all</code> may return Comments, Messages, and Emails by storing the record's subclass in a <code>type</code> attribute. By calling <code>instantiate</code> instead of <code>new</code>, finder methods ensure they get new instances of the appropriate class for each record.</p> <p>See <code>ActiveRecord::Inheritance#discriminate_class_for_record</code> to see how this “single-table” inheritance mapping is implemented.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-update"> <span class="method-name">update</span><span class="method-args">(id = :all, attributes)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="update-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/persistence.rb, line 287
def update(id = :all, attributes)
  if id.is_a?(Array)
    id.map { |one_id| find(one_id) }.each_with_index { |object, idx|
      object.update(attributes[idx])
    }
  elsif id == :all
    all.each { |record| record.update(attributes) }
  else
    if ActiveRecord::Base === id
      raise ArgumentError,
        "You are passing an instance of ActiveRecord::Base to `update`. " \
        "Please pass the id of the object by calling `.id`."
    end
    object = find(id)
    object.update(attributes)
    object
  end
end</pre> </div> <p>Updates an object (or multiple objects) and saves it to the database, if validations pass. The resulting object is returned whether the object was saved successfully to the database or not.</p> <h4 id="method-i-update-label-Parameters">Parameters</h4> <ul>
<li> <p><code>id</code> - This should be the id or an array of ids to be updated.</p> </li>
<li> <p><code>attributes</code> - This should be a hash of attributes or an array of hashes.</p> </li>
</ul> <h4 id="method-i-update-label-Examples">Examples</h4> <pre class="ruby" data-language="ruby"># Updates one record
Person.update(15, user_name: "Samuel", group: "expert")

# Updates multiple records
people = { 1 =&gt; { "first_name" =&gt; "David" }, 2 =&gt; { "first_name" =&gt; "Jeremy" } }
Person.update(people.keys, people.values)

# Updates multiple records from the result of a relation
people = Person.where(group: "expert")
people.update(group: "masters")
</pre> <p>Note: Updating a large number of records will run an UPDATE query for each record, which may cause a performance issue. When running callbacks is not needed for each record update, it is preferred to use <a href="../relation#method-i-update_all">update_all</a> for updating all records in a single query.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-upsert"> <span class="method-name">upsert</span><span class="method-args">(attributes, returning: nil, unique_by: nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="upsert-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/persistence.rb, line 187
def upsert(attributes, returning: nil, unique_by: nil)
  upsert_all([ attributes ], returning: returning, unique_by: unique_by)
end</pre> </div> <p>Updates or inserts (upserts) a single record into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record's type casting and serialization.</p> <p>See <code>ActiveRecord::Persistence#upsert_all</code> for documentation.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-upsert_all"> <span class="method-name">upsert_all</span><span class="method-args">(attributes, returning: nil, unique_by: nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="upsert_all-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/persistence.rb, line 242
def upsert_all(attributes, returning: nil, unique_by: nil)
  InsertAll.new(self, attributes, on_duplicate: :update, returning: returning, unique_by: unique_by).execute
end</pre> </div> <p>Updates or inserts (upserts) multiple records into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record's type casting and serialization.</p> <p>The <code>attributes</code> parameter is an <a href="../../array">Array</a> of Hashes. Every <a href="../../hash">Hash</a> determines the attributes for a single row and must have the same keys.</p> <p>Returns an <code>ActiveRecord::Result</code> with its contents based on <code>:returning</code> (see below).</p> <h4 id="method-i-upsert_all-label-Options">Options</h4> <dl class="rdoc-list label-list">
<dt>:returning </dt>
<dd> <p>(PostgreSQL only) An array of attributes to return for all successfully inserted records, which by default is the primary key. Pass <code>returning: %w[ id name ]</code> for both id and name or <code>returning: false</code> to omit the underlying <code>RETURNING</code> SQL clause entirely.</p> </dd>
<dt>:unique_by </dt>
<dd> <p>(PostgreSQL and SQLite only) By default rows are considered to be unique by every unique index on the table. Any duplicate rows are skipped.</p> <p>To skip rows according to just one unique index pass <code>:unique_by</code>.</p> <p>Consider a Book model where no duplicate ISBNs make sense, but if any row has an existing id, or is not unique by another unique index, <code>ActiveRecord::RecordNotUnique</code> is raised.</p> <p>Unique indexes can be identified by columns or name:</p> <pre>unique_by: :isbn
unique_by: %i[ author_id name ]
unique_by: :index_books_on_isbn</pre> </dd>
</dl> <p>Because it relies on the index information from the database <code>:unique_by</code> is recommended to be paired with Active Record's schema_cache.</p> <h4 id="method-i-upsert_all-label-Examples">Examples</h4> <pre class="ruby" data-language="ruby"># Inserts multiple records, performing an upsert when records have duplicate ISBNs.
# Here "Eloquent Ruby" overwrites "Rework" because its ISBN is duplicate.

Book.upsert_all([
  { title: "Rework", author: "David", isbn: "1" },
  { title: "Eloquent Ruby", author: "Russ", isbn: "1" }
], unique_by: :isbn)

Book.find_by(isbn: "1").title # =&gt; "Eloquent Ruby"
</pre>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    © 2004–2019 David Heinemeier Hansson<br>Licensed under the MIT License.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
