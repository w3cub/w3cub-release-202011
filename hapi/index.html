
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Hapi Documentation - W3cubDocs</title>
  
  <meta name="description" content=" Hapi documentation ">
  <meta name="keywords" content="hapi, documentation">
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/hapi/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-c8f743fc70bb84079c3cf4b71f5f99835529659c30689b2fd6193651a680f383ef1d96896f8966c7ca8a0160ffd557685bb8ad12820ec6002d60143812238086.css">
  <script type="text/javascript" src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js"></script>
  <script src="/json/hapi.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/hapi/" class="_nav-link" title="" style="margin-left:0;">Hapi</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _hapi">
				
				
<h2>
Server</h2> <p>The server object is the main application container. The server manages all incoming requests along with all the facilities provided by the framework. Each server supports a single connection (e.g. listen to port <code data-language="javascript">80</code>).</p> <h3 id="-serveroptions">
  <code data-language="javascript">server([options])</code> </h3> <p>Creates a new server object where:</p> <ul> <li> <code data-language="javascript">options</code> - (optional) a <a href="#server.options">server configuration object</a>.</li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">load</span>: <span class="pl-kos">{</span> <span class="pl-c1">sampleInterval</span>: <span class="pl-c1">1000</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-server-options">
  Server options</h3> <p>The server options control the behavior of the server object. Note that the options object is deeply cloned (with the exception of <a href="#server.options.listener"><code data-language="javascript">listener</code></a> which is shallowly copied) and should not contain any values that are unsafe to perform deep copy on.</p> <p>All options are optionals.</p> <h4 id="-serveroptionsaddress">
  <code data-language="javascript">server.options.address</code> </h4> <p>Default value: <code data-language="javascript">'::'</code> if IPv6 is available, otherwise <code data-language="javascript">'0.0.0.0'</code> (i.e. all available network interfaces).</p> <p>Sets the hostname or IP address the server will listen on. If not configured, defaults to <a href="#server.options.host"><code data-language="javascript">host</code></a> if present, otherwise to all available network interfaces. Set to <code data-language="javascript">'127.0.0.1'</code>, <code data-language="javascript">'::1'</code>, or <code data-language="javascript">'localhost'</code> to restrict the server to only those coming from the same host.</p> <h4 id="-serveroptionsapp">
  <code data-language="javascript">server.options.app</code> </h4> <p>Default value: <code data-language="javascript">{}</code>.</p> <p>Provides application-specific configuration which can later be accessed via <a href="#server.settings"><code data-language="javascript">server.settings.app</code></a>. The framework does not interact with this object. It is simply a reference made available anywhere a <code data-language="javascript">server</code> reference is provided.</p> <p>Note the difference between <code data-language="javascript">server.settings.app</code> which is used to store static configuration values and <a href="#server.app"><code data-language="javascript">server.app</code></a> which is meant for storing run-time state.</p> <h4 id="-serveroptionsautolisten">
  <code data-language="javascript">server.options.autoListen</code> </h4> <p>Default value: <code data-language="javascript">true</code>.</p> <p>Used to disable the automatic initialization of the <a href="#server.options.listener"><code data-language="javascript">listener</code></a>. When <code data-language="javascript">false</code>, indicates that the <a href="#server.options.listener"><code data-language="javascript">listener</code></a> will be started manually outside the framework.</p> <p>Cannot be set to <code data-language="javascript">false</code> along with a <a href="#server.options.port"><code data-language="javascript">port</code></a> value.</p> <h4 id="-serveroptionscache">
  <code data-language="javascript">server.options.cache</code> </h4> <p>Default value: <code data-language="javascript">{ provider: { constructor: require('@hapi/catbox-memory'), options: { partition: 'hapi-cache' } } }</code>.</p> <p>Sets up server-side caching providers. Every server includes a default cache for storing application state. By default, a simple memory-based cache is created which has limited capacity and capabilities.</p> <p><strong>hapi</strong> uses <a href="https://hapi.dev/family/catbox/api" rel="nofollow"><strong>catbox</strong></a> for its cache implementation which includes support for common storage solutions (e.g. Redis, MongoDB, Memcached, Riak, among others). Caching is only utilized if <a href="#server.methods">methods</a> and <a href="#plugins">plugins</a> explicitly store their state in the cache.</p> <p>The server cache configuration only defines the storage container itself. The configuration can be assigned one or more (array):</p> <ul> <li> <p>a class or prototype function (usually obtained by calling <code data-language="javascript">require()</code> on a <strong>catbox</strong> strategy such as <code data-language="javascript">require('@hapi/catbox-redis')</code>). A new <strong>catbox</strong> <a href="https://hapi.dev/family/catbox/api#client" rel="nofollow">client</a> will be created internally using this constructor.</p> </li> <li> <p>a configuration object with the following:</p> <ul> <li> <p><code data-language="javascript">engine</code> - a <strong>catbox</strong> engine object instance.</p> </li> <li> <p><code data-language="javascript">name</code> - an identifier used later when provisioning or configuring caching for <a href="#server.methods">server methods</a> or <a href="#plugins">plugins</a>. Each cache name must be unique. A single item may omit the <code data-language="javascript">name</code> option which defines the default cache. If every cache includes a <code data-language="javascript">name</code>, a default memory cache is provisioned as well.</p> </li> <li> <p><code data-language="javascript">provider</code> - a class, a constructor function, or an object with the following:</p> <ul> <li> <p><code data-language="javascript">constructor</code> - a class or a prototype function.</p> </li> <li> <p><code data-language="javascript">options</code> - (optional) a settings object passed as-is to the <code data-language="javascript">constructor</code> with the following:</p> <ul> <li> <code data-language="javascript">partition</code> - (optional) string used to isolate cached data. Defaults to <code data-language="javascript">'hapi-cache'</code>.</li> <li>other constructor-specific options passed to the <code data-language="javascript">constructor</code> on instantiation.</li> </ul> </li> </ul> </li> <li> <p><code data-language="javascript">shared</code> - if <code data-language="javascript">true</code>, allows multiple cache users to share the same segment (e.g. multiple methods using the same cache storage container). Default to <code data-language="javascript">false</code>.</p> </li> <li> <p>One (and only one) of <code data-language="javascript">engine</code> or <code data-language="javascript">provider</code> is required per configuration object.</p> </li> </ul> </li> </ul> <h4 id="-serveroptionscompression">
  <code data-language="javascript">server.options.compression</code> </h4> <p>Default value: <code data-language="javascript">{ minBytes: 1024 }</code>.</p> <p>Defines server handling of content encoding requests. If <code data-language="javascript">false</code>, response content encoding is disabled and no compression is performed by the server.</p> <h5>
  <code data-language="javascript">server.options.compression.minBytes</code> </h5> <p>Default value: '1024'.</p> <p>Sets the minimum response payload size in bytes that is required for content encoding compression. If the payload size is under the limit, no compression is performed.</p> <h4 id="-serveroptionsdebug">
  <code data-language="javascript">server.options.debug</code> </h4> <p>Default value: <code data-language="javascript">{ request: ['implementation'] }</code>.</p> <p>Determines which logged events are sent to the console. This should only be used for development and does not affect which events are actually logged internally and recorded. Set to <code data-language="javascript">false</code> to disable all console logging, or to an object with:</p> <ul> <li> <p><code data-language="javascript">log</code> - a string array of server log tags to be displayed via <code data-language="javascript">console.error()</code> when the events are logged via <a href="#server.log()"><code data-language="javascript">server.log()</code></a> as well as internally generated <a href="#server-logs">server logs</a>. Defaults to no output.</p> </li> <li> <p><code data-language="javascript">request</code> - a string array of request log tags to be displayed via <code data-language="javascript">console.error()</code> when the events are logged via <a href="#request.log()"><code data-language="javascript">request.log()</code></a> as well as internally generated <a href="#request-logs">request logs</a>. For example, to display all errors, set the option to <code data-language="javascript">['error']</code>. To turn off all console debug messages set it to <code data-language="javascript">false</code>. To display all request logs, set it to <code data-language="javascript">'*'</code>. Defaults to uncaught errors thrown in external code (these errors are handled automatically and result in an Internal Server Error response) or runtime errors due to developer error.</p> </li> </ul> <p>For example, to display all errors, set the <code data-language="javascript">log</code> or <code data-language="javascript">request</code> to <code data-language="javascript">['error']</code>. To turn off all output set the <code data-language="javascript">log</code> or <code data-language="javascript">request</code> to <code data-language="javascript">false</code>. To display all server logs, set the <code data-language="javascript">log</code> or <code data-language="javascript">request</code> to <code data-language="javascript">'*'</code>. To disable all debug information, set <code data-language="javascript">debug</code> to <code data-language="javascript">false</code>.</p> <h4 id="-serveroptionshost">
  <code data-language="javascript">server.options.host</code> </h4> <p>Default value: the operating system hostname and if not available, to <code data-language="javascript">'localhost'</code>.</p> <p>The public hostname or IP address. Used to set <a href="#server.info"><code data-language="javascript">server.info.host</code></a> and <a href="#server.info"><code data-language="javascript">server.info.uri</code></a> and as <a href="#server.options.address"><code data-language="javascript">address</code></a> if none is provided.</p> <h4 id="-serveroptionsinforemote">
  <code data-language="javascript">server.options.info.remote</code> </h4> <p>Default value: <code data-language="javascript">false</code>.</p> <p>If <code data-language="javascript">true</code>, the <code data-language="javascript">request.info.remoteAddress</code> and <code data-language="javascript">request.info.remotePort</code> are populated when the request is received which can consume more resource (but is ok if the information is needed, especially for aborted requests). When <code data-language="javascript">false</code>, the fields are only populated upon demand (but will be <code data-language="javascript">undefined</code> if accessed after the request is aborted).</p> <h4 id="-serveroptionslistener">
  <code data-language="javascript">server.options.listener</code> </h4> <p>Default value: none.</p> <p>An optional node HTTP (or HTTPS) <a href="https://nodejs.org/api/http.html#http_class_http_server" rel="nofollow"><code data-language="javascript">http.Server</code></a> object (or an object with a compatible interface).</p> <p>If the <code data-language="javascript">listener</code> needs to be manually started, set <a href="#server.options.autolisten"><code data-language="javascript">autoListen</code></a> to <code data-language="javascript">false</code>.</p> <p>If the <code data-language="javascript">listener</code> uses TLS, set <a href="#server.options.tls"><code data-language="javascript">tls</code></a> to <code data-language="javascript">true</code>.</p> <h4 id="-serveroptionsload">
  <code data-language="javascript">server.options.load</code> </h4> <p>Default value: <code data-language="javascript">{ sampleInterval: 0, maxHeapUsedBytes: 0, maxRssBytes: 0, maxEventLoopDelay: 0, maxEventLoopUtilization: 0 }</code>.</p> <p>Server excessive load handling limits where:</p> <ul> <li> <p><code data-language="javascript">sampleInterval</code> - the frequency of sampling in milliseconds. When set to <code data-language="javascript">0</code>, the other load options are ignored. Defaults to <code data-language="javascript">0</code> (no sampling).</p> </li> <li> <p><code data-language="javascript">maxHeapUsedBytes</code> - maximum V8 heap size over which incoming requests are rejected with an HTTP Server Timeout (503) response. Defaults to <code data-language="javascript">0</code> (no limit).</p> </li> <li> <p><code data-language="javascript">maxRssBytes</code> - maximum process RSS size over which incoming requests are rejected with an HTTP Server Timeout (503) response. Defaults to <code data-language="javascript">0</code> (no limit).</p> </li> <li> <p><code data-language="javascript">maxEventLoopDelay</code> - maximum event loop delay duration in milliseconds over which incoming requests are rejected with an HTTP Server Timeout (503) response. Defaults to <code data-language="javascript">0</code> (no limit).</p> </li> <li> <p><code data-language="javascript">maxEventLoopUtilization</code> - maximum event loop utilization value over which incoming requests are rejected with an HTTP Server Timeout (503) response. Defaults to <code data-language="javascript">0</code> (no limit).</p> </li> </ul> <h4 id="-serveroptionsmime">
  <code data-language="javascript">server.options.mime</code> </h4> <p>Default value: none.</p> <p>Options passed to the <a href="https://hapi.dev/family/mimos/api" rel="nofollow"><strong>mimos</strong></a> module when generating the mime database used by the server (and accessed via <a href="#server.mime"><code data-language="javascript">server.mime</code></a>):</p> <ul> <li> <p><code data-language="javascript">override</code> - an object hash that is merged into the built in mime information specified <a href="https://github.com/jshttp/mime-db">here</a>. Each key value pair represents a single mime object. Each override value must contain:</p> <ul> <li> <p><code data-language="javascript">key</code> - the lower-cased mime-type string (e.g. <code data-language="javascript">'application/javascript'</code>).</p> </li> <li> <p><code data-language="javascript">value</code> - an object following the specifications outlined <a href="https://github.com/jshttp/mime-db#data-structure">here</a>. Additional values include:</p> <ul> <li> <p><code data-language="javascript">type</code> - specify the <code data-language="javascript">type</code> value of result objects, defaults to <code data-language="javascript">key</code>.</p> </li> <li> <p><code data-language="javascript">predicate</code> - method with signature <code data-language="javascript">function(mime)</code> when this mime type is found in the database, this function will execute to allows customizations.</p> </li> </ul> </li> </ul> </li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-s1">options</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
    <span class="pl-c1">mime</span>: <span class="pl-kos">{</span>
        <span class="pl-c1">override</span>: <span class="pl-kos">{</span>
            <span class="pl-s">'node/module'</span>: <span class="pl-kos">{</span>
                <span class="pl-c1">source</span>: <span class="pl-s">'iana'</span><span class="pl-kos">,</span>
                <span class="pl-c1">compressible</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
                <span class="pl-c1">extensions</span>: <span class="pl-kos">[</span><span class="pl-s">'node'</span><span class="pl-kos">,</span> <span class="pl-s">'module'</span><span class="pl-kos">,</span> <span class="pl-s">'npm'</span><span class="pl-kos">]</span><span class="pl-kos">,</span>
                <span class="pl-c1">type</span>: <span class="pl-s">'node/module'</span>
            <span class="pl-kos">}</span><span class="pl-kos">,</span>
            <span class="pl-s">'application/javascript'</span>: <span class="pl-kos">{</span>
                <span class="pl-c1">source</span>: <span class="pl-s">'iana'</span><span class="pl-kos">,</span>
                <span class="pl-c1">charset</span>: <span class="pl-s">'UTF-8'</span><span class="pl-kos">,</span>
                <span class="pl-c1">compressible</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
                <span class="pl-c1">extensions</span>: <span class="pl-kos">[</span><span class="pl-s">'js'</span><span class="pl-kos">,</span> <span class="pl-s">'javascript'</span><span class="pl-kos">]</span><span class="pl-kos">,</span>
                <span class="pl-c1">type</span>: <span class="pl-s">'text/javascript'</span>
            <span class="pl-kos">}</span><span class="pl-kos">,</span>
            <span class="pl-s">'text/html'</span>: <span class="pl-kos">{</span>
                <span class="pl-en">predicate</span>: <span class="pl-k">function</span><span class="pl-kos">(</span><span class="pl-s1">mime</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
                    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">someCondition</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
                        <span class="pl-s1">mime</span><span class="pl-kos">.</span><span class="pl-c1">foo</span> <span class="pl-c1">=</span> <span class="pl-s">'test'</span><span class="pl-kos">;</span>
                    <span class="pl-kos">}</span>
                    <span class="pl-k">else</span> <span class="pl-kos">{</span>
                        <span class="pl-s1">mime</span><span class="pl-kos">.</span><span class="pl-c1">foo</span> <span class="pl-c1">=</span> <span class="pl-s">'bar'</span><span class="pl-kos">;</span>
                    <span class="pl-kos">}</span>
                    <span class="pl-k">return</span> <span class="pl-s1">mime</span><span class="pl-kos">;</span>
                <span class="pl-kos">}</span>
            <span class="pl-kos">}</span>
        <span class="pl-kos">}</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <h4 id="-serveroptionsoperations">
  <code data-language="javascript">server.options.operations</code> </h4> <p>Default value: <code data-language="javascript">{ cleanStop: true }</code>.</p> <p>Defines server handling of server operations:</p> <ul> <li> <code data-language="javascript">cleanStop</code> - if <code data-language="javascript">true</code>, the server keeps track of open connections and properly closes them when the server is stopped. Under normal load, this should not interfere with server performance. However, under severe load connection monitoring can consume additional resources and aggravate the situation. If the server is never stopped, or if it is forced to stop without waiting for open connection to close, setting this to <code data-language="javascript">false</code> can save resources that are not being utilized anyway. Defaults to <code data-language="javascript">true</code>.</li> </ul> <h4 id="-serveroptionsplugins">
  <code data-language="javascript">server.options.plugins</code> </h4> <p>Default value: <code data-language="javascript">{}</code>.</p> <p>Plugin-specific configuration which can later be accessed via <a href="#server.settings"><code data-language="javascript">server.settings.plugins</code></a>. <code data-language="javascript">plugins</code> is an object where each key is a plugin name and the value is the configuration. Note the difference between <a href="#server.settings"><code data-language="javascript">server.settings.plugins</code></a> which is used to store static configuration values and <a href="#server.plugins"><code data-language="javascript">server.plugins</code></a> which is meant for storing run-time state.</p> <h4 id="-serveroptionsport">
  <code data-language="javascript">server.options.port</code> </h4> <p>Default value: <code data-language="javascript">0</code> (an ephemeral port).</p> <p>The TCP port the server will listen to. Defaults the next available port when the server is started (and assigned to <a href="#server.info"><code data-language="javascript">server.info.port</code></a>).</p> <p>If <code data-language="javascript">port</code> is a string containing a '/' character, it is used as a UNIX domain socket path. If it starts with '\.\pipe', it is used as a Windows named pipe.</p> <h4 id="-serveroptionsquery">
  <code data-language="javascript">server.options.query</code> </h4> <p>Default value: <code data-language="javascript">{}</code>.</p> <p>Defines server handling of the request path query component.</p> <h5>
  <code data-language="javascript">server.options.query.parser</code> </h5> <p>Default value: none.</p> <p>Sets a query parameters parser method using the signature <code data-language="javascript">function(query)</code> where:</p> <ul> <li> <code data-language="javascript">query</code> - an object containing the incoming <a href="#request.query"><code data-language="javascript">request.query</code></a> parameters.</li> <li>the method must return an object where each key is a parameter and matching value is the parameter value. If the method throws, the error is used as the response or returned when <a href="#request.setUrl()"><code data-language="javascript">request.setUrl()</code></a> is called.</li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Qs</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'qs'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">options</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
    <span class="pl-c1">query</span>: <span class="pl-kos">{</span>
        <span class="pl-en">parser</span>: <span class="pl-kos">(</span><span class="pl-s1">query</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-v">Qs</span><span class="pl-kos">.</span><span class="pl-en">parse</span><span class="pl-kos">(</span><span class="pl-s1">query</span><span class="pl-kos">)</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <h4 id="-serveroptionsrouter">
  <code data-language="javascript">server.options.router</code> </h4> <p>Default value: <code data-language="javascript">{ isCaseSensitive: true, stripTrailingSlash: false }</code>.</p> <p>Controls how incoming request URIs are matched against the routing table:</p> <ul> <li> <p><code data-language="javascript">isCaseSensitive</code> - determines whether the paths '/example' and '/EXAMPLE' are considered different resources. Defaults to <code data-language="javascript">true</code>.</p> </li> <li> <p><code data-language="javascript">stripTrailingSlash</code> - removes trailing slashes on incoming paths. Defaults to <code data-language="javascript">false</code>.</p> </li> </ul> <h4 id="-serveroptionsroutes">
  <code data-language="javascript">server.options.routes</code> </h4> <p>Default value: none.</p> <p>A <a href="#route-options">route options</a> object used as the default configuration for every route.</p> <h4 id="-serveroptionsstate">
  <code data-language="javascript">server.options.state</code> </h4> <p>Default value:</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-kos">{</span>
    <span class="pl-c1">strictHeader</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
    <span class="pl-c1">ignoreErrors</span>: <span class="pl-c1">false</span><span class="pl-kos">,</span>
    <span class="pl-c1">isSecure</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
    <span class="pl-c1">isHttpOnly</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
    <span class="pl-c1">isSameSite</span>: <span class="pl-s">'Strict'</span><span class="pl-kos">,</span>
    <span class="pl-c1">encoding</span>: <span class="pl-s">'none'</span>
<span class="pl-kos">}</span></pre></div> <p>Sets the default configuration for every state (cookie) set explicitly via <a href="#server.state()"><code data-language="javascript">server.state()</code></a> or implicitly (without definition) using the <a href="#server.state()">state configuration</a> object.</p> <h4 id="-serveroptionstls">
  <code data-language="javascript">server.options.tls</code> </h4> <p>Default value: none.</p> <p>Used to create an HTTPS connection. The <code data-language="javascript">tls</code> object is passed unchanged to the node HTTPS server as described in the <a href="https://nodejs.org/api/https.html#https_https_createserver_options_requestlistener" rel="nofollow">node HTTPS documentation</a>.</p> <p>Set to <code data-language="javascript">true</code> when passing a <a href="#server.options.listener"><code data-language="javascript">listener</code></a> object that has been configured to use TLS directly.</p> <h4 id="-serveroptionsuri">
  <code data-language="javascript">server.options.uri</code> </h4> <p>Default value: constructed from runtime server information.</p> <p>The full public URI without the path (e.g. '<a href="http://example.com:8080" rel="nofollow">http://example.com:8080</a>'). If present, used as the server <a href="#server.info"><code data-language="javascript">server.info.uri</code></a>, otherwise constructed from the server settings.</p> <h3 id="server-properties">
Server properties</h3> <h4 id="-serverapp">
  <code data-language="javascript">server.app</code> </h4> <p>Access: read / write.</p> <p>Provides a safe place to store server-specific run-time application data without potential conflicts with the framework internals. The data can be accessed whenever the server is accessible. Initialized with an empty object.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">app</span><span class="pl-kos">.</span><span class="pl-c1">key</span> <span class="pl-c1">=</span> <span class="pl-s">'value'</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">handler</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">server</span><span class="pl-kos">.</span><span class="pl-c1">app</span><span class="pl-kos">.</span><span class="pl-c1">key</span><span class="pl-kos">;</span>        <span class="pl-c">// 'value'</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <h4 id="-serverauthapi">
  <code data-language="javascript">server.auth.api</code> </h4> <p>Access: authentication strategy specific.</p> <p>An object where each key is an authentication strategy name and the value is the exposed strategy API. Available only when the authentication scheme exposes an API by returning an <code data-language="javascript">api</code> key in the object returned from its implementation function.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">scheme</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-kos">{</span>
        <span class="pl-c1">api</span>: <span class="pl-kos">{</span>
            <span class="pl-c1">settings</span>: <span class="pl-kos">{</span>
                <span class="pl-c1">x</span>: <span class="pl-c1">5</span>
            <span class="pl-kos">}</span>
        <span class="pl-kos">}</span><span class="pl-kos">,</span>
        <span class="pl-en">authenticate</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

            <span class="pl-k">const</span> <span class="pl-s1">authorization</span> <span class="pl-c1">=</span> <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">headers</span><span class="pl-kos">.</span><span class="pl-c1">authorization</span><span class="pl-kos">;</span>
            <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-s1">authorization</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
                <span class="pl-k">throw</span> <span class="pl-v">Boom</span><span class="pl-kos">.</span><span class="pl-en">unauthorized</span><span class="pl-kos">(</span><span class="pl-c1">null</span><span class="pl-kos">,</span> <span class="pl-s">'Custom'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
            <span class="pl-kos">}</span>

            <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-en">authenticated</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">credentials</span>: <span class="pl-kos">{</span> <span class="pl-c1">user</span>: <span class="pl-s">'john'</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>
    <span class="pl-kos">}</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-en">scheme</span><span class="pl-kos">(</span><span class="pl-s">'custom'</span><span class="pl-kos">,</span> <span class="pl-en">scheme</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-en">strategy</span><span class="pl-kos">(</span><span class="pl-s">'default'</span><span class="pl-kos">,</span> <span class="pl-s">'custom'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-c1">api</span><span class="pl-kos">.</span><span class="pl-c1">default</span><span class="pl-kos">.</span><span class="pl-c1">settings</span><span class="pl-kos">.</span><span class="pl-c1">x</span><span class="pl-kos">)</span><span class="pl-kos">;</span>    <span class="pl-c">// 5</span></pre></div> <h4 id="-serverauthsettingsdefault">
  <code data-language="javascript">server.auth.settings.default</code> </h4> <p>Access: read only.</p> <p>Contains the default authentication configuration if a default strategy was set via <a href="#server.auth.default()"><code data-language="javascript">server.auth.default()</code></a>.</p> <h4 id="-serverdecorations">
  <code data-language="javascript">server.decorations</code> </h4> <p>Access: read only.</p> <p>Provides access to the decorations already applied to various framework interfaces. The object must not be modified directly, but only through <a href="#server.decorate()"><code data-language="javascript">server.decorate</code></a>. Contains:</p> <ul> <li> <code data-language="javascript">request</code> - decorations on the <a href="#request">request object</a>.</li> <li> <code data-language="javascript">response</code> - decorations on the <a href="#response-object">response object</a>.</li> <li> <code data-language="javascript">toolkit</code> - decorations on the <a href="#response-toolkit">response toolkit</a>.</li> <li> <code data-language="javascript">server</code> - decorations on the <a href="#server">server</a> object.</li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">success</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-en">response</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">status</span>: <span class="pl-s">'ok'</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">decorate</span><span class="pl-kos">(</span><span class="pl-s">'toolkit'</span><span class="pl-kos">,</span> <span class="pl-s">'success'</span><span class="pl-kos">,</span> <span class="pl-en">success</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">decorations</span><span class="pl-kos">.</span><span class="pl-c1">toolkit</span><span class="pl-kos">)</span><span class="pl-kos">;</span>            <span class="pl-c">// ['success']</span></pre></div> <h4 id="-serverevents">
  <code data-language="javascript">server.events</code> </h4> <p>Access: <strong>podium</strong> public interface.</p> <p>The server events emitter. Utilizes the <a href="https://hapi.dev/family/podium/api" rel="nofollow"><strong>podium</strong></a> with support for event criteria validation, channels, and filters.</p> <p>Use the following methods to interact with <code data-language="javascript">server.events</code>:</p> <ul> <li> <a href="#server.event()"><code data-language="javascript">server.event(events)</code></a> - register application events.</li> <li> <a href="#server.events.emit()"><code data-language="javascript">server.events.emit(criteria, data)</code></a> - emit server events.</li> <li> <a href="#server.events.on()"><code data-language="javascript">server.events.on(criteria, listener, context)</code></a> - subscribe to all events.</li> <li> <a href="#server.events.once()"><code data-language="javascript">server.events.once(criteria, listener, context)</code></a> - subscribe to a single event.</li> </ul> <p>Other methods include: <code data-language="javascript">server.events.removeListener(name, listener)</code>, <code data-language="javascript">server.events.removeAllListeners(name)</code>, and <code data-language="javascript">server.events.hasListeners(name)</code>.</p> <h5>
  <code data-language="javascript">'log'</code> Event</h5> <p>The <code data-language="javascript">'log'</code> event type emits internal server events generated by the framework as well as application events logged with <a href="#server.log()"><code data-language="javascript">server.log()</code></a>.</p> <p>The <code data-language="javascript">'log'</code> event handler uses the function signature <code data-language="javascript">function(event, tags)</code> where:</p> <ul> <li> <p><code data-language="javascript">event</code> - an object with the following properties:</p> <ul> <li> <code data-language="javascript">timestamp</code> - the event timestamp.</li> <li> <code data-language="javascript">tags</code> - an array of tags identifying the event (e.g. <code data-language="javascript">['error', 'http']</code>).</li> <li> <code data-language="javascript">channel</code> - set to <code data-language="javascript">'internal'</code> for internally generated events, otherwise <code data-language="javascript">'app'</code> for events generated by <a href="#server.log()"><code data-language="javascript">server.log()</code></a>.</li> <li> <code data-language="javascript">data</code> - event-specific information. Available when event data was provided and is not an error. Errors are passed via <code data-language="javascript">error</code>.</li> <li> <code data-language="javascript">error</code> - the error object related to the event if applicable. Cannot appear together with <code data-language="javascript">data</code>.</li> </ul> </li> <li> <p><code data-language="javascript">tags</code> - an object where each <code data-language="javascript">event.tag</code> is a key and the value is <code data-language="javascript">true</code>. Useful for quick identification of events.</p> </li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s">'log'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">event</span><span class="pl-kos">,</span> <span class="pl-s1">tags</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">tags</span><span class="pl-kos">.</span><span class="pl-c1">error</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">`Server error: <span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">event</span><span class="pl-kos">.</span><span class="pl-c1">error</span> ? <span class="pl-s1">event</span><span class="pl-kos">.</span><span class="pl-c1">error</span><span class="pl-kos">.</span><span class="pl-c1">message</span> : <span class="pl-s">'unknown'</span><span class="pl-kos">}</span></span>`</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <p>The internally generated events are (identified by their <code data-language="javascript">tags</code>):</p> <ul> <li> <p><code data-language="javascript">load</code> - logs the current server load measurements when the server rejects a request due to <a href="#server.options.load">high load</a>. The event data contains the process load metrics.</p> </li> <li> <p><code data-language="javascript">connection</code> <code data-language="javascript">client</code> <code data-language="javascript">error</code> - a <code data-language="javascript">clientError</code> event was received from the HTTP or HTTPS listener. The event data is the error object received.</p> </li> </ul> <h5>
  <code data-language="javascript">'cachePolicy'</code> Event</h5> <p>The <code data-language="javascript">'cachePolicy'</code> event type is emitted when a server <a href="https://hapi.dev/module/catbox/api#policy" rel="nofollow">cache policy</a> is created via <a href="#server.cache()"><code data-language="javascript">server.cache()</code></a> or a <a href="#server.method()"><code data-language="javascript">server.method()</code></a> with caching enabled is registered. The <code data-language="javascript">'cachePolicy'</code> event handler uses the function signature <code data-language="javascript">function(cachePolicy, cache, segment)</code> where:</p> <ul> <li> <code data-language="javascript">cachePolicy</code> - the catbox <a href="https://hapi.dev/module/catbox/api#policy" rel="nofollow">cache policy</a>.</li> <li> <code data-language="javascript">cache</code> - the <a href="#server.options.cache">cache provision</a> name used when the policy was created or <code data-language="javascript">undefined</code> if the default cache was used.</li> <li> <code data-language="javascript">segment</code> - the segment name used when the policy was created.</li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s">'cachePolicy'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">cachePolicy</span><span class="pl-kos">,</span> <span class="pl-s1">cache</span><span class="pl-kos">,</span> <span class="pl-s1">segment</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">`New cache policy created using cache: <span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">cache</span> <span class="pl-c1">===</span> <span class="pl-c1">undefined</span> ? <span class="pl-s">'default'</span> : <span class="pl-s1">cache</span><span class="pl-kos">}</span></span> and segment: <span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">segment</span><span class="pl-kos">}</span></span>`</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h5>
  <code data-language="javascript">'request'</code> Event</h5> <p>The <code data-language="javascript">'request'</code> event type emits internal request events generated by the framework as well as application events logged with <a href="#request.log()"><code data-language="javascript">request.log()</code></a>.</p> <p>The <code data-language="javascript">'request'</code> event handler uses the function signature <code data-language="javascript">function(request, event, tags)</code> where:</p> <ul> <li> <p><code data-language="javascript">request</code> - the <a href="#request">request object</a>.</p> </li> <li> <p><code data-language="javascript">event</code> - an object with the following properties:</p> <ul> <li> <code data-language="javascript">timestamp</code> - the event timestamp.</li> <li> <code data-language="javascript">tags</code> - an array of tags identifying the event (e.g. <code data-language="javascript">['error', 'http']</code>).</li> <li> <code data-language="javascript">channel</code> - one of <ul> <li> <code data-language="javascript">'app'</code> - events generated by <a href="#request.log()"><code data-language="javascript">request.log()</code></a>.</li> <li> <code data-language="javascript">'error'</code> - emitted once per request if the response had a <code data-language="javascript">500</code> status code.</li> <li> <code data-language="javascript">'internal'</code> - internally generated events.</li> </ul> </li> <li> <code data-language="javascript">request</code> - the request <a href="#request.info.id">identifier</a>.</li> <li> <code data-language="javascript">data</code> - event-specific information. Available when event data was provided and is not an error. Errors are passed via <code data-language="javascript">error</code>.</li> <li> <code data-language="javascript">error</code> - the error object related to the event if applicable. Cannot appear together with <code data-language="javascript">data</code>.</li> </ul> </li> <li> <p><code data-language="javascript">tags</code> - an object where each <code data-language="javascript">event.tag</code> is a key and the value is <code data-language="javascript">true</code>. Useful for quick identification of events.</p> </li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s">'request'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">event</span><span class="pl-kos">,</span> <span class="pl-s1">tags</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">tags</span><span class="pl-kos">.</span><span class="pl-c1">error</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">`Request <span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">event</span><span class="pl-kos">.</span><span class="pl-c1">request</span><span class="pl-kos">}</span></span> error: <span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">event</span><span class="pl-kos">.</span><span class="pl-c1">error</span> ? <span class="pl-s1">event</span><span class="pl-kos">.</span><span class="pl-c1">error</span><span class="pl-kos">.</span><span class="pl-c1">message</span> : <span class="pl-s">'unknown'</span><span class="pl-kos">}</span></span>`</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <p>To listen to only one of the channels, use the event criteria object:</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">name</span>: <span class="pl-s">'request'</span><span class="pl-kos">,</span> <span class="pl-c1">channels</span>: <span class="pl-s">'error'</span> <span class="pl-kos">}</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">event</span><span class="pl-kos">,</span> <span class="pl-s1">tags</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">`Request <span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">event</span><span class="pl-kos">.</span><span class="pl-c1">request</span><span class="pl-kos">}</span></span> failed`</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <p>The internally generated events are (identified by their <code data-language="javascript">tags</code>):</p> <ul> <li> <code data-language="javascript">accept-encoding</code> <code data-language="javascript">error</code> - a request received contains an invalid Accept-Encoding header.</li> <li> <code data-language="javascript">auth</code> <code data-language="javascript">unauthenticated</code> - no authentication scheme included with the request.</li> <li> <code data-language="javascript">auth</code> <code data-language="javascript">unauthenticated</code> <code data-language="javascript">response</code> <code data-language="javascript">{strategy}</code> - the authentication strategy listed returned a non-error response (e.g. a redirect to a login page).</li> <li> <code data-language="javascript">auth</code> <code data-language="javascript">unauthenticated</code> <code data-language="javascript">error</code> <code data-language="javascript">{strategy}</code> - the request failed to pass the listed authentication strategy (invalid credentials).</li> <li> <code data-language="javascript">auth</code> <code data-language="javascript">unauthenticated</code> <code data-language="javascript">missing</code> <code data-language="javascript">{strategy}</code> - the request failed to pass the listed authentication strategy (no credentials found).</li> <li> <code data-language="javascript">auth</code> <code data-language="javascript">unauthenticated</code> <code data-language="javascript">try</code> <code data-language="javascript">{strategy}</code> - the request failed to pass the listed authentication strategy in <code data-language="javascript">'try'</code> mode and will continue.</li> <li> <code data-language="javascript">auth</code> <code data-language="javascript">scope</code> <code data-language="javascript">error</code> - the request authenticated but failed to meet the scope requirements.</li> <li> <code data-language="javascript">auth</code> <code data-language="javascript">entity</code> <code data-language="javascript">user</code> <code data-language="javascript">error</code> - the request authenticated but included an application entity when a user entity was required.</li> <li> <code data-language="javascript">auth</code> <code data-language="javascript">entity</code> <code data-language="javascript">app</code> <code data-language="javascript">error</code> - the request authenticated but included a user entity when an application entity was required.</li> <li> <code data-language="javascript">ext</code> <code data-language="javascript">error</code> - an <code data-language="javascript">onPostResponse</code> extension handler errored.</li> <li> <code data-language="javascript">handler</code> <code data-language="javascript">error</code> - the route handler returned an error. Includes the execution duration and the error message.</li> <li> <code data-language="javascript">pre</code> <code data-language="javascript">error</code> - a pre method was executed and returned an error. Includes the execution duration, assignment key, and error.</li> <li> <code data-language="javascript">internal</code> <code data-language="javascript">error</code> - an HTTP 500 error response was assigned to the request.</li> <li> <code data-language="javascript">internal</code> <code data-language="javascript">implementation</code> <code data-language="javascript">error</code> - an incorrectly implemented <a href="#lifecycle-methods">lifecycle method</a>.</li> <li> <code data-language="javascript">request</code> <code data-language="javascript">abort</code> <code data-language="javascript">error</code> - the request aborted.</li> <li> <code data-language="javascript">request</code> <code data-language="javascript">closed</code> <code data-language="javascript">error</code> - the request closed prematurely.</li> <li> <code data-language="javascript">request</code> <code data-language="javascript">error</code> - the request stream emitted an error. Includes the error.</li> <li> <code data-language="javascript">request</code> <code data-language="javascript">server</code> <code data-language="javascript">timeout</code> <code data-language="javascript">error</code> - the request took too long to process by the server. Includes the timeout configuration value and the duration.</li> <li> <code data-language="javascript">state</code> <code data-language="javascript">error</code> - the request included an invalid cookie or cookies. Includes the cookies and error details.</li> <li> <code data-language="javascript">state</code> <code data-language="javascript">response</code> <code data-language="javascript">error</code> - the response included an invalid cookie which prevented generating a valid header. Includes the error.</li> <li> <code data-language="javascript">payload</code> <code data-language="javascript">error</code> - failed processing the request payload. Includes the error.</li> <li> <code data-language="javascript">response</code> <code data-language="javascript">error</code> - failed writing the response to the client. Includes the error.</li> <li> <code data-language="javascript">response</code> <code data-language="javascript">error</code> <code data-language="javascript">close</code> - failed writing the response to the client due to prematurely closed connection.</li> <li> <code data-language="javascript">response</code> <code data-language="javascript">error</code> <code data-language="javascript">aborted</code> - failed writing the response to the client due to prematurely aborted connection.</li> <li> <code data-language="javascript">response</code> <code data-language="javascript">error</code> <code data-language="javascript">cleanup</code> - failed freeing response resources.</li> <li> <code data-language="javascript">validation</code> <code data-language="javascript">error</code> <code data-language="javascript">{input}</code> - input (i.e. payload, query, params, headers) validation failed. Includes the error. Only emitted when <code data-language="javascript">failAction</code> is set to <code data-language="javascript">'log'</code>.</li> <li> <code data-language="javascript">validation</code> <code data-language="javascript">response</code> <code data-language="javascript">error</code> - response validation failed. Includes the error message. Only emitted when <code data-language="javascript">failAction</code> is set to <code data-language="javascript">'log'</code>.</li> </ul> <h5>
  <code data-language="javascript">'response'</code> Event</h5> <p>The <code data-language="javascript">'response'</code> event type is emitted after the response is sent back to the client (or when the client connection closed and no response sent, in which case <a href="#request.response"><code data-language="javascript">request.response</code></a> is <code data-language="javascript">null</code>). A single event is emitted per request. The <code data-language="javascript">'response'</code> event handler uses the function signature <code data-language="javascript">function(request)</code> where:</p> <ul> <li> <code data-language="javascript">request</code> - the <a href="#request">request object</a>.</li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s">'response'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">`Response sent for request: <span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">info</span><span class="pl-kos">.</span><span class="pl-c1">id</span><span class="pl-kos">}</span></span>`</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h5>
  <code data-language="javascript">'route'</code> Event</h5> <p>The <code data-language="javascript">'route'</code> event type is emitted when a route is added via <a href="#server.route()"><code data-language="javascript">server.route()</code></a>. The <code data-language="javascript">'route'</code> event handler uses the function signature <code data-language="javascript">function(route)</code> where:</p> <ul> <li> <code data-language="javascript">route</code> - the <a href="#request.route">route information</a>. The <code data-language="javascript">route</code> object must not be modified.</li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s">'route'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">route</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">`New route added: <span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">route</span><span class="pl-kos">.</span><span class="pl-c1">path</span><span class="pl-kos">}</span></span>`</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h5>
  <code data-language="javascript">'start'</code> Event</h5> <p>The <code data-language="javascript">'start'</code> event type is emitted when the server is started using <a href="#server.start()"><code data-language="javascript">server.start()</code></a>. The <code data-language="javascript">'start'</code> event handler uses the function signature <code data-language="javascript">function()</code>.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s">'start'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">'Server started'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h5>
  <code data-language="javascript">'closing'</code> Event</h5> <p>The <code data-language="javascript">'closing'</code> event type is emitted when the server is stopped using <a href="#server.stop()"><code data-language="javascript">server.stop()</code></a>. It is triggered when incoming requests are no longer accepted but before all underlying active connections have been closed, and thus before the <a href="#server.events.stop"><code data-language="javascript">'stop'</code></a> event is triggered. The <code data-language="javascript">'closing'</code> event handler uses the function signature <code data-language="javascript">function()</code>.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s">'closing'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">'Server is closing'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h5>
  <code data-language="javascript">'stop'</code> Event</h5> <p>The <code data-language="javascript">'stop'</code> event type is emitted when the server is stopped using <a href="#server.stop()"><code data-language="javascript">server.stop()</code></a>. The <code data-language="javascript">'stop'</code> event handler uses the function signature <code data-language="javascript">function()</code>.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s">'stop'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">'Server stopped'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h4 id="-serverinfo">
  <code data-language="javascript">server.info</code> </h4> <p>Access: read only.</p> <p>An object containing information about the server where:</p> <ul> <li> <p><code data-language="javascript">id</code> - a unique server identifier (using the format '{hostname}:{pid}:{now base36}').</p> </li> <li> <p><code data-language="javascript">created</code> - server creation timestamp.</p> </li> <li> <p><code data-language="javascript">started</code> - server start timestamp (<code data-language="javascript">0</code> when stopped).</p> </li> <li> <p><code data-language="javascript">port</code> - the connection port based on the following rules:</p> <ul> <li>before the server has been started: the configured <a href="#server.options.port"><code data-language="javascript">port</code></a> value.</li> <li>after the server has been started: the actual port assigned when no port is configured or was set to <code data-language="javascript">0</code>.</li> </ul> </li> <li> <p><code data-language="javascript">host</code> - The <a href="#server.options.host"><code data-language="javascript">host</code></a> configuration value.</p> </li> <li> <p><code data-language="javascript">address</code> - the active IP address the connection was bound to after starting. Set to <code data-language="javascript">undefined</code> until the server has been started or when using a non TCP port (e.g. UNIX domain socket).</p> </li> <li> <p><code data-language="javascript">protocol</code> - the protocol used:</p> <ul> <li> <code data-language="javascript">'http'</code> - HTTP.</li> <li> <code data-language="javascript">'https'</code> - HTTPS.</li> <li> <code data-language="javascript">'socket'</code> - UNIX domain socket or Windows named pipe.</li> </ul> </li> <li> <p><code data-language="javascript">uri</code> - a string representing the connection (e.g. '<a href="http://example.com:8080" rel="nofollow">http://example.com:8080</a>' or 'socket:/unix/domain/socket/path'). Contains the <a href="#server.options.uri"><code data-language="javascript">uri</code></a> value if set, otherwise constructed from the available settings. If no <a href="#server.options.port"><code data-language="javascript">port</code></a> is configured or is set to <code data-language="javascript">0</code>, the <code data-language="javascript">uri</code> will not include a port component until the server is started.</p> </li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">info</span><span class="pl-kos">.</span><span class="pl-c1">port</span><span class="pl-kos">)</span><span class="pl-kos">;</span>            <span class="pl-c">// 80</span></pre></div> <h4 id="-serverlistener">
  <code data-language="javascript">server.listener</code> </h4> <p>Access: read only and listener public interface.</p> <p>The node HTTP server object.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-v">SocketIO</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'socket.io'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">io</span> <span class="pl-c1">=</span> <span class="pl-v">SocketIO</span><span class="pl-kos">.</span><span class="pl-en">listen</span><span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">listener</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-s1">io</span><span class="pl-kos">.</span><span class="pl-c1">sockets</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s">'connection'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">socket</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-s1">socket</span><span class="pl-kos">.</span><span class="pl-en">emit</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">msg</span>: <span class="pl-s">'welcome'</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h4 id="-serverload">
  <code data-language="javascript">server.load</code> </h4> <p>Access: read only.</p> <p>An object containing the process load metrics (when <a href="#server.options.load"><code data-language="javascript">load.sampleInterval</code></a> is enabled):</p> <ul> <li> <code data-language="javascript">eventLoopDelay</code> - event loop delay milliseconds.</li> <li> <code data-language="javascript">eventLoopUtilization</code> - current event loop utilization value.</li> <li> <code data-language="javascript">heapUsed</code> - V8 heap usage.</li> <li> <code data-language="javascript">rss</code> - RSS memory usage.</li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">load</span>: <span class="pl-kos">{</span> <span class="pl-c1">sampleInterval</span>: <span class="pl-c1">1000</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">load</span><span class="pl-kos">.</span><span class="pl-c1">rss</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h4 id="-servermethods">
  <code data-language="javascript">server.methods</code> </h4> <p>Access: read only.</p> <p>Server methods are functions registered with the server and used throughout the application as a common utility. Their advantage is in the ability to configure them to use the built-in cache and share across multiple request handlers without having to create a common module.</p> <p><code data-language="javascript">sever.methods</code> is an object which provides access to the methods registered via <a href="#server.method()">server.method()</a> where each server method name is an object property.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">method</span><span class="pl-kos">(</span><span class="pl-s">'add'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">a</span><span class="pl-kos">,</span> <span class="pl-s1">b</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">(</span><span class="pl-s1">a</span> <span class="pl-c1">+</span> <span class="pl-s1">b</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">result</span> <span class="pl-c1">=</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">methods</span><span class="pl-kos">.</span><span class="pl-en">add</span><span class="pl-kos">(</span><span class="pl-c1">1</span><span class="pl-kos">,</span> <span class="pl-c1">2</span><span class="pl-kos">)</span><span class="pl-kos">;</span>    <span class="pl-c">// 3</span></pre></div> <h4 id="-servermime">
  <code data-language="javascript">server.mime</code> </h4> <p>Access: read only and <strong>mimos</strong> public interface.</p> <p>Provides access to the server MIME database used for setting content-type information. The object must not be modified directly but only through the <a href="#server.options.mime"><code data-language="javascript">mime</code></a> server setting.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">options</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
    <span class="pl-c1">mime</span>: <span class="pl-kos">{</span>
        <span class="pl-c1">override</span>: <span class="pl-kos">{</span>
            <span class="pl-s">'node/module'</span>: <span class="pl-kos">{</span>
                <span class="pl-c1">source</span>: <span class="pl-s">'steve'</span><span class="pl-kos">,</span>
                <span class="pl-c1">compressible</span>: <span class="pl-c1">false</span><span class="pl-kos">,</span>
                <span class="pl-c1">extensions</span>: <span class="pl-kos">[</span><span class="pl-s">'node'</span><span class="pl-kos">,</span> <span class="pl-s">'module'</span><span class="pl-kos">,</span> <span class="pl-s">'npm'</span><span class="pl-kos">]</span><span class="pl-kos">,</span>
                <span class="pl-c1">type</span>: <span class="pl-s">'node/module'</span>
            <span class="pl-kos">}</span>
        <span class="pl-kos">}</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-s1">options</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">mime</span><span class="pl-kos">.</span><span class="pl-en">path</span><span class="pl-kos">(</span><span class="pl-s">'code.js'</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-c1">type</span><span class="pl-kos">)</span>        <span class="pl-c">// 'application/javascript'</span>
<span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">mime</span><span class="pl-kos">.</span><span class="pl-en">path</span><span class="pl-kos">(</span><span class="pl-s">'file.npm'</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-c1">type</span><span class="pl-kos">)</span>        <span class="pl-c">// 'node/module'</span></pre></div> <h4 id="-serverplugins">
  <code data-language="javascript">server.plugins</code> </h4> <p>Access: read / write.</p> <p>An object containing the values exposed by each registered plugin where each key is a plugin name and the values are the exposed properties by each plugin using <a href="#server.expose()"><code data-language="javascript">server.expose()</code></a>. Plugins may set the value of the <code data-language="javascript">server.plugins[name]</code> object directly or via the <code data-language="javascript">server.expose()</code> method.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">exports</span><span class="pl-kos">.</span><span class="pl-c1">plugin</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
    <span class="pl-c1">name</span>: <span class="pl-s">'example'</span><span class="pl-kos">,</span>
    <span class="pl-en">register</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">expose</span><span class="pl-kos">(</span><span class="pl-s">'key'</span><span class="pl-kos">,</span> <span class="pl-s">'value'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">plugins</span><span class="pl-kos">.</span><span class="pl-c1">example</span><span class="pl-kos">.</span><span class="pl-c1">other</span> <span class="pl-c1">=</span> <span class="pl-s">'other'</span><span class="pl-kos">;</span>

        <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">plugins</span><span class="pl-kos">.</span><span class="pl-c1">example</span><span class="pl-kos">.</span><span class="pl-c1">key</span><span class="pl-kos">)</span><span class="pl-kos">;</span>      <span class="pl-c">// 'value'</span>
        <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">plugins</span><span class="pl-kos">.</span><span class="pl-c1">example</span><span class="pl-kos">.</span><span class="pl-c1">other</span><span class="pl-kos">)</span><span class="pl-kos">;</span>    <span class="pl-c">// 'other'</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <h4 id="-serverrealm">
  <code data-language="javascript">server.realm</code> </h4> <p>Access: read only.</p> <p>The realm object contains sandboxed server settings specific to each plugin or authentication strategy. When registering a plugin or an authentication scheme, a <code data-language="javascript">server</code> object reference is provided with a new <code data-language="javascript">server.realm</code> container specific to that registration. It allows each plugin to maintain its own settings without leaking and affecting other plugins.</p> <p>For example, a plugin can set a default file path for local resources without breaking other plugins' configured paths. When calling <a href="#server.bind()"><code data-language="javascript">server.bind()</code></a>, the active realm's <code data-language="javascript">settings.bind</code> property is set which is then used by routes and extensions added at the same level (server root or plugin).</p> <p>The <code data-language="javascript">server.realm</code> object contains:</p> <ul> <li> <p><code data-language="javascript">modifiers</code> - when the server object is provided as an argument to the plugin <code data-language="javascript">register()</code> method, <code data-language="javascript">modifiers</code> provides the registration preferences passed the <a href="#server.register()"><code data-language="javascript">server.register()</code></a> method and includes:</p> <ul> <li> <p><code data-language="javascript">route</code> - routes preferences:</p> <ul> <li> <code data-language="javascript">prefix</code> - the route path prefix used by any calls to <a href="#server.route()"><code data-language="javascript">server.route()</code></a> from the server. Note that if a prefix is used and the route path is set to <code data-language="javascript">'/'</code>, the resulting path will not include the trailing slash.</li> <li> <code data-language="javascript">vhost</code> - the route virtual host settings used by any calls to <a href="#server.route()"><code data-language="javascript">server.route()</code></a> from the server.</li> </ul> </li> </ul> </li> <li> <p><code data-language="javascript">parent</code> - the realm of the parent server object, or <code data-language="javascript">null</code> for the root server.</p> </li> <li> <p><code data-language="javascript">plugin</code> - the active plugin name (empty string if at the server root).</p> </li> <li> <p><code data-language="javascript">pluginOptions</code> - the plugin options passed at registration.</p> </li> <li> <p><code data-language="javascript">plugins</code> - plugin-specific state to be shared only among activities sharing the same active state. <code data-language="javascript">plugins</code> is an object where each key is a plugin name and the value is the plugin state.</p> </li> <li> <p><code data-language="javascript">settings</code> - settings overrides:</p> <ul> <li><code data-language="javascript">files.relativeTo</code></li> <li><code data-language="javascript">bind</code></li> </ul> </li> </ul> <p>The <code data-language="javascript">server.realm</code> object should be considered read-only and must not be changed directly except for the <code data-language="javascript">plugins</code> property which can be directly manipulated by each plugin, setting its properties inside <code data-language="javascript">plugins[name]</code>.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">exports</span><span class="pl-kos">.</span><span class="pl-en">register</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">realm</span><span class="pl-kos">.</span><span class="pl-c1">modifiers</span><span class="pl-kos">.</span><span class="pl-c1">route</span><span class="pl-kos">.</span><span class="pl-c1">prefix</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <h4 id="-serverregistrations">
  <code data-language="javascript">server.registrations</code> </h4> <p>Access: read only.</p> <p>An object of the currently registered plugins where each key is a registered plugin name and the value is an object containing:</p> <ul> <li> <code data-language="javascript">version</code> - the plugin version.</li> <li> <code data-language="javascript">name</code> - the plugin name.</li> <li> <code data-language="javascript">options</code> - (optional) options passed to the plugin during registration.</li> </ul> <h4 id="-serversettings">
  <code data-language="javascript">server.settings</code> </h4> <p>Access: read only.</p> <p>The server configuration object after defaults applied.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">app</span>: <span class="pl-kos">{</span>
        <span class="pl-c1">key</span>: <span class="pl-s">'value'</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">settings</span><span class="pl-kos">.</span><span class="pl-c1">app</span><span class="pl-kos">)</span><span class="pl-kos">;</span>   <span class="pl-c">// { key: 'value' }</span></pre></div> <h4 id="-serverstates">
  <code data-language="javascript">server.states</code> </h4> <p>Access: read only and <strong>statehood</strong> public interface.</p> <p>The server cookies manager.</p> <h4 id="-serverstatessettings">
  <code data-language="javascript">server.states.settings</code> </h4> <p>Access: read only.</p> <p>The server cookies manager settings. The settings are based on the values configured in <a href="#server.options.state"><code data-language="javascript">server.options.state</code></a>.</p> <h4 id="-serverstatescookies">
  <code data-language="javascript">server.states.cookies</code> </h4> <p>Access: read only.</p> <p>An object containing the configuration of each cookie added via <a href="#server.state()"><code data-language="javascript">server.state()</code></a> where each key is the cookie name and value is the configuration object.</p> <h4 id="-serverstatesnames">
  <code data-language="javascript">server.states.names</code> </h4> <p>Access: read only.</p> <p>An array containing the names of all configured cookies.</p> <h4 id="-servertype">
  <code data-language="javascript">server.type</code> </h4> <p>Access: read only.</p> <p>A string indicating the listener type where:</p> <ul> <li> <code data-language="javascript">'socket'</code> - UNIX domain socket or Windows named pipe.</li> <li> <code data-language="javascript">'tcp'</code> - an HTTP listener.</li> </ul> <h4 id="-serverversion">
  <code data-language="javascript">server.version</code> </h4> <p>Access: read only.</p> <p>The <strong>hapi</strong> module version number.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">version</span><span class="pl-kos">)</span><span class="pl-kos">;</span>        <span class="pl-c">// '17.0.0'</span></pre></div> <h3 id="-serverauthdefaultoptions">
  <code data-language="javascript">server.auth.default(options)</code> </h3> <p>Sets a default strategy which is applied to every route where:</p> <ul> <li> <p><code data-language="javascript">options</code> - one of:</p> <ul> <li>a string with the default strategy name</li> <li>an authentication configuration object using the same format as the <a href="#route.options.auth">route <code data-language="javascript">auth</code> handler options</a>.</li> </ul> </li> </ul> <p>Return value: none.</p> <p>The default does not apply when a route config specifies <code data-language="javascript">auth</code> as <code data-language="javascript">false</code>, or has an authentication strategy configured (contains the <a href="#route.options.auth.strategy"><code data-language="javascript">strategy</code></a> or <a href="#route.options.auth.strategies"><code data-language="javascript">strategies</code></a> authentication settings). Otherwise, the route authentication config is applied to the defaults.</p> <p>Note that if the route has authentication configured, the default only applies at the time of adding the route, not at runtime. This means that calling <code data-language="javascript">server.auth.default()</code> after adding a route with some authentication config will have no impact on the routes added prior. However, the default will apply to routes added before <code data-language="javascript">server.auth.default()</code> is called if those routes lack any authentication config.</p> <p>The default auth strategy configuration can be accessed via <a href="#server.auth.settings.default"><code data-language="javascript">server.auth.settings.default</code></a>. To obtain the active authentication configuration of a route, use <code data-language="javascript">server.auth.lookup(request.route)</code>.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-en">scheme</span><span class="pl-kos">(</span><span class="pl-s">'custom'</span><span class="pl-kos">,</span> <span class="pl-s1">scheme</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-en">strategy</span><span class="pl-kos">(</span><span class="pl-s">'default'</span><span class="pl-kos">,</span> <span class="pl-s">'custom'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-en">default</span><span class="pl-kos">(</span><span class="pl-s">'default'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/'</span><span class="pl-kos">,</span>
    <span class="pl-en">handler</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-k">return</span> <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-c1">credentials</span><span class="pl-kos">.</span><span class="pl-c1">user</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-serverauthschemename-scheme">
  <code data-language="javascript">server.auth.scheme(name, scheme)</code> </h3> <p>Registers an authentication scheme where:</p> <ul> <li> <code data-language="javascript">name</code> - the scheme name.</li> <li> <code data-language="javascript">scheme</code> - the method implementing the scheme with signature <code data-language="javascript">function(server, options)</code> where: <ul> <li> <code data-language="javascript">server</code> - a reference to the server object the scheme is added to. Each auth strategy is given its own <a href="#server.realm"><code data-language="javascript">server.realm</code></a> whose parent is the realm of the <code data-language="javascript">server</code> in the call to <a href="#server.auth.strategy()"><code data-language="javascript">server.auth.strategy()</code></a>.</li> <li> <code data-language="javascript">options</code> - (optional) the scheme <code data-language="javascript">options</code> argument passed to <a href="#server.auth.strategy()"><code data-language="javascript">server.auth.strategy()</code></a> when instantiation a strategy.</li> </ul> </li> </ul> <p>Return value: none.</p> <p>The <code data-language="javascript">scheme</code> function must return an <a href="#authentication-scheme">authentication scheme object</a> when invoked.</p> <h4 id="authentication-scheme">
Authentication scheme</h4> <p>An authentication scheme is an object with the following properties:</p> <ul> <li> <p><code data-language="javascript">api</code> - (optional) object which is exposed via the <a href="#server.auth.api"><code data-language="javascript">server.auth.api</code></a> object.</p> </li> <li> <p><code data-language="javascript">async authenticate(request, h)</code> - (required) a <a href="#lifecycle-methods">lifecycle method</a> function called for each incoming request configured with the authentication scheme. The method is provided with two special toolkit methods for returning an authenticated or an unauthenticate result:</p> <ul> <li> <a href="#h.authenticated()"><code data-language="javascript">h.authenticated()</code></a> - indicate request authenticated successfully.</li> <li> <a href="#h.unauthenticated()"><code data-language="javascript">h.unauthenticated()</code></a> - indicate request failed to authenticate.</li> </ul> </li> <li> <p><code data-language="javascript">async payload(request, h)</code> - (optional) a <a href="#lifecycle-methods">lifecycle method</a> to authenticate the request payload.</p> </li> <li> <p><code data-language="javascript">async response(request, h)</code> - (optional) a <a href="#lifecycle-methods">lifecycle method</a> to decorate the response with authentication headers before the response headers or payload is written.</p> </li> <li> <p><code data-language="javascript">async verify(auth)</code> - (optional) a method used to verify the authentication credentials provided are still valid (e.g. not expired or revoked after the initial authentication) where:</p> <ul> <li> <code data-language="javascript">auth</code> - the <a href="#request.auth"><code data-language="javascript">request.auth</code></a> object containing the <code data-language="javascript">credentials</code> and <code data-language="javascript">artifacts</code> objects returned by the scheme's <code data-language="javascript">authenticate()</code> method.</li> <li>the method throws an <code data-language="javascript">Error</code> when the credentials passed are no longer valid (e.g. expired or revoked). Note that the method does not have access to the original request, only to the credentials and artifacts produced by the <code data-language="javascript">authenticate()</code> method.</li> </ul> </li> <li> <p><code data-language="javascript">options</code> - (optional) an object with the following keys:</p> <ul> <li> <code data-language="javascript">payload</code> - if <code data-language="javascript">true</code>, requires payload validation as part of the scheme and forbids routes from disabling payload auth validation. Defaults to <code data-language="javascript">false</code>.</li> </ul> </li> </ul> <p>When the scheme <code data-language="javascript">authenticate()</code> method implementation throws an error or calls <a href="#h.unauthenticated()"><code data-language="javascript">h.unauthenticated()</code></a>, the specifics of the error affect whether additional authentication strategies will be attempted (if configured for the route). If the error includes a message, no additional strategies will be attempted. If the <code data-language="javascript">err</code> does not include a message but does include the scheme name (e.g. <code data-language="javascript">Boom.unauthorized(null, 'Custom')</code>), additional strategies will be attempted in the order of preference (defined in the route configuration). If authentication fails, the scheme names will be present in the 'WWW-Authenticate' header.</p> <p>When the scheme <code data-language="javascript">payload()</code> method throws an error with a message, it means payload validation failed due to bad payload. If the error has no message but includes a scheme name (e.g. <code data-language="javascript">Boom.unauthorized(null, 'Custom')</code>), authentication may still be successful if the route <a href="#route.options.auth.payload"><code data-language="javascript">auth.payload</code></a> configuration is set to <code data-language="javascript">'optional'</code>.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">scheme</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-kos">{</span>
        <span class="pl-en">authenticate</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

            <span class="pl-k">const</span> <span class="pl-s1">req</span> <span class="pl-c1">=</span> <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">raw</span><span class="pl-kos">.</span><span class="pl-c1">req</span><span class="pl-kos">;</span>
            <span class="pl-k">const</span> <span class="pl-s1">authorization</span> <span class="pl-c1">=</span> <span class="pl-s1">req</span><span class="pl-kos">.</span><span class="pl-c1">headers</span><span class="pl-kos">.</span><span class="pl-c1">authorization</span><span class="pl-kos">;</span>
            <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-s1">authorization</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
                <span class="pl-k">throw</span> <span class="pl-v">Boom</span><span class="pl-kos">.</span><span class="pl-en">unauthorized</span><span class="pl-kos">(</span><span class="pl-c1">null</span><span class="pl-kos">,</span> <span class="pl-s">'Custom'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
            <span class="pl-kos">}</span>

            <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-en">authenticated</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">credentials</span>: <span class="pl-kos">{</span> <span class="pl-c1">user</span>: <span class="pl-s">'john'</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>
    <span class="pl-kos">}</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-en">scheme</span><span class="pl-kos">(</span><span class="pl-s">'custom'</span><span class="pl-kos">,</span> <span class="pl-en">scheme</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-serverauthstrategyname-scheme-options">
  <code data-language="javascript">server.auth.strategy(name, scheme, [options])</code> </h3> <p>Registers an authentication strategy where:</p> <ul> <li> <code data-language="javascript">name</code> - the strategy name.</li> <li> <code data-language="javascript">scheme</code> - the scheme name (must be previously registered using <a href="#server.auth.scheme()"><code data-language="javascript">server.auth.scheme()</code></a>).</li> <li> <code data-language="javascript">options</code> - scheme options based on the scheme requirements.</li> </ul> <p>Return value: none.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-en">scheme</span><span class="pl-kos">(</span><span class="pl-s">'custom'</span><span class="pl-kos">,</span> <span class="pl-s1">scheme</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-en">strategy</span><span class="pl-kos">(</span><span class="pl-s">'default'</span><span class="pl-kos">,</span> <span class="pl-s">'custom'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/'</span><span class="pl-kos">,</span>
    <span class="pl-c1">options</span>: <span class="pl-kos">{</span>
        <span class="pl-c1">auth</span>: <span class="pl-s">'default'</span><span class="pl-kos">,</span>
        <span class="pl-en">handler</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

            <span class="pl-k">return</span> <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-c1">credentials</span><span class="pl-kos">.</span><span class="pl-c1">user</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-await-serverauthteststrategy-request">
  <code data-language="javascript">await server.auth.test(strategy, request)</code> </h3> <p>Tests a request against an authentication strategy where:</p> <ul> <li> <code data-language="javascript">strategy</code> - the strategy name registered with <a href="#server.auth.strategy()"><code data-language="javascript">server.auth.strategy()</code></a>.</li> <li> <code data-language="javascript">request</code> - the <a href="#request">request object</a>.</li> </ul> <p>Return value: an object containing the authentication <code data-language="javascript">credentials</code> and <code data-language="javascript">artifacts</code> if authentication was successful, otherwise throws an error.</p> <p>Note that the <code data-language="javascript">test()</code> method does not take into account the route authentication configuration. It also does not perform payload authentication. It is limited to the basic strategy authentication execution. It does not include verifying scope, entity, or other route properties.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-en">scheme</span><span class="pl-kos">(</span><span class="pl-s">'custom'</span><span class="pl-kos">,</span> <span class="pl-s1">scheme</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-en">strategy</span><span class="pl-kos">(</span><span class="pl-s">'default'</span><span class="pl-kos">,</span> <span class="pl-s">'custom'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/'</span><span class="pl-kos">,</span>
    <span class="pl-en">handler</span>: <span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-k">try</span> <span class="pl-kos">{</span>
            <span class="pl-k">const</span> <span class="pl-kos">{</span> credentials<span class="pl-kos">,</span> artifacts <span class="pl-kos">}</span> <span class="pl-c1">=</span> <span class="pl-k">await</span> <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">server</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-en">test</span><span class="pl-kos">(</span><span class="pl-s">'default'</span><span class="pl-kos">,</span> <span class="pl-s1">request</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
            <span class="pl-k">return</span> <span class="pl-kos">{</span> <span class="pl-c1">status</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span> <span class="pl-c1">user</span>: <span class="pl-s1">credentials</span><span class="pl-kos">.</span><span class="pl-c1">name</span> <span class="pl-kos">}</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>
        <span class="pl-k">catch</span> <span class="pl-kos">(</span><span class="pl-s1">err</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
            <span class="pl-k">return</span> <span class="pl-kos">{</span> <span class="pl-c1">status</span>: <span class="pl-c1">false</span> <span class="pl-kos">}</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-await-serverauthverifyrequest">
  <code data-language="javascript">await server.auth.verify(request)</code> </h3> <p>Verify a request's authentication credentials against an authentication strategy where:</p> <ul> <li> <code data-language="javascript">request</code> - the <a href="#request">request object</a>.</li> </ul> <p>Return value: nothing if verification was successful, otherwise throws an error.</p> <p>Note that the <code data-language="javascript">verify()</code> method does not take into account the route authentication configuration or any other information from the request other than the <code data-language="javascript">request.auth</code> object. It also does not perform payload authentication. It is limited to verifying that the previously valid credentials are still valid (e.g. have not been revoked or expired). It does not include verifying scope, entity, or other route properties.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-en">scheme</span><span class="pl-kos">(</span><span class="pl-s">'custom'</span><span class="pl-kos">,</span> <span class="pl-s1">scheme</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-en">strategy</span><span class="pl-kos">(</span><span class="pl-s">'default'</span><span class="pl-kos">,</span> <span class="pl-s">'custom'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/'</span><span class="pl-kos">,</span>
    <span class="pl-en">handler</span>: <span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-k">try</span> <span class="pl-kos">{</span>
            <span class="pl-k">const</span> <span class="pl-s1">credentials</span> <span class="pl-c1">=</span> <span class="pl-k">await</span> <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">server</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">.</span><span class="pl-en">verify</span><span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
            <span class="pl-k">return</span> <span class="pl-kos">{</span> <span class="pl-c1">status</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span> <span class="pl-c1">user</span>: <span class="pl-s1">credentials</span><span class="pl-kos">.</span><span class="pl-c1">name</span> <span class="pl-kos">}</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>
        <span class="pl-k">catch</span> <span class="pl-kos">(</span><span class="pl-s1">err</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
            <span class="pl-k">return</span> <span class="pl-kos">{</span> <span class="pl-c1">status</span>: <span class="pl-c1">false</span> <span class="pl-kos">}</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-serverbindcontext">
  <code data-language="javascript">server.bind(context)</code> </h3> <p>Sets a global context used as the default bind object when adding a route or an extension where:</p> <ul> <li> <code data-language="javascript">context</code> - the object used to bind <code data-language="javascript">this</code> in <a href="#lifecycle-methods">lifecycle methods</a> such as the <a href="#route.options.handler">route handler</a> and <a href="#server.ext()">extension methods</a>. The context is also made available as <a href="#h.context"><code data-language="javascript">h.context</code></a>.</li> </ul> <p>Return value: none.</p> <p>When setting a context inside a plugin, the context is applied only to methods set up by the plugin. Note that the context applies only to routes and extensions added after it has been set. Ignored if the method being bound is an arrow function.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-en">handler</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">message</span><span class="pl-kos">;</span>    <span class="pl-c">// Or h.context.message</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">exports</span><span class="pl-kos">.</span><span class="pl-c1">plugin</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
    <span class="pl-c1">name</span>: <span class="pl-s">'example'</span><span class="pl-kos">,</span>
    <span class="pl-en">register</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-k">const</span> <span class="pl-s1">bind</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
            <span class="pl-c1">message</span>: <span class="pl-s">'hello'</span>
        <span class="pl-kos">}</span><span class="pl-kos">;</span>

        <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">bind</span><span class="pl-kos">(</span><span class="pl-s1">bind</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span> <span class="pl-c1">path</span>: <span class="pl-s">'/'</span><span class="pl-kos">,</span> handler <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <h3 id="-servercacheoptions">
  <code data-language="javascript">server.cache(options)</code> </h3> <p>Provisions a cache segment within the server cache facility where:</p> <ul> <li> <p><code data-language="javascript">options</code> - <a href="https://hapi.dev/family/catbox/api#policy" rel="nofollow"><strong>catbox</strong> policy</a> configuration where:</p> <ul> <li> <p><code data-language="javascript">expiresIn</code> - relative expiration expressed in the number of milliseconds since the item was saved in the cache. Cannot be used together with <code data-language="javascript">expiresAt</code>.</p> </li> <li> <p><code data-language="javascript">expiresAt</code> - time of day expressed in 24h notation using the 'HH:MM' format, at which point all cache records expire. Uses local time. Cannot be used together with <code data-language="javascript">expiresIn</code>.</p> </li> <li> <p><code data-language="javascript">generateFunc</code> - a function used to generate a new cache item if one is not found in the cache when calling <code data-language="javascript">get()</code>. The method's signature is <code data-language="javascript">async function(id, flags)</code> where:</p> <pre data-language="javascript"><code data-language="javascript">- `id` - the `id` string or object provided to the `get()` method.
- `flags` - an object used to pass back additional flags to the cache where:
    - `ttl` - the cache ttl value in milliseconds. Set to `0` to skip storing in the
      cache. Defaults to the cache global policy.
</code></pre> </li> <li> <p><code data-language="javascript">staleIn</code> - number of milliseconds to mark an item stored in cache as stale and attempt to regenerate it when <code data-language="javascript">generateFunc</code> is provided. Must be less than <code data-language="javascript">expiresIn</code>.</p> </li> <li> <p><code data-language="javascript">staleTimeout</code> - number of milliseconds to wait before checking if an item is stale.</p> </li> <li> <p><code data-language="javascript">generateTimeout</code> - number of milliseconds to wait before returning a timeout error when the <code data-language="javascript">generateFunc</code> function takes too long to return a value. When the value is eventually returned, it is stored in the cache for future requests. Required if <code data-language="javascript">generateFunc</code> is present. Set to <code data-language="javascript">false</code> to disable timeouts which may cause all <code data-language="javascript">get()</code> requests to get stuck forever.</p> </li> <li> <p><code data-language="javascript">generateOnReadError</code> - if <code data-language="javascript">false</code>, an upstream cache read error will stop the <code data-language="javascript">cache.get()</code> method from calling the generate function and will instead pass back the cache error. Defaults to <code data-language="javascript">true</code>.</p> </li> <li> <p><code data-language="javascript">generateIgnoreWriteError</code> - if <code data-language="javascript">false</code>, an upstream cache write error when calling <code data-language="javascript">cache.get()</code> will be passed back with the generated value when calling. Defaults to <code data-language="javascript">true</code>.</p> </li> <li> <p><code data-language="javascript">dropOnError</code> - if <code data-language="javascript">true</code>, an error or timeout in the <code data-language="javascript">generateFunc</code> causes the stale value to be evicted from the cache. Defaults to <code data-language="javascript">true</code>.</p> </li> <li> <p><code data-language="javascript">pendingGenerateTimeout</code> - number of milliseconds while <code data-language="javascript">generateFunc</code> call is in progress for a given id, before a subsequent <code data-language="javascript">generateFunc</code> call is allowed. Defaults to <code data-language="javascript">0</code> (no blocking of concurrent <code data-language="javascript">generateFunc</code> calls beyond <code data-language="javascript">staleTimeout</code>).</p> </li> <li> <p><code data-language="javascript">cache</code> - the cache name configured in <a href="#server.options.cache"><code data-language="javascript">server.cache</code></a>. Defaults to the default cache.</p> </li> <li> <p><code data-language="javascript">segment</code> - string segment name, used to isolate cached items within the cache partition. When called within a plugin, defaults to '!name' where 'name' is the plugin name. When called within a server method, defaults to '#name' where 'name' is the server method name. Required when called outside of a plugin.</p> </li> <li> <p><code data-language="javascript">shared</code> - if <code data-language="javascript">true</code>, allows multiple cache provisions to share the same segment. Default to <code data-language="javascript">false</code>.</p> </li> </ul> </li> </ul> <p>Return value: a <a href="https://hapi.dev/family/catbox/api#policy" rel="nofollow"><strong>catbox</strong> policy</a> object.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">const</span> <span class="pl-s1">cache</span> <span class="pl-c1">=</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">cache</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">segment</span>: <span class="pl-s">'countries'</span><span class="pl-kos">,</span> <span class="pl-c1">expiresIn</span>: <span class="pl-c1">60</span> <span class="pl-c1">*</span> <span class="pl-c1">60</span> <span class="pl-c1">*</span> <span class="pl-c1">1000</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">await</span> <span class="pl-s1">cache</span><span class="pl-kos">.</span><span class="pl-en">set</span><span class="pl-kos">(</span><span class="pl-s">'norway'</span><span class="pl-kos">,</span> <span class="pl-kos">{</span> <span class="pl-c1">capital</span>: <span class="pl-s">'oslo'</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">const</span> <span class="pl-s1">value</span> <span class="pl-c1">=</span> <span class="pl-k">await</span> <span class="pl-s1">cache</span><span class="pl-kos">.</span><span class="pl-en">get</span><span class="pl-kos">(</span><span class="pl-s">'norway'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div> <h3 id="-await-servercacheprovisionoptions">
  <code data-language="javascript">await server.cache.provision(options)</code> </h3> <p>Provisions a server cache as described in <a href="#server.options.cache"><code data-language="javascript">server.cache</code></a> where:</p> <ul> <li> <code data-language="javascript">options</code> - same as the server <a href="#server.options.cache"><code data-language="javascript">cache</code></a> configuration options.</li> </ul> <p>Return value: none.</p> <p>Note that if the server has been initialized or started, the cache will be automatically started to match the state of any other provisioned server cache.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">await</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">initialize</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">await</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">cache</span><span class="pl-kos">.</span><span class="pl-en">provision</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">provider</span>: <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/catbox-memory'</span><span class="pl-kos">)</span><span class="pl-kos">,</span> <span class="pl-c1">name</span>: <span class="pl-s">'countries'</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-k">const</span> <span class="pl-s1">cache</span> <span class="pl-c1">=</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">cache</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">cache</span>: <span class="pl-s">'countries'</span><span class="pl-kos">,</span> <span class="pl-c1">expiresIn</span>: <span class="pl-c1">60</span> <span class="pl-c1">*</span> <span class="pl-c1">60</span> <span class="pl-c1">*</span> <span class="pl-c1">1000</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">await</span> <span class="pl-s1">cache</span><span class="pl-kos">.</span><span class="pl-en">set</span><span class="pl-kos">(</span><span class="pl-s">'norway'</span><span class="pl-kos">,</span> <span class="pl-kos">{</span> <span class="pl-c1">capital</span>: <span class="pl-s">'oslo'</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">const</span> <span class="pl-s1">value</span> <span class="pl-c1">=</span> <span class="pl-k">await</span> <span class="pl-s1">cache</span><span class="pl-kos">.</span><span class="pl-en">get</span><span class="pl-kos">(</span><span class="pl-s">'norway'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div> <h3 id="-servercontrolserver">
  <code data-language="javascript">server.control(server)</code> </h3> <p>Links another server to the initialize/start/stop state of the current server by calling the controlled server <code data-language="javascript">initialize()</code>/<code data-language="javascript">start()</code>/<code data-language="javascript">stop()</code> methods whenever the current server methods are called, where:</p> <ul> <li> <code data-language="javascript">server</code> - the <strong>hapi</strong> server object to be controlled.</li> </ul> <h3 id="-serverdecoderencoding-decoder">
  <code data-language="javascript">server.decoder(encoding, decoder)</code> </h3> <p>Registers a custom content decoding compressor to extend the built-in support for <code data-language="javascript">'gzip'</code> and '<code data-language="javascript">deflate</code>' where:</p> <ul> <li> <p><code data-language="javascript">encoding</code> - the decoder name string.</p> </li> <li> <p><code data-language="javascript">decoder</code> - a function using the signature <code data-language="javascript">function(options)</code> where <code data-language="javascript">options</code> are the encoding specific options configured in the route <a href="#route.options.payload.compression"><code data-language="javascript">payload.compression</code></a> configuration option, and the return value is an object compatible with the output of node's <a href="https://nodejs.org/api/zlib.html#zlib_zlib_creategunzip_options" rel="nofollow"><code data-language="javascript">zlib.createGunzip()</code></a>.</p> </li> </ul> <p>Return value: none.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Zlib</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'zlib'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span><span class="pl-kos">,</span> <span class="pl-c1">routes</span>: <span class="pl-kos">{</span> <span class="pl-c1">payload</span>: <span class="pl-kos">{</span> <span class="pl-c1">compression</span>: <span class="pl-kos">{</span> <span class="pl-c1">special</span>: <span class="pl-kos">{</span> <span class="pl-c1">chunkSize</span>: <span class="pl-c1">16</span> <span class="pl-c1">*</span> <span class="pl-c1">1024</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">decoder</span><span class="pl-kos">(</span><span class="pl-s">'special'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-v">Zlib</span><span class="pl-kos">.</span><span class="pl-en">createGunzip</span><span class="pl-kos">(</span><span class="pl-s1">options</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-serverdecoratetype-property-method-options">
  <code data-language="javascript">server.decorate(type, property, method, [options])</code> </h3> <p>Extends various framework interfaces with custom methods where:</p> <ul> <li> <p><code data-language="javascript">type</code> - the interface being decorated. Supported types:</p> <ul> <li> <code data-language="javascript">'handler'</code> - adds a new handler type to be used in <a href="#route.options.handler">routes handlers</a>.</li> <li> <code data-language="javascript">'request'</code> - adds methods to the <a href="#request">Request object</a>.</li> <li> <code data-language="javascript">'response'</code> - adds methods to the <a href="#response-object">Response object</a>.</li> <li> <code data-language="javascript">'server'</code> - adds methods to the <a href="#server">Server</a> object.</li> <li> <code data-language="javascript">'toolkit'</code> - adds methods to the <a href="#response-toolkit">response toolkit</a>.</li> </ul> </li> <li> <p><code data-language="javascript">property</code> - the object decoration key name or symbol.</p> </li> <li> <p><code data-language="javascript">method</code> - the extension function or other value.</p> </li> <li> <p><code data-language="javascript">options</code> - (optional) supports the following optional settings:</p> <ul> <li> <code data-language="javascript">apply</code> - when the <code data-language="javascript">type</code> is <code data-language="javascript">'request'</code>, if <code data-language="javascript">true</code>, the <code data-language="javascript">method</code> function is invoked using the signature <code data-language="javascript">function(request)</code> where <code data-language="javascript">request</code> is the current request object and the returned value is assigned as the decoration.</li> <li> <code data-language="javascript">extend</code> - if <code data-language="javascript">true</code>, overrides an existing decoration. The <code data-language="javascript">method</code> must be a function with the signature <code data-language="javascript">function(existing)</code> where: <ul> <li> <code data-language="javascript">existing</code> - is the previously set decoration method value.</li> <li>must return the new decoration function or value.</li> <li>cannot be used to extend handler decorations.</li> </ul> </li> </ul> </li> </ul> <p>Return value: none.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">success</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-en">response</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">status</span>: <span class="pl-s">'ok'</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">decorate</span><span class="pl-kos">(</span><span class="pl-s">'toolkit'</span><span class="pl-kos">,</span> <span class="pl-s">'success'</span><span class="pl-kos">,</span> <span class="pl-en">success</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/'</span><span class="pl-kos">,</span>
    <span class="pl-en">handler</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-en">success</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <p>When registering a handler decoration, the <code data-language="javascript">method</code> must be a function using the signature <code data-language="javascript">function(route, options)</code> where:</p> <ul> <li> <code data-language="javascript">route</code> - the <a href="#request.route">route information</a>.</li> <li> <code data-language="javascript">options</code> - the configuration object provided in the handler config.</li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">host</span>: <span class="pl-s">'localhost'</span><span class="pl-kos">,</span> <span class="pl-c1">port</span>: <span class="pl-c1">8000</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-c">// Defines new handler for routes on this server</span>

    <span class="pl-k">const</span> <span class="pl-en">handler</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">route</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-k">return</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

            <span class="pl-k">return</span> <span class="pl-s">'new handler: '</span> <span class="pl-c1">+</span> <span class="pl-s1">options</span><span class="pl-kos">.</span><span class="pl-c1">msg</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>
    <span class="pl-kos">}</span><span class="pl-kos">;</span>

    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">decorate</span><span class="pl-kos">(</span><span class="pl-s">'handler'</span><span class="pl-kos">,</span> <span class="pl-s">'test'</span><span class="pl-kos">,</span> <span class="pl-en">handler</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
        <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
        <span class="pl-c1">path</span>: <span class="pl-s">'/'</span><span class="pl-kos">,</span>
        <span class="pl-c1">handler</span>: <span class="pl-kos">{</span> <span class="pl-c1">test</span>: <span class="pl-kos">{</span> <span class="pl-c1">msg</span>: <span class="pl-s">'test'</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-k">await</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">start</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div> <p>The <code data-language="javascript">method</code> function can have a <code data-language="javascript">defaults</code> object or function property. If the property is set to an object, that object is used as the default route config for routes using this handler. If the property is set to a function, the function uses the signature <code data-language="javascript">function(method)</code> and returns the route default configuration.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">host</span>: <span class="pl-s">'localhost'</span><span class="pl-kos">,</span> <span class="pl-c1">port</span>: <span class="pl-c1">8000</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">handler</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">route</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-k">return</span> <span class="pl-s">'new handler: '</span> <span class="pl-c1">+</span> <span class="pl-s1">options</span><span class="pl-kos">.</span><span class="pl-c1">msg</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-c">// Change the default payload processing for this handler</span>

<span class="pl-en">handler</span><span class="pl-kos">.</span><span class="pl-c1">defaults</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
    <span class="pl-c1">payload</span>: <span class="pl-kos">{</span>
        <span class="pl-c1">output</span>: <span class="pl-s">'stream'</span><span class="pl-kos">,</span>
        <span class="pl-c1">parse</span>: <span class="pl-c1">false</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">decorate</span><span class="pl-kos">(</span><span class="pl-s">'handler'</span><span class="pl-kos">,</span> <span class="pl-s">'test'</span><span class="pl-kos">,</span> <span class="pl-en">handler</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-serverdependencydependencies-after">
  <code data-language="javascript">server.dependency(dependencies, [after])</code> </h3> <p>Used within a plugin to declare a required dependency on other <a href="#plugins">plugins</a> required for the current plugin to operate (plugins listed must be registered before the server is initialized or started) where:</p> <ul> <li> <p><code data-language="javascript">dependencies</code> - one of:</p> <ul> <li>a single plugin name string.</li> <li>an array of plugin name strings.</li> <li>an object where each key is a plugin name and each matching value is a <a href="https://www.npmjs.com/package/semver" rel="nofollow">version range string</a> which must match the registered plugin version.</li> </ul> </li> <li> <p><code data-language="javascript">after</code> - (optional) a function that is called after all the specified dependencies have been registered and before the server starts. The function is only called if the server is initialized or started. The function signature is <code data-language="javascript">async function(server)</code> where:</p> <ul> <li> <code data-language="javascript">server</code> - the server the <code data-language="javascript">dependency()</code> method was called on.</li> </ul> </li> </ul> <p>Return value: none.</p> <p>The <code data-language="javascript">after</code> method is identical to setting a server extension point on <code data-language="javascript">'onPreStart'</code>.</p> <p>If a circular dependency is detected, an exception is thrown (e.g. two plugins each has an <code data-language="javascript">after</code> function to be called after the other).</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-en">after</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-c">// Additional plugin registration logic</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">exports</span><span class="pl-kos">.</span><span class="pl-c1">plugin</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
    <span class="pl-c1">name</span>: <span class="pl-s">'example'</span><span class="pl-kos">,</span>
    <span class="pl-en">register</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">dependency</span><span class="pl-kos">(</span><span class="pl-s">'yar'</span><span class="pl-kos">,</span> <span class="pl-en">after</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <p>Dependencies can also be set via the plugin <code data-language="javascript">dependencies</code> property (does not support setting <code data-language="javascript">after</code>):</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">exports</span><span class="pl-kos">.</span><span class="pl-c1">plugin</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
    <span class="pl-c1">name</span>: <span class="pl-s">'test'</span><span class="pl-kos">,</span>
    <span class="pl-c1">version</span>: <span class="pl-s">'1.0.0'</span><span class="pl-kos">,</span>
    <span class="pl-c1">dependencies</span>: <span class="pl-kos">{</span>
        <span class="pl-c1">yar</span>: <span class="pl-s">'1.x.x'</span>
    <span class="pl-kos">}</span><span class="pl-kos">,</span>
    <span class="pl-en">register</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-kos">{</span> <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <p>The <code data-language="javascript">dependencies</code> configuration accepts one of:</p> <ul> <li>a single plugin name string.</li> <li>an array of plugin name strings.</li> <li>an object where each key is a plugin name and each matching value is a <a href="https://www.npmjs.com/package/semver" rel="nofollow">version range string</a> which must match the registered plugin version.</li> </ul> <h3 id="-serverencoderencoding-encoder">
  <code data-language="javascript">server.encoder(encoding, encoder)</code> </h3> <p>Registers a custom content encoding compressor to extend the built-in support for <code data-language="javascript">'gzip'</code> and '<code data-language="javascript">deflate</code>' where:</p> <ul> <li> <p><code data-language="javascript">encoding</code> - the encoder name string.</p> </li> <li> <p><code data-language="javascript">encoder</code> - a function using the signature <code data-language="javascript">function(options)</code> where <code data-language="javascript">options</code> are the encoding specific options configured in the route <a href="#route.options.compression"><code data-language="javascript">compression</code></a> option, and the return value is an object compatible with the output of node's <a href="https://nodejs.org/api/zlib.html#zlib_zlib_creategzip_options" rel="nofollow"><code data-language="javascript">zlib.createGzip()</code></a>.</p> </li> </ul> <p>Return value: none.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Zlib</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'zlib'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span><span class="pl-kos">,</span> <span class="pl-c1">routes</span>: <span class="pl-kos">{</span> <span class="pl-c1">compression</span>: <span class="pl-kos">{</span> <span class="pl-c1">special</span>: <span class="pl-kos">{</span> <span class="pl-c1">chunkSize</span>: <span class="pl-c1">16</span> <span class="pl-c1">*</span> <span class="pl-c1">1024</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">encoder</span><span class="pl-kos">(</span><span class="pl-s">'special'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-v">Zlib</span><span class="pl-kos">.</span><span class="pl-en">createGzip</span><span class="pl-kos">(</span><span class="pl-s1">options</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-servereventevents">
  <code data-language="javascript">server.event(events)</code> </h3> <p>Register custom application events where:</p> <ul> <li> <p><code data-language="javascript">events</code> - must be one of:</p> <ul> <li> <p>an event name string.</p> </li> <li> <p>an event options object with the following optional keys (unless noted otherwise):</p> <ul> <li> <p><code data-language="javascript">name</code> - the event name string (required).</p> </li> <li> <p><code data-language="javascript">channels</code> - a string or array of strings specifying the event channels available. Defaults to no channel restrictions (event updates can specify a channel or not).</p> </li> <li> <p><code data-language="javascript">clone</code> - if <code data-language="javascript">true</code>, the <code data-language="javascript">data</code> object passed to <a href="#server.events.emit()"><code data-language="javascript">server.events.emit()</code></a> is cloned before it is passed to the listeners (unless an override specified by each listener). Defaults to <code data-language="javascript">false</code> (<code data-language="javascript">data</code> is passed as-is).</p> </li> <li> <p><code data-language="javascript">spread</code> - if <code data-language="javascript">true</code>, the <code data-language="javascript">data</code> object passed to <a href="#server.event.emit()"><code data-language="javascript">server.event.emit()</code></a> must be an array and the <code data-language="javascript">listener</code> method is called with each array element passed as a separate argument (unless an override specified by each listener). This should only be used when the emitted data structure is known and predictable. Defaults to <code data-language="javascript">false</code> (<code data-language="javascript">data</code> is emitted as a single argument regardless of its type).</p> </li> <li> <p><code data-language="javascript">tags</code> - if <code data-language="javascript">true</code> and the <code data-language="javascript">criteria</code> object passed to <a href="#server.event.emit()"><code data-language="javascript">server.event.emit()</code></a> includes <code data-language="javascript">tags</code>, the tags are mapped to an object (where each tag string is the key and the value is <code data-language="javascript">true</code>) which is appended to the arguments list at the end. A configuration override can be set by each listener. Defaults to <code data-language="javascript">false</code>.</p> </li> <li> <p><code data-language="javascript">shared</code> - if <code data-language="javascript">true</code>, the same event <code data-language="javascript">name</code> can be registered multiple times where the second registration is ignored. Note that if the registration config is changed between registrations, only the first configuration is used. Defaults to <code data-language="javascript">false</code> (a duplicate registration will throw an error).</p> </li> </ul> </li> <li> <p>an array containing any of the above.</p> </li> </ul> </li> </ul> <p>Return value: none.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">event</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">update</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">update</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">await</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">gauge</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">,</span> <span class="pl-s">'hello'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div> <h3 id="-servereventsemitcriteria-data">
  <code data-language="javascript">server.events.emit(criteria, data)</code> </h3> <p>Emits a custom application event to all the subscribed listeners where:</p> <ul> <li> <p><code data-language="javascript">criteria</code> - the event update criteria which must be one of:</p> <ul> <li>the event name string.</li> <li>an object with the following optional keys (unless noted otherwise): <ul> <li> <code data-language="javascript">name</code> - the event name string (required).</li> <li> <code data-language="javascript">channel</code> - the channel name string.</li> <li> <code data-language="javascript">tags</code> - a tag string or array of tag strings.</li> </ul> </li> </ul> </li> <li> <p><code data-language="javascript">data</code> - the value emitted to the subscribers. If <code data-language="javascript">data</code> is a function, the function signature is <code data-language="javascript">function()</code> and it called once to generate (return value) the actual data emitted to the listeners. If no listeners match the event, the <code data-language="javascript">data</code> function is not invoked.</p> </li> </ul> <p>Return value: none.</p> <p>Note that events must be registered before they can be emitted or subscribed to by calling <a href="#server.event()"><code data-language="javascript">server.event(events)</code></a>. This is done to detect event name misspelling and invalid event activities.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">event</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">update</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">update</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">emit</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">,</span> <span class="pl-s">'hello'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div> <h3 id="-servereventsoncriteria-listener-context">
  <code data-language="javascript">server.events.on(criteria, listener, context)</code> </h3> <p>Subscribe to an event where:</p> <ul> <li> <p><code data-language="javascript">criteria</code> - the subscription criteria which must be one of:</p> <ul> <li> <p>event name string which can be any of the <a href="#server.events">built-in server events</a> or a custom application event registered with <a href="#server.event()"><code data-language="javascript">server.event()</code></a>.</p> </li> <li> <p>a criteria object with the following optional keys (unless noted otherwise):</p> <ul> <li> <p><code data-language="javascript">name</code> - (required) the event name string.</p> </li> <li> <p><code data-language="javascript">channels</code> - a string or array of strings specifying the event channels to subscribe to. If the event registration specified a list of allowed channels, the <code data-language="javascript">channels</code> array must match the allowed channels. If <code data-language="javascript">channels</code> are specified, event updates without any channel designation will not be included in the subscription. Defaults to no channels filter.</p> </li> <li> <p><code data-language="javascript">clone</code> - if <code data-language="javascript">true</code>, the <code data-language="javascript">data</code> object passed to <a href="#server.event.emit()"><code data-language="javascript">server.event.emit()</code></a> is cloned before it is passed to the <code data-language="javascript">listener</code> method. Defaults to the event registration option (which defaults to <code data-language="javascript">false</code>).</p> </li> <li> <p><code data-language="javascript">count</code> - a positive integer indicating the number of times the <code data-language="javascript">listener</code> can be called after which the subscription is automatically removed. A count of <code data-language="javascript">1</code> is the same as calling <code data-language="javascript">server.events.once()</code>. Defaults to no limit.</p> </li> <li> <p><code data-language="javascript">filter</code> - the event tags (if present) to subscribe to which can be one of:</p> <ul> <li> <p>a tag string.</p> </li> <li> <p>an array of tag strings.</p> </li> <li> <p>an object with the following:</p> <ul> <li> <code data-language="javascript">tags</code> - a tag string or array of tag strings.</li> <li> <code data-language="javascript">all</code> - if <code data-language="javascript">true</code>, all <code data-language="javascript">tags</code> must be present for the event update to match the subscription. Defaults to <code data-language="javascript">false</code> (at least one matching tag).</li> </ul> </li> </ul> </li> <li> <p><code data-language="javascript">spread</code> - if <code data-language="javascript">true</code>, and the <code data-language="javascript">data</code> object passed to <a href="#server.event.emit()"><code data-language="javascript">server.event.emit()</code></a> is an array, the <code data-language="javascript">listener</code> method is called with each array element passed as a separate argument. This should only be used when the emitted data structure is known and predictable. Defaults to the event registration option (which defaults to <code data-language="javascript">false</code>).</p> </li> <li> <p><code data-language="javascript">tags</code> - if <code data-language="javascript">true</code> and the <code data-language="javascript">criteria</code> object passed to <a href="#server.event.emit()"><code data-language="javascript">server.event.emit()</code></a> includes <code data-language="javascript">tags</code>, the tags are mapped to an object (where each tag string is the key and the value is <code data-language="javascript">true</code>) which is appended to the arguments list at the end. Defaults to the event registration option (which defaults to <code data-language="javascript">false</code>).</p> </li> </ul> </li> </ul> </li> <li> <p><code data-language="javascript">listener</code> - the handler method set to receive event updates. The function signature depends on the event argument, and the <code data-language="javascript">spread</code> and <code data-language="javascript">tags</code> options.</p> </li> <li> <p><code data-language="javascript">context</code> - an object that binds to the listener handler.</p> </li> </ul> <p>Return value: none.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">event</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">update</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">update</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">emit</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">,</span> <span class="pl-s">'hello'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div> <h3 id="-servereventsoncecriteria-listener-context">
  <code data-language="javascript">server.events.once(criteria, listener, context)</code> </h3> <p>Same as calling <a href="#server.events.on()"><code data-language="javascript">server.events.on()</code></a> with the <code data-language="javascript">count</code> option set to <code data-language="javascript">1</code>.</p> <p>Return value: none.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">event</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">once</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">update</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">update</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">emit</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">,</span> <span class="pl-s">'hello'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">emit</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">,</span> <span class="pl-s">'hello'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>       <span class="pl-c">// Ignored</span>
<span class="pl-kos">}</span></pre></div> <h3 id="-await-servereventsoncecriteria">
  <code data-language="javascript">await server.events.once(criteria)</code> </h3> <p>Same as calling <a href="#server.events.on()"><code data-language="javascript">server.events.on()</code></a> with the <code data-language="javascript">count</code> option set to <code data-language="javascript">1</code>.</p> <p>Return value: a promise that resolves when the event is emitted.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">event</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">const</span> <span class="pl-s1">pending</span> <span class="pl-c1">=</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">once</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">emit</span><span class="pl-kos">(</span><span class="pl-s">'test'</span><span class="pl-kos">,</span> <span class="pl-s">'hello'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">const</span> <span class="pl-s1">update</span> <span class="pl-c1">=</span> <span class="pl-k">await</span> <span class="pl-s1">pending</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div> <h3 id="-await-servereventsgaugecriteria-data">
  <code data-language="javascript">await server.events.gauge(criteria, data)</code> </h3> <p>Behaves identically to <a href="#server.events.emit()"><code data-language="javascript">server.events.emit()</code></a>, but also returns an array of the results of all the event listeners that run. The return value is that of <code data-language="javascript">Promise.allSettled()</code>, where each item in the resulting array is <code data-language="javascript">{ status: 'fulfilled', value }</code> in the case of a successful handler, or <code data-language="javascript">{ status: 'rejected', reason }</code> in the case of a handler that throws.</p> <p>Please note that system errors such as a <code data-language="javascript">TypeError</code> are not handled specially, and it's recommended to scrutinize any rejections using something like <a href="https://hapi.dev/module/bounce/" rel="nofollow">bounce</a>.</p> <h3 id="-serverexposekey-value-options">
  <code data-language="javascript">server.expose(key, value, [options])</code> </h3> <p>Used within a plugin to expose a property via <a href="#server.plugins"><code data-language="javascript">server.plugins[name]</code></a> where:</p> <ul> <li> <code data-language="javascript">key</code> - the key assigned (<a href="#server.plugins"><code data-language="javascript">server.plugins[name][key]</code></a>).</li> <li> <code data-language="javascript">value</code> - the value assigned.</li> <li> <code data-language="javascript">options</code> - optional settings: <ul> <li> <code data-language="javascript">scope</code> - controls how to handle the presence of a plugin scope in the name (e.g. <code data-language="javascript">@hapi/test</code>): <ul> <li> <code data-language="javascript">false</code> - the scope is removed (e.g. <code data-language="javascript">@hapi/test</code> is changed to <code data-language="javascript">test</code> under <code data-language="javascript">server.plugins</code>). This is the default.</li> <li> <code data-language="javascript">true</code> - the scope is retained as-is (e.g. <code data-language="javascript">@hapi/test</code> is used as <code data-language="javascript">server.plugins['@hapi/test']</code>).</li> <li> <code data-language="javascript">'underscore'</code> - the scope is rewritten (e.g. <code data-language="javascript">@hapi/test</code> is used as <code data-language="javascript">server.plugins.hapi__test</code>).</li> </ul> </li> </ul> </li> </ul> <p>Return value: none.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">exports</span><span class="pl-kos">.</span><span class="pl-c1">plugin</span> <span class="pl-c1">=</span>
    <span class="pl-s1">name</span>: <span class="pl-s">'example'</span><span class="pl-kos">,</span>
    <span class="pl-s1">register</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">expose</span><span class="pl-kos">(</span><span class="pl-s">'util'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">'something'</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <h3 id="-serverexposeobj">
  <code data-language="javascript">server.expose(obj)</code> </h3> <p>Merges an object into to the existing content of <a href="#server.plugins"><code data-language="javascript">server.plugins[name]</code></a> where:</p> <ul> <li> <code data-language="javascript">obj</code> - the object merged into the exposed properties container.</li> </ul> <p>Return value: none.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">exports</span><span class="pl-kos">.</span><span class="pl-c1">plugin</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
    <span class="pl-c1">name</span>: <span class="pl-s">'example'</span><span class="pl-kos">,</span>
    <span class="pl-en">register</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">expose</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-en">util</span>: <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">'something'</span><span class="pl-kos">)</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <p>Note that all the properties of <code data-language="javascript">obj</code> are deeply cloned into <a href="#server.plugins"><code data-language="javascript">server.plugins[name]</code></a>, so avoid using this method for exposing large objects that may be expensive to clone or singleton objects such as database client objects. Instead favor <a href="#server.expose()"><code data-language="javascript">server.expose(key, value)</code></a>, which only copies a reference to <code data-language="javascript">value</code>.</p> <h3 id="-serverextevents">
  <code data-language="javascript">server.ext(events)</code> </h3> <p>Registers an extension function in one of the <a href="#request-lifecycle">request lifecycle</a> extension points where:</p> <ul> <li> <p><code data-language="javascript">events</code> - an object or array of objects with the following:</p> <ul> <li> <p><code data-language="javascript">type</code> - (required) the extension point event name. The available extension points include the <a href="#request-lifecycle">request extension points</a> as well as the following server extension points:</p> <ul> <li> <code data-language="javascript">'onPreStart'</code> - called before the connection listeners are started.</li> <li> <code data-language="javascript">'onPostStart'</code> - called after the connection listeners are started.</li> <li> <code data-language="javascript">'onPreStop'</code> - called before the connection listeners are stopped.</li> <li> <code data-language="javascript">'onPostStop'</code> - called after the connection listeners are stopped.</li> </ul> </li> <li> <p><code data-language="javascript">method</code> - (required) a function or an array of functions to be executed at a specified point during request processing. The required extension function signature is:</p> <ul> <li> <p>server extension points: <code data-language="javascript">async function(server)</code> where:</p> <ul> <li> <code data-language="javascript">server</code> - the server object.</li> <li> <code data-language="javascript">this</code> - the object provided via <code data-language="javascript">options.bind</code> or the current active context set with <a href="#server.bind()"><code data-language="javascript">server.bind()</code></a>.</li> </ul> </li> <li> <p>request extension points: a <a href="#lifecycle-methods">lifecycle method</a>.</p> </li> </ul> </li> <li> <p><code data-language="javascript">options</code> - (optional) an object with the following:</p> <ul> <li> <p><code data-language="javascript">before</code> - a string or array of strings of plugin names this method must execute before (on the same event). Otherwise, extension methods are executed in the order added.</p> </li> <li> <p><code data-language="javascript">after</code> - a string or array of strings of plugin names this method must execute after (on the same event). Otherwise, extension methods are executed in the order added.</p> </li> <li> <p><code data-language="javascript">bind</code> - a context object passed back to the provided method (via <code data-language="javascript">this</code>) when called. Ignored if the method is an arrow function.</p> </li> <li> <p><code data-language="javascript">sandbox</code> - if set to <code data-language="javascript">'plugin'</code> when adding a <a href="#request-lifecycle">request extension points</a> the extension is only added to routes defined by the current plugin. Not allowed when configuring route-level extensions, or when adding server extensions. Defaults to <code data-language="javascript">'server'</code> which applies to any route added to the server the extension is added to.</p> </li> <li> <p><code data-language="javascript">timeout</code> - number of milliseconds to wait for the <code data-language="javascript">method</code> to complete before returning a timeout error. Defaults to no timeout.</p> </li> </ul> </li> </ul> </li> </ul> <p>Return value: none.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">ext</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
        <span class="pl-c1">type</span>: <span class="pl-s">'onRequest'</span><span class="pl-kos">,</span>
        <span class="pl-en">method</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

            <span class="pl-c">// Change all requests to '/test'</span>

            <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-en">setUrl</span><span class="pl-kos">(</span><span class="pl-s">'/test'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
            <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-c1">continue</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span> <span class="pl-c1">path</span>: <span class="pl-s">'/test'</span><span class="pl-kos">,</span> <span class="pl-en">handler</span>: <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-s">'ok'</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">await</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">start</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-c">// All requests will get routed to '/test'</span>
<span class="pl-kos">}</span></pre></div> <h3 id="-serverextevent-method-options">
  <code data-language="javascript">server.ext(event, [method, [options]])</code> </h3> <p>Registers a single extension event using the same properties as used in <a href="#server.ext()"><code data-language="javascript">server.ext(events)</code></a>, but passed as arguments.</p> <p>The <code data-language="javascript">method</code> may be omitted (if <code data-language="javascript">options</code> isn't present) or passed <code data-language="javascript">null</code> which will cause the function to return a promise. The promise is resolved with the <code data-language="javascript">request</code> object on the first invocation of the extension point. This is primarily used for writing tests without having to write custom handlers just to handle a single event.</p> <p>Return value: a promise if <code data-language="javascript">method</code> is omitted, otherwise <code data-language="javascript">undefined</code>.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">ext</span><span class="pl-kos">(</span><span class="pl-s">'onRequest'</span><span class="pl-kos">,</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-c">// Change all requests to '/test'</span>

        <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-en">setUrl</span><span class="pl-kos">(</span><span class="pl-s">'/test'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-c1">continue</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span> <span class="pl-c1">path</span>: <span class="pl-s">'/test'</span><span class="pl-kos">,</span> <span class="pl-en">handler</span>: <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-s">'ok'</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">await</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">start</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-c">// All requests will get routed to '/test'</span>
<span class="pl-kos">}</span></pre></div> <h3 id="-await-serverinitialize">
  <code data-language="javascript">await server.initialize()</code> </h3> <p>Initializes the server (starts the caches, finalizes plugin registration) but does not start listening on the connection port.</p> <p>Return value: none.</p> <p>Note that if the method fails and throws an error, the server is considered to be in an undefined state and should be shut down. In most cases it would be impossible to fully recover as the various plugins, caches, and other event listeners will get confused by repeated attempts to start the server or make assumptions about the healthy state of the environment. It is recommended to abort the process when the server fails to start properly. If you must try to resume after an error, call <a href="#server.stop()"><code data-language="javascript">server.stop()</code></a> first to reset the server state.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-v">Hoek</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hoek'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">await</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">initialize</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div> <h3 id="-await-serverinjectoptions">
  <code data-language="javascript">await server.inject(options)</code> </h3> <p>Injects a request into the server simulating an incoming HTTP request without making an actual socket connection. Injection is useful for testing purposes as well as for invoking routing logic internally without the overhead and limitations of the network stack.</p> <p>The method utilizes the <a href="https://hapi.dev/family/shot/api" rel="nofollow"><strong>shot</strong></a> module for performing injections, with some additional options and response properties:</p> <ul> <li> <p><code data-language="javascript">options</code> - can be assigned a string with the requested URI, or an object with:</p> <ul> <li> <p><code data-language="javascript">method</code> - (optional) the request HTTP method (e.g. <code data-language="javascript">'POST'</code>). Defaults to <code data-language="javascript">'GET'</code>.</p> </li> <li> <p><code data-language="javascript">url</code> - (required) the request URL. If the URI includes an authority (e.g. <code data-language="javascript">'example.com:8080'</code>), it is used to automatically set an HTTP 'Host' header, unless one was specified in <code data-language="javascript">headers</code>.</p> </li> <li> <p><code data-language="javascript">authority</code> - (optional) a string specifying the HTTP 'Host' header value. Only used if 'Host' is not specified in <code data-language="javascript">headers</code> and the <code data-language="javascript">url</code> does not include an authority component. Default is inferred from runtime server information.</p> </li> <li> <p><code data-language="javascript">headers</code> - (optional) an object with optional request headers where each key is the header name and the value is the header content. Defaults to no additions to the default <strong>shot</strong> headers.</p> </li> <li> <p><code data-language="javascript">payload</code> - (optional) an string, buffer or object containing the request payload. In case of an object it will be converted to a string for you. Defaults to no payload. Note that payload processing defaults to <code data-language="javascript">'application/json'</code> if no 'Content-Type' header provided.</p> </li> <li> <p><code data-language="javascript">auth</code> - (optional) an object containing parsed authentication credentials where:</p> <ul> <li> <p><code data-language="javascript">strategy</code> - (required) the authentication strategy name matching the provided credentials.</p> </li> <li> <p><code data-language="javascript">credentials</code> - (required) a credentials object containing authentication information. The <code data-language="javascript">credentials</code> are used to bypass the default authentication strategies, and are validated directly as if they were received via an authentication scheme.</p> </li> <li> <p><code data-language="javascript">artifacts</code> - (optional) an artifacts object containing authentication artifact information. The <code data-language="javascript">artifacts</code> are used to bypass the default authentication strategies, and are validated directly as if they were received via an authentication scheme. Defaults to no artifacts.</p> </li> <li> <p><code data-language="javascript">payload</code> - (optional) disables payload authentication when set to false. Only required when an authentication strategy requires payload authentication. Defaults to <code data-language="javascript">true</code>.</p> </li> </ul> </li> <li> <p><code data-language="javascript">app</code> - (optional) sets the initial value of <code data-language="javascript">request.app</code>, defaults to <code data-language="javascript">{}</code>.</p> </li> <li> <p><code data-language="javascript">plugins</code> - (optional) sets the initial value of <code data-language="javascript">request.plugins</code>, defaults to <code data-language="javascript">{}</code>.</p> </li> <li> <p><code data-language="javascript">allowInternals</code> - (optional) allows access to routes with <code data-language="javascript">options.isInternal</code> set to <code data-language="javascript">true</code>. Defaults to <code data-language="javascript">false</code>.</p> </li> <li> <p><code data-language="javascript">remoteAddress</code> - (optional) sets the remote address for the incoming connection.</p> </li> <li> <p><code data-language="javascript">simulate</code> - (optional) an object with options used to simulate client request stream conditions for testing:</p> <ul> <li> <p><code data-language="javascript">error</code> - if <code data-language="javascript">true</code>, emits an <code data-language="javascript">'error'</code> event after payload transmission (if any). Defaults to <code data-language="javascript">false</code>.</p> </li> <li> <p><code data-language="javascript">close</code> - if <code data-language="javascript">true</code>, emits a <code data-language="javascript">'close'</code> event after payload transmission (if any). Defaults to <code data-language="javascript">false</code>.</p> </li> <li> <p><code data-language="javascript">end</code> - if <code data-language="javascript">false</code>, does not end the stream. Defaults to <code data-language="javascript">true</code>.</p> </li> <li> <p><code data-language="javascript">split</code> - indicates whether the request payload will be split into chunks. Defaults to <code data-language="javascript">undefined</code>, meaning payload will not be chunked.</p> </li> </ul> </li> <li> <p><code data-language="javascript">validate</code> - (optional) if <code data-language="javascript">false</code>, the <code data-language="javascript">options</code> inputs are not validated. This is recommended for run-time usage of <code data-language="javascript">inject()</code> to make it perform faster where input validation can be tested separately.</p> </li> </ul> </li> </ul> <p>Return value: a response object with the following properties:</p> <ul> <li> <p><code data-language="javascript">statusCode</code> - the HTTP status code.</p> </li> <li> <p><code data-language="javascript">headers</code> - an object containing the headers set.</p> </li> <li> <p><code data-language="javascript">payload</code> - the response payload string.</p> </li> <li> <p><code data-language="javascript">rawPayload</code> - the raw response payload buffer.</p> </li> <li> <p><code data-language="javascript">raw</code> - an object with the injection request and response objects:</p> <ul> <li> <code data-language="javascript">req</code> - the simulated node request object.</li> <li> <code data-language="javascript">res</code> - the simulated node response object.</li> </ul> </li> <li> <p><code data-language="javascript">result</code> - the raw handler response (e.g. when not a stream or a view) before it is serialized for transmission. If not available, the value is set to <code data-language="javascript">payload</code>. Useful for inspection and reuse of the internal objects returned (instead of parsing the response string).</p> </li> <li> <p><code data-language="javascript">request</code> - the <a href="#request">request object</a>.</p> </li> </ul> <p>Throws a Boom error if the request processing fails. The partial response object is exposed on the <code data-language="javascript">data</code> property.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span> <span class="pl-c1">path</span>: <span class="pl-s">'/'</span><span class="pl-kos">,</span> <span class="pl-en">handler</span>: <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-s">'Success!'</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-k">const</span> <span class="pl-s1">res</span> <span class="pl-c1">=</span> <span class="pl-k">await</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">inject</span><span class="pl-kos">(</span><span class="pl-s">'/'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">res</span><span class="pl-kos">.</span><span class="pl-c1">result</span><span class="pl-kos">)</span><span class="pl-kos">;</span>                <span class="pl-c">// 'Success!'</span>
<span class="pl-kos">}</span></pre></div> <h3 id="-serverlogtags-data-timestamp">
  <code data-language="javascript">server.log(tags, [data, [timestamp]])</code> </h3> <p>Logs server events that cannot be associated with a specific request. When called the server emits a <code data-language="javascript">'log'</code> event which can be used by other listeners or <a href="#plugins">plugins</a> to record the information or output to the console. The arguments are:</p> <ul> <li> <p><code data-language="javascript">tags</code> - (required) a string or an array of strings (e.g. <code data-language="javascript">['error', 'database', 'read']</code>) used to identify the event. Tags are used instead of log levels and provide a much more expressive mechanism for describing and filtering events. Any logs generated by the server internally include the <code data-language="javascript">'hapi'</code> tag along with event-specific information.</p> </li> <li> <p><code data-language="javascript">data</code> - (optional) an message string or object with the application data being logged. If <code data-language="javascript">data</code> is a function, the function signature is <code data-language="javascript">function()</code> and it called once to generate (return value) the actual data emitted to the listeners. If no listeners match the event, the <code data-language="javascript">data</code> function is not invoked.</p> </li> <li> <p><code data-language="javascript">timestamp</code> - (optional) an timestamp expressed in milliseconds. Defaults to <code data-language="javascript">Date.now()</code> (now).</p> </li> </ul> <p>Return value: none.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s">'log'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">event</span><span class="pl-kos">,</span> <span class="pl-s1">tags</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">tags</span><span class="pl-kos">.</span><span class="pl-c1">error</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">event</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-kos">[</span><span class="pl-s">'test'</span><span class="pl-kos">,</span> <span class="pl-s">'error'</span><span class="pl-kos">]</span><span class="pl-kos">,</span> <span class="pl-s">'Test event'</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-serverlookupid">
  <code data-language="javascript">server.lookup(id)</code> </h3> <p>Looks up a route configuration where:</p> <ul> <li> <code data-language="javascript">id</code> - the <a href="#route.options.id">route identifier</a>.</li> </ul> <p>Return value: the <a href="#request.route">route information</a> if found, otherwise <code data-language="javascript">null</code>.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/'</span><span class="pl-kos">,</span>
    <span class="pl-c1">options</span>: <span class="pl-kos">{</span>
        <span class="pl-c1">id</span>: <span class="pl-s">'root'</span><span class="pl-kos">,</span>
        <span class="pl-en">handler</span>: <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-s">'ok'</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">route</span> <span class="pl-c1">=</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">lookup</span><span class="pl-kos">(</span><span class="pl-s">'root'</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-servermatchmethod-path-host">
  <code data-language="javascript">server.match(method, path, [host])</code> </h3> <p>Looks up a route configuration where:</p> <ul> <li> <code data-language="javascript">method</code> - the HTTP method (e.g. 'GET', 'POST').</li> <li> <code data-language="javascript">path</code> - the requested path (must begin with '/').</li> <li> <code data-language="javascript">host</code> - (optional) hostname (to match against routes with <code data-language="javascript">vhost</code>).</li> </ul> <p>Return value: the <a href="#request.route">route information</a> if found, otherwise <code data-language="javascript">null</code>.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/'</span><span class="pl-kos">,</span>
    <span class="pl-c1">options</span>: <span class="pl-kos">{</span>
        <span class="pl-c1">id</span>: <span class="pl-s">'root'</span><span class="pl-kos">,</span>
        <span class="pl-en">handler</span>: <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-s">'ok'</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">route</span> <span class="pl-c1">=</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">match</span><span class="pl-kos">(</span><span class="pl-s">'get'</span><span class="pl-kos">,</span> <span class="pl-s">'/'</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-servermethodname-method-options">
  <code data-language="javascript">server.method(name, method, [options])</code> </h3> <p>Registers a <a href="#server.methods">server method</a> where:</p> <ul> <li> <p><code data-language="javascript">name</code> - a unique method name used to invoke the method via <a href="#server.method"><code data-language="javascript">server.methods[name]</code></a>.</p> </li> <li> <p><code data-language="javascript">method</code> - the method function with a signature <code data-language="javascript">async function(...args, [flags])</code> where:</p> <ul> <li> <code data-language="javascript">...args</code> - the method function arguments (can be any number of arguments or none).</li> <li> <code data-language="javascript">flags</code> - when caching is enabled, an object used to set optional method result flags. This parameter is provided automatically and can only be accessed/modified within the method function. It cannot be passed as an argument. <ul> <li> <code data-language="javascript">ttl</code> - <code data-language="javascript">0</code> if result is valid but cannot be cached. Defaults to cache policy.</li> </ul> </li> </ul> </li> <li> <p><code data-language="javascript">options</code> - (optional) configuration object:</p> <ul> <li> <p><code data-language="javascript">bind</code> - a context object passed back to the method function (via <code data-language="javascript">this</code>) when called. Defaults to active context (set via <a href="#server.bind()"><code data-language="javascript">server.bind()</code></a> when the method is registered. Ignored if the method is an arrow function.</p> </li> <li> <p><code data-language="javascript">cache</code> - the same cache configuration used in <a href="#server.cache()"><code data-language="javascript">server.cache()</code></a>. The <code data-language="javascript">generateTimeout</code> option is required, and the <code data-language="javascript">generateFunc</code> options is not allowed.</p> </li> <li> <p><code data-language="javascript">generateKey</code> - a function used to generate a unique key (for caching) from the arguments passed to the method function (the <code data-language="javascript">flags</code> argument is not passed as input). The server will automatically generate a unique key if the function's arguments are all of types <code data-language="javascript">'string'</code>, <code data-language="javascript">'number'</code>, or <code data-language="javascript">'boolean'</code>. However if the method uses other types of arguments, a key generation function must be provided which takes the same arguments as the function and returns a unique string (or <code data-language="javascript">null</code> if no key can be generated).</p> </li> </ul> </li> </ul> <p>Return value: none.</p> <p>Method names can be nested (e.g. <code data-language="javascript">utils.users.get</code>) which will automatically create the full path under <a href="#server.methods"><code data-language="javascript">server.methods</code></a> (e.g. accessed via <code data-language="javascript">server.methods.utils.users.get</code>).</p> <p>When configured with caching enabled, <code data-language="javascript">server.methods[name].cache</code> is assigned an object with the following properties and methods: - <code data-language="javascript">await drop(...args)</code> - a function that can be used to clear the cache for a given key. - <code data-language="javascript">stats</code> - an object with cache statistics, see <strong>catbox</strong> for stats documentation.</p> <p>Simple arguments example:</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-k">const</span> <span class="pl-en">add</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-s1">a</span><span class="pl-kos">,</span> <span class="pl-s1">b</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">(</span><span class="pl-s1">a</span> <span class="pl-c1">+</span> <span class="pl-s1">b</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">method</span><span class="pl-kos">(</span><span class="pl-s">'sum'</span><span class="pl-kos">,</span> <span class="pl-en">add</span><span class="pl-kos">,</span> <span class="pl-kos">{</span> <span class="pl-c1">cache</span>: <span class="pl-kos">{</span> <span class="pl-c1">expiresIn</span>: <span class="pl-c1">2000</span><span class="pl-kos">,</span> <span class="pl-c1">generateTimeout</span>: <span class="pl-c1">100</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-k">await</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">methods</span><span class="pl-kos">.</span><span class="pl-en">sum</span><span class="pl-kos">(</span><span class="pl-c1">4</span><span class="pl-kos">,</span> <span class="pl-c1">5</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span>          <span class="pl-c">// 9</span>
<span class="pl-kos">}</span></pre></div> <p>Object argument example:</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-k">const</span> <span class="pl-en">addArray</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">array</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-k">let</span> <span class="pl-s1">sum</span> <span class="pl-c1">=</span> <span class="pl-c1">0</span><span class="pl-kos">;</span>
        <span class="pl-s1">array</span><span class="pl-kos">.</span><span class="pl-en">forEach</span><span class="pl-kos">(</span><span class="pl-kos">(</span><span class="pl-s1">item</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

            <span class="pl-s1">sum</span> <span class="pl-c1">+=</span> <span class="pl-s1">item</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

        <span class="pl-k">return</span> <span class="pl-s1">sum</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span><span class="pl-kos">;</span>

    <span class="pl-k">const</span> <span class="pl-s1">options</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
        <span class="pl-c1">cache</span>: <span class="pl-kos">{</span> <span class="pl-c1">expiresIn</span>: <span class="pl-c1">2000</span><span class="pl-kos">,</span> <span class="pl-c1">generateTimeout</span>: <span class="pl-c1">100</span> <span class="pl-kos">}</span><span class="pl-kos">,</span>
        <span class="pl-en">generateKey</span>: <span class="pl-kos">(</span><span class="pl-s1">array</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-s1">array</span><span class="pl-kos">.</span><span class="pl-en">join</span><span class="pl-kos">(</span><span class="pl-s">','</span><span class="pl-kos">)</span>
    <span class="pl-kos">}</span><span class="pl-kos">;</span>

    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">method</span><span class="pl-kos">(</span><span class="pl-s">'sumObj'</span><span class="pl-kos">,</span> <span class="pl-en">addArray</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-k">await</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">methods</span><span class="pl-kos">.</span><span class="pl-en">sumObj</span><span class="pl-kos">(</span><span class="pl-kos">[</span><span class="pl-c1">5</span><span class="pl-kos">,</span> <span class="pl-c1">6</span><span class="pl-kos">]</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span>     <span class="pl-c">// 11</span>
<span class="pl-kos">}</span></pre></div> <h3 id="-servermethodmethods">
  <code data-language="javascript">server.method(methods)</code> </h3> <p>Registers a server method function as described in <a href="#server.method()"><code data-language="javascript">server.method()</code></a> using a configuration object where:</p> <ul> <li> <p><code data-language="javascript">methods</code> - an object or an array of objects where each one contains:</p> <ul> <li> <code data-language="javascript">name</code> - the method name.</li> <li> <code data-language="javascript">method</code> - the method function.</li> <li> <code data-language="javascript">options</code> - (optional) settings.</li> </ul> </li> </ul> <p>Return value: none.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-en">add</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">a</span><span class="pl-kos">,</span> <span class="pl-s1">b</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-s1">a</span> <span class="pl-c1">+</span> <span class="pl-s1">b</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">method</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">name</span>: <span class="pl-s">'sum'</span><span class="pl-kos">,</span>
    <span class="pl-c1">method</span>: <span class="pl-en">add</span><span class="pl-kos">,</span>
    <span class="pl-c1">options</span>: <span class="pl-kos">{</span>
        <span class="pl-c1">cache</span>: <span class="pl-kos">{</span>
            <span class="pl-c1">expiresIn</span>: <span class="pl-c1">2000</span><span class="pl-kos">,</span>
            <span class="pl-c1">generateTimeout</span>: <span class="pl-c1">100</span>
        <span class="pl-kos">}</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-serverpathrelativeto">
  <code data-language="javascript">server.path(relativeTo)</code> </h3> <p>Sets the path prefix used to locate static resources (files and view templates) when relative paths are used where:</p> <ul> <li> <code data-language="javascript">relativeTo</code> - the path prefix added to any relative file path starting with <code data-language="javascript">'.'</code>.</li> </ul> <p>Return value: none.</p> <p>Note that setting a path within a plugin only applies to resources accessed by plugin methods. If no path is set, the server default <a href="#server.options.routes">route configuration</a> <a href="#route.options.files"><code data-language="javascript">files.relativeTo</code></a> settings is used. The path only applies to routes added after it has been set.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">exports</span><span class="pl-kos">.</span><span class="pl-c1">plugin</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
    <span class="pl-c1">name</span>: <span class="pl-s">'example'</span><span class="pl-kos">,</span>
    <span class="pl-en">register</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-c">// Assuming the Inert plugin was registered previously</span>

        <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">path</span><span class="pl-kos">(</span><span class="pl-s1">__dirname</span> <span class="pl-c1">+</span> <span class="pl-s">'../static'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
        <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">path</span>: <span class="pl-s">'/file'</span><span class="pl-kos">,</span> <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span> <span class="pl-c1">handler</span>: <span class="pl-kos">{</span> <span class="pl-c1">file</span>: <span class="pl-s">'./test.html'</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <h3 id="-await-serverregisterplugins-options">
  <code data-language="javascript">await server.register(plugins, [options])</code> </h3> <p>Registers a plugin where:</p> <ul> <li> <p><code data-language="javascript">plugins</code> - one or an array of:</p> <ul> <li> <p>a <a href="#plugins">plugin object</a>.</p> </li> <li> <p>an object with the following:</p> <ul> <li> <code data-language="javascript">plugin</code> - a <a href="#plugins">plugin object</a>.</li> <li> <code data-language="javascript">options</code> - (optional) options passed to the plugin during registration.</li> <li> <code data-language="javascript">once</code>, <code data-language="javascript">routes</code> - (optional) plugin-specific registration options as defined below.</li> </ul> </li> </ul> </li> <li> <p><code data-language="javascript">options</code> - (optional) registration options (different from the options passed to the registration function):</p> <ul> <li> <p><code data-language="javascript">once</code> - if <code data-language="javascript">true</code>, subsequent registrations of the same plugin are skipped without error. Cannot be used with plugin options. Defaults to <code data-language="javascript">false</code>. If not set to <code data-language="javascript">true</code>, an error will be thrown the second time a plugin is registered on the server.</p> </li> <li> <p><code data-language="javascript">routes</code> - modifiers applied to each route added by the plugin:</p> <ul> <li> <code data-language="javascript">prefix</code> - string added as prefix to any route path (must begin with <code data-language="javascript">'/'</code>). If a plugin registers a child plugin the <code data-language="javascript">prefix</code> is passed on to the child or is added in front of the child-specific prefix.</li> <li> <code data-language="javascript">vhost</code> - virtual host string (or array of strings) applied to every route. The outer-most <code data-language="javascript">vhost</code> overrides the any nested configuration.</li> </ul> </li> </ul> </li> </ul> <p>Return value: a reference to the <code data-language="javascript">server</code>.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">await</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">register</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">plugin</span>: <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'plugin_name'</span><span class="pl-kos">)</span><span class="pl-kos">,</span> <span class="pl-c1">options</span>: <span class="pl-kos">{</span> <span class="pl-c1">message</span>: <span class="pl-s">'hello'</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div> <h3 id="-serverrouteroute">
  <code data-language="javascript">server.route(route)</code> </h3> <p>Adds a route where:</p> <ul> <li> <p><code data-language="javascript">route</code> - a route configuration object or an array of configuration objects where each object contains:</p> <ul> <li> <p><code data-language="javascript">path</code> - (required) the absolute path used to match incoming requests (must begin with '/'). Incoming requests are compared to the configured paths based on the server's <a href="#server.options.router"><code data-language="javascript">router</code></a> configuration. The path can include named parameters enclosed in <code data-language="javascript">{}</code> which will be matched against literal values in the request as described in <a href="#path-parameters">Path parameters</a>.</p> </li> <li> <p><code data-language="javascript">method</code> - (required) the HTTP method. Typically one of 'GET', 'POST', 'PUT', 'PATCH', 'DELETE', or 'OPTIONS'. Any HTTP method is allowed, except for 'HEAD'. Use <code data-language="javascript">'*'</code> to match against any HTTP method (only when an exact match was not found, and any match with a specific method will be given a higher priority over a wildcard match). Can be assigned an array of methods which has the same result as adding the same route with different methods manually.</p> </li> <li> <p><code data-language="javascript">vhost</code> - (optional) a domain string or an array of domain strings for limiting the route to only requests with a matching host header field. Matching is done against the hostname part of the header only (excluding the port). Defaults to all hosts.</p> </li> <li> <p><code data-language="javascript">handler</code> - (required when <a href="#route.options.handler"><code data-language="javascript">handler</code></a> is not set) the route handler function called to generate the response after successful authentication and validation.</p> </li> <li> <p><code data-language="javascript">options</code> - additional <a href="#route-options">route options</a>. The <code data-language="javascript">options</code> value can be an object or a function that returns an object using the signature <code data-language="javascript">function(server)</code> where <code data-language="javascript">server</code> is the server the route is being added to and <code data-language="javascript">this</code> is bound to the current <a href="#server.realm">realm</a>'s <code data-language="javascript">bind</code> option.</p> </li> <li> <p><code data-language="javascript">rules</code> - route custom rules object. The object is passed to each rules processor registered with <a href="#server.rules()"><code data-language="javascript">server.rules()</code></a>. Cannot be used if <a href="#route.options.rules"><code data-language="javascript">route.options.rules</code></a> is defined.</p> </li> </ul> </li> </ul> <p>Return value: none.</p> <p>Note that the <code data-language="javascript">options</code> object is deeply cloned (with the exception of <code data-language="javascript">bind</code> which is shallowly copied) and cannot contain any values that are unsafe to perform deep copy on.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-c">// Handler in top level</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span> <span class="pl-c1">path</span>: <span class="pl-s">'/status'</span><span class="pl-kos">,</span> <span class="pl-en">handler</span>: <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-s">'ok'</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-c">// Handler in config</span>

<span class="pl-k">const</span> <span class="pl-s1">user</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
    <span class="pl-c1">cache</span>: <span class="pl-kos">{</span> <span class="pl-c1">expiresIn</span>: <span class="pl-c1">5000</span> <span class="pl-kos">}</span><span class="pl-kos">,</span>
    <span class="pl-en">handler</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-k">return</span> <span class="pl-kos">{</span> <span class="pl-c1">name</span>: <span class="pl-s">'John'</span> <span class="pl-kos">}</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span> <span class="pl-c1">path</span>: <span class="pl-s">'/user'</span><span class="pl-kos">,</span> <span class="pl-c1">options</span>: <span class="pl-s1">user</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-c">// An array of routes</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">[</span>
    <span class="pl-kos">{</span> <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span> <span class="pl-c1">path</span>: <span class="pl-s">'/1'</span><span class="pl-kos">,</span> <span class="pl-en">handler</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span> <span class="pl-k">return</span> <span class="pl-s">'ok'</span><span class="pl-kos">;</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span><span class="pl-kos">,</span>
    <span class="pl-kos">{</span> <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span> <span class="pl-c1">path</span>: <span class="pl-s">'/2'</span><span class="pl-kos">,</span> <span class="pl-en">handler</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span> <span class="pl-k">return</span> <span class="pl-s">'ok'</span><span class="pl-kos">;</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span>
<span class="pl-kos">]</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h4 id="path-parameters">
Path parameters</h4> <p>Parameterized paths are processed by matching the named parameters to the content of the incoming request path at that path segment. For example, <code data-language="javascript">'/book/{id}/cover'</code> will match <code data-language="javascript">'/book/123/cover'</code> and <code data-language="javascript">request.params.id</code> will be set to <code data-language="javascript">'123'</code>. Each path segment (everything between the opening <code data-language="javascript">'/'</code> and the closing <code data-language="javascript">'/'</code> unless it is the end of the path) can only include one named parameter. A parameter can cover the entire segment (<code data-language="javascript">'/{param}'</code>) or part of the segment (<code data-language="javascript">'/file.{ext}'</code>). A path parameter may only contain letters, numbers and underscores, e.g. <code data-language="javascript">'/{file-name}'</code> is invalid and <code data-language="javascript">'/{file_name}'</code> is valid.</p> <p>An optional <code data-language="javascript">'?'</code> suffix following the parameter name indicates an optional parameter (only allowed if the parameter is at the ends of the path or only covers part of the segment as in <code data-language="javascript">'/a{param?}/b'</code>). For example, the route <code data-language="javascript">'/book/{id?}'</code> matches <code data-language="javascript">'/book/'</code> with the value of <code data-language="javascript">request.params.id</code> set to an empty string <code data-language="javascript">''</code>.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">getAlbum</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-s">'You asked for '</span> <span class="pl-c1">+</span>
        <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">params</span><span class="pl-kos">.</span><span class="pl-c1">song</span> ? <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">params</span><span class="pl-kos">.</span><span class="pl-c1">song</span> <span class="pl-c1">+</span> <span class="pl-s">' from '</span> : <span class="pl-s">''</span><span class="pl-kos">)</span> <span class="pl-c1">+</span>
        <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">params</span><span class="pl-kos">.</span><span class="pl-c1">album</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/{album}/{song?}'</span><span class="pl-kos">,</span>
    <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
    <span class="pl-c1">handler</span>: <span class="pl-en">getAlbum</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <p>In addition to the optional <code data-language="javascript">?</code> suffix, a parameter name can also specify the number of matching segments using the <code data-language="javascript">*</code> suffix, followed by a number greater than 1. If the number of expected parts can be anything, then use <code data-language="javascript">*</code> without a number (matching any number of segments can only be used in the last path segment).</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">getPerson</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">nameParts</span> <span class="pl-c1">=</span> <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">params</span><span class="pl-kos">.</span><span class="pl-c1">name</span><span class="pl-kos">.</span><span class="pl-en">split</span><span class="pl-kos">(</span><span class="pl-s">'/'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">return</span> <span class="pl-kos">{</span> <span class="pl-c1">first</span>: <span class="pl-s1">nameParts</span><span class="pl-kos">[</span><span class="pl-c1">0</span><span class="pl-kos">]</span><span class="pl-kos">,</span> <span class="pl-c1">last</span>: <span class="pl-s1">nameParts</span><span class="pl-kos">[</span><span class="pl-c1">1</span><span class="pl-kos">]</span> <span class="pl-kos">}</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/person/{name*2}'</span><span class="pl-kos">,</span>   <span class="pl-c">// Matches '/person/john/doe'</span>
    <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
    <span class="pl-c1">handler</span>: <span class="pl-en">getPerson</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h4 id="path-matching-order">
Path matching order</h4> <p>The router iterates through the routing table on each incoming request and executes the first (and only the first) matching route. Route matching is done based on the combination of the request path and the HTTP verb (e.g. 'GET, 'POST'). The query is excluded from the routing logic. Requests are matched in a deterministic order where the order in which routes are added does not matter.</p> <p>Routes are matched based on the specificity of the route which is evaluated at each segment of the incoming request path. Each request path is split into its segment (the parts separated by <code data-language="javascript">'/'</code>). The segments are compared to the routing table one at a time and are matched against the most specific path until a match is found. If no match is found, the next match is tried.</p> <p>When matching routes, string literals (no path parameter) have the highest priority, followed by mixed parameters (<code data-language="javascript">'/a{p}b'</code>), parameters (<code data-language="javascript">'/{p}'</code>), and then wildcard (<code data-language="javascript">/{p*}</code>).</p> <p>Note that mixed parameters are slower to compare as they cannot be hashed and require an array iteration over all the regular expressions representing the various mixed parameter at each routing table node.</p> <h4 id="catch-all-route">
Catch all route</h4> <p>If the application needs to override the default Not Found (404) error response, it can add a catch-all route for a specific method or all methods. Only one catch-all route can be defined.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">handler</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-en">response</span><span class="pl-kos">(</span><span class="pl-s">'The page was not found'</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">code</span><span class="pl-kos">(</span><span class="pl-c1">404</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">method</span>: <span class="pl-s">'*'</span><span class="pl-kos">,</span> <span class="pl-c1">path</span>: <span class="pl-s">'/{p*}'</span><span class="pl-kos">,</span> handler <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-serverrulesprocessor-options">
  <code data-language="javascript">server.rules(processor, [options])</code> </h3> <p>Defines a route rules processor for converting route rules object into route configuration where:</p> <ul> <li> <p><code data-language="javascript">processor</code> - a function using the signature <code data-language="javascript">function(rules, info)</code> where:</p> <ul> <li> <code data-language="javascript">rules</code> - the <a href="#route.options.rules">custom object</a> defined in your routes configuration for you to use its values.</li> <li> <code data-language="javascript">info</code> - an object with the following properties: <ul> <li> <code data-language="javascript">method</code> - the route method.</li> <li> <code data-language="javascript">path</code> - the route path.</li> <li> <code data-language="javascript">vhost</code> - the route virtual host (if any defined).</li> </ul> </li> <li>returns a route config object.</li> </ul> </li> <li> <p><code data-language="javascript">options</code> - optional settings:</p> <ul> <li> <code data-language="javascript">validate</code> - rules object validation: <ul> <li> <code data-language="javascript">schema</code> - <strong>joi</strong> schema.</li> <li> <code data-language="javascript">options</code> - optional <strong>joi</strong> validation options. Defaults to <code data-language="javascript">{ allowUnknown: true }</code>.</li> </ul> </li> </ul> </li> </ul> <p>Note that the root server and each plugin server instance can only register one rules processor. If a route is added after the rules are configured, it will not include the rules config. Routes added by plugins apply the rules to each of the parent realms' rules from the root to the route's realm. This means the processor defined by the plugin overrides the config generated by the root processor if they overlap. Similarly, the route's own config overrides the config produced by the rules processors.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-s1">validateSchema</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
    <span class="pl-c1">auth</span>: <span class="pl-v">Joi</span><span class="pl-kos">.</span><span class="pl-en">string</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
    <span class="pl-c1">myCustomPre</span>: <span class="pl-v">Joi</span><span class="pl-kos">.</span><span class="pl-en">array</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">min</span><span class="pl-kos">(</span><span class="pl-c1">2</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">items</span><span class="pl-kos">(</span><span class="pl-v">Joi</span><span class="pl-kos">.</span><span class="pl-en">string</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
    <span class="pl-c1">payload</span>: <span class="pl-v">Joi</span><span class="pl-kos">.</span><span class="pl-en">object</span><span class="pl-kos">(</span><span class="pl-kos">)</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">myPreHelper</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-s1">name</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-kos">{</span>
        <span class="pl-en">method</span>: <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

            <span class="pl-k">return</span> <span class="pl-s">`hello <span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">name</span> <span class="pl-c1">||</span> <span class="pl-s">'world'</span><span class="pl-kos">}</span></span>!`</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span><span class="pl-kos">,</span>
        <span class="pl-c1">assign</span>: <span class="pl-s">'myPreHelper'</span>
    <span class="pl-kos">}</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">processor</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-s1">rules</span><span class="pl-kos">,</span> <span class="pl-s1">info</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-s1">rules</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-k">return</span> <span class="pl-c1">null</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>

    <span class="pl-k">const</span> <span class="pl-s1">options</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span><span class="pl-kos">}</span><span class="pl-kos">;</span>

    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">rules</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-s1">options</span><span class="pl-kos">.</span><span class="pl-c1">auth</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
            <span class="pl-c1">strategy</span>: <span class="pl-s1">rules</span><span class="pl-kos">.</span><span class="pl-c1">auth</span><span class="pl-kos">,</span>
            <span class="pl-c1">validate</span>: <span class="pl-kos">{</span>
                <span class="pl-c1">entity</span>: <span class="pl-s">'user'</span>
            <span class="pl-kos">}</span>
        <span class="pl-kos">}</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>

    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">rules</span><span class="pl-kos">.</span><span class="pl-c1">myCustomPre</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-s1">options</span><span class="pl-kos">.</span><span class="pl-c1">pre</span> <span class="pl-c1">=</span> <span class="pl-kos">[</span>
            <span class="pl-en">myPreHelper</span><span class="pl-kos">(</span>...<span class="pl-s1">rules</span><span class="pl-kos">.</span><span class="pl-c1">myCustomPre</span><span class="pl-kos">)</span>
        <span class="pl-kos">]</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>

    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">rules</span><span class="pl-kos">.</span><span class="pl-c1">payload</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-s1">options</span><span class="pl-kos">.</span><span class="pl-c1">validate</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span> <span class="pl-c1">payload</span>: <span class="pl-v">Joi</span><span class="pl-kos">.</span><span class="pl-en">object</span><span class="pl-kos">(</span><span class="pl-s1">rules</span><span class="pl-kos">.</span><span class="pl-c1">payload</span><span class="pl-kos">)</span> <span class="pl-kos">}</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>

    <span class="pl-k">return</span> <span class="pl-s1">options</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">rules</span><span class="pl-kos">(</span><span class="pl-en">processor</span><span class="pl-kos">,</span> <span class="pl-kos">{</span>
    <span class="pl-c1">validate</span>: <span class="pl-kos">{</span> <span class="pl-c1">schema</span>: <span class="pl-s1">validateSchema</span> <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/'</span><span class="pl-kos">,</span>
    <span class="pl-c1">rules</span>: <span class="pl-kos">{</span>
        <span class="pl-c1">auth</span>: <span class="pl-s">'jwt'</span><span class="pl-kos">,</span>
        <span class="pl-c1">myCustomPre</span>: <span class="pl-kos">[</span><span class="pl-s">'arg1'</span><span class="pl-kos">,</span> <span class="pl-s">'arg2'</span><span class="pl-kos">]</span><span class="pl-kos">,</span>
        <span class="pl-c1">payload</span>: <span class="pl-kos">{</span> <span class="pl-c1">a</span>: <span class="pl-v">Joi</span><span class="pl-kos">.</span><span class="pl-en">boolean</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">,</span> <span class="pl-c1">b</span>: <span class="pl-v">Joi</span><span class="pl-kos">.</span><span class="pl-en">string</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">}</span>
    <span class="pl-kos">}</span><span class="pl-kos">,</span>
    <span class="pl-c1">options</span>: <span class="pl-kos">{</span>
        <span class="pl-c1">id</span>: <span class="pl-s">'my-route'</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-await-serverstart">
  <code data-language="javascript">await server.start()</code> </h3> <p>Starts the server by listening for incoming requests on the configured port (unless the connection was configured with <a href="#server.options.autoListen"><code data-language="javascript">autoListen</code></a> set to <code data-language="javascript">false</code>).</p> <p>Return value: none.</p> <p>Note that if the method fails and throws an error, the server is considered to be in an undefined state and should be shut down. In most cases it would be impossible to fully recover as the various plugins, caches, and other event listeners will get confused by repeated attempts to start the server or make assumptions about the healthy state of the environment. It is recommended to abort the process when the server fails to start properly. If you must try to resume after an error, call <a href="#server.stop()"><code data-language="javascript">server.stop()</code></a> first to reset the server state.</p> <p>If a started server is started again, the second call to <code data-language="javascript">server.start()</code> is ignored. No events will be emitted and no extension points invoked.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">await</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">start</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">'Server started at: '</span> <span class="pl-c1">+</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">info</span><span class="pl-kos">.</span><span class="pl-c1">uri</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div> <h3 id="-serverstatename-options">
  <code data-language="javascript">server.state(name, [options])</code> </h3> <p><a href="https://tools.ietf.org/html/rfc6265" rel="nofollow">HTTP state management</a> uses client cookies to persist a state across multiple requests. Registers a cookie definitions where:</p> <ul> <li> <p><code data-language="javascript">name</code> - the cookie name string.</p> </li> <li> <p><code data-language="javascript">options</code> - are the optional cookie settings:</p> <ul> <li> <p><code data-language="javascript">ttl</code> - time-to-live in milliseconds. Defaults to <code data-language="javascript">null</code> (session time-life - cookies are deleted when the browser is closed).</p> </li> <li> <p><code data-language="javascript">isSecure</code> - sets the 'Secure' flag. Defaults to <code data-language="javascript">true</code>.</p> </li> <li> <p><code data-language="javascript">isHttpOnly</code> - sets the 'HttpOnly' flag. Defaults to <code data-language="javascript">true</code>.</p> </li> <li> <p><code data-language="javascript">isSameSite</code> - sets the <a href="https://www.owasp.org/index.php/SameSite" rel="nofollow">'SameSite' flag</a>. The value must be one of:</p> <ul> <li> <code data-language="javascript">false</code> - no flag.</li> <li> <code data-language="javascript">'Strict'</code> - sets the value to <code data-language="javascript">'Strict'</code> (this is the default value).</li> <li> <code data-language="javascript">'Lax'</code> - sets the value to <code data-language="javascript">'Lax'</code>.</li> <li> <code data-language="javascript">'None'</code> - sets the value to <code data-language="javascript">'None'</code>.</li> </ul> </li> <li> <p><code data-language="javascript">path</code> - the path scope. Defaults to <code data-language="javascript">null</code> (no path).</p> </li> <li> <p><code data-language="javascript">domain</code> - the domain scope. Defaults to <code data-language="javascript">null</code> (no domain).</p> </li> <li> <p><code data-language="javascript">autoValue</code> - if present and the cookie was not received from the client or explicitly set by the route handler, the cookie is automatically added to the response with the provided value. The value can be a function with signature <code data-language="javascript">async function(request)</code> where:</p> <ul> <li> <code data-language="javascript">request</code> - the <a href="#request">request object</a>.</li> </ul> </li> <li> <p><code data-language="javascript">encoding</code> - encoding performs on the provided value before serialization. Options are:</p> <ul> <li> <code data-language="javascript">'none'</code> - no encoding. When used, the cookie value must be a string. This is the default value.</li> <li> <code data-language="javascript">'base64'</code> - string value is encoded using Base64.</li> <li> <code data-language="javascript">'base64json'</code> - object value is JSON-stringified then encoded using Base64.</li> <li> <code data-language="javascript">'form'</code> - object value is encoded using the <em>x-www-form-urlencoded</em> method.</li> <li> <code data-language="javascript">'iron'</code> - Encrypts and sign the value using <a href="https://hapi.dev/family/iron/api" rel="nofollow"><strong>iron</strong></a>.</li> </ul> </li> <li> <p><code data-language="javascript">sign</code> - an object used to calculate an HMAC for cookie integrity validation. This does not provide privacy, only a mean to verify that the cookie value was generated by the server. Redundant when <code data-language="javascript">'iron'</code> encoding is used. Options are:</p> <ul> <li> <code data-language="javascript">integrity</code> - algorithm options. Defaults to <a href="https://hapi.dev/family/iron/api/#options" rel="nofollow"><code data-language="javascript">require('iron').defaults.integrity</code></a>.</li> <li> <code data-language="javascript">password</code> - password used for HMAC key generation (must be at least 32 characters long).</li> </ul> </li> <li> <p><code data-language="javascript">password</code> - password used for <code data-language="javascript">'iron'</code> encoding (must be at least 32 characters long).</p> </li> <li> <p><code data-language="javascript">iron</code> - options for <code data-language="javascript">'iron'</code> encoding. Defaults to <a href="https://hapi.dev/family/iron/api/#options" rel="nofollow"><code data-language="javascript">require('iron').defaults</code></a>.</p> </li> <li> <p><code data-language="javascript">ignoreErrors</code> - if <code data-language="javascript">true</code>, errors are ignored and treated as missing cookies.</p> </li> <li> <p><code data-language="javascript">clearInvalid</code> - if <code data-language="javascript">true</code>, automatically instruct the client to remove invalid cookies. Defaults to <code data-language="javascript">false</code>.</p> </li> <li> <p><code data-language="javascript">strictHeader</code> - if <code data-language="javascript">false</code>, allows any cookie value including values in violation of <a href="https://tools.ietf.org/html/rfc6265" rel="nofollow">RFC 6265</a>. Defaults to <code data-language="javascript">true</code>.</p> </li> <li> <p><code data-language="javascript">passThrough</code> - used by proxy plugins (e.g. <a href="https://hapi.dev/family/h2o2/api" rel="nofollow"><strong>h2o2</strong></a>).</p> </li> <li> <p><code data-language="javascript">contextualize</code> - a function using the signature <code data-language="javascript">async function(definition, request)</code> used to override a request-specific cookie settings where:</p> <ul> <li> <code data-language="javascript">definition</code> - a copy of the <code data-language="javascript">options</code> to be used for formatting the cookie that can be manipulated by the function to customize the request cookie header. Note that changing the <code data-language="javascript">definition.contextualize</code> property will be ignored.</li> <li> <code data-language="javascript">request</code> - the current request object.</li> </ul> </li> </ul> </li> </ul> <p>Return value: none.</p> <p>State defaults can be modified via the <a href="#server.options.state">server.options.state</a> configuration option.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-c">// Set cookie definition</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">state</span><span class="pl-kos">(</span><span class="pl-s">'session'</span><span class="pl-kos">,</span> <span class="pl-kos">{</span>
    <span class="pl-c1">ttl</span>: <span class="pl-c1">24</span> <span class="pl-c1">*</span> <span class="pl-c1">60</span> <span class="pl-c1">*</span> <span class="pl-c1">60</span> <span class="pl-c1">*</span> <span class="pl-c1">1000</span><span class="pl-kos">,</span>     <span class="pl-c">// One day</span>
    <span class="pl-c1">isSecure</span>: <span class="pl-c1">true</span><span class="pl-kos">,</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/'</span><span class="pl-kos">,</span>
    <span class="pl-c1">encoding</span>: <span class="pl-s">'base64json'</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-c">// Set state in route handler</span>

<span class="pl-k">const</span> <span class="pl-en">handler</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">let</span> <span class="pl-s1">session</span> <span class="pl-c1">=</span> <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">state</span><span class="pl-kos">.</span><span class="pl-c1">session</span><span class="pl-kos">;</span>
    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-s1">session</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-s1">session</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span> <span class="pl-c1">user</span>: <span class="pl-s">'joe'</span> <span class="pl-kos">}</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>

    <span class="pl-s1">session</span><span class="pl-kos">.</span><span class="pl-c1">last</span> <span class="pl-c1">=</span> <span class="pl-v">Date</span><span class="pl-kos">.</span><span class="pl-en">now</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-en">response</span><span class="pl-kos">(</span><span class="pl-s">'Success'</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">state</span><span class="pl-kos">(</span><span class="pl-s">'session'</span><span class="pl-kos">,</span> <span class="pl-s1">session</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <p>Registered cookies are automatically parsed when received. Parsing rules depends on the route <a href="#route.options.state"><code data-language="javascript">state.parse</code></a> configuration. If an incoming registered cookie fails parsing, it is not included in <a href="#request.state"><code data-language="javascript">request.state</code></a>, regardless of the <a href="#route.options.state.failAction"><code data-language="javascript">state.failAction</code></a> setting. When <a href="#route.options.state.failAction"><code data-language="javascript">state.failAction</code></a> is set to <code data-language="javascript">'log'</code> and an invalid cookie value is received, the server will emit a <a href="#server.events.request"><code data-language="javascript">'request'</code> event</a>. To capture these errors subscribe to the <code data-language="javascript">'request'</code> event on the <code data-language="javascript">'internal'</code> channel and filter on <code data-language="javascript">'error'</code> and <code data-language="javascript">'state'</code> tags:</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">name</span>: <span class="pl-s">'request'</span><span class="pl-kos">,</span> <span class="pl-c1">channels</span>: <span class="pl-s">'internal'</span> <span class="pl-kos">}</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">event</span><span class="pl-kos">,</span> <span class="pl-s1">tags</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">tags</span><span class="pl-kos">.</span><span class="pl-c1">error</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-s1">tags</span><span class="pl-kos">.</span><span class="pl-c1">state</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">error</span><span class="pl-kos">(</span><span class="pl-s1">event</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-serverstatesaddname-options">
  <code data-language="javascript">server.states.add(name, [options])</code> </h3> <p>Access: read only.</p> <p>Same as calling <a href="#server.state()"><code data-language="javascript">server.state()</code></a>.</p> <h3 id="-await-serverstatesformatcookies">
  <code data-language="javascript">await server.states.format(cookies)</code> </h3> <p>Formats an HTTP 'Set-Cookie' header based on the <a href="#server.options.state"><code data-language="javascript">server.options.state</code></a> where:</p> <ul> <li> <code data-language="javascript">cookies</code> - a single object or an array of object where each contains: <ul> <li> <code data-language="javascript">name</code> - the cookie name.</li> <li> <code data-language="javascript">value</code> - the cookie value.</li> <li> <code data-language="javascript">options</code> - cookie configuration to override the server settings.</li> </ul> </li> </ul> <p>Return value: a header string.</p> <p>Note that this utility uses the server configuration but does not change the server state. It is provided for manual cookie formatting (e.g. when headers are set manually).</p> <h3 id="-await-serverstatesparseheader">
  <code data-language="javascript">await server.states.parse(header)</code> </h3> <p>Parses an HTTP 'Cookies' header based on the <a href="#server.options.state"><code data-language="javascript">server.options.state</code></a> where:</p> <ul> <li> <code data-language="javascript">header</code> - the HTTP header.</li> </ul> <p>Return value: an object where each key is a cookie name and value is the parsed cookie.</p> <p>Note that this utility uses the server configuration but does not change the server state. It is provided for manual cookie parsing (e.g. when server parsing is disabled).</p> <h3 id="-await-serverstopoptions">
  <code data-language="javascript">await server.stop([options])</code> </h3> <p>Stops the server's listener by refusing to accept any new connections or requests (existing connections will continue until closed or timeout), where:</p> <ul> <li> <p><code data-language="javascript">options</code> - (optional) object with:</p> <ul> <li> <code data-language="javascript">timeout</code> - sets the timeout in millisecond before forcefully terminating any open connections that arrived before the server stopped accepting new connections. The timeout only applies to waiting for existing connections to close, and not to any <a href="#server.ext.args()"><code data-language="javascript">'onPreStop'</code> or <code data-language="javascript">'onPostStop'</code> server extensions</a> which can delay or block the stop operation indefinitely. Ignored if <a href="#server.options.operations"><code data-language="javascript">server.options.operations.cleanStop</code></a> is <code data-language="javascript">false</code>. Note that if the server is set as a <a href="#server.control()">group controller</a>, the timeout is per controlled server and the controlling server itself. Defaults to <code data-language="javascript">5000</code> (5 seconds).</li> </ul> </li> </ul> <p>Return value: none.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">await</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">start</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">await</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">stop</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">timeout</span>: <span class="pl-c1">60</span> <span class="pl-c1">*</span> <span class="pl-c1">1000</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">'Server stopped'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div> <h3 id="-servertablehost">
  <code data-language="javascript">server.table([host])</code> </h3> <p>Returns a copy of the routing table where:</p> <ul> <li> <code data-language="javascript">host</code> - (optional) host to filter routes matching a specific virtual host. Defaults to all virtual hosts.</li> </ul> <p>Return value: an array of routes where each route contains:</p> <ul> <li> <code data-language="javascript">settings</code> - the route config with defaults applied.</li> <li> <code data-language="javascript">method</code> - the HTTP method in lower case.</li> <li> <code data-language="javascript">path</code> - the route path.</li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span> <span class="pl-c1">path</span>: <span class="pl-s">'/example'</span><span class="pl-kos">,</span> <span class="pl-en">handler</span>: <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-s">'ok'</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">table</span> <span class="pl-c1">=</span> <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">table</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-servervalidatorvalidator">
  <code data-language="javascript">server.validator(validator)</code> </h3> <p>Registers a server validation module used to compile raw validation rules into validation schemas for all routes where:</p> <ul> <li> <code data-language="javascript">validator</code> - the validation module (e.g. <strong>joi</strong>).</li> </ul> <p>Return value: none.</p> <p>Note: the validator is only used when validation rules are not pre-compiled schemas. When a validation rules is a function or schema object, the rule is used as-is and the validator is not used. When setting a validator inside a plugin, the validator is only applied to routes set up by the plugin and plugins registered by it.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-v">Joi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'joi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">async</span> <span class="pl-k">function</span> <span class="pl-en">example</span><span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">validator</span><span class="pl-kos">(</span><span class="pl-v">Joi</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div> <h2>
Route options</h2> <p>Each route can be customized to change the default behavior of the request lifecycle.</p> <h3 id="-routeoptionsapp">
  <code data-language="javascript">route.options.app</code> </h3> <p>Application-specific route configuration state. Should not be used by <a href="#plugins">plugins</a> which should use <code data-language="javascript">options.plugins[name]</code> instead.</p> <h3 id="-routeoptionsauth">
  <code data-language="javascript">route.options.auth</code> </h3> <p>Route authentication configuration. Value can be:</p> <ul> <li> <p><code data-language="javascript">false</code> to disable authentication if a default strategy is set.</p> </li> <li> <p>a string with the name of an authentication strategy registered with <a href="#server.auth.strategy()"><code data-language="javascript">server.auth.strategy()</code></a>. The strategy will be set to <code data-language="javascript">'required'</code> mode.</p> </li> <li> <p>an <a href="#authentication-options">authentication configuration object</a>.</p> </li> </ul> <h4 id="-routeoptionsauthaccess">
  <code data-language="javascript">route.options.auth.access</code> </h4> <p>Default value: none.</p> <p>An object or array of objects specifying the route access rules. Each rule is evaluated against an incoming request and access is granted if at least one of the rules matches. Each rule object must include at least one of <a href="#route.options.auth.access.scope"><code data-language="javascript">scope</code></a> or <a href="#route.options.auth.access.entity"><code data-language="javascript">entity</code></a>.</p> <h4 id="-routeoptionsauthaccessscope">
  <code data-language="javascript">route.options.auth.access.scope</code> </h4> <p>Default value: <code data-language="javascript">false</code> (no scope requirements).</p> <p>The application scope required to access the route. Value can be a scope string or an array of scope strings. When authenticated, the credentials object <code data-language="javascript">scope</code> property must contain at least one of the scopes defined to access the route.</p> <p>If a scope string begins with a <code data-language="javascript">+</code> character, that scope is required. If a scope string begins with a <code data-language="javascript">!</code> character, that scope is forbidden. For example, the scope <code data-language="javascript">['!a', '+b', 'c', 'd']</code> means the incoming request credentials' <code data-language="javascript">scope</code> must not include 'a', must include 'b', and must include one of 'c' or 'd'.</p> <p>You may also access properties on the request object (<code data-language="javascript">query</code>, <code data-language="javascript">params</code>, <code data-language="javascript">payload</code>, and <code data-language="javascript">credentials</code>) to populate a dynamic scope by using the '{' and '}' characters around the property name, such as <code data-language="javascript">'user-{params.id}'</code>.</p> <h4 id="-routeoptionsauthaccessentity">
  <code data-language="javascript">route.options.auth.access.entity</code> </h4> <p>Default value: <code data-language="javascript">'any'</code>.</p> <p>The required authenticated entity type. If set, must match the <code data-language="javascript">entity</code> value of the request authenticated credentials. Available values:</p> <ul> <li> <code data-language="javascript">'any'</code> - the authentication can be on behalf of a user or application.</li> <li> <code data-language="javascript">'user'</code> - the authentication must be on behalf of a user which is identified by the presence of a <code data-language="javascript">'user'</code> attribute in the <code data-language="javascript">credentials</code> object returned by the authentication strategy.</li> <li> <code data-language="javascript">'app'</code> - the authentication must be on behalf of an application which is identified by the lack of presence of a <code data-language="javascript">user</code> attribute in the <code data-language="javascript">credentials</code> object returned by the authentication strategy.</li> </ul> <h4 id="-routeoptionsauthmode">
  <code data-language="javascript">route.options.auth.mode</code> </h4> <p>Default value: <code data-language="javascript">'required'</code>.</p> <p>The authentication mode. Available values:</p> <ul> <li> <code data-language="javascript">'required'</code> - authentication is required.</li> <li> <code data-language="javascript">'optional'</code> - authentication is optional - the request must include valid credentials or no credentials at all.</li> <li> <code data-language="javascript">'try'</code> - similar to <code data-language="javascript">'optional'</code>, any request credentials are attempted authentication, but if the credentials are invalid, the request proceeds regardless of the authentication error.</li> </ul> <h4 id="-routeoptionsauthpayload">
  <code data-language="javascript">route.options.auth.payload</code> </h4> <p>Default value: <code data-language="javascript">false</code>, unless the scheme requires payload authentication.</p> <p>If set, the incoming request payload is authenticated after it is processed. Requires a strategy with payload authentication support (e.g. <a href="https://hapi.dev/family/hawk/api" rel="nofollow">Hawk</a>). Cannot be set to a value other than <code data-language="javascript">'required'</code> when the scheme sets the authentication <code data-language="javascript">options.payload</code> to <code data-language="javascript">true</code>.</p> <p>Available values:</p> <ul> <li> <code data-language="javascript">false</code> - no payload authentication.</li> <li> <code data-language="javascript">'required'</code> - payload authentication required.</li> <li> <code data-language="javascript">'optional'</code> - payload authentication performed only when the client includes payload authentication information (e.g. <code data-language="javascript">hash</code> attribute in Hawk).</li> </ul> <h4 id="-routeoptionsauthstrategies">
  <code data-language="javascript">route.options.auth.strategies</code> </h4> <p>Default value: the default strategy set via <a href="#server.auth.default()"><code data-language="javascript">server.auth.default()</code></a>.</p> <p>An array of string strategy names in the order they should be attempted. Cannot be used together with <a href="#route.options.auth.strategy"><code data-language="javascript">strategy</code></a>.</p> <h4 id="-routeoptionsauthstrategy">
  <code data-language="javascript">route.options.auth.strategy</code> </h4> <p>Default value: the default strategy set via <a href="#server.auth.default()"><code data-language="javascript">server.auth.default()</code></a>.</p> <p>A string strategy names. Cannot be used together with <a href="#route.options.auth.strategies"><code data-language="javascript">strategies</code></a>.</p> <h3 id="-routeoptionsbind">
  <code data-language="javascript">route.options.bind</code> </h3> <p>Default value: <code data-language="javascript">null</code>.</p> <p>An object passed back to the provided <code data-language="javascript">handler</code> (via <code data-language="javascript">this</code>) when called. Ignored if the method is an arrow function.</p> <h3 id="-routeoptionscache">
  <code data-language="javascript">route.options.cache</code> </h3> <p>Default value: <code data-language="javascript">{ privacy: 'default', statuses: [200], otherwise: 'no-cache' }</code>.</p> <p>If the route method is 'GET', the route can be configured to include HTTP caching directives in the response. Caching can be customized using an object with the following options:</p> <ul> <li> <p><code data-language="javascript">privacy</code> - determines the privacy flag included in client-side caching using the 'Cache-Control' header. Values are:</p> <ul> <li> <code data-language="javascript">'default'</code> - no privacy flag.</li> <li> <code data-language="javascript">'public'</code> - mark the response as suitable for public caching.</li> <li> <code data-language="javascript">'private'</code> - mark the response as suitable only for private caching.</li> </ul> </li> <li> <p><code data-language="javascript">expiresIn</code> - relative expiration expressed in the number of milliseconds since the item was saved in the cache. Cannot be used together with <code data-language="javascript">expiresAt</code>.</p> </li> <li> <p><code data-language="javascript">expiresAt</code> - time of day expressed in 24h notation using the 'HH:MM' format, at which point all cache records for the route expire. Cannot be used together with <code data-language="javascript">expiresIn</code>.</p> </li> <li> <p><code data-language="javascript">statuses</code> - an array of HTTP response status code numbers (e.g. <code data-language="javascript">200</code>) which are allowed to include a valid caching directive.</p> </li> <li> <p><code data-language="javascript">otherwise</code> - a string with the value of the 'Cache-Control' header when caching is disabled.</p> </li> </ul> <p>The default <code data-language="javascript">Cache-Control: no-cache</code> header can be disabled by setting <code data-language="javascript">cache</code> to <code data-language="javascript">false</code>.</p> <h3 id="-routeoptionscompression">
  <code data-language="javascript">route.options.compression</code> </h3> <p>An object where each key is a content-encoding name and each value is an object with the desired encoder settings. Note that decoder settings are set in <a href="#route.options.payload.compression"><code data-language="javascript">compression</code></a>.</p> <h3 id="-routeoptionscors">
  <code data-language="javascript">route.options.cors</code> </h3> <p>Default value: <code data-language="javascript">false</code> (no CORS headers).</p> <p>The <a href="https://www.w3.org/TR/cors/" rel="nofollow">Cross-Origin Resource Sharing</a> protocol allows browsers to make cross-origin API calls. CORS is required by web applications running inside a browser which are loaded from a different domain than the API server. To enable, set <code data-language="javascript">cors</code> to <code data-language="javascript">true</code>, or to an object with the following options:</p> <ul> <li> <p><code data-language="javascript">origin</code> - an array of allowed origin servers strings ('Access-Control-Allow-Origin'). The array can contain any combination of fully qualified origins along with origin strings containing a wildcard <code data-language="javascript">'*'</code> character, or a single <code data-language="javascript">'*'</code> origin string. If set to <code data-language="javascript">'ignore'</code>, any incoming Origin header is ignored (present or not) and the 'Access-Control-Allow-Origin' header is set to <code data-language="javascript">'*'</code>. Defaults to any origin <code data-language="javascript">['*']</code>.</p> </li> <li> <p><code data-language="javascript">maxAge</code> - number of seconds the browser should cache the CORS response ('Access-Control-Max-Age'). The greater the value, the longer it will take before the browser checks for changes in policy. Defaults to <code data-language="javascript">86400</code> (one day).</p> </li> <li> <p><code data-language="javascript">headers</code> - a strings array of allowed headers ('Access-Control-Allow-Headers'). Defaults to <code data-language="javascript">['Accept', 'Authorization', 'Content-Type', 'If-None-Match']</code>.</p> </li> <li> <p><code data-language="javascript">additionalHeaders</code> - a strings array of additional headers to <code data-language="javascript">headers</code>. Use this to keep the default headers in place.</p> </li> <li> <p><code data-language="javascript">exposedHeaders</code> - a strings array of exposed headers ('Access-Control-Expose-Headers'). Defaults to <code data-language="javascript">['WWW-Authenticate', 'Server-Authorization']</code>.</p> </li> <li> <p><code data-language="javascript">additionalExposedHeaders</code> - a strings array of additional headers to <code data-language="javascript">exposedHeaders</code>. Use this to keep the default headers in place.</p> </li> <li> <p><code data-language="javascript">credentials</code> - if <code data-language="javascript">true</code>, allows user credentials to be sent ('Access-Control-Allow-Credentials'). Defaults to <code data-language="javascript">false</code>.</p> </li> <li> <p><code data-language="javascript">preflightStatusCode</code> - the status code used for CORS preflight responses, either <code data-language="javascript">200</code> or <code data-language="javascript">204</code>. Defaults to <code data-language="javascript">200</code>.</p> </li> </ul> <h3 id="-routeoptionsdescription">
  <code data-language="javascript">route.options.description</code> </h3> <p>Default value: none.</p> <p>Route description used for generating documentation (string).</p> <p>This setting is not available when setting server route defaults using <a href="#server.options.routes"><code data-language="javascript">server.options.routes</code></a>.</p> <h3 id="-routeoptionsext">
  <code data-language="javascript">route.options.ext</code> </h3> <p>Default value: none.</p> <p>Route-level <a href="#request-lifecycle">request extension points</a> by setting the option to an object with a key for each of the desired extension points (<code data-language="javascript">'onRequest'</code> is not allowed), and the value is the same as the <a href="#server.ext()"><code data-language="javascript">server.ext(events)</code></a> <code data-language="javascript">event</code> argument.</p> <h3 id="-routeoptionsfiles">
  <code data-language="javascript">route.options.files</code> </h3> <p>Default value: <code data-language="javascript">{ relativeTo: '.' }</code>.</p> <p>Defines the behavior for accessing files:</p> <ul> <li> <code data-language="javascript">relativeTo</code> - determines the folder relative paths are resolved against.</li> </ul> <h3 id="-routeoptionshandler">
  <code data-language="javascript">route.options.handler</code> </h3> <p>Default value: none.</p> <p>The route handler function performs the main business logic of the route and sets the response. <code data-language="javascript">handler</code> can be assigned:</p> <ul> <li> <p>a <a href="#lifecycle-methods">lifecycle method</a>.</p> </li> <li> <p>an object with a single property using the name of a handler type registered with the <a href="#server.decorate()"><code data-language="javascript">server.decorate()</code></a> method. The matching property value is passed as options to the registered handler generator.</p> </li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-en">handler</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-s">'success'</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <p>Note: handlers using a fat arrow style function cannot be bound to any <code data-language="javascript">bind</code> property. Instead, the bound context is available under <a href="#h.context"><code data-language="javascript">h.context</code></a>.</p> <h3 id="-routeoptionsid">
  <code data-language="javascript">route.options.id</code> </h3> <p>Default value: none.</p> <p>An optional unique identifier used to look up the route using <a href="#server.lookup()"><code data-language="javascript">server.lookup()</code></a>. Cannot be assigned to routes added with an array of methods.</p> <h3 id="-routeoptionsisinternal">
  <code data-language="javascript">route.options.isInternal</code> </h3> <p>Default value: <code data-language="javascript">false</code>.</p> <p>If <code data-language="javascript">true</code>, the route cannot be accessed through the HTTP listener but only through the <a href="#server.inject()"><code data-language="javascript">server.inject()</code></a> interface with the <code data-language="javascript">allowInternals</code> option set to <code data-language="javascript">true</code>. Used for internal routes that should not be accessible to the outside world.</p> <h3 id="-routeoptionsjson">
  <code data-language="javascript">route.options.json</code> </h3> <p>Default value: none.</p> <p>Optional arguments passed to <code data-language="javascript">JSON.stringify()</code> when converting an object or error response to a string payload or escaping it after stringification. Supports the following:</p> <ul> <li> <p><code data-language="javascript">replacer</code> - the replacer function or array. Defaults to no action.</p> </li> <li> <p><code data-language="javascript">space</code> - number of spaces to indent nested object keys. Defaults to no indentation.</p> </li> <li> <p><code data-language="javascript">suffix</code> - string suffix added after conversion to JSON string. Defaults to no suffix.</p> </li> <li> <p><code data-language="javascript">escape</code> - calls <a href="https://hapi.dev/family/hoek/api/#escapejsonstring" rel="nofollow"><code data-language="javascript">Hoek.jsonEscape()</code></a> after conversion to JSON string. Defaults to <code data-language="javascript">false</code>.</p> </li> </ul> <h3 id="-routeoptionslog">
  <code data-language="javascript">route.options.log</code> </h3> <p>Default value: <code data-language="javascript">{ collect: false }</code>.</p> <p>Request logging options:</p> <ul> <li> <code data-language="javascript">collect</code> - if <code data-language="javascript">true</code>, request-level logs (both internal and application) are collected and accessible via <a href="#request.logs"><code data-language="javascript">request.logs</code></a>.</li> </ul> <h3 id="-routeoptionsnotes">
  <code data-language="javascript">route.options.notes</code> </h3> <p>Default value: none.</p> <p>Route notes used for generating documentation (string or array of strings).</p> <p>This setting is not available when setting server route defaults using <a href="#server.options.routes"><code data-language="javascript">server.options.routes</code></a>.</p> <h3 id="-routeoptionspayload">
  <code data-language="javascript">route.options.payload</code> </h3> <p>Determines how the request payload is processed.</p> <h4 id="-routeoptionspayloadallow">
  <code data-language="javascript">route.options.payload.allow</code> </h4> <p>Default value: allows parsing of the following mime types:</p> <ul> <li>application/json</li> <li>application/*+json</li> <li>application/octet-stream</li> <li>application/x-www-form-urlencoded</li> <li>multipart/form-data</li> <li>text/*</li> </ul> <p>A string or an array of strings with the allowed mime types for the endpoint. Use this settings to limit the set of allowed mime types. Note that allowing additional mime types not listed above will not enable them to be parsed, and if <a href="#route.options.payload.parse"><code data-language="javascript">parse</code></a> is <code data-language="javascript">true</code>, the request will result in an error response.</p> <h4 id="-routeoptionspayloadcompression">
  <code data-language="javascript">route.options.payload.compression</code> </h4> <p>Default value: none.</p> <p>An object where each key is a content-encoding name and each value is an object with the desired decoder settings. Note that encoder settings are set in <a href="#server.options.compression"><code data-language="javascript">compression</code></a>.</p> <h4 id="-routeoptionspayloaddefaultcontenttype">
  <code data-language="javascript">route.options.payload.defaultContentType</code> </h4> <p>Default value: <code data-language="javascript">'application/json'</code>.</p> <p>The default content type if the 'Content-Type' request header is missing.</p> <h4 id="-routeoptionspayloadfailaction">
  <code data-language="javascript">route.options.payload.failAction</code> </h4> <p>Default value: <code data-language="javascript">'error'</code> (return a Bad Request (400) error response).</p> <p>A <a href="#lifecycle-failAction"><code data-language="javascript">failAction</code> value</a> which determines how to handle payload parsing errors.</p> <h4 id="-routeoptionspayloadmaxbytes">
  <code data-language="javascript">route.options.payload.maxBytes</code> </h4> <p>Default value: <code data-language="javascript">1048576</code> (1MB).</p> <p>Limits the size of incoming payloads to the specified byte count. Allowing very large payloads may cause the server to run out of memory.</p> <h4 id="-routeoptionspayloadmaxparts">
  <code data-language="javascript">route.options.payload.maxParts</code> </h4> <p>Default value: <code data-language="javascript">1000</code>.</p> <p>Limits the number of parts allowed in multipart payloads.</p> <h4 id="-routeoptionspayloadmultipart">
  <code data-language="javascript">route.options.payload.multipart</code> </h4> <p>Default value: <code data-language="javascript">false</code>.</p> <p>Overrides payload processing for multipart requests. Value can be one of:</p> <ul> <li> <p><code data-language="javascript">false</code> - disable multipart processing (this is the default value).</p> </li> <li> <p><code data-language="javascript">true</code> - enable multipart processing using the <a href="#route.options.payload.output"><code data-language="javascript">output</code></a> value.</p> </li> <li> <p>an object with the following required options:</p> <ul> <li> <code data-language="javascript">output</code> - same as the <a href="#route.options.payload.output"><code data-language="javascript">output</code></a> option with an additional value option: <ul> <li> <p><code data-language="javascript">annotated</code> - wraps each multipart part in an object with the following keys:</p> <ul> <li> <code data-language="javascript">headers</code> - the part headers.</li> <li> <code data-language="javascript">filename</code> - the part file name.</li> <li> <code data-language="javascript">payload</code> - the processed part payload.</li> </ul> </li> </ul> </li> </ul> </li> </ul> <h4 id="-routeoptionspayloadoutput">
  <code data-language="javascript">route.options.payload.output</code> </h4> <p>Default value: <code data-language="javascript">'data'</code>.</p> <p>The processed payload format. The value must be one of:</p> <ul> <li> <p><code data-language="javascript">'data'</code> - the incoming payload is read fully into memory. If <a href="#route.options.payload.parse"><code data-language="javascript">parse</code></a> is <code data-language="javascript">true</code>, the payload is parsed (JSON, form-decoded, multipart) based on the 'Content-Type' header. If <a href="#route.options.payload.parse"><code data-language="javascript">parse</code></a> is <code data-language="javascript">false</code>, a raw <code data-language="javascript">Buffer</code> is returned.</p> </li> <li> <p><code data-language="javascript">'stream'</code> - the incoming payload is made available via a <code data-language="javascript">Stream.Readable</code> interface. If the payload is 'multipart/form-data' and <a href="#route.options.payload.parse"><code data-language="javascript">parse</code></a> is <code data-language="javascript">true</code>, field values are presented as text while files are provided as streams. File streams from a 'multipart/form-data' upload will also have a <code data-language="javascript">hapi</code> property containing the <code data-language="javascript">filename</code> and <code data-language="javascript">headers</code> properties. Note that payload streams for multipart payloads are a synthetic interface created on top of the entire multipart content loaded into memory. To avoid loading large multipart payloads into memory, set <a href="#route.options.payload.parse"><code data-language="javascript">parse</code></a> to <code data-language="javascript">false</code> and handle the multipart payload in the handler using a streaming parser (e.g. <a href="https://hapi.dev/family/pez/api" rel="nofollow"><strong>pez</strong></a>).</p> </li> <li> <p><code data-language="javascript">'file'</code> - the incoming payload is written to temporary file in the directory specified by the <a href="#route.options.payload.uploads"><code data-language="javascript">uploads</code></a> settings. If the payload is 'multipart/form-data' and <a href="#route.options.payload.parse"><code data-language="javascript">parse</code></a> is <code data-language="javascript">true</code>, field values are presented as text while files are saved to disk. Note that it is the sole responsibility of the application to clean up the files generated by the framework. This can be done by keeping track of which files are used (e.g. using the <code data-language="javascript">request.app</code> object), and listening to the server <code data-language="javascript">'response'</code> event to perform cleanup.</p> </li> </ul> <h4 id="-routeoptionspayloadoverride">
  <code data-language="javascript">route.options.payload.override</code> </h4> <p>Default value: none.</p> <p>A mime type string overriding the 'Content-Type' header value received.</p> <h4 id="-routeoptionspayloadparse">
  <code data-language="javascript">route.options.payload.parse</code> </h4> <p>Default value: <code data-language="javascript">true</code>.</p> <p>Determines if the incoming payload is processed or presented raw. Available values:</p> <ul> <li> <p><code data-language="javascript">true</code> - if the request 'Content-Type' matches the allowed mime types set by <a href="#route.options.payload.allow"><code data-language="javascript">allow</code></a> (for the whole payload as well as parts), the payload is converted into an object when possible. If the format is unknown, a Bad Request (400) error response is sent. Any known content encoding is decoded.</p> </li> <li> <p><code data-language="javascript">false</code> - the raw payload is returned unmodified.</p> </li> <li> <p><code data-language="javascript">'gunzip'</code> - the raw payload is returned unmodified after any known content encoding is decoded.</p> </li> </ul> <h4 id="-routeoptionspayloadprotoaction">
  <code data-language="javascript">route.options.payload.protoAction</code> </h4> <p>Default value: <code data-language="javascript">'error'</code>.</p> <p>Sets handling of incoming payload that may contain a prototype poisoning security attack. Available values:</p> <ul> <li> <p><code data-language="javascript">'error'</code> - returns a <code data-language="javascript">400</code> bad request error when the payload contains a prototype.</p> </li> <li> <p><code data-language="javascript">'remove'</code> - sanitizes the payload to remove the prototype.</p> </li> <li> <p><code data-language="javascript">'ignore'</code> - disables the protection and allows the payload to pass as received. Use this option only when you are sure that such incoming data cannot pose any risks to your application.</p> </li> </ul> <h4 id="-routeoptionspayloadtimeout">
  <code data-language="javascript">route.options.payload.timeout</code> </h4> <p>Default value: to <code data-language="javascript">10000</code> (10 seconds).</p> <p>Payload reception timeout in milliseconds. Sets the maximum time allowed for the client to transmit the request payload (body) before giving up and responding with a Request Timeout (408) error response.</p> <p>Set to <code data-language="javascript">false</code> to disable.</p> <h4 id="-routeoptionspayloaduploads">
  <code data-language="javascript">route.options.payload.uploads</code> </h4> <p>Default value: <code data-language="javascript">os.tmpdir()</code>.</p> <p>The directory used for writing file uploads.</p> <h3 id="-routeoptionsplugins">
  <code data-language="javascript">route.options.plugins</code> </h3> <p>Default value: <code data-language="javascript">{}</code>.</p> <p>Plugin-specific configuration. <code data-language="javascript">plugins</code> is an object where each key is a plugin name and the value is the plugin configuration.</p> <h3 id="-routeoptionspre">
  <code data-language="javascript">route.options.pre</code> </h3> <p>Default value: none.</p> <p>The <code data-language="javascript">pre</code> option allows defining methods for performing actions before the handler is called. These methods allow breaking the handler logic into smaller, reusable components that can be shared across routes, as well as provide a cleaner error handling of prerequisite operations (e.g. load required reference data from a database).</p> <p><code data-language="javascript">pre</code> is assigned an ordered array of methods which are called serially in order. If the <code data-language="javascript">pre</code> array contains another array of methods as one of its elements, those methods are called in parallel. Note that during parallel execution, if any of the methods error, return a <a href="#takeover-response">takeover response</a>, or abort signal, the other parallel methods will continue to execute but will be ignored once completed.</p> <p><code data-language="javascript">pre</code> can be assigned a mixed array of:</p> <ul> <li> <p>an array containing the elements listed below, which are executed in parallel.</p> </li> <li> <p>an object with:</p> <ul> <li> <code data-language="javascript">method</code> - a <a href="#lifecycle-methods">lifecycle method</a>.</li> <li> <code data-language="javascript">assign</code> - key name used to assign the response of the method to in <a href="#request.pre"><code data-language="javascript">request.pre</code></a> and <a href="#request.preResponses"><code data-language="javascript">request.preResponses</code></a>.</li> <li> <code data-language="javascript">failAction</code> - A <a href="#lifecycle-failAction"><code data-language="javascript">failAction</code> value</a> which determine what to do when a pre-handler method throws an error. If <code data-language="javascript">assign</code> is specified and the <code data-language="javascript">failAction</code> setting is not <code data-language="javascript">'error'</code>, the error will be assigned.</li> </ul> </li> <li> <p>a method function - same as including an object with a single <code data-language="javascript">method</code> key.</p> </li> </ul> <p>Note that pre-handler methods do not behave the same way other <a href="#lifecycle-methods">lifecycle methods</a> do when a value is returned. Instead of the return value becoming the new response payload, the value is used to assign the corresponding <a href="#request.pre"><code data-language="javascript">request.pre</code></a> and <a href="#request.preResponses"><code data-language="javascript">request.preResponses</code></a> properties. Otherwise, the handling of errors, <a href="#takeover-response">takeover response</a> response, or abort signal behave the same as any other <a href="#lifecycle-methods">lifecycle methods</a>.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">pre1</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-s">'Hello'</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">pre2</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-s">'World'</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">pre3</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">pre</span><span class="pl-kos">.</span><span class="pl-c1">m1</span> <span class="pl-c1">+</span> <span class="pl-s">' '</span> <span class="pl-c1">+</span> <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">pre</span><span class="pl-kos">.</span><span class="pl-c1">m2</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/'</span><span class="pl-kos">,</span>
    <span class="pl-c1">options</span>: <span class="pl-kos">{</span>
        <span class="pl-c1">pre</span>: <span class="pl-kos">[</span>
            <span class="pl-kos">[</span>
                <span class="pl-c">// m1 and m2 executed in parallel</span>
                <span class="pl-kos">{</span> <span class="pl-c1">method</span>: <span class="pl-en">pre1</span><span class="pl-kos">,</span> <span class="pl-c1">assign</span>: <span class="pl-s">'m1'</span> <span class="pl-kos">}</span><span class="pl-kos">,</span>
                <span class="pl-kos">{</span> <span class="pl-c1">method</span>: <span class="pl-en">pre2</span><span class="pl-kos">,</span> <span class="pl-c1">assign</span>: <span class="pl-s">'m2'</span> <span class="pl-kos">}</span>
            <span class="pl-kos">]</span><span class="pl-kos">,</span>
            <span class="pl-kos">{</span> <span class="pl-c1">method</span>: <span class="pl-en">pre3</span><span class="pl-kos">,</span> <span class="pl-c1">assign</span>: <span class="pl-s">'m3'</span> <span class="pl-kos">}</span><span class="pl-kos">,</span>
        <span class="pl-kos">]</span><span class="pl-kos">,</span>
        <span class="pl-en">handler</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

            <span class="pl-k">return</span> <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">pre</span><span class="pl-kos">.</span><span class="pl-c1">m3</span> <span class="pl-c1">+</span> <span class="pl-s">'!\n'</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-routeoptionsresponse">
  <code data-language="javascript">route.options.response</code> </h3> <p>Processing rules for the outgoing response.</p> <h4 id="-routeoptionsresponsedisconnectstatuscode">
  <code data-language="javascript">route.options.response.disconnectStatusCode</code> </h4> <p>Default value: <code data-language="javascript">499</code>.</p> <p>The default HTTP status code used to set a response error when the request is closed or aborted before the response is fully transmitted. Value can be any integer greater or equal to <code data-language="javascript">400</code>. The default value <code data-language="javascript">499</code> is based on the non-standard nginx "CLIENT CLOSED REQUEST" error. The value is only used for logging as the request has already ended.</p> <h4 id="-routeoptionsresponseemptystatuscode">
  <code data-language="javascript">route.options.response.emptyStatusCode</code> </h4> <p>Default value: <code data-language="javascript">204</code>.</p> <p>The default HTTP status code when the payload is considered empty. Value can be <code data-language="javascript">200</code> or <code data-language="javascript">204</code>. Note that a <code data-language="javascript">200</code> status code is converted to a <code data-language="javascript">204</code> only at the time of response transmission (the response status code will remain <code data-language="javascript">200</code> throughout the request lifecycle unless manually set).</p> <h4 id="-routeoptionsresponsefailaction">
  <code data-language="javascript">route.options.response.failAction</code> </h4> <p>Default value: <code data-language="javascript">'error'</code> (return an Internal Server Error (500) error response).</p> <p>A <a href="#lifecycle-failAction"><code data-language="javascript">failAction</code> value</a> which defines what to do when a response fails payload validation.</p> <h4 id="-routeoptionsresponsemodify">
  <code data-language="javascript">route.options.response.modify</code> </h4> <p>Default value: <code data-language="javascript">false</code>.</p> <p>If <code data-language="javascript">true</code>, applies the validation rule changes to the response payload.</p> <h4 id="-routeoptionsresponseoptions">
  <code data-language="javascript">route.options.response.options</code> </h4> <p>Default value: none.</p> <p><a href="https://joi.dev/api" rel="nofollow"><strong>joi</strong></a> options object pass to the validation function. Useful to set global options such as <code data-language="javascript">stripUnknown</code> or <code data-language="javascript">abortEarly</code>. If a custom validation function is defined via <a href="#route.options.response.schema"><code data-language="javascript">schema</code></a> or <a href="#route.options.response.status"><code data-language="javascript">status</code></a> then <code data-language="javascript">options</code> can an arbitrary object that will be passed to this function as the second argument.</p> <h4 id="-routeoptionsresponseranges">
  <code data-language="javascript">route.options.response.ranges</code> </h4> <p>Default value: <code data-language="javascript">true</code>.</p> <p>If <code data-language="javascript">false</code>, payload <a href="https://tools.ietf.org/html/rfc7233#section-3" rel="nofollow">range</a> support is disabled.</p> <h4 id="-routeoptionsresponsesample">
  <code data-language="javascript">route.options.response.sample</code> </h4> <p>Default value: <code data-language="javascript">100</code> (all responses).</p> <p>The percent of response payloads validated (0 - 100). Set to <code data-language="javascript">0</code> to disable all validation.</p> <h4 id="-routeoptionsresponseschema">
  <code data-language="javascript">route.options.response.schema</code> </h4> <p>Default value: <code data-language="javascript">true</code> (no validation).</p> <p>The default response payload validation rules (for all non-error responses) expressed as one of:</p> <ul> <li> <p><code data-language="javascript">true</code> - any payload allowed (no validation).</p> </li> <li> <p><code data-language="javascript">false</code> - no payload allowed.</p> </li> <li> <p>a <a href="https://joi.dev/api" rel="nofollow"><strong>joi</strong></a> validation object. The <a href="#route.options.response.options"><code data-language="javascript">options</code></a> along with the request context (<code data-language="javascript">{ headers, params, query, payload, state, app, auth }</code>) are passed to the validation function.</p> </li> <li> <p>a validation function using the signature <code data-language="javascript">async function(value, options)</code> where:</p> <ul> <li> <p><code data-language="javascript">value</code> - the pending response payload.</p> </li> <li> <p><code data-language="javascript">options</code> - The <a href="#route.options.response.options"><code data-language="javascript">options</code></a> along with the request context (<code data-language="javascript">{ headers, params, query, payload, state, app, auth }</code>).</p> </li> <li> <p>if the function returns a value and <a href="#route.options.response.modify"><code data-language="javascript">modify</code></a> is <code data-language="javascript">true</code>, the value is used as the new response. If the original response is an error, the return value is used to override the original error <code data-language="javascript">output.payload</code>. If an error is thrown, the error is processed according to <a href="#route.options.response.failAction"><code data-language="javascript">failAction</code></a>.</p> </li> </ul> </li> </ul> <h4 id="-routeoptionsresponsestatus">
  <code data-language="javascript">route.options.response.status</code> </h4> <p>Default value: none.</p> <p>Validation schemas for specific HTTP status codes. Responses (excluding errors) not matching the listed status codes are validated using the default <a href="#route.options.response.schema"><code data-language="javascript">schema</code></a>.</p> <p><code data-language="javascript">status</code> is set to an object where each key is a 3 digit HTTP status code and the value has the same definition as <a href="#route.options.response.schema"><code data-language="javascript">schema</code></a>.</p> <h3 id="-routeoptionsrules">
  <code data-language="javascript">route.options.rules</code> </h3> <p>Default value: none.</p> <p>A custom rules object passed to each rules processor registered with <a href="#server.rules()"><code data-language="javascript">server.rules()</code></a>.</p> <h3 id="-routeoptionssecurity">
  <code data-language="javascript">route.options.security</code> </h3> <p>Default value: <code data-language="javascript">false</code> (security headers disabled).</p> <p>Sets common security headers. To enable, set <code data-language="javascript">security</code> to <code data-language="javascript">true</code> or to an object with the following options:</p> <ul> <li> <p><code data-language="javascript">hsts</code> - controls the 'Strict-Transport-Security' header, where:</p> <ul> <li> <p><code data-language="javascript">true</code> - the header will be set to <code data-language="javascript">max-age=15768000</code>. This is the default value.</p> </li> <li> <p>a number - the maxAge parameter will be set to the provided value.</p> </li> <li> <p>an object with the following fields:</p> <ul> <li> <code data-language="javascript">maxAge</code> - the max-age portion of the header, as a number. Default is <code data-language="javascript">15768000</code>.</li> <li> <code data-language="javascript">includeSubDomains</code> - a boolean specifying whether to add the <code data-language="javascript">includeSubDomains</code> flag to the header.</li> <li> <code data-language="javascript">preload</code> - a boolean specifying whether to add the <code data-language="javascript">'preload'</code> flag (used to submit domains inclusion in Chrome's HTTP Strict Transport Security (HSTS) preload list) to the header.</li> </ul> </li> </ul> </li> <li> <p><code data-language="javascript">xframe</code> - controls the 'X-Frame-Options' header, where:</p> <ul> <li> <p><code data-language="javascript">true</code> - the header will be set to <code data-language="javascript">'DENY'</code>. This is the default value.</p> </li> <li> <p><code data-language="javascript">'deny'</code> - the headers will be set to <code data-language="javascript">'DENY'</code>.</p> </li> <li> <p><code data-language="javascript">'sameorigin'</code> - the headers will be set to <code data-language="javascript">'SAMEORIGIN'</code>.</p> </li> <li> <p>an object for specifying the 'allow-from' rule, where:</p> <ul> <li> <code data-language="javascript">rule</code> - one of: <ul> <li><code data-language="javascript">'deny'</code></li> <li><code data-language="javascript">'sameorigin'</code></li> <li><code data-language="javascript">'allow-from'</code></li> </ul> </li> <li> <code data-language="javascript">source</code> - when <code data-language="javascript">rule</code> is <code data-language="javascript">'allow-from'</code> this is used to form the rest of the header, otherwise this field is ignored. If <code data-language="javascript">rule</code> is <code data-language="javascript">'allow-from'</code> but <code data-language="javascript">source</code> is unset, the rule will be automatically changed to <code data-language="javascript">'sameorigin'</code>.</li> </ul> </li> </ul> </li> <li> <p><code data-language="javascript">xss</code> - controls the 'X-XSS-Protection' header, where:</p> <ul> <li> <code data-language="javascript">'disabled'</code> - the header will be set to <code data-language="javascript">'0'</code>. This is the default value.</li> <li> <code data-language="javascript">'enabled'</code> - the header will be set to <code data-language="javascript">'1; mode=block'</code>.</li> <li> <code data-language="javascript">false</code> - the header will be omitted.</li> </ul> <p>Note: when enabled, this setting can create a security vulnerabilities in versions of Internet Explorer below 8, unpatched versions of IE8, and browsers that employ an XSS filter/auditor. See <a href="https://hackademix.net/2009/11/21/ies-xss-filter-creates-xss-vulnerabilities/" rel="nofollow">here</a>, <a href="https://technet.microsoft.com/library/security/ms10-002" rel="nofollow">here</a>, and <a href="https://blog.innerht.ml/the-misunderstood-x-xss-protection/" rel="nofollow">here</a> for more information.</p> </li> <li> <p><code data-language="javascript">noOpen</code> - boolean controlling the 'X-Download-Options' header for Internet Explorer, preventing downloads from executing in your context. Defaults to <code data-language="javascript">true</code> setting the header to <code data-language="javascript">'noopen'</code>.</p> </li> <li> <p><code data-language="javascript">noSniff</code> - boolean controlling the 'X-Content-Type-Options' header. Defaults to <code data-language="javascript">true</code> setting the header to its only and default option, <code data-language="javascript">'nosniff'</code>.</p> </li> <li> <p><code data-language="javascript">referrer</code> - controls the <a href="https://www.w3.org/TR/referrer-policy/" rel="nofollow">'Referrer-Policy'</a> header, which has the following possible values.</p> <ul> <li> <code data-language="javascript">false</code> - the 'Referrer-Policy' header will not be sent to clients with responses. This is the default value.</li> <li> <code data-language="javascript">''</code> - instructs clients that the Referrer-Policy will be <a href="https://www.w3.org/TR/referrer-policy/#referrer-policy-empty-string" rel="nofollow">defined elsewhere</a>, such as in a meta html tag.</li> <li> <code data-language="javascript">'no-referrer'</code> - instructs clients to never include the referrer header when making requests.</li> <li> <code data-language="javascript">'no-referrer-when-downgrade'</code> - instructs clients to never include the referrer when navigating from HTTPS to HTTP.</li> <li> <code data-language="javascript">'same-origin'</code> - instructs clients to only include the referrer on the current site origin.</li> <li> <code data-language="javascript">'origin'</code> - instructs clients to include the referrer but strip off path information so that the value is the current origin only.</li> <li> <code data-language="javascript">'strict-origin'</code> - same as <code data-language="javascript">'origin'</code> but instructs clients to omit the referrer header when going from HTTPS to HTTP.</li> <li> <code data-language="javascript">'origin-when-cross-origin'</code> - instructs clients to include the full path in the referrer header for same-origin requests but only the origin components of the URL are included for cross origin requests.</li> <li> <code data-language="javascript">'strict-origin-when-cross-origin'</code> - same as <code data-language="javascript">'origin-when-cross-origin'</code> but the client is instructed to omit the referrer when going from HTTPS to HTTP.</li> <li> <code data-language="javascript">'unsafe-url'</code> - instructs the client to always include the referrer with the full URL.</li> </ul> </li> </ul> <h3 id="-routeoptionsstate">
  <code data-language="javascript">route.options.state</code> </h3> <p>Default value: <code data-language="javascript">{ parse: true, failAction: 'error' }</code>.</p> <p>HTTP state management (cookies) allows the server to store information on the client which is sent back to the server with every request (as defined in <a href="https://tools.ietf.org/html/rfc6265" rel="nofollow">RFC 6265</a>). <code data-language="javascript">state</code> supports the following options:</p> <ul> <li> <p><code data-language="javascript">parse</code> - determines if incoming 'Cookie' headers are parsed and stored in the <a href="#request.state"><code data-language="javascript">request.state</code></a> object.</p> </li> <li> <p><code data-language="javascript">failAction</code> - A <a href="#lifecycle-failAction"><code data-language="javascript">failAction</code> value</a> which determines how to handle cookie parsing errors. Defaults to <code data-language="javascript">'error'</code> (return a Bad Request (400) error response).</p> </li> </ul> <h3 id="-routeoptionstags">
  <code data-language="javascript">route.options.tags</code> </h3> <p>Default value: none.</p> <p>Route tags used for generating documentation (array of strings).</p> <p>This setting is not available when setting server route defaults using <a href="#server.options.routes"><code data-language="javascript">server.options.routes</code></a>.</p> <h3 id="-routeoptionstimeout">
  <code data-language="javascript">route.options.timeout</code> </h3> <p>Default value: <code data-language="javascript">{ server: false }</code>.</p> <p>Timeouts for processing durations.</p> <h4 id="-routeoptionstimeoutserver">
  <code data-language="javascript">route.options.timeout.server</code> </h4> <p>Default value: <code data-language="javascript">false</code>.</p> <p>Response timeout in milliseconds. Sets the maximum time allowed for the server to respond to an incoming request before giving up and responding with a Service Unavailable (503) error response.</p> <h4 id="-routeoptionstimeoutsocket">
  <code data-language="javascript">route.options.timeout.socket</code> </h4> <p>Default value: none (use node default of 2 minutes).</p> <p>By default, node sockets automatically timeout after 2 minutes. Use this option to override this behavior. Set to <code data-language="javascript">false</code> to disable socket timeouts.</p> <h3 id="-routeoptionsvalidate">
  <code data-language="javascript">route.options.validate</code> </h3> <p>Default value: <code data-language="javascript">{ headers: true, params: true, query: true, payload: true, state: true, failAction: 'error' }</code>.</p> <p>Request input validation rules for various request components.</p> <h4 id="-routeoptionsvalidateerrorfields">
  <code data-language="javascript">route.options.validate.errorFields</code> </h4> <p>Default value: none.</p> <p>An optional object with error fields copied into every validation error response.</p> <h4 id="-routeoptionsvalidatefailaction">
  <code data-language="javascript">route.options.validate.failAction</code> </h4> <p>Default value: <code data-language="javascript">'error'</code> (return a Bad Request (400) error response).</p> <p>A <a href="#lifecycle-failAction"><code data-language="javascript">failAction</code> value</a> which determines how to handle failed validations. When set to a function, the <code data-language="javascript">err</code> argument includes the type of validation error under <code data-language="javascript">err.output.payload.validation.source</code>. The default error that would otherwise have been logged or returned can be accessed under <code data-language="javascript">err.data.defaultError</code>.</p> <h4 id="-routeoptionsvalidateheaders">
  <code data-language="javascript">route.options.validate.headers</code> </h4> <p>Default value: <code data-language="javascript">true</code> (no validation).</p> <p>Validation rules for incoming request headers:</p> <ul> <li> <p><code data-language="javascript">true</code> - any headers allowed (no validation performed).</p> </li> <li> <p>a <a href="https://joi.dev/api" rel="nofollow"><strong>joi</strong></a> validation object.</p> </li> <li> <p>a validation function using the signature <code data-language="javascript">async function(value, options)</code> where:</p> <ul> <li> <code data-language="javascript">value</code> - the <a href="#request.headers"><code data-language="javascript">request.headers</code></a> object containing the request headers.</li> <li> <code data-language="javascript">options</code> - <a href="#route.options.validate.options"><code data-language="javascript">options</code></a>.</li> <li>if a value is returned, the value is used as the new <a href="#request.headers"><code data-language="javascript">request.headers</code></a> value and the original value is stored in <a href="#request.orig"><code data-language="javascript">request.orig.headers</code></a>. Otherwise, the headers are left unchanged. If an error is thrown, the error is handled according to <a href="#route.options.validate.failAction"><code data-language="javascript">failAction</code></a>.</li> </ul> </li> </ul> <p>Note that all header field names must be in lowercase to match the headers normalized by node.</p> <h4 id="-routeoptionsvalidateoptions">
  <code data-language="javascript">route.options.validate.options</code> </h4> <p>Default value: none.</p> <p>An options object passed to the <a href="https://joi.dev/api" rel="nofollow"><strong>joi</strong></a> rules or the custom validation methods. Used for setting global options such as <code data-language="javascript">stripUnknown</code> or <code data-language="javascript">abortEarly</code>.</p> <p>If a custom validation function (see <code data-language="javascript">headers</code>, <code data-language="javascript">params</code>, <code data-language="javascript">query</code>, or <code data-language="javascript">payload</code> above) is defined then <code data-language="javascript">options</code> can an arbitrary object that will be passed to this function as the second parameter.</p> <p>The values of the other inputs (i.e. <code data-language="javascript">headers</code>, <code data-language="javascript">query</code>, <code data-language="javascript">params</code>, <code data-language="javascript">payload</code>, <code data-language="javascript">state</code>, <code data-language="javascript">app</code>, and <code data-language="javascript">auth</code>) are added to the <code data-language="javascript">options</code> object under the validation <code data-language="javascript">context</code> (accessible in rules as <code data-language="javascript">Joi.ref('$query.key')</code>).</p> <p>Note that validation is performed in order (i.e. headers, params, query, and payload) and if type casting is used (e.g. converting a string to a number), the value of inputs not yet validated will reflect the raw, unvalidated and unmodified values.</p> <p>If the validation rules for <code data-language="javascript">headers</code>, <code data-language="javascript">params</code>, <code data-language="javascript">query</code>, and <code data-language="javascript">payload</code> are defined at both the server <a href="#server.options.routes"><code data-language="javascript">routes</code></a> level and at the route level, the individual route settings override the routes defaults (the rules are not merged).</p> <h4 id="-routeoptionsvalidateparams">
  <code data-language="javascript">route.options.validate.params</code> </h4> <p>Default value: <code data-language="javascript">true</code> (no validation).</p> <p>Validation rules for incoming request path parameters, after matching the path against the route, extracting any parameters, and storing them in <a href="#request.params"><code data-language="javascript">request.params</code></a>, where:</p> <ul> <li> <p><code data-language="javascript">true</code> - any path parameter value allowed (no validation performed).</p> </li> <li> <p>a <a href="https://joi.dev/api" rel="nofollow"><strong>joi</strong></a> validation object.</p> </li> <li> <p>a validation function using the signature <code data-language="javascript">async function(value, options)</code> where:</p> <ul> <li> <code data-language="javascript">value</code> - the <a href="#request.params"><code data-language="javascript">request.params</code></a> object containing the request path parameters.</li> <li> <code data-language="javascript">options</code> - <a href="#route.options.validate.options"><code data-language="javascript">options</code></a>.</li> <li>if a value is returned, the value is used as the new <a href="#request.params"><code data-language="javascript">request.params</code></a> value and the original value is stored in <a href="#request.orig"><code data-language="javascript">request.orig.params</code></a>. Otherwise, the path parameters are left unchanged. If an error is thrown, the error is handled according to <a href="#route.options.validate.failAction"><code data-language="javascript">failAction</code></a>.</li> </ul> </li> </ul> <p>Note that failing to match the validation rules to the route path parameters definition will cause all requests to fail.</p> <h4 id="-routeoptionsvalidatepayload">
  <code data-language="javascript">route.options.validate.payload</code> </h4> <p>Default value: <code data-language="javascript">true</code> (no validation).</p> <p>Validation rules for incoming request payload (request body), where:</p> <ul> <li> <p><code data-language="javascript">true</code> - any payload allowed (no validation performed).</p> </li> <li> <p><code data-language="javascript">false</code> - no payload allowed.</p> </li> <li> <p>a <a href="https://joi.dev/api" rel="nofollow"><strong>joi</strong></a> validation object.</p> <ul> <li>Note that empty payloads are represented by a <code data-language="javascript">null</code> value. If a validation schema is provided and empty payload are allowed, the schema must be explicitly defined by setting the rule to a <strong>joi</strong> schema with <code data-language="javascript">null</code> allowed (e.g. <code data-language="javascript">Joi.object({ /* keys here */ }).allow(null)</code>).</li> </ul> </li> <li> <p>a validation function using the signature <code data-language="javascript">async function(value, options)</code> where:</p> <ul> <li> <code data-language="javascript">value</code> - the <a href="#request.payload"><code data-language="javascript">request.payload</code></a> object containing the request payload.</li> <li> <code data-language="javascript">options</code> - <a href="#route.options.validate.options"><code data-language="javascript">options</code></a>.</li> <li>if a value is returned, the value is used as the new <a href="#request.payload"><code data-language="javascript">request.payload</code></a> value and the original value is stored in <a href="#request.orig"><code data-language="javascript">request.orig.payload</code></a>. Otherwise, the payload is left unchanged. If an error is thrown, the error is handled according to <a href="#route.options.validate.failAction"><code data-language="javascript">failAction</code></a>.</li> </ul> </li> </ul> <p>Note that validating large payloads and modifying them will cause memory duplication of the payload (since the original is kept), as well as the significant performance cost of validating large amounts of data.</p> <h4 id="-routeoptionsvalidatequery">
  <code data-language="javascript">route.options.validate.query</code> </h4> <p>Default value: <code data-language="javascript">true</code> (no validation).</p> <p>Validation rules for incoming request URI query component (the key-value part of the URI between '?' and '#'). The query is parsed into its individual key-value pairs, decoded, and stored in <a href="#request.query"><code data-language="javascript">request.query</code></a> prior to validation. Where:</p> <ul> <li> <p><code data-language="javascript">true</code> - any query parameter value allowed (no validation performed).</p> </li> <li> <p><code data-language="javascript">false</code> - no query parameter value allowed.</p> </li> <li> <p>a <a href="https://joi.dev/api" rel="nofollow"><strong>joi</strong></a> validation object.</p> </li> <li> <p>a validation function using the signature <code data-language="javascript">async function(value, options)</code> where:</p> <ul> <li> <code data-language="javascript">value</code> - the <a href="#request.query"><code data-language="javascript">request.query</code></a> object containing the request query parameters.</li> <li> <code data-language="javascript">options</code> - <a href="#route.options.validate.options"><code data-language="javascript">options</code></a>.</li> <li>if a value is returned, the value is used as the new <a href="#request.query"><code data-language="javascript">request.query</code></a> value and the original value is stored in <a href="#request.orig"><code data-language="javascript">request.orig.query</code></a>. Otherwise, the query parameters are left unchanged. If an error is thrown, the error is handled according to <a href="#route.options.validate.failAction"><code data-language="javascript">failAction</code></a>.</li> </ul> </li> </ul> <p>Note that changes to the query parameters will not be reflected in <a href="#request.url"><code data-language="javascript">request.url</code></a>.</p> <h4 id="-routeoptionsvalidatestate">
  <code data-language="javascript">route.options.validate.state</code> </h4> <p>Default value: <code data-language="javascript">true</code> (no validation).</p> <p>Validation rules for incoming cookies. The <code data-language="javascript">cookie</code> header is parsed and decoded into the <a href="#request.state"><code data-language="javascript">request.state</code></a> prior to validation. Where:</p> <ul> <li> <p><code data-language="javascript">true</code> - any cookie value allowed (no validation performed).</p> </li> <li> <p><code data-language="javascript">false</code> - no cookies allowed.</p> </li> <li> <p>a <a href="https://joi.dev/api" rel="nofollow"><strong>joi</strong></a> validation object.</p> </li> <li> <p>a validation function using the signature <code data-language="javascript">async function(value, options)</code> where:</p> <ul> <li> <code data-language="javascript">value</code> - the <a href="#request.state"><code data-language="javascript">request.state</code></a> object containing all parsed cookie values.</li> <li> <code data-language="javascript">options</code> - <a href="#route.options.validate.options"><code data-language="javascript">options</code></a>.</li> <li>if a value is returned, the value is used as the new <a href="#request.state"><code data-language="javascript">request.state</code></a> value and the original value is stored in <a href="#request.orig"><code data-language="javascript">request.orig.state</code></a>. Otherwise, the cookie values are left unchanged. If an error is thrown, the error is handled according to <a href="#route.options.validate.failAction"><code data-language="javascript">failAction</code></a>.</li> </ul> </li> </ul> <h4 id="-routeoptionsvalidatevalidator">
  <code data-language="javascript">route.options.validate.validator</code> </h4> <p>Default value: <code data-language="javascript">null</code> (no default validator).</p> <p>Sets a server validation module used to compile raw validation rules into validation schemas (e.g. <strong>joi</strong>).</p> <p>Note: the validator is only used when validation rules are not pre-compiled schemas. When a validation rules is a function or schema object, the rule is used as-is and the validator is not used.</p> <h2>
Request lifecycle</h2> <p>Each incoming request passes through the request lifecycle. The specific steps vary based on the server and route configurations, but the order in which the applicable steps are executed is always the same. The following is the complete list of steps a request can go through:</p> <ul> <li> <p><em><strong>onRequest</strong></em></p> <ul> <li>always called when <code data-language="javascript">onRequest</code> extensions exist.</li> <li>the request path and method can be modified via the <a href="#request.setUrl()"><code data-language="javascript">request.setUrl()</code></a> and <a href="#request.setMethod()"><code data-language="javascript">request.setMethod()</code></a> methods. Changes to the request path or method will impact how the request is routed and can be used for rewrite rules.</li> <li> <a href="#request.payload"><code data-language="javascript">request.payload</code></a> is <code data-language="javascript">undefined</code> and can be overridden with any non-<code data-language="javascript">undefined</code> value to bypass payload processing.</li> <li> <a href="#request.route"><code data-language="javascript">request.route</code></a> is unassigned.</li> <li> <a href="#request.url"><code data-language="javascript">request.url</code></a> can be <code data-language="javascript">null</code> if the incoming request path is invalid.</li> <li> <a href="#request.path"><code data-language="javascript">request.path</code></a> can be an invalid path.</li> </ul> </li> <li> <p><em><strong>Route lookup</strong></em></p> <ul> <li>lookup based on <code data-language="javascript">request.path</code> and <code data-language="javascript">request.method</code>.</li> <li>skips to <em><strong>onPreResponse</strong></em> if no route is found or if the path violates the HTTP specification.</li> </ul> </li> <li> <p><em><strong>Cookies processing</strong></em></p> <ul> <li>based on the route <a href="#route.options.state"><code data-language="javascript">state</code></a> option.</li> <li>error handling based on <a href="#route.options.state.failAction"><code data-language="javascript">failAction</code></a>.</li> </ul> </li> <li> <p><em><strong>onPreAuth</strong></em></p> <ul> <li>called regardless if authentication is performed.</li> </ul> </li> <li> <p><em><strong>Authentication</strong></em></p> <ul> <li>based on the route <a href="#route.options.auth"><code data-language="javascript">auth</code></a> option.</li> </ul> </li> <li> <p><em><strong>Payload processing</strong></em></p> <ul> <li>based on the route <a href="#route.options.payload"><code data-language="javascript">payload</code></a> option and if <a href="#request.payload"><code data-language="javascript">request.payload</code></a> has not been overridden in <em><strong>onRequest</strong></em>.</li> <li>error handling based on <a href="#route.options.payload.failAction"><code data-language="javascript">failAction</code></a>.</li> </ul> </li> <li> <p><em><strong>Payload authentication</strong></em></p> <ul> <li>based on the route <a href="#route.options.auth"><code data-language="javascript">auth</code></a> option.</li> </ul> </li> <li> <p><em><strong>onCredentials</strong></em></p> <ul> <li>called only if authentication is performed.</li> </ul> </li> <li> <p><em><strong>Authorization</strong></em></p> <ul> <li>based on the route authentication <a href="#route.options.auth.access"><code data-language="javascript">access</code></a> option.</li> </ul> </li> <li> <p><em><strong>onPostAuth</strong></em></p> <ul> <li>called regardless if authentication is performed.</li> </ul> </li> <li> <p><em><strong>Headers validation</strong></em></p> <ul> <li>based on the route <a href="#route.options.validate.headers"><code data-language="javascript">validate.headers</code></a> option.</li> <li>error handling based on <a href="#route.options.validate.failAction"><code data-language="javascript">failAction</code></a>.</li> </ul> </li> <li> <p><em><strong>Path parameters validation</strong></em></p> <ul> <li>based on the route <a href="#route.options.validate.params"><code data-language="javascript">validate.params</code></a> option.</li> <li>error handling based on <a href="#route.options.validate.failAction"><code data-language="javascript">failAction</code></a>.</li> </ul> </li> <li> <p><em><strong>Query validation</strong></em></p> <ul> <li>based on the route <a href="#route.options.validate.query"><code data-language="javascript">validate.query</code></a> option.</li> <li>error handling based on <a href="#route.options.validate.failAction"><code data-language="javascript">failAction</code></a>.</li> </ul> </li> <li> <p><em><strong>Payload validation</strong></em></p> <ul> <li>based on the route <a href="#route.options.validate.payload"><code data-language="javascript">validate.payload</code></a> option.</li> <li>error handling based on <a href="#route.options.validate.failAction"><code data-language="javascript">failAction</code></a>.</li> </ul> </li> <li> <p><em><strong>State validation</strong></em></p> <ul> <li>based on the route <a href="#route.options.validate.state"><code data-language="javascript">validate.state</code></a> option.</li> <li>error handling based on <a href="#route.options.validate.failAction"><code data-language="javascript">failAction</code></a>.</li> </ul> </li> <li> <p><em><strong>onPreHandler</strong></em></p> </li> <li> <p><em><strong>Pre-handler methods</strong></em></p> <ul> <li>based on the route <a href="#route.options.pre"><code data-language="javascript">pre</code></a> option.</li> <li>error handling based on each pre-handler method's <code data-language="javascript">failAction</code> setting.</li> </ul> </li> <li> <p><em><strong>Route handler</strong></em></p> <ul> <li>executes the route <a href="#route.options.handler"><code data-language="javascript">handler</code></a>.</li> </ul> </li> <li> <p><em><strong>onPostHandler</strong></em></p> <ul> <li>the response contained in <a href="#request.response"><code data-language="javascript">request.response</code></a> may be modified (but not assigned a new value). To return a different response type (for example, replace an error with an HTML response), return a new response value.</li> </ul> </li> <li> <p><em><strong>Response validation</strong></em></p> <ul> <li>error handling based on <a href="#route.options.response.failAction"><code data-language="javascript">failAction</code></a>.</li> </ul> </li> <li> <p><em><strong>onPreResponse</strong></em></p> <ul> <li>always called, unless the request is aborted.</li> <li>the response contained in <a href="#request.response"><code data-language="javascript">request.response</code></a> may be modified (but not assigned a new value). To return a different response type (for example, replace an error with an HTML response), return a new response value. Note that any errors generated will not be passed back to <em><strong>onPreResponse</strong></em> to prevent an infinite loop.</li> </ul> </li> <li> <p><em><strong>Response transmission</strong></em></p> <ul> <li>may emit a <a href="#server.events.request"><code data-language="javascript">'request'</code> event</a> on the <code data-language="javascript">'error'</code> channel.</li> </ul> </li> <li> <p><em><strong>Finalize request</strong></em></p> <ul> <li>emits <code data-language="javascript">'response'</code> event.</li> </ul> </li> <li> <p><em><strong>onPostResponse</strong></em></p> <ul> <li>return value is ignored since the response is already set.</li> <li>emits a <a href="#server.events.request"><code data-language="javascript">'request'</code> event</a> on the <code data-language="javascript">'error'</code> channel if an error is returned.</li> <li>all extension handlers are executed even if some error.</li> <li>note that since the handlers are executed in serial (each is <code data-language="javascript">await</code>ed), care must be taken to avoid blocking execution if other extension handlers expect to be called immediately when the response is sent. If an <em><strong>onPostResponse</strong></em> handler is performing IO, it should defer that activity to another tick and return immediately (either without a return value or without a promise that is solve to resolve).</li> </ul> </li> </ul> <h3 id="lifecycle-methods">
Lifecycle methods</h3> <p>Lifecycle methods are the interface between the framework and the application. Many of the request lifecycle steps: <a href="#server.ext()">extensions</a>, <a href="#authentication-scheme">authentication</a>, <a href="#route.options.handler">handlers</a>, <a href="#route.options.pre">pre-handler methods</a>, and <a href="#lifecycle-failAction"><code data-language="javascript">failAction</code> function values</a> are lifecyle methods provided by the developer and executed by the framework.</p> <p>Each lifecycle method is a function with the signature <code data-language="javascript">await function(request, h, [err])</code> where:</p> <ul> <li> <code data-language="javascript">request</code> - the <a href="#request">request object</a>.</li> <li> <code data-language="javascript">h</code> - the <a href="#response-toolkit">response toolkit</a> the handler must call to set a response and return control back to the framework.</li> <li> <code data-language="javascript">err</code> - an error object available only when the method is used as a <a href="#lifecycle-failAction"><code data-language="javascript">failAction</code> value</a>.</li> </ul> <p>Each lifecycle method must return a value or a promise that resolves into a value. If a lifecycle method returns without a value or resolves to an <code data-language="javascript">undefined</code> value, an Internal Server Error (500) error response is sent.</p> <p>The return value must be one of:</p> <ul> <li>Plain value: <ul> <li><code data-language="javascript">null</code></li> <li>string</li> <li>number</li> <li>boolean</li> </ul> </li> <li> <code data-language="javascript">Buffer</code> object</li> <li> <code data-language="javascript">Error</code> object <ul> <li>plain <code data-language="javascript">Error</code>.</li> <li>a <a href="https://hapi.dev/family/boom/api" rel="nofollow"><code data-language="javascript">Boom</code></a> object.</li> </ul> </li> <li> <code data-language="javascript">Stream</code> object <ul> <li>must be compatible with the "streams2" API and not be in <code data-language="javascript">objectMode</code>.</li> <li>if the stream object has a <code data-language="javascript">statusCode</code> property, that status code will be used as the default response code based on the <a href="#response.settings.passThrough"><code data-language="javascript">passThrough</code></a> option.</li> <li>if the stream object has a <code data-language="javascript">headers</code> property, the headers will be included in the response based on the <a href="#response.settings.passThrough"><code data-language="javascript">passThrough</code></a> option.</li> <li>if the stream object has a function property <code data-language="javascript">setCompressor(compressor)</code> and the response passes through a compressor, a reference to the compressor stream will be passed to the response stream via this method.</li> </ul> </li> <li>any object or array <ul> <li>must not include circular references.</li> </ul> </li> <li>a toolkit signal: <ul> <li> <a href="#h.abandon"><code data-language="javascript">h.abandon</code></a> - abort processing the request.</li> <li> <a href="#h.close"><code data-language="javascript">h.close</code></a> - abort processing the request and call <code data-language="javascript">end()</code> to ensure the response is closed.</li> <li> <a href="#h.continue"><code data-language="javascript">h.continue</code></a> - continue processing the request lifecycle without changing the response.</li> </ul> </li> <li>a toolkit method response: <ul> <li> <a href="#h.response()"><code data-language="javascript">h.response()</code></a> - wraps a plain response in a <a href="#response-object">response object</a>.</li> <li> <a href="#h.redirect()"><code data-language="javascript">h.redirect()</code></a> - wraps a plain response with a redirection directive.</li> <li> <a href="#h.authenticated()"><code data-language="javascript">h.authenticated()</code></a> - indicate request authenticated successfully (auth scheme only).</li> <li> <a href="#h.unauthenticated()"><code data-language="javascript">h.unauthenticated()</code></a> - indicate request failed to authenticate (auth scheme only).</li> </ul> </li> <li>a promise object that resolve to any of the above values</li> </ul> <p>Any error thrown by a lifecycle method will be used as the <a href="#response-object">response object</a>. While errors and valid values can be returned, it is recommended to throw errors. Throwing non-error values will generate a Bad Implementation (500) error response.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-en">handler</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">query</span><span class="pl-kos">.</span><span class="pl-c1">forbidden</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-k">throw</span> <span class="pl-v">Boom</span><span class="pl-kos">.</span><span class="pl-en">badRequest</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>

    <span class="pl-k">return</span> <span class="pl-s">'success'</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <p>If the route has a <a href="#route.options.bind"><code data-language="javascript">bind</code></a> option or <a href="#server.bind()"><code data-language="javascript">server.bind()</code></a> was called, the lifecycle method will be bound to the provided context via <code data-language="javascript">this</code> as well as accessible via <a href="#h.context"><code data-language="javascript">h.context</code></a>.</p> <h4 id="lifecycle-workflow">
Lifecycle workflow</h4> <p>The flow between each lifecycle step depends on the value returned by each lifecycle method as follows:</p> <ul> <li> <p>an error:</p> <ul> <li>the lifecycle skips to the <em><strong>Response validation</strong></em> step.</li> <li>if returned by the <em><strong>onRequest</strong></em> step it skips to the <em><strong>onPreResponse</strong></em> step.</li> <li>if returned by the <em><strong>Response validation</strong></em> step it skips to the <em><strong>onPreResponse</strong></em> step.</li> <li>if returned by the <em><strong>onPreResponse</strong></em> step it skips to the <em><strong>Response transmission</strong></em> step.</li> </ul> </li> <li> <p>an abort signal (<a href="#h.abandon"><code data-language="javascript">h.abandon</code></a> or <a href="#h.close"><code data-language="javascript">h.close</code></a>):</p> <ul> <li>skips to the <em><strong>Finalize request</strong></em> step.</li> </ul> </li> <li> <p>a <a href="#h.continue"><code data-language="javascript">h.continue</code></a> signal:</p> <ul> <li>continues processing the request lifecycle without changing the request response.</li> <li>cannot be used by the <a href="#authentication-scheme"><code data-language="javascript">authenticate()</code></a> scheme method.</li> </ul> </li> <li> <p>a <a href="#takeover-response">takeover response</a>:</p> <ul> <li>overrides the request response with the provided value and skips to the <em><strong>Response validation</strong></em> step.</li> <li>if returned by the <em><strong>Response validation</strong></em> step it skips to the <em><strong>onPreResponse</strong></em> step.</li> <li>if returned by the <em><strong>onPreResponse</strong></em> step it skips to the <em><strong>Response transmission</strong></em> step.</li> </ul> </li> <li> <p>any other response:</p> <ul> <li>overrides the request response with the provided value and continues processing the request lifecycle.</li> <li>cannot be returned from any step prior to the <em><strong>Pre-handler methods</strong></em> step.</li> </ul> </li> </ul> <p>The <a href="#authentication-scheme"><code data-language="javascript">authenticate()</code></a> method has access to two additional return values: - <a href="#h.authenticated()"><code data-language="javascript">h.authenticated()</code></a> - indicate request authenticated successfully. - <a href="#h.unauthenticated()"><code data-language="javascript">h.unauthenticated()</code></a> - indicate request failed to authenticate.</p> <p>Note that these rules apply somewhat differently when used in a <a href="#route.options.pre">pre-handler method</a>.</p> <h4 id="takeover-response">
Takeover response</h4> <p>A takeover response is a <a href="#response-object"><code data-language="javascript">response object</code></a> on which <a href="#response.takever()"><code data-language="javascript">response.takeover()</code></a> was called to signal that the <a href="#lifecycle-methods">lifecycle method</a> return value should be set as the response and skip to immediately validate and trasmit the value, bypassing other lifecycle steps.</p> <h4 id="-failaction-configuration">
  <code data-language="javascript">failAction</code> configuration</h4> <p>Various configuration options allows defining how errors are handled. For example, when invalid payload is received or malformed cookie, instead of returning an error, the framework can be configured to perform another action. When supported the <code data-language="javascript">failAction</code> option supports the following values:</p> <ul> <li> <p><code data-language="javascript">'error'</code> - return the error object as the response.</p> </li> <li> <p><code data-language="javascript">'log'</code> - report the error but continue processing the request.</p> </li> <li> <p><code data-language="javascript">'ignore'</code> - take no action and continue processing the request.</p> </li> <li> <p>a <a href="#lifecycle-methods">lifecycle method</a> with the signature <code data-language="javascript">async function(request, h, err)</code> where:</p> <ul> <li> <code data-language="javascript">request</code> - the <a href="#request">request object</a>.</li> <li> <code data-language="javascript">h</code> - the <a href="#response-toolkit">response toolkit</a>.</li> <li> <code data-language="javascript">err</code> - the error object.</li> </ul> </li> </ul> <h4 id="errors">
Errors</h4> <p><strong>hapi</strong> uses the <a href="https://hapi.dev/family/boom/api" rel="nofollow"><strong>boom</strong></a> error library for all its internal error generation. <strong>boom</strong> provides an expressive interface to return HTTP errors. Any error thrown by a <a href="#lifecycle-methods">lifecycle method</a> is converted into a <strong>boom</strong> object and defaults to status code <code data-language="javascript">500</code> if the error is not already a <strong>boom</strong> object.</p> <p>When the error is sent back to the client, the response contains a JSON object with the <code data-language="javascript">statusCode</code>, <code data-language="javascript">error</code>, and <code data-language="javascript">message</code> keys.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-v">Boom</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/boom'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/badRequest'</span><span class="pl-kos">,</span>
    <span class="pl-en">handler</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-k">throw</span> <span class="pl-v">Boom</span><span class="pl-kos">.</span><span class="pl-en">badRequest</span><span class="pl-kos">(</span><span class="pl-s">'Unsupported parameter'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>     <span class="pl-c">// 400</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/internal'</span><span class="pl-kos">,</span>
    <span class="pl-en">handler</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-v">Error</span><span class="pl-kos">(</span><span class="pl-s">'unexpect error'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>                  <span class="pl-c">// 500</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h5>
Error transformation</h5> <p>Errors can be customized by changing their <code data-language="javascript">output</code> content. The <strong>boom</strong> error object includes the following properties:</p> <ul> <li> <p><code data-language="javascript">isBoom</code> - if <code data-language="javascript">true</code>, indicates this is a <code data-language="javascript">Boom</code> object instance.</p> </li> <li> <p><code data-language="javascript">message</code> - the error message.</p> </li> <li> <p><code data-language="javascript">output</code> - the formatted response. Can be directly manipulated after object construction to return a custom error response. Allowed root keys:</p> <ul> <li> <p><code data-language="javascript">statusCode</code> - the HTTP status code (typically 4xx or 5xx).</p> </li> <li> <p><code data-language="javascript">headers</code> - an object containing any HTTP headers where each key is a header name and value is the header content.</p> </li> <li> <p><code data-language="javascript">payload</code> - the formatted object used as the response payload. Can be directly manipulated but any changes will be lost if <code data-language="javascript">reformat()</code> is called. Any content allowed and by default includes the following content:</p> <ul> <li> <p><code data-language="javascript">statusCode</code> - the HTTP status code, derived from <code data-language="javascript">error.output.statusCode</code>.</p> </li> <li> <p><code data-language="javascript">error</code> - the HTTP status message (e.g. 'Bad Request', 'Internal Server Error') derived from <code data-language="javascript">statusCode</code>.</p> </li> <li> <p><code data-language="javascript">message</code> - the error message derived from <code data-language="javascript">error.message</code>.</p> </li> </ul> </li> </ul> </li> <li> <p>inherited <code data-language="javascript">Error</code> properties.</p> </li> </ul> <p>It also supports the following method:</p> <ul> <li> <code data-language="javascript">reformat()</code> - rebuilds <code data-language="javascript">error.output</code> using the other object properties.</li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Boom</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/boom'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">handler</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">error</span> <span class="pl-c1">=</span> <span class="pl-v">Boom</span><span class="pl-kos">.</span><span class="pl-en">badRequest</span><span class="pl-kos">(</span><span class="pl-s">'Cannot feed after midnight'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">error</span><span class="pl-kos">.</span><span class="pl-c1">output</span><span class="pl-kos">.</span><span class="pl-c1">statusCode</span> <span class="pl-c1">=</span> <span class="pl-c1">499</span><span class="pl-kos">;</span>    <span class="pl-c">// Assign a custom error code</span>
    <span class="pl-s1">error</span><span class="pl-kos">.</span><span class="pl-en">reformat</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">error</span><span class="pl-kos">.</span><span class="pl-c1">output</span><span class="pl-kos">.</span><span class="pl-c1">payload</span><span class="pl-kos">.</span><span class="pl-c1">custom</span> <span class="pl-c1">=</span> <span class="pl-s">'abc_123'</span><span class="pl-kos">;</span> <span class="pl-c">// Add custom key</span>
    <span class="pl-k">throw</span> <span class="pl-s1">error</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <p>When a different error representation is desired, such as an HTML page or a different payload format, the <code data-language="javascript">'onPreResponse'</code> extension point may be used to identify errors and replace them with a different <a href="#response-object">response object</a>, as in this example using <a href="https://hapi.dev/family/vision/api" rel="nofollow">Vision's</a> <code data-language="javascript">.view()</code> <a href="#response-toolkit">response toolkit</a> property.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-v">Vision</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/vision'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">register</span><span class="pl-kos">(</span><span class="pl-v">Vision</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">err</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
    <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">views</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
        <span class="pl-c1">engines</span>: <span class="pl-kos">{</span>
            <span class="pl-c1">html</span>: <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'handlebars'</span><span class="pl-kos">)</span>
        <span class="pl-kos">}</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">preResponse</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">response</span> <span class="pl-c1">=</span> <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">response</span><span class="pl-kos">;</span>
    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-s1">response</span><span class="pl-kos">.</span><span class="pl-c1">isBoom</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-c1">continue</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>

    <span class="pl-c">// Replace error with friendly HTML</span>

      <span class="pl-k">const</span> <span class="pl-s1">error</span> <span class="pl-c1">=</span> <span class="pl-s1">response</span><span class="pl-kos">;</span>
      <span class="pl-k">const</span> <span class="pl-s1">ctx</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
          <span class="pl-c1">message</span>: <span class="pl-kos">(</span><span class="pl-s1">error</span><span class="pl-kos">.</span><span class="pl-c1">output</span><span class="pl-kos">.</span><span class="pl-c1">statusCode</span> <span class="pl-c1">===</span> <span class="pl-c1">404</span> ? <span class="pl-s">'page not found'</span> : <span class="pl-s">'something went wrong'</span><span class="pl-kos">)</span>
      <span class="pl-kos">}</span><span class="pl-kos">;</span>

      <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-en">view</span><span class="pl-kos">(</span><span class="pl-s">'error'</span><span class="pl-kos">,</span> <span class="pl-s1">ctx</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">code</span><span class="pl-kos">(</span><span class="pl-s1">error</span><span class="pl-kos">.</span><span class="pl-c1">output</span><span class="pl-kos">.</span><span class="pl-c1">statusCode</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">ext</span><span class="pl-kos">(</span><span class="pl-s">'onPreResponse'</span><span class="pl-kos">,</span> <span class="pl-en">preResponse</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="response-toolkit">
Response Toolkit</h3> <p>Access: read only.</p> <p>The response toolkit is a collection of properties and utilities passed to every <a href="#lifecycle-methods">lifecycle method</a>. It is somewhat hard to define as it provides both utilities for manipulating responses as well as other information. Since the toolkit is passed as a function argument, developers can name it whatever they want. For the purpose of this document the <code data-language="javascript">h</code> notation is used. It is named in the spirit of the RethinkDB <code data-language="javascript">r</code> method, with <code data-language="javascript">h</code> for <strong>h</strong>api.</p> <h4 id="toolkit-properties">
Toolkit properties</h4> <h5>
  <code data-language="javascript">h.abandon</code> </h5> <p>Access: read only.</p> <p>A response symbol. When returned by a lifecycle method, the request lifecycle skips to the finalizing step without further interaction with the node response stream. It is the developer's responsibility to write and end the response directly via <a href="#request.raw"><code data-language="javascript">request.raw.res</code></a>.</p> <h5>
  <code data-language="javascript">h.close</code> </h5> <p>Access: read only.</p> <p>A response symbol. When returned by a lifecycle method, the request lifecycle skips to the finalizing step after calling <code data-language="javascript">request.raw.res.end())</code> to close the node response stream.</p> <h5>
  <code data-language="javascript">h.context</code> </h5> <p>Access: read / write (will impact the shared context if the object is modified).</p> <p>A response symbol. Provides access to the route or server context set via the route <a href="#route.options.bind"><code data-language="javascript">bind</code></a> option or <a href="#server.bind()"><code data-language="javascript">server.bind()</code></a>.</p> <h5>
  <code data-language="javascript">h.continue</code> </h5> <p>Access: read only.</p> <p>A response symbol. When returned by a lifecycle method, the request lifecycle continues without changing the response.</p> <h5>
  <code data-language="javascript">h.realm</code> </h5> <p>Access: read only.</p> <p>The <a href="#server.realm">server realm</a> associated with the matching route. Defaults to the root server realm in the <em><strong>onRequest</strong></em> step.</p> <h5>
  <code data-language="javascript">h.request</code> </h5> <p>Access: read only and public request interface.</p> <p>The [request] object. This is a duplication of the <code data-language="javascript">request</code> lifecycle method argument used by <a href="#server.decorate()">toolkit decorations</a> to access the current request.</p> <h4 id="-hauthenticateddata">
  <code data-language="javascript">h.authenticated(data)</code> </h4> <p>Used by the [authentication] method to pass back valid credentials where:</p> <ul> <li> <p><code data-language="javascript">data</code> - an object with:</p> <ul> <li> <code data-language="javascript">credentials</code> - (required) object representing the authenticated entity.</li> <li> <code data-language="javascript">artifacts</code> - (optional) authentication artifacts object specific to the authentication scheme.</li> </ul> </li> </ul> <p>Return value: an internal authentication object.</p> <h4 id="-hentityoptions">
  <code data-language="javascript">h.entity(options)</code> </h4> <p>Sets the response 'ETag' and 'Last-Modified' headers and checks for any conditional request headers to decide if the response is going to qualify for an HTTP 304 (Not Modified). If the entity values match the request conditions, <code data-language="javascript">h.entity()</code> returns a <a href="#response-object">response object</a> for the lifecycle method to return as its value which will set a 304 response. Otherwise, it sets the provided entity headers and returns <code data-language="javascript">undefined</code>. The method arguments are:</p> <ul> <li> <code data-language="javascript">options</code> - a required configuration object with: <ul> <li> <code data-language="javascript">etag</code> - the ETag string. Required if <code data-language="javascript">modified</code> is not present. Defaults to no header.</li> <li> <code data-language="javascript">modified</code> - the Last-Modified header value. Required if <code data-language="javascript">etag</code> is not present. Defaults to no header.</li> <li> <code data-language="javascript">vary</code> - same as the <a href="#response.etag()"><code data-language="javascript">response.etag()</code></a> option. Defaults to <code data-language="javascript">true</code>.</li> </ul> </li> </ul> <p>Return value: - a <a href="#response-object">response object</a> if the response is unmodified. - <code data-language="javascript">undefined</code> if the response has changed.</p> <p>If <code data-language="javascript">undefined</code> is returned, the developer must return a valid lifecycle method value. If a response is returned, it should be used as the return value (but may be customize using the response methods).</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/'</span><span class="pl-kos">,</span>
    <span class="pl-c1">options</span>: <span class="pl-kos">{</span>
        <span class="pl-c1">cache</span>: <span class="pl-kos">{</span> <span class="pl-c1">expiresIn</span>: <span class="pl-c1">5000</span> <span class="pl-kos">}</span><span class="pl-kos">,</span>
        <span class="pl-en">handler</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

            <span class="pl-k">const</span> <span class="pl-s1">response</span> <span class="pl-c1">=</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-en">entity</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">etag</span>: <span class="pl-s">'abc'</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
            <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">response</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
                <span class="pl-s1">response</span><span class="pl-kos">.</span><span class="pl-en">header</span><span class="pl-kos">(</span><span class="pl-s">'X'</span><span class="pl-kos">,</span> <span class="pl-s">'y'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
                <span class="pl-k">return</span> <span class="pl-s1">response</span><span class="pl-kos">;</span>
            <span class="pl-kos">}</span>

            <span class="pl-k">return</span> <span class="pl-s">'ok'</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h4 id="-hredirecturi">
  <code data-language="javascript">h.redirect(uri)</code> </h4> <p>Redirects the client to the specified uri. Same as calling <code data-language="javascript">h.response().redirect(uri)</code>.</p> <p>Returns a <a href="#response-object">response object</a>.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-en">handler</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-en">redirect</span><span class="pl-kos">(</span><span class="pl-s">'http://example.com'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <h4 id="-hresponsevalue">
  <code data-language="javascript">h.response([value])</code> </h4> <p>Wraps the provided value and returns a <a href="#response-object"><code data-language="javascript">response</code></a> object which allows customizing the response (e.g. setting the HTTP status code, custom headers, etc.), where:</p> <ul> <li> <code data-language="javascript">value</code> - (optional) return value. Defaults to <code data-language="javascript">null</code>.</li> </ul> <p>Returns a <a href="#response-object">response object</a>.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-c">// Detailed notation</span>

<span class="pl-k">const</span> <span class="pl-en">handler</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">response</span> <span class="pl-c1">=</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-en">response</span><span class="pl-kos">(</span><span class="pl-s">'success'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">response</span><span class="pl-kos">.</span><span class="pl-en">type</span><span class="pl-kos">(</span><span class="pl-s">'text/plain'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">response</span><span class="pl-kos">.</span><span class="pl-en">header</span><span class="pl-kos">(</span><span class="pl-s">'X-Custom'</span><span class="pl-kos">,</span> <span class="pl-s">'some-value'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">return</span> <span class="pl-s1">response</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-c">// Chained notation</span>

<span class="pl-k">const</span> <span class="pl-en">handler</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-en">response</span><span class="pl-kos">(</span><span class="pl-s">'success'</span><span class="pl-kos">)</span>
        <span class="pl-kos">.</span><span class="pl-en">type</span><span class="pl-kos">(</span><span class="pl-s">'text/plain'</span><span class="pl-kos">)</span>
        <span class="pl-kos">.</span><span class="pl-en">header</span><span class="pl-kos">(</span><span class="pl-s">'X-Custom'</span><span class="pl-kos">,</span> <span class="pl-s">'some-value'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <h4 id="-hstatename-value-options">
  <code data-language="javascript">h.state(name, value, [options])</code> </h4> <p>Sets a response cookie using the same arguments as <a href="#response.state()"><code data-language="javascript">response.state()</code></a>.</p> <p>Return value: none.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-en">ext</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-en">state</span><span class="pl-kos">(</span><span class="pl-s">'cookie-name'</span><span class="pl-kos">,</span> <span class="pl-s">'value'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-c1">continue</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <h4 id="-hunauthenticatederror-data">
  <code data-language="javascript">h.unauthenticated(error, [data])</code> </h4> <p>Used by the [authentication] method to indicate authentication failed and pass back the credentials received where:</p> <ul> <li> <code data-language="javascript">error</code> - (required) the authentication error.</li> <li> <code data-language="javascript">data</code> - (optional) an object with: <ul> <li> <code data-language="javascript">credentials</code> - (required) object representing the authenticated entity.</li> <li> <code data-language="javascript">artifacts</code> - (optional) authentication artifacts object specific to the authentication scheme.</li> </ul> </li> </ul> <p>The method is used to pass both the authentication error and the credentials. For example, if a request included expired credentials, it allows the method to pass back the user information (combined with a <code data-language="javascript">'try'</code> authentication <a href="#route.options.auth.mode"><code data-language="javascript">mode</code></a>) for error customization.</p> <p>There is no difference between throwing the error or passing it with the <code data-language="javascript">h.unauthenticated()</code> method if no credentials are passed, but it might still be helpful for code clarity.</p> <h4 id="-hunstatename-options">
  <code data-language="javascript">h.unstate(name, [options])</code> </h4> <p>Clears a response cookie using the same arguments as <a href="#response.unstate()"><code data-language="javascript">response.unstate()</code></a>.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-en">ext</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-en">unstate</span><span class="pl-kos">(</span><span class="pl-s">'cookie-name'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-c1">continue</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <h3 id="response-object">
Response object</h3> <p>The response object contains the request response value along with various HTTP headers and flags. When a <a href="#lifecycle-methods">lifecycle method</a> returns a value, the value is wrapped in a response object along with some default flags (e.g. <code data-language="javascript">200</code> status code). In order to customize a response before it is returned, the <a href="#h.response()"><code data-language="javascript">h.response()</code></a> method is provided.</p> <h4 id="response-properties">
Response properties</h4> <h5>
  <code data-language="javascript">response.app</code> </h5> <p>Access: read / write.</p> <p>Default value: <code data-language="javascript">{}</code>.</p> <p>Application-specific state. Provides a safe place to store application data without potential conflicts with the framework. Should not be used by <a href="#plugins">plugins</a> which should use <a href="#response.plugins"><code data-language="javascript">plugins[name]</code></a>.</p> <h5>
  <code data-language="javascript">response.contentType</code> </h5> <p>Access: read.</p> <p>Default value: none.</p> <p>Provides a preview of the response HTTP Content-Type header based on the implicit response type, any explicit Content-Type header set, and any content character-set defined. The returned value is only a preview as the content type can change later both internally and by user code (it represents current response state). The value is <code data-language="javascript">null</code> if no implicit type can be determined.</p> <h5>
  <code data-language="javascript">response.events</code> </h5> <p>Access: read only and the public <strong>podium</strong> interface.</p> <p>The <code data-language="javascript">response.events</code> object supports the following events:</p> <ul> <li> <p><code data-language="javascript">'peek'</code> - emitted for each chunk of data written back to the client connection. The event method signature is <code data-language="javascript">function(chunk, encoding)</code>.</p> </li> <li> <p><code data-language="javascript">'finish'</code> - emitted when the response finished writing but before the client response connection is ended. The event method signature is <code data-language="javascript">function ()</code>.</p> </li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Crypto</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'crypto'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">preResponse</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">response</span> <span class="pl-c1">=</span> <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">response</span><span class="pl-kos">;</span>
    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">response</span><span class="pl-kos">.</span><span class="pl-c1">isBoom</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-k">return</span> <span class="pl-c1">null</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>

    <span class="pl-k">const</span> <span class="pl-s1">hash</span> <span class="pl-c1">=</span> <span class="pl-v">Crypto</span><span class="pl-kos">.</span><span class="pl-en">createHash</span><span class="pl-kos">(</span><span class="pl-s">'sha1'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">response</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s">'peek'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">chunk</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

        <span class="pl-s1">hash</span><span class="pl-kos">.</span><span class="pl-en">update</span><span class="pl-kos">(</span><span class="pl-s1">chunk</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-s1">response</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">once</span><span class="pl-kos">(</span><span class="pl-s">'finish'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

        <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">hash</span><span class="pl-kos">.</span><span class="pl-en">digest</span><span class="pl-kos">(</span><span class="pl-s">'hex'</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-c1">continue</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">ext</span><span class="pl-kos">(</span><span class="pl-s">'onPreResponse'</span><span class="pl-kos">,</span> <span class="pl-en">preResponse</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h5>
  <code data-language="javascript">response.headers</code> </h5> <p>Access: read only.</p> <p>Default value: <code data-language="javascript">{}</code>.</p> <p>An object containing the response headers where each key is a header field name and the value is the string header value or array of string.</p> <p>Note that this is an incomplete list of headers to be included with the response. Additional headers will be added once the response is prepared for transmission.</p> <h5>
  <code data-language="javascript">response.plugins</code> </h5> <p>Access: read / write.</p> <p>Default value: <code data-language="javascript">{}</code>.</p> <p>Plugin-specific state. Provides a place to store and pass request-level plugin data. <code data-language="javascript">plugins</code> is an object where each key is a plugin name and the value is the state.</p> <h5>
  <code data-language="javascript">response.settings</code> </h5> <p>Access: read only.</p> <p>Object containing the response handling flags.</p> <h6>
  <code data-language="javascript">response.settings.passThrough</code> </h6> <p>Access: read only.</p> <p>Defaults value: <code data-language="javascript">true</code>.</p> <p>If <code data-language="javascript">true</code> and <a href="#response.source"><code data-language="javascript">source</code></a> is a <code data-language="javascript">Stream</code>, copies the <code data-language="javascript">statusCode</code> and <code data-language="javascript">headers</code> properties of the stream object to the outbound response.</p> <h6>
  <code data-language="javascript">response.settings.stringify</code> </h6> <p>Access: read only.</p> <p>Default value: <code data-language="javascript">null</code> (use route defaults).</p> <p>Override the route <a href="#route.options.json"><code data-language="javascript">json</code></a> options used when <a href="#response.source"><code data-language="javascript">source</code></a> value requires stringification.</p> <h6>
  <code data-language="javascript">response.settings.ttl</code> </h6> <p>Access: read only.</p> <p>Default value: <code data-language="javascript">null</code> (use route defaults).</p> <p>If set, overrides the route <a href="#route.options.cache"><code data-language="javascript">cache</code></a> with an expiration value in milliseconds.</p> <h6>
  <code data-language="javascript">response.settings.varyEtag</code> </h6> <p>Default value: <code data-language="javascript">false</code>.</p> <p>If <code data-language="javascript">true</code>, a suffix will be automatically added to the 'ETag' header at transmission time (separated by a <code data-language="javascript">'-'</code> character) when the HTTP 'Vary' header is present.</p> <h5>
  <code data-language="javascript">response.source</code> </h5> <p>Access: read only.</p> <p>The raw value returned by the <a href="#lifecycle-methods">lifecycle method</a>.</p> <h5>
  <code data-language="javascript">response.statusCode</code> </h5> <p>Access: read only.</p> <p>Default value: <code data-language="javascript">200</code>.</p> <p>The HTTP response status code.</p> <h5>
  <code data-language="javascript">response.variety</code> </h5> <p>Access: read only.</p> <p>A string indicating the type of <a href="#response.source"><code data-language="javascript">source</code></a> with available values:</p> <ul> <li> <code data-language="javascript">'plain'</code> - a plain response such as string, number, <code data-language="javascript">null</code>, or simple object.</li> <li> <code data-language="javascript">'buffer'</code> - a <code data-language="javascript">Buffer</code>.</li> <li> <code data-language="javascript">'stream'</code> - a <code data-language="javascript">Stream</code>.</li> </ul> <h4 id="-responsebyteslength">
  <code data-language="javascript">response.bytes(length)</code> </h4> <p>Sets the HTTP 'Content-Length' header (to avoid chunked transfer encoding) where:</p> <ul> <li> <code data-language="javascript">length</code> - the header value. Must match the actual payload size.</li> </ul> <p>Return value: the current response object.</p> <h4 id="-responsecharsetcharset">
  <code data-language="javascript">response.charset(charset)</code> </h4> <p>Sets the 'Content-Type' HTTP header 'charset' property where:</p> <ul> <li> <code data-language="javascript">charset</code> - the charset property value. When <code data-language="javascript">charset</code> value is falsy, it will prevent hapi from using its default charset setting.</li> </ul> <p>Return value: the current response object.</p> <h4 id="-responsecodestatuscode">
  <code data-language="javascript">response.code(statusCode)</code> </h4> <p>Sets the HTTP status code where:</p> <ul> <li> <code data-language="javascript">statusCode</code> - the HTTP status code (e.g. 200).</li> </ul> <p>Return value: the current response object.</p> <h4 id="-responsemessagehttpmessage">
  <code data-language="javascript">response.message(httpMessage)</code> </h4> <p>Sets the HTTP status message where:</p> <ul> <li> <code data-language="javascript">httpMessage</code> - the HTTP status message (e.g. 'Ok' for status code 200).</li> </ul> <p>Return value: the current response object.</p> <h4 id="-responsecompressedencoding">
  <code data-language="javascript">response.compressed(encoding)</code> </h4> <p>Sets the HTTP 'content-encoding' header where:</p> <ul> <li> <code data-language="javascript">encoding</code> - the header value string.</li> </ul> <p>Return value: the current response object.</p> <p>Note that setting content encoding via this method does not set a 'vary' HTTP header with 'accept-encoding' value. To vary the response, use the <code data-language="javascript">response.header()</code> method instead.</p> <h4 id="-responsecreateduri">
  <code data-language="javascript">response.created(uri)</code> </h4> <p>Sets the HTTP status code to Created (201) and the HTTP 'Location' header where:</p> <ul> <li> <code data-language="javascript">uri</code> - an absolute or relative URI used as the 'Location' header value.</li> </ul> <p>Return value: the current response object.</p> <h4 id="-responseencodingencoding">
  <code data-language="javascript">response.encoding(encoding)</code> </h4> <p>Sets the string encoding scheme used to serial data into the HTTP payload where:</p> <ul> <li> <code data-language="javascript">encoding</code> - the encoding property value (see <a href="https://nodejs.org/api/buffer.html#buffer_buffers_and_character_encodings" rel="nofollow">node Buffer encoding</a>).</li> </ul> <p>Return value: the current response object.</p> <h4 id="-responseetagtag-options">
  <code data-language="javascript">response.etag(tag, options)</code> </h4> <p>Sets the representation <a href="https://tools.ietf.org/html/rfc7232#section-2.3" rel="nofollow">entity tag</a> where:</p> <ul> <li> <p><code data-language="javascript">tag</code> - the entity tag string without the double-quote.</p> </li> <li> <p><code data-language="javascript">options</code> - (optional) settings where:</p> <ul> <li> <p><code data-language="javascript">weak</code> - if <code data-language="javascript">true</code>, the tag will be prefixed with the <code data-language="javascript">'W/'</code> weak signifier. Weak tags will fail to match identical tags for the purpose of determining 304 response status. Defaults to <code data-language="javascript">false</code>.</p> </li> <li> <p><code data-language="javascript">vary</code> - if <code data-language="javascript">true</code> and content encoding is set or applied to the response (e.g 'gzip' or 'deflate'), the encoding name will be automatically added to the tag at transmission time (separated by a <code data-language="javascript">'-'</code> character). Ignored when <code data-language="javascript">weak</code> is <code data-language="javascript">true</code>. Defaults to <code data-language="javascript">true</code>.</p> </li> </ul> </li> </ul> <p>Return value: the current response object.</p> <h4 id="-responseheadername-value-options">
  <code data-language="javascript">response.header(name, value, options)</code> </h4> <p>Sets an HTTP header where:</p> <ul> <li> <p><code data-language="javascript">name</code> - the header name.</p> </li> <li> <p><code data-language="javascript">value</code> - the header value.</p> </li> <li> <p><code data-language="javascript">options</code> - (optional) object where:</p> <ul> <li> <p><code data-language="javascript">append</code> - if <code data-language="javascript">true</code>, the value is appended to any existing header value using <code data-language="javascript">separator</code>. Defaults to <code data-language="javascript">false</code>.</p> </li> <li> <p><code data-language="javascript">separator</code> - string used as separator when appending to an existing value. Defaults to <code data-language="javascript">','</code>.</p> </li> <li> <p><code data-language="javascript">override</code> - if <code data-language="javascript">false</code>, the header value is not set if an existing value present. Defaults to <code data-language="javascript">true</code>.</p> </li> <li> <p><code data-language="javascript">duplicate</code> - if <code data-language="javascript">false</code>, the header value is not modified if the provided value is already included. Does not apply when <code data-language="javascript">append</code> is <code data-language="javascript">false</code> or if the <code data-language="javascript">name</code> is <code data-language="javascript">'set-cookie'</code>. Defaults to <code data-language="javascript">true</code>.</p> </li> </ul> </li> </ul> <p>Return value: the current response object.</p> <h4 id="-responselocationuri">
  <code data-language="javascript">response.location(uri)</code> </h4> <p>Sets the HTTP 'Location' header where:</p> <ul> <li> <code data-language="javascript">uri</code> - an absolute or relative URI used as the 'Location' header value.</li> </ul> <p>Return value: the current response object.</p> <h4 id="-responseredirecturi">
  <code data-language="javascript">response.redirect(uri)</code> </h4> <p>Sets an HTTP redirection response (302) and decorates the response with additional methods, where:</p> <ul> <li> <code data-language="javascript">uri</code> - an absolute or relative URI used to redirect the client to another resource.</li> </ul> <p>Return value: the current response object.</p> <p>Decorates the response object with the <a href="#response.temporary()"><code data-language="javascript">response.temporary()</code></a>, <a href="#response.permanent()"><code data-language="javascript">response.permanent()</code></a>, and <a href="#response.rewritable()"><code data-language="javascript">response.rewritable()</code></a> methods to easily change the default redirection code (302).</p> <table> <thead> <tr> <th></th> <th>Permanent</th> <th>Temporary</th> </tr> </thead> <tbody> <tr> <td>Rewritable</td> <td>301</td> <td>302</td> </tr> <tr> <td>Non-rewritable</td> <td>308</td> <td>307</td> </tr> </tbody> </table> <h4 id="-responsereplacermethod">
  <code data-language="javascript">response.replacer(method)</code> </h4> <p>Sets the <code data-language="javascript">JSON.stringify()</code> <code data-language="javascript">replacer</code> argument where:</p> <ul> <li> <code data-language="javascript">method</code> - the replacer function or array. Defaults to none.</li> </ul> <p>Return value: the current response object.</p> <h4 id="-responsespacescount">
  <code data-language="javascript">response.spaces(count)</code> </h4> <p>Sets the <code data-language="javascript">JSON.stringify()</code> <code data-language="javascript">space</code> argument where:</p> <ul> <li> <code data-language="javascript">count</code> - the number of spaces to indent nested object keys. Defaults to no indentation.</li> </ul> <p>Return value: the current response object.</p> <h4 id="-responsestatename-value-options">
  <code data-language="javascript">response.state(name, value, [options])</code> </h4> <p>Sets an HTTP cookie where:</p> <ul> <li> <p><code data-language="javascript">name</code> - the cookie name.</p> </li> <li> <p><code data-language="javascript">value</code> - the cookie value. If no <code data-language="javascript">options.encoding</code> is defined, must be a string. See <a href="#server.state()"><code data-language="javascript">server.state()</code></a> for supported <code data-language="javascript">encoding</code> values.</p> </li> <li> <p><code data-language="javascript">options</code> - (optional) configuration. If the state was previously registered with the server using <a href="#server.state()"><code data-language="javascript">server.state()</code></a>, the specified keys in <code data-language="javascript">options</code> are merged with the default server definition.</p> </li> </ul> <p>Return value: the current response object.</p> <h4 id="-responsesuffixsuffix">
  <code data-language="javascript">response.suffix(suffix)</code> </h4> <p>Sets a string suffix when the response is process via <code data-language="javascript">JSON.stringify()</code> where:</p> <ul> <li> <code data-language="javascript">suffix</code> - the string suffix.</li> </ul> <p>Return value: the current response object.</p> <h4 id="-responsettlmsec">
  <code data-language="javascript">response.ttl(msec)</code> </h4> <p>Overrides the default route cache expiration rule for this response instance where:</p> <ul> <li> <code data-language="javascript">msec</code> - the time-to-live value in milliseconds.</li> </ul> <p>Return value: the current response object.</p> <h4 id="-responsetypemimetype">
  <code data-language="javascript">response.type(mimeType)</code> </h4> <p>Sets the HTTP 'Content-Type' header where:</p> <ul> <li> <code data-language="javascript">mimeType</code> - is the mime type.</li> </ul> <p>Return value: the current response object.</p> <p>Should only be used to override the built-in default for each response type.</p> <h4 id="-responseunstatename-options">
  <code data-language="javascript">response.unstate(name, [options])</code> </h4> <p>Clears the HTTP cookie by setting an expired value where:</p> <ul> <li> <code data-language="javascript">name</code> - the cookie name.</li> <li> <code data-language="javascript">options</code> - (optional) configuration for expiring cookie. If the state was previously registered with the server using <a href="#serverstatename-options"><code data-language="javascript">server.state()</code></a>, the specified <code data-language="javascript">options</code> are merged with the server definition.</li> </ul> <p>Return value: the current response object.</p> <h4 id="-responsevaryheader">
  <code data-language="javascript">response.vary(header)</code> </h4> <p>Adds the provided header to the list of inputs affected the response generation via the HTTP 'Vary' header where:</p> <ul> <li> <code data-language="javascript">header</code> - the HTTP request header name.</li> </ul> <p>Return value: the current response object.</p> <h4 id="-responsetakeover">
  <code data-language="javascript">response.takeover()</code> </h4> <p>Marks the response object as a <a href="#takeover-response">takeover response</a>.</p> <p>Return value: the current response object.</p> <h4 id="-responsetemporaryistemporary">
  <code data-language="javascript">response.temporary(isTemporary)</code> </h4> <p>Sets the status code to <code data-language="javascript">302</code> or <code data-language="javascript">307</code> (based on the <a href="#response.rewriteable()"><code data-language="javascript">response.rewritable()</code></a> setting) where:</p> <ul> <li> <code data-language="javascript">isTemporary</code> - if <code data-language="javascript">false</code>, sets status to permanent. Defaults to <code data-language="javascript">true</code>.</li> </ul> <p>Return value: the current response object.</p> <p>Only available after calling the <a href="#response.redirect()"><code data-language="javascript">response.redirect()</code></a> method.</p> <h4 id="-responsepermanentispermanent">
  <code data-language="javascript">response.permanent(isPermanent)</code> </h4> <p>Sets the status code to <code data-language="javascript">301</code> or <code data-language="javascript">308</code> (based on the <a href="#response.rewritable()"><code data-language="javascript">response.rewritable()</code></a> setting) where:</p> <ul> <li> <code data-language="javascript">isPermanent</code> - if <code data-language="javascript">false</code>, sets status to temporary. Defaults to <code data-language="javascript">true</code>.</li> </ul> <p>Return value: the current response object.</p> <p>Only available after calling the <a href="#response.redirect()"><code data-language="javascript">response.redirect()</code></a> method.</p> <h4 id="-responserewritableisrewritable">
  <code data-language="javascript">response.rewritable(isRewritable)</code> </h4> <p>Sets the status code to <code data-language="javascript">301</code>/<code data-language="javascript">302</code> for rewritable (allows changing the request method from 'POST' to 'GET') or <code data-language="javascript">307</code>/<code data-language="javascript">308</code> for non-rewritable (does not allow changing the request method from 'POST' to 'GET'). Exact code based on the <a href="#response.temporary()"><code data-language="javascript">response.temporary()</code></a> or <a href="#response.permanent()"><code data-language="javascript">response.permanent()</code></a> setting. Arguments:</p> <ul> <li> <code data-language="javascript">isRewritable</code> - if <code data-language="javascript">false</code>, sets to non-rewritable. Defaults to <code data-language="javascript">true</code>.</li> </ul> <p>Return value: the current response object.</p> <p>Only available after calling the <a href="#response.redirect()"><code data-language="javascript">response.redirect()</code></a> method.</p> <h2>
Request</h2> <p>The request object is created internally for each incoming request. It is not the same object received from the node HTTP server callback (which is available via <a href="#request.raw"><code data-language="javascript">request.raw.req</code></a>). The request properties change throughout the <a href="#request-lifecycle">request lifecycle</a>.</p> <h3 id="request-properties">
Request properties</h3> <h4 id="-requestapp">
  <code data-language="javascript">request.app</code> </h4> <p>Access: read / write.</p> <p>Application-specific state. Provides a safe place to store application data without potential conflicts with the framework. Should not be used by <a href="#plugins">plugins</a> which should use <code data-language="javascript">plugins[name]</code>.</p> <h4 id="-requestauth">
  <code data-language="javascript">request.auth</code> </h4> <p>Access: read only.</p> <p>Authentication information:</p> <ul> <li> <p><code data-language="javascript">artifacts</code> - an artifact object received from the authentication strategy and used in authentication-related actions.</p> </li> <li> <p><code data-language="javascript">credentials</code> - the <code data-language="javascript">credential</code> object received during the authentication process. The presence of an object does not mean successful authentication.</p> </li> <li> <p><code data-language="javascript">error</code> - the authentication error if failed and mode set to <code data-language="javascript">'try'</code>.</p> </li> <li> <p><code data-language="javascript">isAuthenticated</code> - <code data-language="javascript">true</code> if the request has been successfully authenticated, otherwise <code data-language="javascript">false</code>.</p> </li> <li> <p><code data-language="javascript">isAuthorized</code> - <code data-language="javascript">true</code> is the request has been successfully authorized against the route authentication <a href="#route.options.auth.access"><code data-language="javascript">access</code></a> configuration. If the route has not access rules defined or if the request failed authorization, set to <code data-language="javascript">false</code>.</p> </li> <li> <p><code data-language="javascript">isInjected</code> - <code data-language="javascript">true</code> if the request has been authenticated via the <a href="#server.inject()"><code data-language="javascript">server.inject()</code></a> <code data-language="javascript">auth</code> option, otherwise <code data-language="javascript">undefined</code>.</p> </li> <li> <p><code data-language="javascript">mode</code> - the route authentication mode.</p> </li> <li> <p><code data-language="javascript">strategy</code> - the name of the strategy used.</p> </li> </ul> <h4 id="-requestevents">
  <code data-language="javascript">request.events</code> </h4> <p>Access: read only and the public <strong>podium</strong> interface.</p> <p>The <code data-language="javascript">request.events</code> supports the following events:</p> <ul> <li> <p><code data-language="javascript">'peek'</code> - emitted for each chunk of payload data read from the client connection. The event method signature is <code data-language="javascript">function(chunk, encoding)</code>.</p> </li> <li> <p><code data-language="javascript">'finish'</code> - emitted when the request payload finished reading. The event method signature is <code data-language="javascript">function ()</code>.</p> </li> <li> <p><code data-language="javascript">'disconnect'</code> - emitted when a request errors or aborts unexpectedly.</p> </li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Crypto</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'crypto'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">onRequest</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-k">const</span> <span class="pl-s1">hash</span> <span class="pl-c1">=</span> <span class="pl-v">Crypto</span><span class="pl-kos">.</span><span class="pl-en">createHash</span><span class="pl-kos">(</span><span class="pl-s">'sha1'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-s">'peek'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">chunk</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

        <span class="pl-s1">hash</span><span class="pl-kos">.</span><span class="pl-en">update</span><span class="pl-kos">(</span><span class="pl-s1">chunk</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">once</span><span class="pl-kos">(</span><span class="pl-s">'finish'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

        <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">hash</span><span class="pl-kos">.</span><span class="pl-en">digest</span><span class="pl-kos">(</span><span class="pl-s">'hex'</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">once</span><span class="pl-kos">(</span><span class="pl-s">'disconnect'</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

        <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">error</span><span class="pl-kos">(</span><span class="pl-s">'request aborted'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

    <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-c1">continue</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">ext</span><span class="pl-kos">(</span><span class="pl-s">'onRequest'</span><span class="pl-kos">,</span> <span class="pl-en">onRequest</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h4 id="-requestheaders">
  <code data-language="javascript">request.headers</code> </h4> <p>Access: read only.</p> <p>The raw request headers (references <code data-language="javascript">request.raw.req.headers</code>).</p> <h4 id="-requestinfo">
  <code data-language="javascript">request.info</code> </h4> <p>Access: read only.</p> <p>Request information:</p> <ul> <li> <p><code data-language="javascript">acceptEncoding</code> - the request preferred encoding.</p> </li> <li> <p><code data-language="javascript">completed</code> - request processing completion timestamp (<code data-language="javascript">0</code> is still processing).</p> </li> <li> <p><code data-language="javascript">cors</code> - request CORS information (available only after the <code data-language="javascript">'onRequest'</code> extension point as CORS is configured per-route and no routing decisions are made at that point in the request lifecycle), where:</p> <ul> <li> <code data-language="javascript">isOriginMatch</code> - <code data-language="javascript">true</code> if the request 'Origin' header matches the configured CORS restrictions. Set to <code data-language="javascript">false</code> if no 'Origin' header is found or if it does not match.</li> </ul> </li> <li> <p><code data-language="javascript">host</code> - content of the HTTP 'Host' header (e.g. 'example.com:8080').</p> </li> <li> <p><code data-language="javascript">hostname</code> - the hostname part of the 'Host' header (e.g. 'example.com').</p> </li> <li> <p><code data-language="javascript">id</code> - a unique request identifier (using the format '{now}:{server.info.id}:{5 digits counter}').</p> </li> <li> <p><code data-language="javascript">received</code> - request reception timestamp.</p> </li> <li> <p><code data-language="javascript">referrer</code> - content of the HTTP 'Referrer' (or 'Referer') header.</p> </li> <li> <p><code data-language="javascript">remoteAddress</code> - remote client IP address.</p> </li> <li> <p><code data-language="javascript">remotePort</code> - remote client port.</p> </li> <li> <p><code data-language="javascript">responded</code> - request response timestamp (<code data-language="javascript">0</code> is not responded yet or response failed when <code data-language="javascript">completed</code> is set).</p> </li> </ul> <p>Note that the <code data-language="javascript">request.info</code> object is not meant to be modified.</p> <h4 id="-requestisinjected">
  <code data-language="javascript">request.isInjected</code> </h4> <p>Access: read only.</p> <p><code data-language="javascript">true</code> if the request was created via <a href="#server.inject()"><code data-language="javascript">server.inject()</code></a>, and <code data-language="javascript">false</code> otherwise.</p> <h4 id="-requestlogs">
  <code data-language="javascript">request.logs</code> </h4> <p>Access: read only.</p> <p>An array containing the logged request events.</p> <p>Note that this array will be empty if route <a href="#route.options.log"><code data-language="javascript">log.collect</code></a> is set to <code data-language="javascript">false</code>.</p> <h4 id="-requestmethod">
  <code data-language="javascript">request.method</code> </h4> <p>Access: read only.</p> <p>The request method in lower case (e.g. <code data-language="javascript">'get'</code>, <code data-language="javascript">'post'</code>).</p> <h4 id="-requestmime">
  <code data-language="javascript">request.mime</code> </h4> <p>Access: read only.</p> <p>The parsed content-type header. Only available when payload parsing enabled and no payload error occurred.</p> <h4 id="-requestorig">
  <code data-language="javascript">request.orig</code> </h4> <p>Access: read only.</p> <p>An object containing the values of <code data-language="javascript">params</code>, <code data-language="javascript">query</code>, <code data-language="javascript">payload</code> and <code data-language="javascript">state</code> before any validation modifications made. Only set when input validation is performed.</p> <h4 id="-requestparams">
  <code data-language="javascript">request.params</code> </h4> <p>Access: read only.</p> <p>An object where each key is a path parameter name with matching value as described in <a href="#path-parameters">Path parameters</a>.</p> <h4 id="-requestparamsarray">
  <code data-language="javascript">request.paramsArray</code> </h4> <p>Access: read only.</p> <p>An array containing all the path <code data-language="javascript">params</code> values in the order they appeared in the path.</p> <h4 id="-requestpath">
  <code data-language="javascript">request.path</code> </h4> <p>Access: read only.</p> <p>The request URI's <a href="https://nodejs.org/api/url.html#url_urlobject_pathname" rel="nofollow">pathname</a> component.</p> <h4 id="-requestpayload">
  <code data-language="javascript">request.payload</code> </h4> <p>Access: read only / write in <code data-language="javascript">'onRequest'</code> extension method.</p> <p>The request payload based on the route <code data-language="javascript">payload.output</code> and <code data-language="javascript">payload.parse</code> settings. Set to <code data-language="javascript">undefined</code> in <code data-language="javascript">'onRequest'</code> extension methods and can be overridden to any non-<code data-language="javascript">undefined</code> value to bypass payload processing.</p> <h4 id="-requestplugins">
  <code data-language="javascript">request.plugins</code> </h4> <p>Access: read / write.</p> <p>Plugin-specific state. Provides a place to store and pass request-level plugin data. The <code data-language="javascript">plugins</code> is an object where each key is a plugin name and the value is the state.</p> <h4 id="-requestpre">
  <code data-language="javascript">request.pre</code> </h4> <p>Access: read only.</p> <p>An object where each key is the name assigned by a <a href="#route.options.pre">route pre-handler methods</a> function. The values are the raw values provided to the continuation function as argument. For the wrapped response object, use <code data-language="javascript">responses</code>.</p> <h4 id="-requestresponse">
  <code data-language="javascript">request.response</code> </h4> <p>Access: read / write (see limitations below).</p> <p>The response object when set. The object can be modified but must not be assigned another object. To replace the response with another from within an <a href="#server.ext()">extension point</a>, return a new response value. Contains an error when a request terminates prematurely when the client disconnects.</p> <h4 id="-requestpreresponses">
  <code data-language="javascript">request.preResponses</code> </h4> <p>Access: read only.</p> <p>Same as <code data-language="javascript">pre</code> but represented as the response object created by the pre method.</p> <h4 id="-requestquery">
  <code data-language="javascript">request.query</code> </h4> <p>Access: read only.</p> <p>An object where each key is a query parameter name and each matching value is the parameter value or an array of values if a parameter repeats. Can be modified indirectly via <a href="#request.setUrl()">request.setUrl</a>.</p> <h4 id="-requestraw">
  <code data-language="javascript">request.raw</code> </h4> <p>Access: read only.</p> <p>An object containing the Node HTTP server objects. <strong>Direct interaction with these raw objects is not recommended.</strong></p> <ul> <li> <code data-language="javascript">req</code> - the node request object.</li> <li> <code data-language="javascript">res</code> - the node response object.</li> </ul> <h4 id="-requestroute">
  <code data-language="javascript">request.route</code> </h4> <p>Access: read only.</p> <p>The request route information object, where:</p> <ul> <li> <code data-language="javascript">method</code> - the route HTTP method.</li> <li> <code data-language="javascript">path</code> - the route path.</li> <li> <code data-language="javascript">vhost</code> - the route vhost option if configured.</li> <li> <code data-language="javascript">realm</code> - the <a href="#server.realm">active realm</a> associated with the route.</li> <li> <code data-language="javascript">settings</code> - the <a href="#route-options">route options</a> object with all defaults applied.</li> <li> <code data-language="javascript">fingerprint</code> - the route internal normalized string representing the normalized path.</li> </ul> <h4 id="-requestserver">
  <code data-language="javascript">request.server</code> </h4> <p>Access: read only and the public server interface.</p> <p>The server object.</p> <h4 id="-requeststate">
  <code data-language="javascript">request.state</code> </h4> <p>Access: read only.</p> <p>An object containing parsed HTTP state information (cookies) where each key is the cookie name and value is the matching cookie content after processing using any registered cookie definition.</p> <h4 id="-requesturl">
  <code data-language="javascript">request.url</code> </h4> <p>Access: read only.</p> <p>The parsed request URI.</p> <h3 id="-requestgenerateresponsesource-options">
  <code data-language="javascript">request.generateResponse(source, [options])</code> </h3> <p>Returns a <a href="#response-object"><code data-language="javascript">response</code></a> which you can pass to <a href="#h.response()">h.response()</a> where:</p> <ul> <li> <code data-language="javascript">source</code> - the value to set as the source of <a href="#h.response()">h.response()</a>, optional.</li> <li> <code data-language="javascript">options</code> - optional object with the following optional properties: <ul> <li> <code data-language="javascript">variety</code> - a sting name of the response type (e.g. <code data-language="javascript">'file'</code>).</li> <li> <code data-language="javascript">prepare</code> - a function with the signature <code data-language="javascript">async function(response)</code> used to prepare the response after it is returned by a <a href="#lifecycle-methods">lifecycle method</a> such as setting a file descriptor, where: <ul> <li> <code data-language="javascript">response</code> - the response object being prepared.</li> <li>must return the prepared response object (<code data-language="javascript">response</code>).</li> <li>may throw an error which is used as the prepared response.</li> </ul> </li> <li> <code data-language="javascript">marshal</code> - a function with the signature <code data-language="javascript">async function(response)</code> used to prepare the response for transmission to the client before it is sent, where: <ul> <li> <code data-language="javascript">response</code> - the response object being marshaled.</li> <li>must return the prepared value (not as response object) which can be any value accepted by the <a href="#h.response()"><code data-language="javascript">h.response()</code></a> <code data-language="javascript">value</code> argument.</li> <li>may throw an error which is used as the marshaled value.</li> </ul> </li> <li> <code data-language="javascript">close</code> - a function with the signature <code data-language="javascript">function(response)</code> used to close the resources opened by the response object (e.g. file handlers), where: <ul> <li> <code data-language="javascript">response</code> - the response object being marshaled.</li> <li>should not throw errors (which are logged but otherwise ignored).</li> </ul> </li> </ul> </li> </ul> <h3 id="-requestactive">
  <code data-language="javascript">request.active()</code> </h3> <p>Returns <code data-language="javascript">true</code> when the request is active and processing should continue and <code data-language="javascript">false</code> when the request terminated early or completed its lifecycle. Useful when request processing is a resource-intensive operation and should be terminated early if the request is no longer active (e.g. client disconnected or aborted early).</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
    <span class="pl-c1">method</span>: <span class="pl-s">'POST'</span><span class="pl-kos">,</span>
    <span class="pl-c1">path</span>: <span class="pl-s">'/worker'</span><span class="pl-kos">,</span>
    <span class="pl-en">handler</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-c">// Do some work...</span>

        <span class="pl-c">// Check if request is still active</span>
        <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-en">active</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
            <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-c1">close</span><span class="pl-kos">;</span>
        <span class="pl-kos">}</span>

        <span class="pl-c">// Do some more work...</span>

        <span class="pl-k">return</span> <span class="pl-c1">null</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-requestlogtags-data">
  <code data-language="javascript">request.log(tags, [data])</code> </h3> <p>Logs request-specific events. When called, the server emits a <a href="#server.events.request"><code data-language="javascript">'request'</code> event</a> on the <code data-language="javascript">'app'</code> channel which can be used by other listeners or <a href="#plugins">plugins</a>. The arguments are:</p> <ul> <li> <code data-language="javascript">tags</code> - a string or an array of strings (e.g. <code data-language="javascript">['error', 'database', 'read']</code>) used to identify the event. Tags are used instead of log levels and provide a much more expressive mechanism for describing and filtering events.</li> <li> <code data-language="javascript">data</code> - (optional) an message string or object with the application data being logged. If <code data-language="javascript">data</code> is a function, the function signature is <code data-language="javascript">function()</code> and it called once to generate (return value) the actual data emitted to the listeners.</li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span><span class="pl-kos">,</span> <span class="pl-c1">routes</span>: <span class="pl-kos">{</span> <span class="pl-c1">log</span>: <span class="pl-kos">{</span> <span class="pl-c1">collect</span>: <span class="pl-c1">true</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">name</span>: <span class="pl-s">'request'</span><span class="pl-kos">,</span> <span class="pl-c1">channels</span>: <span class="pl-s">'app'</span> <span class="pl-kos">}</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">event</span><span class="pl-kos">,</span> <span class="pl-s1">tags</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">tags</span><span class="pl-kos">.</span><span class="pl-c1">error</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">event</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">handler</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-kos">[</span><span class="pl-s">'test'</span><span class="pl-kos">,</span> <span class="pl-s">'error'</span><span class="pl-kos">]</span><span class="pl-kos">,</span> <span class="pl-s">'Test event'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">return</span> <span class="pl-c1">null</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <p>Note that any logs generated by the server internally will be emitted using the <a href="#server.events.request"><code data-language="javascript">'request'</code> event</a> on the <code data-language="javascript">'internal'</code> channel.</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-c1">events</span><span class="pl-kos">.</span><span class="pl-en">on</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">name</span>: <span class="pl-s">'request'</span><span class="pl-kos">,</span> <span class="pl-c1">channels</span>: <span class="pl-s">'internal'</span> <span class="pl-kos">}</span><span class="pl-kos">,</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">event</span><span class="pl-kos">,</span> <span class="pl-s1">tags</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>

    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s1">event</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <h3 id="-requestrouteauthaccessrequest">
  <code data-language="javascript">request.route.auth.access(request)</code> </h3> <p>Validates a request against the route's authentication <a href="#route.options.auth.access"><code data-language="javascript">access</code></a> configuration, where:</p> <ul> <li> <code data-language="javascript">request</code> - the <a href="#request">request object</a>.</li> </ul> <p>Return value: <code data-language="javascript">true</code> if the <code data-language="javascript">request</code> would have passed the route's access requirements.</p> <p>Note that the route's authentication mode and strategies are ignored. The only match is made between the <code data-language="javascript">request.auth.credentials</code> scope and entity information and the route <a href="#route.options.auth.access"><code data-language="javascript">access</code></a> configuration.</p> <p>If the route uses dynamic scopes, the scopes are constructed against the <a href="#request.query"><code data-language="javascript">request.query</code></a>, <a href="#request.params"><code data-language="javascript">request.params</code></a>, <a href="#request.payload"><code data-language="javascript">request.payload</code></a>, and <a href="#request.auth"><code data-language="javascript">request.auth.credentials</code></a> which may or may not match between the route and the request's route. If this method is called using a request that has not been authenticated (yet or not at all), it will return <code data-language="javascript">false</code> if the route requires any authentication.</p> <h3 id="-requestsetmethodmethod">
  <code data-language="javascript">request.setMethod(method)</code> </h3> <p>Changes the request method before the router begins processing the request where:</p> <ul> <li> <code data-language="javascript">method</code> - is the request HTTP method (e.g. <code data-language="javascript">'GET'</code>).</li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">onRequest</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-c">// Change all requests to 'GET'</span>
    <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-en">setMethod</span><span class="pl-kos">(</span><span class="pl-s">'GET'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-c1">continue</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">ext</span><span class="pl-kos">(</span><span class="pl-s">'onRequest'</span><span class="pl-kos">,</span> <span class="pl-en">onRequest</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <p>Can only be called from an <code data-language="javascript">'onRequest'</code> extension method.</p> <h3 id="-requestseturlurl-striptrailingslash">
  <code data-language="javascript">request.setUrl(url, [stripTrailingSlash]</code> </h3> <p>Changes the request URI before the router begins processing the request where:</p> <ul> <li> <code data-language="javascript">url</code> - the new request URI. <code data-language="javascript">url</code> can be a string or an instance of <a href="https://nodejs.org/dist/latest-v10.x/docs/api/url.html#url_class_url" rel="nofollow"><code data-language="javascript">Url.URL</code></a> in which case <code data-language="javascript">url.href</code> is used.</li> <li> <code data-language="javascript">stripTrailingSlash</code> - if <code data-language="javascript">true</code>, strip the trailing slash from the path. Defaults to <code data-language="javascript">false</code>.</li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-v">Hapi</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'@hapi/hapi'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-k">const</span> <span class="pl-s1">server</span> <span class="pl-c1">=</span> <span class="pl-v">Hapi</span><span class="pl-kos">.</span><span class="pl-en">server</span><span class="pl-kos">(</span><span class="pl-kos">{</span> <span class="pl-c1">port</span>: <span class="pl-c1">80</span> <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-k">const</span> <span class="pl-en">onRequest</span> <span class="pl-c1">=</span> <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

    <span class="pl-c">// Change all requests to '/test'</span>
    <span class="pl-s1">request</span><span class="pl-kos">.</span><span class="pl-en">setUrl</span><span class="pl-kos">(</span><span class="pl-s">'/test'</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-k">return</span> <span class="pl-s1">h</span><span class="pl-kos">.</span><span class="pl-c1">continue</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span>

<span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">ext</span><span class="pl-kos">(</span><span class="pl-s">'onRequest'</span><span class="pl-kos">,</span> <span class="pl-en">onRequest</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div> <p>Can only be called from an <code data-language="javascript">'onRequest'</code> extension method.</p> <h2>
Plugins</h2> <p>Plugins provide a way to organize application code by splitting the server logic into smaller components. Each plugin can manipulate the server through the standard server interface, but with the added ability to sandbox certain properties. For example, setting a file path in one plugin doesn't affect the file path set in another plugin.</p> <p>A plugin is an object with the following properties:</p> <ul> <li> <p><code data-language="javascript">register</code> - (required) the registration function with the signature <code data-language="javascript">async function(server, options)</code> where:</p> <ul> <li> <code data-language="javascript">server</code> - the server object with a plugin-specific <a href="#server.realm"><code data-language="javascript">server.realm</code></a>.</li> <li> <code data-language="javascript">options</code> - any options passed to the plugin during registration via <a href="#server.register()"><code data-language="javascript">server.register()</code></a>.</li> </ul> </li> <li> <p><code data-language="javascript">name</code> - (required) the plugin name string. The name is used as a unique key. Published plugins (e.g. published in the npm registry) should use the same name as the name field in their 'package.json' file. Names must be unique within each application.</p> </li> <li> <p><code data-language="javascript">version</code> - (optional) plugin version string. The version is only used informatively to enable other plugins to find out the versions loaded. The version should be the same as the one specified in the plugin's 'package.json' file.</p> </li> <li> <p><code data-language="javascript">multiple</code> - (optional) if <code data-language="javascript">true</code>, allows the plugin to be registered multiple times with the same server. Defaults to <code data-language="javascript">false</code>.</p> </li> <li> <p><code data-language="javascript">dependencies</code> - (optional) a string or an array of strings indicating a plugin dependency. Same as setting dependencies via <a href="#server.dependency()"><code data-language="javascript">server.dependency()</code></a>.</p> </li> <li> <p><code data-language="javascript">requirements</code> - (optional) object declaring the plugin supported <a href="https://semver.org/" rel="nofollow">semver range</a> for:</p> <ul> <li> <code data-language="javascript">node</code> runtime <a href="https://nodejs.org/en/about/releases/" rel="nofollow">semver range</a> string.</li> <li> <code data-language="javascript">hapi</code> framework <a href="#server.version">semver range</a> string.</li> </ul> </li> <li> <p><code data-language="javascript">once</code> - (optional) if <code data-language="javascript">true</code>, will only register the plugin once per server. If set, overrides the <code data-language="javascript">once</code> option passed to <a href="#server.register()"><code data-language="javascript">server.register()</code></a>. Defaults to no override.</p> </li> </ul> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-s1">plugin</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
    <span class="pl-c1">name</span>: <span class="pl-s">'test'</span><span class="pl-kos">,</span>
    <span class="pl-c1">version</span>: <span class="pl-s">'1.0.0'</span><span class="pl-kos">,</span>
    <span class="pl-en">register</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
            <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
            <span class="pl-c1">path</span>: <span class="pl-s">'/test'</span><span class="pl-kos">,</span>
            <span class="pl-en">handler</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

                <span class="pl-k">return</span> <span class="pl-s">'ok'</span><span class="pl-kos">;</span>
            <span class="pl-kos">}</span>
        <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div> <p>Alternatively, the <code data-language="javascript">name</code> and <code data-language="javascript">version</code> can be included via the <code data-language="javascript">pkg</code> property containing the 'package.json' file for the module which already has the name and version included:</p> <div class="highlight highlight-source-js"><pre data-language="javascript"><span class="pl-k">const</span> <span class="pl-s1">plugin</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
    <span class="pl-c1">pkg</span>: <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'./package.json'</span><span class="pl-kos">)</span><span class="pl-kos">,</span>
    <span class="pl-en">register</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">server</span><span class="pl-kos">,</span> <span class="pl-s1">options</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

        <span class="pl-s1">server</span><span class="pl-kos">.</span><span class="pl-en">route</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
            <span class="pl-c1">method</span>: <span class="pl-s">'GET'</span><span class="pl-kos">,</span>
            <span class="pl-c1">path</span>: <span class="pl-s">'/test'</span><span class="pl-kos">,</span>
            <span class="pl-en">handler</span>: <span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">,</span> <span class="pl-s1">h</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>

                <span class="pl-k">return</span> <span class="pl-s">'ok'</span><span class="pl-kos">;</span>
            <span class="pl-kos">}</span>
        <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
<span class="pl-kos">}</span><span class="pl-kos">;</span></pre></div>
<div class="_attribution">
  <p class="_attribution-p">
    Copyright © 2011-2022, Project contributors Copyright © 2011-2020, Sideway Inc Copyright © 2011-2014, Walmart<br>Copyright © 2011, Yahoo Inc.<br>Licensed under the BSD 3-clause License.<br>
    <a href="https://hapi.dev/api/?v=21.3.2" class="_attribution-link">https://hapi.dev/api/?v=21.3.2</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
