
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>PrettyPrint - Ruby 3 - W3cubDocs</title>
  
  <meta name="description" content=" This class implements a pretty printing algorithm. It finds line breaks and nice indentations for grouped structure. ">
  <meta name="keywords" content="class, prettyprint, ruby, ruby~3">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/ruby~3/prettyprint.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/ruby~3.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ruby~3/" class="_nav-link" title="" style="margin-left:0;">Ruby 3</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _rdoc">
				
				
<h1 id="class-PrettyPrint" class="class"> class PrettyPrint </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="object">Object</a></dd>
</dl> <section class="description"> <p>This class implements a pretty printing algorithm. It finds line breaks and nice indentations for grouped structure.</p> <p>By default, the class assumes that primitive elements are strings and each byte in the strings have single column in width. But it can be used for other situations by giving suitable arguments for some methods:</p> <ul>
<li> <p>newline object and space generation block for <a href="prettyprint#method-c-new"><code>PrettyPrint.new</code></a></p> </li>
<li> <p>optional width argument for <a href="prettyprint#method-i-text"><code>PrettyPrint#text</code></a></p> </li>
<li> <p><a href="prettyprint#method-i-breakable"><code>PrettyPrint#breakable</code></a></p> </li>
</ul> <p>There are several candidate uses:</p> <ul>
<li> <p>text formatting using proportional fonts</p> </li>
<li> <p>multibyte characters which has columns different to number of bytes</p> </li>
<li> <p>non-string formatting</p> </li>
</ul> <h2 id="class-PrettyPrint-label-Bugs">Bugs</h2> <ul>
<li> <p>Box based formatting?</p> </li>
<li> <p>Other (better) model/algorithm?</p> </li>
</ul> <p>Report any bugs at <a href="http://bugs.ruby-lang.org">bugs.ruby-lang.org</a></p> <h2 id="class-PrettyPrint-label-References">References</h2> <p>Christian Lindig, Strictly Pretty, March 2000, <a href="http://www.st.cs.uni-sb.de/~lindig/papers/#pretty">www.st.cs.uni-sb.de/~lindig/papers/#pretty</a></p> <p>Philip Wadler, A prettier printer, March 1998, <a href="http://homepages.inf.ed.ac.uk/wadler/topics/language-design.html#prettier">homepages.inf.ed.ac.uk/wadler/topics/language-design.html#prettier</a></p> <h2 id="class-PrettyPrint-label-Author">Author</h2> <p>Tanaka Akira &lt;akr@fsij.org&gt;</p> </section> <section id="5Buntitled-5D" class="documentation-section"> <section class="attribute-method-details"> <header> <h3>Attributes</h3> </header> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-genspace"> <span class="method-name">genspace</span><span class="attribute-access-type">[R]</span> </div> <div class="method-description"> <p>A lambda or <a href="proc"><code>Proc</code></a>, that takes one argument, of an <a href="integer"><code>Integer</code></a>, and returns the corresponding number of spaces.</p> <p>By default this is:</p> <pre class="ruby" data-language="ruby">lambda {|n| ' ' * n}
</pre> </div> </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-group_queue"> <span class="method-name">group_queue</span><span class="attribute-access-type">[R]</span> </div> <div class="method-description"> <p>The PrettyPrint::GroupQueue of groups in stack to be pretty printed</p> </div> </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-indent"> <span class="method-name">indent</span><span class="attribute-access-type">[R]</span> </div> <div class="method-description"> <p>The number of spaces to be indented</p> </div> </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-maxwidth"> <span class="method-name">maxwidth</span><span class="attribute-access-type">[R]</span> </div> <div class="method-description"> <p>The maximum width of a line, before it is separated in to a newline</p> <p>This defaults to 79, and should be an <a href="integer"><code>Integer</code></a></p> </div> </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-newline"> <span class="method-name">newline</span><span class="attribute-access-type">[R]</span> </div> <div class="method-description"> <p>The value that is appended to <code>output</code> to add a new line.</p> <p>This defaults to “n”, and should be <a href="string"><code>String</code></a></p> </div> </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-output"> <span class="method-name">output</span><span class="attribute-access-type">[R]</span> </div> <div class="method-description"> <p>The output object.</p> <p>This defaults to '', and should accept the &lt;&lt; method</p> </div> </div> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-format"> <span class="method-name">format</span><span class="method-args">(output=''.dup, maxwidth=79, newline="\n", genspace=lambda {|n| ' ' * n}) { |q| ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="format-source"> <pre class="ruby" data-language="ruby"># File lib/prettyprint.rb, line 45
def PrettyPrint.format(output=''.dup, maxwidth=79, newline="\n", genspace=lambda {|n| ' ' * n})
  q = PrettyPrint.new(output, maxwidth, newline, &amp;genspace)
  yield q
  q.flush
  output
end</pre> </div> <p>This is a convenience method which is same as follows:</p> <pre class="ruby" data-language="ruby">begin
  q = PrettyPrint.new(output, maxwidth, newline, &amp;genspace)
  ...
  q.flush
  output
end
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-new"> <span class="method-name">new</span><span class="method-args">(output=''.dup, maxwidth=79, newline="\n", &amp;genspace)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="new-source"> <pre class="ruby" data-language="ruby"># File lib/prettyprint.rb, line 82
def initialize(output=''.dup, maxwidth=79, newline="\n", &amp;genspace)
  @output = output
  @maxwidth = maxwidth
  @newline = newline
  @genspace = genspace || lambda {|n| ' ' * n}

  @output_width = 0
  @buffer_width = 0
  @buffer = []

  root_group = Group.new(0)
  @group_stack = [root_group]
  @group_queue = GroupQueue.new(root_group)
  @indent = 0
end</pre> </div> <p>Creates a buffer for pretty printing.</p> <p><code>output</code> is an output target. If it is not specified, '' is assumed. It should have a &lt;&lt; method which accepts the first argument <code>obj</code> of <a href="prettyprint#method-i-text"><code>PrettyPrint#text</code></a>, the first argument <code>sep</code> of <a href="prettyprint#method-i-breakable"><code>PrettyPrint#breakable</code></a>, the first argument <code>newline</code> of <a href="prettyprint#method-c-new"><code>PrettyPrint.new</code></a>, and the result of a given block for <a href="prettyprint#method-c-new"><code>PrettyPrint.new</code></a>.</p> <p><code>maxwidth</code> specifies maximum line length. If it is not specified, 79 is assumed. However actual outputs may overflow <code>maxwidth</code> if long non-breakable texts are provided.</p> <p><code>newline</code> is used for line breaks. “n” is used if it is not specified.</p> <p>The block is used to generate spaces. {|width| ' ' * width} is used if it is not given.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-singleline_format"> <span class="method-name">singleline_format</span><span class="method-args">(output=''.dup, maxwidth=nil, newline=nil, genspace=nil) { |q| ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="singleline_format-source"> <pre class="ruby" data-language="ruby"># File lib/prettyprint.rb, line 59
def PrettyPrint.singleline_format(output=''.dup, maxwidth=nil, newline=nil, genspace=nil)
  q = SingleLine.new(output)
  yield q
  output
end</pre> </div> <p>This is similar to <a href="prettyprint#method-c-format"><code>PrettyPrint::format</code></a> but the result has no breaks.</p> <p><code>maxwidth</code>, <code>newline</code> and <code>genspace</code> are ignored.</p> <p>The invocation of <code>breakable</code> in the block doesn't break a line and is treated as just an invocation of <code>text</code>.</p>  </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-break_outmost_groups"> <span class="method-name">break_outmost_groups</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="break_outmost_groups-source"> <pre class="ruby" data-language="ruby"># File lib/prettyprint.rb, line 160
def break_outmost_groups
  while @maxwidth &lt; @output_width + @buffer_width
    return unless group = @group_queue.deq
    until group.breakables.empty?
      data = @buffer.shift
      @output_width = data.output(@output, @output_width)
      @buffer_width -= data.width
    end
    while !@buffer.empty? &amp;&amp; Text === @buffer.first
      text = @buffer.shift
      @output_width = text.output(@output, @output_width)
      @buffer_width -= text.width
    end
  end
end</pre> </div> <p>Breaks the buffer into lines that are shorter than <a href="prettyprint#attribute-i-maxwidth"><code>maxwidth</code></a></p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-breakable"> <span class="method-name">breakable</span><span class="method-args">(sep=' ', width=sep.length)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="breakable-source"> <pre class="ruby" data-language="ruby"># File lib/prettyprint.rb, line 224
def breakable(sep=' ', width=sep.length)
  group = @group_stack.last
  if group.break?
    flush
    @output &lt;&lt; @newline
    @output &lt;&lt; @genspace.call(@indent)
    @output_width = @indent
    @buffer_width = 0
  else
    @buffer &lt;&lt; Breakable.new(sep, width, self)
    @buffer_width += width
    break_outmost_groups
  end
end</pre> </div> <p>This says “you can break a line here if necessary”, and a <code>width</code>-column text <code>sep</code> is inserted if a line is not broken at the point.</p> <p>If <code>sep</code> is not specified, “ ” is used.</p> <p>If <code>width</code> is not specified, <code>sep.length</code> is used. You will have to specify this when <code>sep</code> is a multibyte character, for example.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-current_group"> <span class="method-name">current_group</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="current_group-source"> <pre class="ruby" data-language="ruby"># File lib/prettyprint.rb, line 155
def current_group
  @group_stack.last
end</pre> </div> <p>Returns the group most recently added to the stack.</p> <p>Contrived example:</p> <pre>out = ""
=&gt; ""
q = PrettyPrint.new(out)
=&gt; #&lt;PrettyPrint:0x82f85c0 @output="", @maxwidth=79, @newline="\n", @genspace=#&lt;Proc:0x82f8368@/home/vbatts/.rvm/rubies/ruby-head/lib/ruby/2.0.0/prettyprint.rb:82 (lambda)&gt;, @output_width=0, @buffer_width=0, @buffer=[], @group_stack=[#&lt;PrettyPrint::Group:0x82f8138 @depth=0, @breakables=[], @break=false&gt;], @group_queue=#&lt;PrettyPrint::GroupQueue:0x82fb7c0 @queue=[[#&lt;PrettyPrint::Group:0x82f8138 @depth=0, @breakables=[], @break=false&gt;]]&gt;, @indent=0&gt;
q.group {
  q.text q.current_group.inspect
  q.text q.newline
  q.group(q.current_group.depth + 1) {
    q.text q.current_group.inspect
    q.text q.newline
    q.group(q.current_group.depth + 1) {
      q.text q.current_group.inspect
      q.text q.newline
      q.group(q.current_group.depth + 1) {
        q.text q.current_group.inspect
        q.text q.newline
      }
    }
  }
}
=&gt; 284
 puts out
#&lt;PrettyPrint::Group:0x8354758 @depth=1, @breakables=[], @break=false&gt;
#&lt;PrettyPrint::Group:0x8354550 @depth=2, @breakables=[], @break=false&gt;
#&lt;PrettyPrint::Group:0x83541cc @depth=3, @breakables=[], @break=false&gt;
#&lt;PrettyPrint::Group:0x8347e54 @depth=4, @breakables=[], @break=false&gt;</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-fill_breakable"> <span class="method-name">fill_breakable</span><span class="method-args">(sep=' ', width=sep.length)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="fill_breakable-source"> <pre class="ruby" data-language="ruby"># File lib/prettyprint.rb, line 212
def fill_breakable(sep=' ', width=sep.length)
  group { breakable sep, width }
end</pre> </div> <p>This is similar to <a href="prettyprint#method-i-breakable"><code>breakable</code></a> except the decision to break or not is determined individually.</p> <p>Two <a href="prettyprint#method-i-fill_breakable"><code>fill_breakable</code></a> under a group may cause 4 results: (break,break), (break,non-break), (non-break,break), (non-break,non-break). This is different to <a href="prettyprint#method-i-breakable"><code>breakable</code></a> because two <a href="prettyprint#method-i-breakable"><code>breakable</code></a> under a group may cause 2 results: (break,break), (non-break,non-break).</p> <p>The text <code>sep</code> is inserted if a line is not broken at this point.</p> <p>If <code>sep</code> is not specified, “ ” is used.</p> <p>If <code>width</code> is not specified, <code>sep.length</code> is used. You will have to specify this when <code>sep</code> is a multibyte character, for example.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-flush"> <span class="method-name">flush</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="flush-source"> <pre class="ruby" data-language="ruby"># File lib/prettyprint.rb, line 288
def flush
  @buffer.each {|data|
    @output_width = data.output(@output, @output_width)
  }
  @buffer.clear
  @buffer_width = 0
end</pre> </div> <p>outputs buffered data.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-group"> <span class="method-name">group</span><span class="method-args">(indent=0, open_obj='', close_obj='', open_width=open_obj.length, close_width=close_obj.length) { || ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="group-source"> <pre class="ruby" data-language="ruby"># File lib/prettyprint.rb, line 249
def group(indent=0, open_obj='', close_obj='', open_width=open_obj.length, close_width=close_obj.length)
  text open_obj, open_width
  group_sub {
    nest(indent) {
      yield
    }
  }
  text close_obj, close_width
end</pre> </div> <p>Groups line break hints added in the block. The line break hints are all to be used or not.</p> <p>If <code>indent</code> is specified, the method call is regarded as nested by nest(indent) { … }.</p> <p>If <code>open_obj</code> is specified, <code>text open_obj, open_width</code> is called before grouping. If <code>close_obj</code> is specified, <code>text close_obj, close_width</code> is called after grouping.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-group_sub"> <span class="method-name">group_sub</span><span class="method-args">() { || ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="group_sub-source"> <pre class="ruby" data-language="ruby"># File lib/prettyprint.rb, line 260
def group_sub
  group = Group.new(@group_stack.last.depth + 1)
  @group_stack.push group
  @group_queue.enq group
  begin
    yield
  ensure
    @group_stack.pop
    if group.breakables.empty?
      @group_queue.delete group
    end
  end
end</pre> </div> <p>Takes a block and queues a new group that is indented 1 level further.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-nest"> <span class="method-name">nest</span><span class="method-args">(indent) { || ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="nest-source"> <pre class="ruby" data-language="ruby"># File lib/prettyprint.rb, line 277
def nest(indent)
  @indent += indent
  begin
    yield
  ensure
    @indent -= indent
  end
end</pre> </div> <p>Increases left margin after newline with <code>indent</code> for line breaks added in the block.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-text"> <span class="method-name">text</span><span class="method-args">(obj, width=obj.length)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="text-source"> <pre class="ruby" data-language="ruby"># File lib/prettyprint.rb, line 180
def text(obj, width=obj.length)
  if @buffer.empty?
    @output &lt;&lt; obj
    @output_width += width
  else
    text = @buffer.last
    unless Text === text
      text = Text.new
      @buffer &lt;&lt; text
    end
    text.add(obj, width)
    @buffer_width += width
    break_outmost_groups
  end
end</pre> </div> <p>This adds <code>obj</code> as a text of <code>width</code> columns in width.</p> <p>If <code>width</code> is not specified, obj.length is used.</p>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core © 1993–2020 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library © contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
