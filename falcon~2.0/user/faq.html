
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>FAQ - Falcon 2.0 - W3cubDocs</title>
  
  <meta name="description" content="Falcon is designed for applications that require a high level of customization or performance tuning. The framework’s minimalist design frees the &hellip;">
  <meta name="keywords" content="faq, falcon, falcon~2.0">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/falcon~2.0/user/faq.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/falcon~2.0.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/falcon~2.0/" class="_nav-link" title="" style="margin-left:0;">Falcon 2.0</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx">
				
				
<h1 id="id1">FAQ</h1>  <ul class="simple" id="faq"> <li>
<a class="reference internal" href="#design-philosophy" id="id3">Design Philosophy</a><ul> <li><a class="reference internal" href="#why-doesn-t-falcon-come-with-batteries-included" id="id4">Why doesn’t Falcon come with batteries included?</a></li> <li><a class="reference internal" href="#why-doesn-t-falcon-create-a-new-resource-instance-for-every-request" id="id5">Why doesn’t Falcon create a new Resource instance for every request?</a></li> <li><a class="reference internal" href="#why-does-raising-an-error-inside-a-resource-crash-my-app" id="id6">Why does raising an error inside a resource crash my app?</a></li> <li><a class="reference internal" href="#how-do-i-generate-api-documentation-for-my-falcon-api" id="id7">How do I generate API documentation for my Falcon API?</a></li> </ul> </li> <li>
<a class="reference internal" href="#performance" id="id8">Performance</a><ul> <li><a class="reference internal" href="#does-falcon-work-with-http-2" id="id9">Does Falcon work with HTTP/2?</a></li> <li><a class="reference internal" href="#is-falcon-thread-safe" id="id10">Is Falcon thread-safe?</a></li> <li><a class="reference internal" href="#does-falcon-support-asyncio" id="id11">Does Falcon support asyncio?</a></li> <li><a class="reference internal" href="#does-falcon-support-websocket" id="id12">Does Falcon support WebSocket?</a></li> </ul> </li> <li>
<a class="reference internal" href="#routing" id="id13">Routing</a><ul> <li><a class="reference internal" href="#how-do-i-implement-cors-with-falcon" id="id14">How do I implement CORS with Falcon?</a></li> <li><a class="reference internal" href="#how-do-i-implement-redirects-within-falcon" id="id15">How do I implement redirects within Falcon?</a></li> <li><a class="reference internal" href="#how-do-i-split-requests-between-my-original-app-and-the-part-i-migrated-to-falcon" id="id16">How do I split requests between my original app and the part I migrated to Falcon?</a></li> <li><a class="reference internal" href="#how-do-i-implement-both-posting-and-geting-items-for-the-same-resource" id="id17">How do I implement both POSTing and GETing items for the same resource?</a></li> <li><a class="reference internal" href="#what-is-the-recommended-way-to-map-related-routes-to-resource-classes" id="id18">What is the recommended way to map related routes to resource classes?</a></li> </ul> </li> <li>
<a class="reference internal" href="#extensibility" id="id19">Extensibility</a><ul> <li><a class="reference internal" href="#how-do-i-use-wsgi-middleware-with-falcon" id="id20">How do I use WSGI middleware with Falcon?</a></li> <li><a class="reference internal" href="#how-can-i-pass-data-from-a-hook-to-a-responder-and-between-hooks" id="id21">How can I pass data from a hook to a responder, and between hooks?</a></li> <li><a class="reference internal" href="#how-can-i-write-a-custom-handler-for-404-and-500-pages-in-falcon" id="id22">How can I write a custom handler for 404 and 500 pages in falcon?</a></li> </ul> </li> <li>
<a class="reference internal" href="#request-handling" id="id23">Request Handling</a><ul> <li><a class="reference internal" href="#how-do-i-authenticate-requests" id="id24">How do I authenticate requests?</a></li> <li><a class="reference internal" href="#why-does-req-stream-read-hang-for-certain-requests" id="id25">Why does req.stream.read() hang for certain requests?</a></li> <li><a class="reference internal" href="#how-does-falcon-handle-a-trailing-slash-in-the-request-path" id="id26">How does Falcon handle a trailing slash in the request path?</a></li> <li><a class="reference internal" href="#why-is-my-query-parameter-missing-from-the-req-object" id="id27">Why is my query parameter missing from the req object?</a></li> <li><a class="reference internal" href="#why-are-characters-in-my-params-being-converted-to-spaces" id="id28">Why are ‘+’ characters in my params being converted to spaces?</a></li> <li><a class="reference internal" href="#how-can-i-access-posted-form-params" id="id29">How can I access POSTed form params?</a></li> <li><a class="reference internal" href="#how-can-i-access-posted-files" id="id30">How can I access POSTed files?</a></li> <li><a class="reference internal" href="#how-do-i-consume-a-query-string-that-has-a-json-value" id="id31">How do I consume a query string that has a JSON value?</a></li> <li><a class="reference internal" href="#how-can-i-handle-forward-slashes-within-a-route-template-field" id="id32">How can I handle forward slashes within a route template field?</a></li> <li><a class="reference internal" href="#how-do-i-adapt-my-code-to-default-context-type-changes-in-falcon-2-0" id="id33">How do I adapt my code to default context type changes in Falcon 2.0?</a></li> </ul> </li> <li>
<a class="reference internal" href="#response-handling" id="id34">Response Handling</a><ul> <li><a class="reference internal" href="#how-can-i-use-resp-media-with-types-like-datetime" id="id35">How can I use resp.media with types like datetime?</a></li> <li><a class="reference internal" href="#does-falcon-set-content-length-or-do-i-need-to-do-that-explicitly" id="id36">Does Falcon set Content-Length or do I need to do that explicitly?</a></li> <li><a class="reference internal" href="#why-is-an-empty-response-body-returned-when-i-raise-an-instance-of-httperror" id="id37">Why is an empty response body returned when I raise an instance of HTTPError?</a></li> <li><a class="reference internal" href="#i-m-setting-a-response-body-but-it-isn-t-getting-returned-what-s-going-on" id="id38">I’m setting a response body, but it isn’t getting returned. What’s going on?</a></li> <li><a class="reference internal" href="#i-m-setting-a-cookie-but-it-isn-t-being-returned-in-subsequent-requests" id="id39">I’m setting a cookie, but it isn’t being returned in subsequent requests.</a></li> <li><a class="reference internal" href="#how-can-i-serve-a-downloadable-file-with-falcon" id="id40">How can I serve a downloadable file with falcon?</a></li> <li><a class="reference internal" href="#can-falcon-serve-static-files" id="id41">Can Falcon serve static files?</a></li> </ul> </li> <li>
<a class="reference internal" href="#misc" id="id42">Misc.</a><ul> <li><a class="reference internal" href="#how-do-i-manage-my-database-connections" id="id43">How do I manage my database connections?</a></li> <li><a class="reference internal" href="#what-is-the-recommended-approach-for-making-configuration-variables-available-to-multiple-resource-classes" id="id44">What is the recommended approach for making configuration variables available to multiple resource classes?</a></li> <li><a class="reference internal" href="#how-do-i-test-my-falcon-app-can-i-use-pytest" id="id45">How do I test my Falcon app? Can I use pytest?</a></li> </ul> </li> </ul>   <h2 id="design-philosophy">Design Philosophy</h2>  <h3 id="why-doesn-t-falcon-come-with-batteries-included">Why doesn’t Falcon come with batteries included?</h3> <p>Falcon is designed for applications that require a high level of customization or performance tuning. The framework’s minimalist design frees the developer to select the best strategies and 3rd-party packages for the task at hand.</p> <p>The Python ecosystem offers a number of great packages that you can use from within your responders, hooks, and middleware components. As a starting point, the community maintains a list of <a class="reference external" href="https://github.com/falconry/falcon/wiki">Falcon add-ons and complementary packages</a>.</p>   <h3 id="why-doesn-t-falcon-create-a-new-resource-instance-for-every-request">Why doesn’t Falcon create a new Resource instance for every request?</h3> <p>Falcon generally tries to minimize the number of objects that it instantiates. It does this for two reasons: first, to avoid the expense of creating the object, and second to reduce memory usage by reducing the total number of objects required under highly concurrent workloads. Therefore, when adding a route, Falcon requires an <em>instance</em> of your resource class, rather than the class type. That same instance will be used to serve all requests coming in on that route.</p>   <h3 id="why-does-raising-an-error-inside-a-resource-crash-my-app">Why does raising an error inside a resource crash my app?</h3> <p>Generally speaking, Falcon assumes that resource responders (such as <code>on_get()</code>, <code>on_post()</code>, etc.) will, for the most part, do the right thing. In other words, Falcon doesn’t try very hard to protect responder code from itself.</p> <p>This approach reduces the number of checks that Falcon would otherwise have to perform, making the framework more efficient. With that in mind, writing a high-quality API based on Falcon requires that:</p> <ol class="arabic simple"> <li>Resource responders set response variables to sane values.</li> <li>Your code is well-tested, with high code coverage.</li> <li>Errors are anticipated, detected, and handled appropriately within each responder and with the aid of custom error handlers.</li> </ol> <div class="admonition tip"> <p class="first admonition-title">Tip</p> <p class="last">Falcon will re-raise errors that do not inherit from <a class="reference internal" href="../api/errors#falcon.HTTPError" title="falcon.HTTPError"><code>HTTPError</code></a> unless you have registered a custom error handler for that type (see also: <a class="reference internal" href="../api/api#api"><span class="std std-ref">falcon.API</span></a>).</p> </div>   <h3 id="how-do-i-generate-api-documentation-for-my-falcon-api">How do I generate API documentation for my Falcon API?</h3> <p>When it comes to API documentation, some developers prefer to use the API implementation as the user contract or source of truth (taking an implementation-first approach), while other developers prefer to use the API spec itself as the contract, implementing and testing the API against that spec (taking a design-first approach).</p> <p>At the risk of erring on the side of flexibility, Falcon does not provide API spec support out of the box. However, there are several community projects available in this vein. Our <a class="reference external" href="https://github.com/falconry/falcon/wiki/Add-on-Catalog">Add on Catalog</a> lists a couple of these projects, but you may also wish to search <a class="reference external" href="https://pypi.python.org/pypi">PyPI</a> for additional packages.</p> <p>If you are interested in the design-first approach mentioned above, you may also want to check out API design and gateway services such as Tyk, Apiary, Amazon API Gateway, or Google Cloud Endpoints.</p>    <h2 id="performance">Performance</h2>  <h3 id="does-falcon-work-with-http-2">Does Falcon work with HTTP/2?</h3> <p>Falcon is a WSGI framework and as such does not serve HTTP requests directly. However, you can get most of the benefits of HTTP/2 by simply deploying any HTTP/2-compliant web server or load balancer in front of your app to translate between HTTP/2 and HTTP/1.1. Eventually we expect that Python web servers (such as uWSGI) will support HTTP/2 natively, eliminating the need for a translation layer.</p>   <h3 id="is-falcon-thread-safe">Is Falcon thread-safe?</h3> <p>The Falcon framework is, itself, thread-safe. For example, new <a class="reference internal" href="../api/request_and_response#falcon.Request" title="falcon.Request"><code>Request</code></a> and <a class="reference internal" href="../api/request_and_response#falcon.Response" title="falcon.Response"><code>Response</code></a> objects are created for each incoming HTTP request. However, a single instance of each resource class attached to a route is shared among all requests. Middleware objects and other types of hooks, such as custom error handlers, are likewise shared. Therefore, as long as you implement these classes and callables in a thread-safe manner, and ensure that any third-party libraries used by your app are also thread-safe, your WSGI app as a whole will be thread-safe.</p> <p>That being said, IO-bound Falcon APIs are usually scaled via multiple processes and green threads (courtesy of the <a class="reference external" href="http://www.gevent.org/">gevent</a> library or similar) which aren’t truly running concurrently, so there may be some edge cases where Falcon is not thread-safe that we aren’t aware of. If you run into any issues, please let us know.</p>   <h3 id="does-falcon-support-asyncio">Does Falcon support asyncio?</h3> <p>Due to the limitations of WSGI, Falcon is unable to support <code>asyncio</code> at this time. However, we are exploring alternatives to WSGI (such as <a class="reference external" href="https://github.com/django/asgiref/blob/master/specs/asgi.rst">ASGI</a>) that will allow us to support asyncio natively in the future.</p> <p>In the meantime, we recommend using the battle-tested <a class="reference external" href="http://www.gevent.org/">gevent</a> library via Gunicorn or uWSGI to scale IO-bound services. <a class="reference external" href="https://pypi.org/project/meinheld/">meinheld</a> has also been used successfully by the community to power high-throughput, low-latency services. Note that if you use Gunicorn, you can combine gevent and PyPy to achieve an impressive level of performance. (Unfortunately, uWSGI does not yet support using gevent and PyPy together.)</p>   <h3 id="does-falcon-support-websocket">Does Falcon support WebSocket?</h3> <p>Due to the limitations of WSGI, Falcon is unable to support the WebSocket protocol as stated above.</p> <p>In the meantime, you might try leveraging <a class="reference external" href="http://uwsgi.readthedocs.io/en/latest/WebSockets.html">uWSGI’s native WebSocket support</a>, or implementing a standalone service via Aymeric Augustin’s handy <a class="reference external" href="https://pypi.python.org/pypi/websockets/4.0.1">websockets</a> library.</p>    <h2 id="routing">Routing</h2>  <h3 id="how-do-i-implement-cors-with-falcon">How do I implement CORS with Falcon?</h3> <p>In order for a website or SPA to access an API hosted under a different domain name, that API must implement <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">Cross-Origin Resource Sharing (CORS)</a>. For a public API, implementing CORS in Falcon can be as simple as implementing a middleware component similar to the following:</p> <pre data-language="python">class CORSComponent(object):
    def process_response(self, req, resp, resource, req_succeeded):
        resp.set_header('Access-Control-Allow-Origin', '*')

        if (req_succeeded
            and req.method == 'OPTIONS'
            and req.get_header('Access-Control-Request-Method')
        ):
            # NOTE(kgriffs): This is a CORS preflight request. Patch the
            #   response accordingly.

            allow = resp.get_header('Allow')
            resp.delete_header('Allow')

            allow_headers = req.get_header(
                'Access-Control-Request-Headers',
                default='*'
            )

            resp.set_headers((
                ('Access-Control-Allow-Methods', allow),
                ('Access-Control-Allow-Headers', allow_headers),
                ('Access-Control-Max-Age', '86400'),  # 24 hours
            ))
</pre> <p>When using the above approach, OPTIONS requests must also be special-cased in any other middleware or hooks you use for auth, content-negotiation, etc. For example, you will typically skip auth for preflight requests because it is simply unnecessary; note that such request do not include the Authorization header in any case.</p> <p>For more sophisticated use cases, have a look at Falcon add-ons from the community, such as <a class="reference external" href="https://github.com/lwcolton/falcon-cors">falcon-cors</a>, or try one of the generic <a class="reference external" href="https://pypi.python.org/pypi?%3Aaction=search&amp;term=cors&amp;submit=search">WSGI CORS libraries available on PyPI</a>. If you use an API gateway, you might also look into what CORS functionality it provides at that level.</p>   <h3 id="how-do-i-implement-redirects-within-falcon">How do I implement redirects within Falcon?</h3> <p>Falcon provides a number of exception classes that can be raised to redirect the client to a different location (see also <a class="reference internal" href="../api/redirects#redirects"><span class="std std-ref">Redirection</span></a>).</p> <p>Note, however, that it is more efficient to handle permanent redirects directly with your web server, if possible, rather than placing additional load on your app for such requests.</p>   <h3 id="how-do-i-split-requests-between-my-original-app-and-the-part-i-migrated-to-falcon">How do I split requests between my original app and the part I migrated to Falcon?</h3> <p>It is common to carve out a portion of an app and reimplement it in Falcon to boost performance where it is most needed.</p> <p>If you have access to your load balancer or reverse proxy configuration, we recommend setting up path or subdomain-based rules to split requests between your original implementation and the parts that have been migrated to Falcon (e.g., by adding an additional <code>location</code> directive to your NGINX config).</p> <p>If the above approach isn’t an option for your deployment, you can implement a simple WSGI wrapper that does the same thing:</p> <pre data-language="python">def application(environ, start_response):
    try:
        # NOTE(kgriffs): Prefer the host header; the web server
        # isn't supposed to mess with it, so it should be what
        # the client actually sent.
        host = environ['HTTP_HOST']
    except KeyError:
        # NOTE(kgriffs): According to PEP-3333, this header
        # will always be present.
        host = environ['SERVER_NAME']

    if host.startswith('api.'):
        return falcon_app(environ, start_response)
    elif:
        return webapp2_app(environ, start_response)
</pre> <p>See also <a class="reference external" href="https://www.python.org/dev/peps/pep-3333/#environ-variables">PEP 3333</a> for a complete list of the variables that are provided via <code>environ</code>.</p>   <h3 id="how-do-i-implement-both-posting-and-geting-items-for-the-same-resource">How do I implement both POSTing and GETing items for the same resource?</h3> <p>Suppose you have the following routes:</p> <pre data-language="python"># Resource Collection
GET /resources{?marker, limit}
POST /resources

# Resource Item
GET /resources/{id}
PATCH /resources/{id}
DELETE /resources/{id}
</pre> <p>You can implement this sort of API by simply using two Python classes, one to represent a single resource, and another to represent the collection of said resources. It is common to place both classes in the same module (see also <a class="reference internal" href="tutorial#tutorial-serving-images"><span class="std std-ref">this section of the tutorial</span></a>.)</p> <p>Alternatively, you can use suffixed responders to map both routes to the same resource class:</p> <pre data-language="python">class MyResource(object):
    def on_get(self, req, resp, id):
        pass

    def on_patch(self, req, resp, id):
        pass

    def on_delete(self, req, resp, id):
        pass

    def on_get_collection(self, req, resp):
        pass

    def on_post_collection(self, req, resp):
        pass


# ...


resource = MyResource()
api.add_route('/resources/{id}', resource)
api.add_route('/resources', resource, suffix='collection')
</pre>   <h3 id="what-is-the-recommended-way-to-map-related-routes-to-resource-classes">What is the recommended way to map related routes to resource classes?</h3> <p>Let’s say we have the following URL schema:</p> <pre data-language="python">GET  /game/ping
GET  /game/{game_id}
POST /game/{game_id}
GET  /game/{game_id}/state
POST /game/{game_id}/state
</pre> <p>We can break this down into three resources:</p> <pre data-language="python">Ping:

    GET  /game/ping

Game:

    GET  /game/{game_id}
    POST /game/{game_id}

GameState:

    GET  /game/{game_id}/state
    POST /game/{game_id}/state
</pre> <p>GameState may be thought of as a sub-resource of Game. It is a distinct logical entity encapsulated within a more general Game concept.</p> <p>In Falcon, these resources would be implemented with standard classes:</p> <pre data-language="python">class Ping(object):

    def on_get(self, req, resp):
        resp.body = '{"message": "pong"}'


class Game(object):

    def __init__(self, dao):
        self._dao = dao

    def on_get(self, req, resp, game_id):
        pass

    def on_post(self, req, resp, game_id):
        pass


class GameState(object):

    def __init__(self, dao):
        self._dao = dao

    def on_get(self, req, resp, game_id):
        pass

    def on_post(self, req, resp, game_id):
        pass


api = falcon.API()

# Game and GameState are closely related, and so it
# probably makes sense for them to share an object
# in the Data Access Layer. This could just as
# easily use a DB object or ORM layer.
#
# Note how the resources classes provide a layer
# of abstraction or indirection which makes your
# app more flexible since the data layer can
# evolve somewhat independently from the presentation
# layer.
game_dao = myapp.DAL.Game(myconfig)

api.add_route('/game/ping', Ping())
api.add_route('/game/{game_id}', Game(game_dao))
api.add_route('/game/{game_id}/state', GameState(game_dao))
</pre> <p>Alternatively, a single resource class could implement suffixed responders in order to handle all three routes:</p> <pre data-language="python">class Game(object):

    def __init__(self, dao):
        self._dao = dao

    def on_get(self, req, resp, game_id):
        pass

    def on_post(self, req, resp, game_id):
        pass

    def on_get_state(self, req, resp, game_id):
        pass

    def on_post_state(self, req, resp, game_id):
        pass

    def on_get_ping(self, req, resp):
        resp.data = b'{"message": "pong"}'


# ...


api = falcon.API()

game = Game(myapp.DAL.Game(myconfig))

api.add_route('/game/{game_id}', game)
api.add_route('/game/{game_id}/state', game, suffix='state')
api.add_route('/game/ping', game, suffix='ping')
</pre>    <h2 id="extensibility">Extensibility</h2>  <h3 id="how-do-i-use-wsgi-middleware-with-falcon">How do I use WSGI middleware with Falcon?</h3> <p>Instances of <a class="reference internal" href="../api/api#falcon.API" title="falcon.API"><code>falcon.API</code></a> are first-class WSGI apps, so you can use the standard pattern outlined in PEP-3333. In your main “app” file, you would simply wrap your api instance with a middleware app. For example:</p> <pre data-language="python">import my_restful_service
import some_middleware

app = some_middleware.DoSomethingFancy(my_restful_service.api)
</pre> <p>See also the <a class="reference external" href="https://www.python.org/dev/peps/pep-3333/#middleware-components-that-play-both-sides">WSGI middleware example</a> given in PEP-3333.</p>   <h3 id="how-can-i-pass-data-from-a-hook-to-a-responder-and-between-hooks">How can I pass data from a hook to a responder, and between hooks?</h3> <p>You can inject extra responder kwargs from a hook by adding them to the <em>params</em> dict passed into the hook. You can also set custom attributes on the <code>req.context</code> object, as a way of passing contextual information around:</p> <pre data-language="python">def authorize(req, resp, resource, params):
    # Check authentication/authorization
    # ...

    req.context.role = 'root'
    req.context.scopes = ('storage', 'things')
    req.context.uid = 0

# ...

@falcon.before(authorize)
def on_post(self, req, resp):
    pass
</pre>   <h3 id="how-can-i-write-a-custom-handler-for-404-and-500-pages-in-falcon">How can I write a custom handler for 404 and 500 pages in falcon?</h3> <p>When a route can not be found for an incoming request, Falcon uses a default responder that simply raises an instance of <a class="reference internal" href="../api/errors#falcon.HTTPNotFound" title="falcon.HTTPNotFound"><code>falcon.HTTPNotFound</code></a>. You can use <a class="reference internal" href="../api/api#falcon.API.add_error_handler" title="falcon.API.add_error_handler"><code>falcon.API.add_error_handler()</code></a> to register a custom error handler for this exception type. Alternatively, you may be able to configure your web server to transform the response for you (e.g., using Nginx’s <code>error_page</code> directive).</p> <p>500 errors are typically the result of an unhandled exception making its way up to the web server. To handle these errors more gracefully, you can add a custom error handler for Python’s base <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#Exception" title="(in Python v3.7)"><code>Exception</code></a> type.</p>    <h2 id="request-handling">Request Handling</h2>  <h3 id="how-do-i-authenticate-requests">How do I authenticate requests?</h3> <p>Hooks and middleware components can be used together to authenticate and authorize requests. For example, a middleware component could be used to parse incoming credentials and place the results in <code>req.context</code>. Downstream components or hooks could then use this information to authorize the request, taking into account the user’s role and the requested resource.</p>   <h3 id="why-does-req-stream-read-hang-for-certain-requests">Why does req.stream.read() hang for certain requests?</h3> <p>This behavior is an unfortunate artifact of the request body mechanics not being fully defined by the WSGI spec (PEP-3333). This is discussed in the reference documentation for <a class="reference internal" href="../api/request_and_response#falcon.Request.stream" title="falcon.Request.stream"><code>stream</code></a>, and a workaround is provided in the form of <a class="reference internal" href="../api/request_and_response#falcon.Request.bounded_stream" title="falcon.Request.bounded_stream"><code>bounded_stream</code></a>.</p>   <h3 id="how-does-falcon-handle-a-trailing-slash-in-the-request-path">How does Falcon handle a trailing slash in the request path?</h3> <p>If your app sets <a class="reference internal" href="../api/api#falcon.RequestOptions.strip_url_path_trailing_slash" title="falcon.RequestOptions.strip_url_path_trailing_slash"><code>strip_url_path_trailing_slash</code></a> to <code>True</code>, Falcon will normalize incoming URI paths to simplify later processing and improve the predictability of application logic. This can be helpful when implementing a REST API schema that does not interpret a trailing slash character as referring to the name of an implicit sub-resource, as traditionally used by websites to reference index pages.</p> <p>For example, with this option enabled, adding a route for <code>'/foo/bar'</code> implicitly adds a route for <code>'/foo/bar/'</code>. In other words, requests coming in for either path will be sent to the same resource.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Starting with version 2.0, the default for the <a class="reference internal" href="../api/api#falcon.RequestOptions.strip_url_path_trailing_slash" title="falcon.RequestOptions.strip_url_path_trailing_slash"><code>strip_url_path_trailing_slash</code></a> request option changed from <code>True</code> to <code>False</code>.</p> </div>   <h3 id="why-is-my-query-parameter-missing-from-the-req-object">Why is my query parameter missing from the req object?</h3> <p>If a query param does not have a value, Falcon will by default ignore that parameter. For example, passing <code>'foo'</code> or <code>'foo='</code> will result in the parameter being ignored.</p> <p>If you would like to recognize such parameters, you must set the <code>keep_blank_qs_values</code> request option to <code>True</code>. Request options are set globally for each instance of <a class="reference internal" href="../api/api#falcon.API" title="falcon.API"><code>falcon.API</code></a> via the <a class="reference internal" href="../api/api#falcon.API.req_options" title="falcon.API.req_options"><code>req_options</code></a> property. For example:</p> <pre data-language="python">api.req_options.keep_blank_qs_values = True
</pre>   <h3 id="why-are-characters-in-my-params-being-converted-to-spaces">Why are ‘+’ characters in my params being converted to spaces?</h3> <p>The <code>+</code> character is often used instead of <code>%20</code> to represent spaces in query string params, due to the historical conflation of form parameter encoding (<code>application/x-www-form-urlencoded</code>) and URI percent-encoding. Therefore, Falcon, converts <code>+</code> to a space when decoding strings.</p> <p>To work around this, RFC 3986 specifies <code>+</code> as a reserved character, and recommends percent-encoding any such characters when their literal value is desired (<code>%2B</code> in the case of <code>+</code>).</p>   <h3 id="how-can-i-access-posted-form-params">How can I access POSTed form params?</h3> <p>By default, Falcon does not consume request bodies. However, setting the <code>auto_parse_form_urlencoded</code> to <code>True</code> on an instance of <code>falcon.API</code> will cause the framework to consume the request body when the content type is <code>application/x-www-form-urlencoded</code>, making the form parameters accessible via <a class="reference internal" href="../api/request_and_response#falcon.Request.params" title="falcon.Request.params"><code>params</code></a>, <a class="reference internal" href="../api/request_and_response#falcon.Request.get_param" title="falcon.Request.get_param"><code>get_param()</code></a>, etc.</p> <pre data-language="python">api.req_options.auto_parse_form_urlencoded = True
</pre> <p>Alternatively, POSTed form parameters may be read directly from <a class="reference internal" href="../api/request_and_response#falcon.Request.stream" title="falcon.Request.stream"><code>stream</code></a> and parsed via <a class="reference internal" href="../api/util#falcon.uri.parse_query_string" title="falcon.uri.parse_query_string"><code>falcon.uri.parse_query_string()</code></a> or <a class="reference external" href="https://docs.python.org/3.6/library/urllib.parse.html#urllib.parse.parse_qs">urllib.parse.parse_qs()</a>.</p>   <h3 id="how-can-i-access-posted-files">How can I access POSTed files?</h3> <p>Falcon does not currently support parsing files submitted by an HTTP form (<code>multipart/form-data</code>), although we do plan to add this feature in a future version. In the meantime, you can use the standard <code>cgi.FieldStorage</code> class to parse the request:</p> <pre data-language="python"># TODO: Either validate that content type is multipart/form-data
# here, or in another hook before allowing execution to proceed.

# This must be done to avoid a bug in cgi.FieldStorage
env = req.env
env.setdefault('QUERY_STRING', '')

# TODO: Add error handling, when the request is not formatted
# correctly or does not contain the desired field...

# TODO: Consider overriding make_file, so that you can
# stream directly to the destination rather than
# buffering using TemporaryFile (see http://goo.gl/Yo8h3P)
form = cgi.FieldStorage(fp=req.stream, environ=env)

file_item = form[name]
if file_item.file:
    # TODO: It's an uploaded file... read it in
else:
    # TODO: Raise an error
</pre> <p>You might also try this <a class="reference external" href="https://streaming-form-data.readthedocs.io/en/latest/">streaming_form_data</a> package by Siddhant Goel, or searching PyPI for additional options from the community.</p>   <h3 id="how-do-i-consume-a-query-string-that-has-a-json-value">How do I consume a query string that has a JSON value?</h3> <p>Falcon defaults to treating commas in a query string as literal characters delimiting a comma separated list. For example, given the query string <code>?c=1,2,3</code>, Falcon defaults to adding this to your <code>request.params</code> dictionary as <code>{'c': ['1', '2', '3']}</code>. If you attempt to use JSON in the value of the query string, for example <code>?c={'a':1,'b':2}</code>, the value will get added to your <code>request.params</code> in a way that you probably don’t expect: <code>{'c': ["{'a':1", "'b':2}"]}</code>.</p> <p>Commas are a reserved character that can be escaped according to <a class="reference external" href="https://tools.ietf.org/html/rfc3986#section-2.2">RFC 3986 - 2.2. Reserved Characters</a>, so one possible solution is to percent encode any commas that appear in your JSON query string. The other option is to switch the way Falcon handles commas in a query string by setting the <a class="reference internal" href="../api/api#falcon.RequestOptions.auto_parse_qs_csv" title="falcon.RequestOptions.auto_parse_qs_csv"><code>auto_parse_qs_csv</code></a> to <code>False</code> on an instance of <a class="reference internal" href="../api/api#falcon.API" title="falcon.API"><code>falcon.API</code></a>:</p> <pre data-language="python">api.req_options.auto_parse_qs_csv = False
</pre> <p>When <a class="reference internal" href="../api/api#falcon.RequestOptions.auto_parse_qs_csv" title="falcon.RequestOptions.auto_parse_qs_csv"><code>auto_parse_qs_csv</code></a> is set to <code>False</code>, the value of the query string <code>?c={'a':1,'b':2}</code> will be added to the <code>req.params</code> dictionary as <code>{'c': "{'a':1,'b':2}"}</code>. This lets you consume JSON whether or not the client chooses to escape commas in the request.</p>   <h3 id="how-can-i-handle-forward-slashes-within-a-route-template-field">How can I handle forward slashes within a route template field?</h3> <p>In Falcon 1.3 we shipped initial support for <a class="reference external" href="http://falcon.readthedocs.io/en/stable/api/routing.html#field-converters">field converters</a>. We’ve discussed building on this feature to support consuming multiple path segments ala Flask. This work is currently planned for 2.0.</p> <p>In the meantime, the workaround is to percent-encode the forward slash. If you don’t control the clients and can’t enforce this, you can implement a Falcon middleware component to rewrite the path before it is routed.</p>   <h3 id="bare-class-context-type">How do I adapt my code to default context type changes in Falcon 2.0?</h3> <p id="how-do-i-adapt-my-code-to-default-context-type-changes-in-falcon-2-0">The default request/response context type has been changed from dict to a bare class in Falcon 2.0. Instead of setting dictionary items, you can now simply set attributes on the object:</p> <pre data-language="python"># Before Falcon 2.0
req.context['cache_backend'] = MyUltraFastCache.connect()

# Falcon 2.0
req.context.cache_backend = MyUltraFastCache.connect()
</pre> <p>The new default context type emulates a dict-like mapping interface in a way that context attributes are linked to dict items, i.e. setting an object attribute also sets the corresponding dict item, and vice versa. As a result, existing code will largely work unmodified with Falcon 2.0. Nevertheless, it is recommended to migrate to the new interface as outlined above since the dict-like mapping interface may be removed from the context type in a future release.</p> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">If you need to mix-and-match both approaches under migration, beware that setting attributes such as <em>items</em> or <em>values</em> would obviously shadow the corresponding mapping interface functions.</p> </div> <p>If an existing project is making extensive use of dictionary contexts, the type can be explicitly overridden back to dict by employing custom request/response types:</p> <pre data-language="python">class RequestWithDictContext(falcon.Request):
    context_type = dict

class ResponseWithDictContext(falcon.Response):
    context_type = dict

# ...

api = falcon.API(request_type=RequestWithDictContext,
                 response_type=ResponseWithDictContext)
</pre>    <h2 id="response-handling">Response Handling</h2>  <h3 id="how-can-i-use-resp-media-with-types-like-datetime">How can I use resp.media with types like datetime?</h3> <p>The default JSON handler for <code>resp.media</code> only supports the objects and types listed in the table documented under <a class="reference external" href="https://docs.python.org/3.6/library/json.html#json.JSONEncoder">json.JSONEncoder</a>. To handle additional types, you can either serialize them beforehand, or create a custom JSON media handler that sets the <code>default</code> param for <code>json.dumps()</code>. When deserializing an incoming request body, you may also wish to implement <code>object_hook</code> for <code>json.loads()</code>. Note, however, that setting the <code>default</code> or <code>object_hook</code> params can negatively impact the performance of (de)serialization.</p>   <h3 id="does-falcon-set-content-length-or-do-i-need-to-do-that-explicitly">Does Falcon set Content-Length or do I need to do that explicitly?</h3> <p>Falcon will try to do this for you, based on the value of <code>resp.body</code>, <code>resp.data</code>, or <code>resp.stream_len</code> (whichever is set in the response, checked in that order.)</p> <p>For dynamically-generated content, you can choose to not set <code>stream_len</code>, in which case Falcon will then leave off the Content-Length header, and hopefully your WSGI server will do the Right Thing™ (assuming you’ve told it to enable keep-alive).</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">PEP-3333 prohibits apps from setting hop-by-hop headers itself, such as Transfer-Encoding.</p> </div>   <h3 id="why-is-an-empty-response-body-returned-when-i-raise-an-instance-of-httperror">Why is an empty response body returned when I raise an instance of HTTPError?</h3> <p>Falcon attempts to serialize the <a class="reference internal" href="../api/errors#falcon.HTTPError" title="falcon.HTTPError"><code>HTTPError</code></a> instance using its <a class="reference internal" href="../api/errors#falcon.HTTPError.to_json" title="falcon.HTTPError.to_json"><code>to_json()</code></a> or <a class="reference internal" href="../api/errors#falcon.HTTPError.to_xml" title="falcon.HTTPError.to_xml"><code>to_xml()</code></a> methods, according to the Accept header in the request. If neither JSON nor XML is acceptable, no response body will be generated. You can override this behavior if needed via <a class="reference internal" href="../api/api#falcon.API.set_error_serializer" title="falcon.API.set_error_serializer"><code>set_error_serializer()</code></a>.</p>   <h3 id="i-m-setting-a-response-body-but-it-isn-t-getting-returned-what-s-going-on">I’m setting a response body, but it isn’t getting returned. What’s going on?</h3> <p>Falcon skips processing the response body when, according to the HTTP spec, no body should be returned. If the client sends a HEAD request, the framework will always return an empty body. Falcon will also return an empty body whenever the response status is any of the following:</p> <pre data-language="python">falcon.HTTP_100
falcon.HTTP_204
falcon.HTTP_416
falcon.HTTP_304
</pre> <p>If you have another case where the body isn’t being returned, it’s probably a bug! <a class="reference internal" href="https://falcon.readthedocs.io/en/2.0.0/community/help.html#help"><span class="std std-ref">Let us know</span></a> so we can help.</p>   <h3 id="i-m-setting-a-cookie-but-it-isn-t-being-returned-in-subsequent-requests">I’m setting a cookie, but it isn’t being returned in subsequent requests.</h3> <p>By default, Falcon enables the <code>secure</code> cookie attribute. Therefore, if you are testing your app over HTTP (instead of HTTPS), the client will not send the cookie in subsequent requests.</p> <p>(See also the <a class="reference internal" href="../api/cookies#cookie-secure-attribute"><span class="std std-ref">cookie documentation</span></a>.)</p>   <h3 id="how-can-i-serve-a-downloadable-file-with-falcon">How can I serve a downloadable file with falcon?</h3> <p>In the <code>on_get()</code> responder method for the resource, you can tell the user agent to download the file by setting the Content-Disposition header. Falcon includes the <code>downloadable_as</code> property to make this easy:</p> <pre data-language="python">resp.downloadable_as = 'report.pdf'
</pre>   <h3 id="can-falcon-serve-static-files">Can Falcon serve static files?</h3> <p>Falcon makes it easy to efficiently serve static files by simply assigning an open file to <code>resp.stream</code> <a class="reference internal" href="tutorial#tutorial-serving-images"><span class="std std-ref">as demonstrated in the tutorial</span></a>. You can also serve an entire directory of files via <a class="reference internal" href="../api/api#falcon.API.add_static_route" title="falcon.API.add_static_route"><code>falcon.API.add_static_route()</code></a>. However, if possible, it is best to serve static files directly from a web server like Nginx, or from a CDN.</p>    <h2 id="misc">Misc.</h2>  <h3 id="how-do-i-manage-my-database-connections">How do I manage my database connections?</h3> <p>Assuming your database library manages its own connection pool, all you need to do is initialize the client and pass an instance of it into your resource classes. For example, using SQLAlchemy Core:</p> <pre data-language="python">engine = create_engine('sqlite:///:memory:')
resource = SomeResource(engine)
</pre> <p>Then, within <code>SomeResource</code>:</p> <pre data-language="python"># Read from the DB
result = self._engine.execute(some_table.select())
for row in result:
    # ....
result.close()

# ...

# Write to the DB within a transaction
with self._engine.begin() as connection:
    r1 = connection.execute(some_table.select())
    # ...
    connection.execute(
        some_table.insert(),
        col1=7,
        col2='this is some data'
    )
</pre> <p>When using a data access layer, simply pass the engine into your data access objects instead. See also <a class="reference external" href="https://github.com/jmvrbanac/falcon-example">this sample Falcon project</a> that demonstrates using an ORM with Falcon.</p> <p>You can also create a middleware component to automatically check out database connections for each request, but this can make it harder to track down errors, or to tune for the needs of individual requests.</p> <p>If you need to transparently handle reconnecting after an error, or for other use cases that may not be supported by your client library, simply encapsulate the client library within a management class that handles all the tricky bits, and pass that around instead.</p>   <h3 id="what-is-the-recommended-approach-for-making-configuration-variables-available-to-multiple-resource-classes">What is the recommended approach for making configuration variables available to multiple resource classes?</h3> <p>People usually fall into two camps when it comes to this question. The first camp likes to instantiate a config object and pass that around to the initializers of the resource classes so the data sharing is explicit. The second camp likes to create a config module and import that wherever it’s needed.</p> <p>With the latter approach, to control when the config is actually loaded, it’s best not to instantiate it at the top level of the config module’s namespace. This avoids any problematic side-effects that may be caused by loading the config whenever Python happens to process the first import of the config module. Instead, consider implementing a function in the module that returns a new or cached config object on demand.</p> <p>Other than that, it’s pretty much up to you if you want to use the standard library config library or something like <code>aumbry</code> as demonstrated by this <a class="reference external" href="https://github.com/jmvrbanac/falcon-example/tree/master/example">falcon example app</a></p> <p>(See also the <strong>Configuration</strong> section of our <a class="reference external" href="https://github.com/falconry/falcon/wiki/Complementary-Packages">Complementary Packages wiki page</a>. You may also wish to search PyPI for other options).</p>   <h3 id="how-do-i-test-my-falcon-app-can-i-use-pytest">How do I test my Falcon app? Can I use pytest?</h3> <p>Falcon’s testing framework supports both <code>unittest</code> and <code>pytest</code>. In fact, the tutorial in the docs provides an excellent introduction to <a class="reference external" href="http://falcon.readthedocs.io/en/stable/user/tutorial.html#testing-your-application">testing Falcon apps with pytest</a>.</p> <p>(See also: <a class="reference external" href="http://falcon.readthedocs.io/en/stable/api/testing.html">Testing</a>)</p>
<div class="_attribution">
  <p class="_attribution-p">
    © 2019 by Falcon contributors<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://falcon.readthedocs.io/en/2.0.0/user/faq.html" class="_attribution-link">https://falcon.readthedocs.io/en/2.0.0/user/faq.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
