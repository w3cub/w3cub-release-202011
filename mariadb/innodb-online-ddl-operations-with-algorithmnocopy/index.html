
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>InnoDB Online DDL Operations With the NOCOPY Alter Algorithm - MariaDB - W3cubDocs</title>
  
  <meta name="description" content="When the ALGORITHM clause is set to NOCOPY, the supported operations are a superset of the operations that are supported when the ALGORITHM clause &hellip;">
  <meta name="keywords" content="innodb, online, ddl, operations, with, nocopy, alter, algorithm, mariadb">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/mariadb/innodb-online-ddl-operations-with-algorithmnocopy/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/mariadb.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/mariadb/" class="_nav-link" title="" style="margin-left:0;">MariaDB</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _mariadb">
				
				
<h1>InnoDB Online DDL Operations with the NOCOPY Alter Algorithm</h1> <div> <div class="node creole"> <div class="answer formatted">  <h2 class="anchored_heading" id="supported-operations-by-inheritance">Supported Operations by Inheritance</h2> <p>When the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause is set to <code>NOCOPY</code>, the supported operations are a superset of the operations that are supported when the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause is set to <code>INSTANT</code>.</p> <p>Therefore, when the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause is set to <code>NOCOPY</code>, some operations are supported by inheritance. See the following additional pages for more information about these supported operations:</p> <ul start="1"><li>
<a href="../innodb-online-ddl-operations-with-algorithminstant/index">InnoDB Online DDL Operations with ALGORITHM=INSTANT</a> </li></ul> <h2 class="anchored_heading" id="column-operations">Column Operations</h2> <h3 class="anchored_heading" id="alter-table-add-column"><code>ALTER TABLE ... ADD COLUMN</code></h3> <p>In <a href="https://mariadb.com/kb/en/mariadb-1032-release-notes/">MariaDB 10.3.2</a> and later, InnoDB supports adding columns to a table with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#alter-table-add-column">InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... ADD COLUMN</a> for more information.</p> <p>This applies to <code><a href="../alter-table/index#add-column">ALTER TABLE ... ADD COLUMN</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h3 class="anchored_heading" id="alter-table-drop-column"><code>ALTER TABLE ... DROP COLUMN</code></h3> <p>In <a href="../what-is-mariadb-104/index">MariaDB 10.4</a> and later, InnoDB supports dropping columns from a table with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#alter-table-drop-column">InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... DROP COLUMN</a> for more information.</p> <p>This applies to <code><a href="../alter-table/index#drop-column">ALTER TABLE ... DROP COLUMN</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h3 class="anchored_heading" id="alter-table-modify-column"><code>ALTER TABLE ... MODIFY COLUMN</code></h3> <p>This applies to <code><a href="../alter-table/index#modify-column">ALTER TABLE ... MODIFY COLUMN</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h4 class="anchored_heading" id="reordering-columns">Reordering Columns</h4> <p>In <a href="../what-is-mariadb-104/index">MariaDB 10.4</a> and later, InnoDB supports reordering columns within a table with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#reordering-columns">InnoDB Online DDL Operations with ALGORITHM=INSTANT: Reordering Columns</a> for more information.</p> <h4 class="anchored_heading" id="changing-the-data-type-of-a-column">Changing the Data Type of a Column</h4> <p>InnoDB does <strong>not</strong> support modifying a column's data type with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in most cases. There are a few exceptions in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#changing-the-data-type-of-a-column">InnoDB Online DDL Operations with ALGORITHM=INSTANT: Changing the Data Type of a Column</a> for more information.</p> <h4 class="anchored_heading" id="changing-a-column-to-null">Changing a Column to NULL</h4> <p>In <a href="https://mariadb.com/kb/en/mariadb-1043-release-notes/">MariaDB 10.4.3</a> and later, InnoDB supports modifying a column to allow <code><a href="../create-table/index#null-and-not-null">NULL</a></code> values with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#changing-a-column-to-null">InnoDB Online DDL Operations with ALGORITHM=INSTANT: Changing a Column to NULL</a> for more information.</p> <h4 class="anchored_heading" id="changing-a-column-to-not-null">Changing a Column to NOT NULL</h4> <p>InnoDB does <strong>not</strong> support modifying a column to <strong>not</strong> allow <code><a href="../create-table/index#null-and-not-null">NULL</a></code> values with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code>.</p> <p>For example:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
) ROW_FORMAT=REDUNDANT;

SET SESSION alter_algorithm='NOCOPY';
ALTER TABLE tab MODIFY COLUMN c varchar(50) NOT NULL;
ERROR 1845 (0A000): ALGORITHM=NOCOPY is not supported for this operation. Try ALGORITHM=INPLACE
</pre>
<h4 class="anchored_heading" id="adding-a-new-enum-option">Adding a New <code>ENUM</code> Option</h4> <p>InnoDB supports adding a new <code><a href="../enum/index">ENUM</a></code> option to a column with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#adding-a-new-enum-option">InnoDB Online DDL Operations with ALGORITHM=INSTANT: Adding a New ENUM Option</a> for more information.</p> <h4 class="anchored_heading" id="adding-a-new-set-option">Adding a New <code>SET</code> Option</h4> <p>InnoDB supports adding a new <code><a href="../set-data-type/index">SET</a></code> option to a column with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#adding-a-new-set-option">InnoDB Online DDL Operations with ALGORITHM=INSTANT: Adding a New SET Option</a> for more information.</p> <h4 class="anchored_heading" id="removing-system-versioning-from-a-column">Removing System Versioning from a Column</h4> <p>In <a href="https://mariadb.com/kb/en/mariadb-1038-release-notes/">MariaDB 10.3.8</a> and later, InnoDB supports removing <a href="../system-versioned-tables/index">system versioning</a> from a column with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#removing-system-versioning-from-a-column">InnoDB Online DDL Operations with ALGORITHM=INSTANT: Removing System Versioning from a Column</a> for more information.</p> <h3 class="anchored_heading" id="alter-table-alter-column"><code>ALTER TABLE ... ALTER COLUMN</code></h3> <p>This applies to <code><a href="../alter-table/index#alter-column">ALTER TABLE ... ALTER COLUMN</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h4 class="anchored_heading" id="setting-a-columns-default-value">Setting a Column's Default Value</h4> <p>InnoDB supports modifying a column's <code><a href="../create-table/index#default-column-option">DEFAULT</a></code> value with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#setting-a-columns-default-value">InnoDB Online DDL Operations with ALGORITHM=INSTANT: Setting a Column's Default Value</a> for more information.</p> <h4 class="anchored_heading" id="removing-a-columns-default-value">Removing a Column's Default Value</h4> <p>InnoDB supports removing a column's <code><a href="../create-table/index#default-column-option">DEFAULT</a></code> value with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#removing-a-columns-default-value">InnoDB Online DDL Operations with ALGORITHM=INSTANT: Removing a Column's Default Value</a> for more information.</p> <h3 class="anchored_heading" id="alter-table-change-column"><code>ALTER TABLE ... CHANGE COLUMN</code></h3> <p>InnoDB supports renaming a column with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#alter-table-change-column">InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... CHANGE COLUMN</a> for more information.</p> <p>This applies to <code><a href="../alter-table/index#change-column">ALTER TABLE ... CHANGE COLUMN</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h2 class="anchored_heading" id="index-operations">Index Operations</h2> <h3 class="anchored_heading" id="alter-table-add-primary-key"><code>ALTER TABLE ... ADD PRIMARY KEY</code></h3> <p>InnoDB does <strong>not</strong> support adding a primary key to a table with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code>.</p> <p>For example:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int,
   b varchar(50),
   c varchar(50)
);

SET SESSION sql_mode='STRICT_TRANS_TABLES';
SET SESSION alter_algorithm='NOCOPY';
ALTER TABLE tab ADD PRIMARY KEY (a);
ERROR 1845 (0A000): ALGORITHM=NOCOPY is not supported for this operation. Try ALGORITHM=INPLACE
</pre>
<p>This applies to <code><a href="../alter-table/index#add-primary-key">ALTER TABLE ... ADD PRIMARY KEY</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h3 class="anchored_heading" id="alter-table-drop-primary-key"><code>ALTER TABLE ... DROP PRIMARY KEY</code></h3> <p>InnoDB does <strong>not</strong> support dropping a primary key with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code>.</p> <p>For example:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SET SESSION alter_algorithm='NOCOPY';
ALTER TABLE tab DROP PRIMARY KEY;
ERROR 1846 (0A000): ALGORITHM=NOCOPY is not supported. Reason: Dropping a primary key is not allowed without also adding a new primary key. Try ALGORITHM=COPY
</pre>
<p>This applies to <code><a href="../alter-table/index#drop-primary-key">ALTER TABLE ... DROP PRIMARY KEY</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h3 class="anchored_heading" id="alter-table-add-index-and-create-index">
<code>ALTER TABLE ... ADD INDEX</code> and <code>CREATE INDEX</code>
</h3> <p>This applies to <code><a href="../alter-table/index#add-index">ALTER TABLE ... ADD INDEX</a></code> and <code><a href="../create-index/index">CREATE INDEX</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h4 class="anchored_heading" id="adding-a-plain-index">Adding a Plain Index</h4> <p>InnoDB supports adding a plain index to a table with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code>.</p> <p>This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <code><a href="../alter-table/index#lock">LOCK</a></code> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p> <p>For example, this succeeds:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SET SESSION alter_algorithm='NOCOPY';
ALTER TABLE tab ADD INDEX b_index (b);
Query OK, 0 rows affected (0.009 sec)
</pre>
<p>And this succeeds:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SET SESSION alter_algorithm='NOCOPY';
CREATE INDEX b_index ON tab (b);
Query OK, 0 rows affected (0.009 sec)
</pre>
<h4 class="anchored_heading" id="adding-a-fulltext-index">Adding a Fulltext Index</h4> <p>InnoDB supports adding a <code><a href="../full-text-indexes/index">FULLTEXT</a></code> index to a table with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code>.</p> <p>However, there are some limitations, such as:</p> <ul start="1"><li>Adding a <code><a href="../full-text-indexes/index">FULLTEXT</a></code> index to a table that does not have a user-defined <code>FTS_DOC_ID</code> column will require the table to be rebuilt once. When the table is rebuilt, the system adds a hidden <code>FTS_DOC_ID</code> column. This initial operation will have to be performed with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>INPLACE</code>.From that point forward, adding additional <code><a href="../full-text-indexes/index">FULLTEXT</a></code> indexes to the same table will not require the table to be rebuilt, and <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> can be set to <code>NOCOPY</code>. </li></ul> <ul start="1"><li>Only one <code><a href="../full-text-indexes/index">FULLTEXT</a></code> index may be added at a time when <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> is set to <code>NOCOPY</code>. </li></ul> <p>This operation supports a read-only locking strategy. This strategy can be explicitly chosen by setting the <code><a href="../alter-table/index#lock">LOCK</a></code> clause to <code>SHARED</code>. When this strategy is used, read-only concurrent DML is permitted. </p> <p>For example, this succeeds, but the first operation requires the table to be rebuilt <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>INPLACE</code>, so that the hidden <code>FTS_DOC_ID</code> column can be added:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SET SESSION alter_algorithm='INPLACE';
ALTER TABLE tab ADD FULLTEXT INDEX b_index (b);
Query OK, 0 rows affected (0.043 sec)

SET SESSION alter_algorithm='NOCOPY';
ALTER TABLE tab ADD FULLTEXT INDEX c_index (c);
Query OK, 0 rows affected (0.017 sec)
</pre>
<p>And this succeeds in the same way as above:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SET SESSION alter_algorithm='INPLACE';
CREATE FULLTEXT INDEX b_index ON tab (b);
Query OK, 0 rows affected (0.048 sec)

SET SESSION alter_algorithm='NOCOPY';
CREATE FULLTEXT INDEX c_index ON tab (c);
Query OK, 0 rows affected (0.016 sec)
</pre>
<p>But this second command fails, because only one <code><a href="../full-text-indexes/index">FULLTEXT</a></code> index can be added at a time:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50),
   d varchar(50)
);

SET SESSION alter_algorithm='INPLACE';
ALTER TABLE tab ADD FULLTEXT INDEX b_index (b);
Query OK, 0 rows affected (0.041 sec)

SET SESSION alter_algorithm='NOCOPY';
ALTER TABLE tab ADD FULLTEXT INDEX c_index (c), ADD FULLTEXT INDEX d_index (d);
ERROR 1846 (0A000): ALGORITHM=NOCOPY is not supported. Reason: InnoDB presently supports one FULLTEXT index creation at a time. Try ALGORITHM=COPY
</pre>
<h4 class="anchored_heading" id="adding-a-spatial-index">Adding a Spatial Index</h4> <p>InnoDB supports adding a <code><a href="../spatial-index/index">SPATIAL</a></code> index to a table with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code>.</p> <p>This operation supports a read-only locking strategy. This strategy can be explicitly chosen by setting the <code><a href="../alter-table/index#lock">LOCK</a></code> clause to <code>SHARED</code>. When this strategy is used, read-only concurrent DML is permitted. </p> <p>For example, this succeeds:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c GEOMETRY NOT NULL
);

SET SESSION alter_algorithm='NOCOPY';
ALTER TABLE tab ADD SPATIAL INDEX c_index (c);
Query OK, 0 rows affected (0.005 sec)
</pre>
<p>And this succeeds in the same way as above:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c GEOMETRY NOT NULL
);

SET SESSION alter_algorithm='NOCOPY';
CREATE SPATIAL INDEX c_index ON tab (c);
Query OK, 0 rows affected (0.005 sec)
</pre>
<h3 class="anchored_heading" id="alter-table-drop-index-and-drop-index">
<code>ALTER TABLE ... DROP INDEX</code> and <code>DROP INDEX</code>
</h3> <p>InnoDB supports dropping indexes from a table with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#alter-table-drop-index-and-drop-index">InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... DROP INDEX and DROP INDEX</a> for more information.</p> <p>This applies to <code><a href="../alter-table/index#drop-index">ALTER TABLE ... DROP INDEX</a></code> and <code><a href="../drop-index/index">DROP INDEX</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h3 class="anchored_heading" id="alter-table-add-foreign-key"><code>ALTER TABLE ... ADD FOREIGN KEY</code></h3> <p>InnoDB does supports adding foreign key constraints to a table with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code>. In order to add a new foreign key constraint to a table with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code>, the <code><a href="../server-system-variables/index#foreign_key_checks">foreign_key_checks</a></code> system variable needs to be set to <code>OFF</code>. If it is set to <code>ON</code>, then <code>ALGORITHM=COPY</code> is required.</p> <p>This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <code><a href="../alter-table/index#lock">LOCK</a></code> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p> <p>For example, this fails:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab1 (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50),
   d int
);

CREATE OR REPLACE TABLE tab2 (
   a int PRIMARY KEY,
   b varchar(50)
);

SET SESSION alter_algorithm='NOCOPY';
ALTER TABLE tab1 ADD FOREIGN KEY tab2_fk (d) REFERENCES tab2 (a);
ERROR 1846 (0A000): ALGORITHM=NOCOPY is not supported. Reason: Adding foreign keys needs foreign_key_checks=OFF. Try ALGORITHM=COPY
</pre>
<p>But this succeeds:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab1 (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50),
   d int
);

CREATE OR REPLACE TABLE tab2 (
   a int PRIMARY KEY,
   b varchar(50)
);

SET SESSION foreign_key_checks=OFF;
SET SESSION alter_algorithm='NOCOPY';
ALTER TABLE tab1 ADD FOREIGN KEY tab2_fk (d) REFERENCES tab2 (a);
Query OK, 0 rows affected (0.011 sec)
</pre>
<p>This applies to <code><a href="../alter-table/index#add-foreign-key">ALTER TABLE ... ADD FOREIGN KEY</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h3 class="anchored_heading" id="alter-table-drop-foreign-key"><code>ALTER TABLE ... DROP FOREIGN KEY</code></h3> <p>InnoDB supports dropping foreign key constraints from a table with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#alter-table-drop-foreign-key">InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... DROP FOREIGN KEY</a> for more information.</p> <p>This applies to <code><a href="../alter-table/index#drop-foreign-key">ALTER TABLE ... DROP FOREIGN KEY</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h2 class="anchored_heading" id="table-operations">Table Operations</h2> <h3 class="anchored_heading" id="alter-table-auto_increment"><code>ALTER TABLE ... AUTO_INCREMENT=...</code></h3> <p>InnoDB supports changing a table's <code><a href="../auto_increment/index">AUTO_INCREMENT</a></code> value with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#alter-table-auto_increment">InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... AUTO_INCREMENT=...</a> for more information.</p> <p>This applies to <code><a href="../create-table/index#auto_increment">ALTER TABLE ... AUTO_INCREMENT=...</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h3 class="anchored_heading" id="alter-table-row_format"><code>ALTER TABLE ... ROW_FORMAT=...</code></h3> <p>InnoDB does <strong>not</strong> support changing a table's <a href="../innodb-storage-formats/index">row format</a> with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code>.</p> <p>For example:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
) ROW_FORMAT=DYNAMIC;

SET SESSION alter_algorithm='NOCOPY';
ALTER TABLE tab ROW_FORMAT=COMPRESSED;
ERROR 1846 (0A000): ALGORITHM=NOCOPY is not supported. Reason: Changing table options requires the table to be rebuilt. Try ALGORITHM=INPLACE
</pre>
<p>This applies to <code><a href="../create-table/index#row_format">ALTER TABLE ... ROW_FORMAT=...</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h3 class="anchored_heading" id="alter-table-key_block_size"><code>ALTER TABLE ... KEY_BLOCK_SIZE=...</code></h3> <p>InnoDB does <strong>not</strong> support changing a table's <code><a href="../innodb-storage-formats/index#using-the-compressed-row-format">KEY_BLOCK_SIZE</a></code> with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code>.</p> <p>For example:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
) ROW_FORMAT=COMPRESSED
  KEY_BLOCK_SIZE=4;

SET SESSION alter_algorithm='NOCOPY';
ALTER TABLE tab KEY_BLOCK_SIZE=2;
ERROR 1846 (0A000): ALGORITHM=NOCOPY is not supported. Reason: Changing table options requires the table to be rebuilt. Try ALGORITHM=INPLACE
</pre>
<p>This applies to <code><a href="../create-table/index#key_block_size">KEY_BLOCK_SIZE=...</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h3 class="anchored_heading" id="alter-table-page_compressed1-and-alter-table-page_compression_level">
<code>ALTER TABLE ... PAGE_COMPRESSED=1</code> and <code>ALTER TABLE ... PAGE_COMPRESSION_LEVEL=...</code>
</h3> <p>In <a href="https://mariadb.com/kb/en/mariadb-10310-release-notes/">MariaDB 10.3.10</a> and later, InnoDB supports setting a table's <code><a href="../create-table/index#page_compressed">PAGE_COMPRESSED</a></code> value to <code>1</code> with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>InnoDB does <strong>not</strong> support changing a table's <code><a href="../create-table/index#page_compressed">PAGE_COMPRESSED</a></code> value from <code>1</code> to <code>0</code> with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code>.</p> <p>In these versions, InnoDB also supports changing a table's <code><a href="../create-table/index#page_compression_level">PAGE_COMPRESSION_LEVEL</a></code> value with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause is set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#alter-table-page_compressed1-and-alter-table-page_compression_level">InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... PAGE_COMPRESSED=1 and ALTER TABLE ... PAGE_COMPRESSION_LEVEL=...</a> for more information.</p> <p>This applies to <code><a href="../create-table/index#page_compressed">ALTER TABLE ... PAGE_COMPRESSED=...</a></code> and <code><a href="../create-table/index#page_compression_level">ALTER TABLE ... PAGE_COMPRESSION_LEVEL=...</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h3 class="anchored_heading" id="alter-table-drop-system-versioning"><code>ALTER TABLE ... DROP SYSTEM VERSIONING</code></h3> <p>InnoDB does <strong>not</strong> support dropping <a href="../system-versioned-tables/index">system versioning</a> from a table with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code>.</p> <p>For example:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
) WITH SYSTEM VERSIONING;

SET SESSION alter_algorithm='NOCOPY';
ALTER TABLE tab DROP SYSTEM VERSIONING;
ERROR 1845 (0A000): ALGORITHM=NOCOPY is not supported for this operation. Try ALGORITHM=INPLACE
</pre>
<p>This applies to <code><a href="../alter-table/index#drop-system-versioning">ALTER TABLE ... DROP SYSTEM VERSIONING</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h3 class="anchored_heading" id="alter-table-drop-constraint"><code>ALTER TABLE ... DROP CONSTRAINT</code></h3> <p>In <a href="https://mariadb.com/kb/en/mariadb-1036-release-notes/">MariaDB 10.3.6</a> and later, InnoDB supports dropping a <code><a href="../constraint/index#check-constraints">CHECK</a></code> constraint from a table with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#alter-table-drop-constraint">InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... DROP CONSTRAINT</a> for more information.</p> <p>This applies to <code><a href="../alter-table/index#drop-constraint">ALTER TABLE ... DROP CONSTRAINT</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h3 class="anchored_heading" id="alter-table-force"><code>ALTER TABLE ... FORCE</code></h3> <p>InnoDB does <strong>not</strong> support forcing a table rebuild with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code>.</p> <p>For example:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SET SESSION alter_algorithm='NOCOPY';
ALTER TABLE tab FORCE;
ERROR 1845 (0A000): ALGORITHM=NOCOPY is not supported for this operation. Try ALGORITHM=INPLACE
</pre>
<p>This applies to <code><a href="../alter-table/index#force">ALTER TABLE ... FORCE</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h3 class="anchored_heading" id="alter-table-engineinnodb"><code>ALTER TABLE ... ENGINE=InnoDB</code></h3> <p>InnoDB does <strong>not</strong> support forcing a table rebuild with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code>.</p> <p>For example:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SET SESSION alter_algorithm='NOCOPY';
ALTER TABLE tab ENGINE=InnoDB;
ERROR 1845 (0A000): ALGORITHM=NOCOPY is not supported for this operation. Try ALGORITHM=INPLACE
</pre>
<p>This applies to <code><a href="../create-table/index#storage-engine">ALTER TABLE ... ENGINE=InnoDB</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h3 class="anchored_heading" id="optimize-table"><code>OPTIMIZE TABLE ...</code></h3> <p>InnoDB does <strong>not</strong> support optimizing a table with with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code>.</p> <p>For example:</p> <pre class="fixed" data-language="sql">CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SHOW GLOBAL VARIABLES WHERE Variable_name IN('innodb_defragment', 'innodb_optimize_fulltext_only');
+-------------------------------+-------+
| Variable_name                 | Value |
+-------------------------------+-------+
| innodb_defragment             | OFF   |
| innodb_optimize_fulltext_only | OFF   |
+-------------------------------+-------+
2 rows in set (0.001 sec)

SET SESSION alter_algorithm='NOCOPY';
OPTIMIZE TABLE tab;
+---------+----------+----------+-----------------------------------------------------------------------------+
| Table   | Op       | Msg_type | Msg_text                                                                    |
+---------+----------+----------+-----------------------------------------------------------------------------+
| db1.tab | optimize | note     | Table does not support optimize, doing recreate + analyze instead           |
| db1.tab | optimize | error    | ALGORITHM=NOCOPY is not supported for this operation. Try ALGORITHM=INPLACE |
| db1.tab | optimize | status   | Operation failed                                                            |
+---------+----------+----------+-----------------------------------------------------------------------------+
3 rows in set, 1 warning (0.002 sec)
</pre>
<p>This applies to <code><a href="../optimize-table/index">OPTIMIZE TABLE</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h3 class="anchored_heading" id="alter-table-rename-to-and-rename-table">
<code>ALTER TABLE ... RENAME TO</code> and <code>RENAME TABLE ...</code>
</h3> <p>InnoDB supports renaming a table with <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> set to <code>NOCOPY</code> in the cases where the operation supports having the <code><a href="../alter-table/index#algorithm">ALGORITHM</a></code> clause set to <code>INSTANT</code>.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index#alter-table-rename-to-and-rename-table">InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... RENAME TO and RENAME TABLE ...</a> for more information.</p> <p>This applies to <code><a href="../alter-table/index#rename-to">ALTER TABLE ... RENAME TO</a></code> and <code><a href="../rename-table/index">RENAME TABLE</a></code> for <a href="../innodb/index">InnoDB</a> tables.</p> <h2 class="anchored_heading" id="limitations">Limitations</h2> <h3 class="anchored_heading" id="limitations-related-to-generated-virtual-and-persistentstored-columns">Limitations Related to Generated (Virtual and Persistent/Stored) Columns</h3> <p><a href="../generated-columns/index">Generated columns</a> do not currently support online DDL for all of the same operations that are supported for "real" columns.</p> <p>See <a href="../generated-columns/index#statement-support">Generated (Virtual and Persistent/Stored) Columns: Statement Support</a> for more information on the limitations.</p> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div>
<div class="_attribution">
  <p class="_attribution-p">
    Â© 2019 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/innodb-online-ddl-operations-with-algorithmnocopy/" class="_attribution-link">https://mariadb.com/kb/en/innodb-online-ddl-operations-with-algorithmnocopy/</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
