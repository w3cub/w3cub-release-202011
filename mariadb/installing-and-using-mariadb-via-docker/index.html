
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Installing and Using MariaDB via Docker - MariaDB - W3cubDocs</title>
  
  <meta name="description" content="Sometimes we want to install a specific version of MariaDB, MariaDB Galera Cluster, or MaxScale on a certain system, but no packages are available. &hellip;">
  <meta name="keywords" content="installing, and, using, mariadb, docker">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/mariadb/installing-and-using-mariadb-via-docker/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/mariadb.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/mariadb/" class="_nav-link" title="" style="margin-left:0;">MariaDB</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _mariadb">
				
				
<h1>Installing and Using MariaDB via Docker</h1> <div> <div class="node creole"> <div class="answer formatted"> <p> Sometimes we want to install a specific version of MariaDB, <a href="../mariadb-galera-cluster/index">MariaDB Galera Cluster</a>, or <a href="../mariadb-maxscale/index">MaxScale</a> on a certain system, but no packages are available. Or maybe, we simply want to isolate MariaDB from the rest of the system, to be sure that we won't cause any damage.</p> <p>A virtual machine would certainly serve the scope. However, this means installing a system on the top of another system. It requires a lot of resources.</p> <p>In many cases, the best solution is Docker. Docker is a framework that runs containers. A container is meant to run a specific daemon, and the software that is needed for that daemon to properly work. Docker does not virtualize a whole system; a container only includes the packages that are not included in the underlying system.</p> <p>Docker requires a very small amount of resources. It can run on a virtualized system. It is used both in development and in production environments.</p> <p>Docker is an open source project, released under the Apache License, version 2.</p> <p>Note that, while your package repositories could have a package called <code>docker</code>, it is probably not the Docker we are talking about. The Docker package could be called <code>docker.io</code> or <code>docker-engine</code>.</p> <h2 class="anchored_heading" id="installing-docker-on-your-system-with-the-universal-installation-script">Installing Docker on Your System with the Universal Installation Script</h2> <p>The script below will install the Docker repositories, required kernel modules and packages on the most common Linux distributions:</p> <pre class="fixed" data-language="sql">curl -sSL https://get.docker.com/ | sh
</pre>
<h2 class="anchored_heading" id="using-mariadb-images">Using MariaDB Images</h2> <p>The easiest way to use MariaDB on Docker is choosing a MariaDB image and creating a container.</p> <h3 class="anchored_heading" id="downloading-an-image">Downloading an Image</h3> <p>You can download a MariaDB image for Docker from the <a href="https://hub.docker.com/u/mariadb/">Offical MariaDB Repository</a>, or choose another image that better suits your needs. You can search Docker Hub (the official set of repositories) for an image with this command:</p> <pre class="fixed" data-language="sql"> docker search mariadb
</pre>
<p>Once you have found an image that you want to use, you can download it via Docker. Some layers including necessary dependencies will be downloaded too. Note that, once a layer is downloaded for a certain image, Docker will not need to download it again for another image.</p> <p>For example, if you want to install the default MariaDB image, you can type:</p> <pre class="fixed" data-language="sql">docker pull mariadb/server:10.3
</pre>
<p>This will install the 10.3 version. Versions 10.1 and 10.2 are also valid choices.</p> <p>You will see a list of necessary layers. For each layer, Dockers will say if it is already present, or its download progress.</p> <p>To get a list of installed images:</p> <pre class="fixed" data-language="sql">docker images
</pre>
<h3 class="anchored_heading" id="creating-a-container">Creating a Container</h3> <p>An image is not a running process; it is just the software needed to be launched. To run it, we must create a container first. The command needed to create a container can usually be found in the image documentation. For example, to create a container for the official MariaDB image:</p> <pre class="fixed" data-language="sql">docker run --name mariadbtest -e MYSQL_ROOT_PASSWORD=mypass -d mariadb/server:10.3
</pre>
<p><code>mariadbtest</code> is the name we want to assign the container. If we don't specify a name, an id will be automatically generated.</p> <p>10.1 and 10.2 are also valid target versions:</p> <pre class="fixed" data-language="sql">docker run --name mariadbtest -e MYSQL_ROOT_PASSWORD=mypass -d mariadb/server:10.1
</pre>
<pre class="fixed" data-language="sql">docker run --name mariadbtest -e MYSQL_ROOT_PASSWORD=mypass -d mariadb/server:10.2
</pre>
<p>Optionally, after the image name, we can specify some <a href="../mysqld-options/index">options for mysqld</a>. For example:</p> <pre class="fixed" data-language="sql">docker run --name mariadbtest -e MYSQL_ROOT_PASSWORD=mypass -d mariadb/server:10.3 --log-bin --binlog-format=MIXED
</pre>
<p>Docker will respond with the container's id. But, just to be sure that the container has been created and is running, we can get a list of running containers in this way:</p> <pre class="fixed" data-language="sql">docker ps
</pre>
<p>We should get an output similar to this one:</p> <pre class="fixed" data-language="sql">CONTAINER ID        IMAGE                      COMMAND                CREATED             STATUS              PORTS               NAMES
819b786a8b48        mariadb/server             "/docker-entrypoint.   4 minutes ago       Up 4 minutes        3306/tcp            mariadbtest        
</pre>
<h3 class="anchored_heading" id="running-and-stopping-the-container">Running and Stopping the Container</h3> <p>Docker allows us to restart a container with a single command:</p> <pre class="fixed" data-language="sql">docker restart mariadbtest
</pre>
<p>The container can also be stopped like this:</p> <pre class="fixed" data-language="sql">docker stop mariadbtest
</pre>
<p>The container will not be destroyed by this command. The data will still live inside the container, even if MariaDB is not running. To restart the container and see our data, we can issue:</p> <pre class="fixed" data-language="sql">docker start mariadbtest
</pre>
<p>With <code>docker stop</code>, the container will be gracefully terminated: a <code>SIGTERM</code> signal will be sent to the <code>mysqld</code> process, and Docker will wait for the process to shutdown before returning the control to the shell. However, it is also possible to set a timeout, after which the process will be immediately killed with a <code>SIGKILL</code>. Or it is possible to immediately kill the process, with no timeout.</p> <pre class="fixed" data-language="sql">docker stop --time=30 mariadbtest
docker kill mariadbtest
</pre>
<p>In case we want to destroy a container, perhaps because the image does not suit our needs, we can stop it and then run:</p> <pre class="fixed" data-language="sql">docker rm mariadbtest
</pre>
<p>Note that the command above does not destroy the data volume that Docker has created for /var/lib/mysql. If you want to destroy the volume as well, use:</p> <pre class="fixed" data-language="sql">docker rm -v mariadbtest
</pre>
<h4 class="anchored_heading" id="pausing-containers">Pausing Containers</h4> <p>A container can also be frozen with the <code>pause</code> command. Docker will freeze the process using croups. MariaDB will not know that it is being frozen and, when we <code>unpause</code> it, MariaDB will resume its work as expected.</p> <p>Both <code>pause</code> and <code>unpause</code> accept one or more container names. So, if we are running a cluster, we can freeze and resume all nodes simultaneously:</p> <pre class="fixed" data-language="sql">docker pause node1 node2 node3
docker unpause node1 node2 node3
</pre>
<p>Pausing a container is very useful when we need to temporarily free our system's resources. If the container is not crucial at this moment (for example, it is performing some batch work), we can free it to allow other programs to run faster.</p> <h3 class="anchored_heading" id="troubleshooting-a-container">Troubleshooting a Container</h3> <p>If the container doesn't start, or is not working properly, we can investigate with the following command:</p> <pre class="fixed" data-language="sql">docker logs mariadbtest
</pre>
<p>This command shows what the daemon sent to the stdout since the last attempt of starting - the text that we typically see when we invoke <code>mysqld</code> from the command line.</p> <p>On some systems, including recent Ubuntu releases, commands such as <code>docker stop mariadbtest</code> and <code>docker restart mariadbtest</code> may fail with a permissions error. This can be caused by the AppArmor package, and even <code>sudo</code> won't allow you to execute the command. You can totally remove AppArmor using the following commands:</p> <pre class="fixed" data-language="sql">sudo apt-get purge --auto-remove apparmor
sudo service docker restart
docker system prune --all --volumes
</pre>
<p>Restarting the system will then allow Docker to operate normally. More information is available in the Docker forums: <a href="https://forums.docker.com/t/can-not-stop-docker-container-permission-denied-error/41142/3">https://forums.docker.com/t/can-not-stop-docker-container-permission-denied-error/41142/3</a></p> <h3 class="anchored_heading" id="accessing-the-container">Accessing the Container</h3> <p>To access the container via Bash, we can run this command:</p> <pre class="fixed" data-language="sql">docker exec -it mariadbtest bash
</pre>
<p>Now we can use normal Linux commands like <em>cd</em>, <em>ls</em>, etc. We will have root privileges. We can even install our favorite file editor, for example:</p> <pre class="fixed" data-language="sql">apt-get update
apt-get install vim
</pre>
<p>In some images, no repository is configured by default, so we may need to add them.</p> <p>Note that if we run <a href="../mysqladmin/index#mysqladmin-commands">mysqladmin shutdown</a> or the <a href="../shutdown/index">SHUTDOWN</a> command to stop the container, the container will be deactivated, and we will automatically exit to our system.</p> <h3 class="anchored_heading" id="connecting-to-mariadb-from-outside-the-container">Connecting to MariaDB from Outside the Container</h3> <p>If we try to connect to the MariaDB server on <code>localhost</code>, the client will bypass networking and attempt to connect to the server using a socket file in the local filesystem. However, this doesn't work when MariaDB is running inside a container because the server's filesystem is isolated from the host. The client can't access the socket file which is inside the container, so it fails to connect.</p> <p>Therefore connections to the MariaDB server must be made using TCP, even when the client is running on the same machine as the server container.</p> <p>Most MariaDB images, including the official one, have external TCP connections disabled using the <code>bind-address</code> option in their #my.cnf# file. The docker image used in this guide is based on Ubuntu, so the file is located at <code>/etc/mysql/my.cnf</code>.</p> <p>To use MariaDB we will need to edit the configuration file to change the appropriate option, and then restart the container.</p> <p>Inside the container, edit the file <code>my.cnf</code> and check for the line that begins <code>bind-address</code>. Put a hash at the start of the line to comment it out:</p> <pre class="fixed" data-language="sql">#bind-address            = 127.0.0.1
</pre>
<p>Save the file.</p> <p>While still inside the container, send the shutdown command to MariaDB. This will shut down the server and also exit back out to the host:</p> <pre class="fixed" data-language="sql">mysqladmin -u root -p shutdown
</pre>
<p>Start the container again. This time the MariaDB server will have networking enabled:</p> <pre class="fixed" data-language="sql">docker start mariadbtest
</pre>
<p>Find the IP address that has been assigned to the container:</p> <pre class="fixed" data-language="sql">docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' mariadbtest
</pre>
<p>You can now connect to the MariaDB server using a TCP connection to that IP address.</p> <h4 class="anchored_heading" id="forcing-a-tcp-connection">Forcing a TCP Connection</h4> <p>After enabling network connections in MariaDB as described above, we will be able to connect to the server from outside the container.</p> <p>On the host, run the client and set the server address ("-h") to the container's IP address that you found in the previous step:</p> <pre class="fixed" data-language="sql">mysql -h 172.17.0.2 -u root -p
</pre>
<p>This simple form of the connection should work in most situations. Depending on your configuration, it may also be necessary to specify the port for the server or to force TCP mode:</p> <pre class="fixed" data-language="sql">mysql -h 172.17.0.2 -P 3306 --protocol=TCP -u root -p
</pre>
<h4 class="anchored_heading" id="port-configuration-for-clustered-containers-and-replication">Port Configuration for Clustered Containers and Replication</h4> <p>Multiple MariaDB servers running in separate Docker containers can connect to each other using TCP. This is useful for forming a Galera cluster or for replication.</p> <p>When running a cluster or a replication setup via Docker, we will want the containers to use different ports. The fastest way to achieve this is mapping the containers ports to different port on our system. We can do this when creating the containers (<code>docker run</code> command), by using the <code>-p</code> option, several times if necessary. For example, for Galera nodes we will use a mapping similar to this one:</p> <pre class="fixed" data-language="sql">-p 4306:3306 -p 5567:5567 -p 5444:5444 -p 5568:5568
</pre>
<h2 class="anchored_heading" id="installing-mariadb-on-another-image">Installing MariaDB on Another Image</h2> <p>It is possible to download a Linux distribution image, and to install MariaDB on it. This is not much harder than installing MariaDB on a regular operating system (which is easy), but it is still the hardest option. Normally we will try existing images first. However, it is possible that no image is available for the exact version we want, or we want a custom installation, or perhaps we want to use a distribution for which no images are available. In these cases, we will install MariaDB in an operating system image.</p> <h3 class="anchored_heading" id="daemonizing-the-operating-system">Daemonizing the Operating System</h3> <p>First, we need the system image to run as a daemon. If we skip this step, MariaDB and all databases will be lost when the container stops.</p> <p>To demonize an image, we need to give it a command that never ends. In the following example, we will create a Debian Jessie daemon that constantly pings the 8.8.8.8 special address:</p> <pre class="fixed" data-language="sql">docker run --name debian -p 3306:3306 -d debian /bin/sh -c "while true; do ping 8.8.8.8; done"
</pre>
<h3 class="anchored_heading" id="installing-mariadb">Installing MariaDB</h3> <p>At this point, we can enter the shell and issue commands. First we will need to update the repositories, or no packages will be available. We can also update the packages, in case some of them are newer than the image. Then, we will need to install a text editor; we will need it to edit configuration files. For example:</p> <pre class="fixed" data-language="sql">docker exec -ti debian bash
apt-get -y update
apt-get -y upgrade
apt-get -y install vim
</pre>
<p>Now we are ready to <a href="../getting-installing-and-upgrading-mariadb/index">install MariaDB</a> in the way we prefer.</p> <h2 class="anchored_heading" id="see-also">See Also</h2> <ul start="1">
<li>
<a href="https://go.mariadb.com/GLBL-WBN_2018-10-09-MariaDB_Containers.html">Official MariaDB Docker Images Webinar</a> </li>
<li>
<a href="https://www.docker.com/">Docker official site</a> </li>
<li>
<a href="https://hub.docker.com/">Docker Hub</a> </li>
<li><a href="https://docs.docker.com/">Docker documentation</a></li>
</ul> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div>
<div class="_attribution">
  <p class="_attribution-p">
    Â© 2019 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/installing-and-using-mariadb-via-docker/" class="_attribution-link">https://mariadb.com/kb/en/installing-and-using-mariadb-via-docker/</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
