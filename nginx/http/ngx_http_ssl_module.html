
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Ngx_http_ssl_module - Nginx - W3cubDocs</title>
  
  <meta name="description" content=" The ngx_http_ssl_module module provides the necessary support for HTTPS. ">
  <meta name="keywords" content="module, ngx, http, ssl, nginx">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/nginx/http/ngx_http_ssl_module.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/nginx.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/nginx/" class="_nav-link" title="" style="margin-left:0;">nginx</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _nginx">
				
				
<h1>Module ngx_http_ssl_module</h1>
<ul>
<li><a href="#example">Example Configuration</a></li>
<li><a href="#directives">Directives</a></li>
<li><a href="#ssl">ssl</a></li>
<li><a href="#ssl_buffer_size">ssl_buffer_size</a></li>
<li><a href="#ssl_certificate">ssl_certificate</a></li>
<li><a href="#ssl_certificate_key">ssl_certificate_key</a></li>
<li><a href="#ssl_ciphers">ssl_ciphers</a></li>
<li><a href="#ssl_client_certificate">ssl_client_certificate</a></li>
<li><a href="#ssl_conf_command">ssl_conf_command</a></li>
<li><a href="#ssl_crl">ssl_crl</a></li>
<li><a href="#ssl_dhparam">ssl_dhparam</a></li>
<li><a href="#ssl_early_data">ssl_early_data</a></li>
<li><a href="#ssl_ecdh_curve">ssl_ecdh_curve</a></li>
<li><a href="#ssl_ocsp">ssl_ocsp</a></li>
<li><a href="#ssl_ocsp_cache">ssl_ocsp_cache</a></li>
<li><a href="#ssl_ocsp_responder">ssl_ocsp_responder</a></li>
<li><a href="#ssl_password_file">ssl_password_file</a></li>
<li><a href="#ssl_prefer_server_ciphers">ssl_prefer_server_ciphers</a></li>
<li><a href="#ssl_protocols">ssl_protocols</a></li>
<li><a href="#ssl_reject_handshake">ssl_reject_handshake</a></li>
<li><a href="#ssl_session_cache">ssl_session_cache</a></li>
<li><a href="#ssl_session_ticket_key">ssl_session_ticket_key</a></li>
<li><a href="#ssl_session_tickets">ssl_session_tickets</a></li>
<li><a href="#ssl_session_timeout">ssl_session_timeout</a></li>
<li><a href="#ssl_stapling">ssl_stapling</a></li>
<li><a href="#ssl_stapling_file">ssl_stapling_file</a></li>
<li><a href="#ssl_stapling_responder">ssl_stapling_responder</a></li>
<li><a href="#ssl_stapling_verify">ssl_stapling_verify</a></li>
<li><a href="#ssl_trusted_certificate">ssl_trusted_certificate</a></li>
<li><a href="#ssl_verify_client">ssl_verify_client</a></li>
<li><a href="#ssl_verify_depth">ssl_verify_depth</a></li>
<li><a href="#errors">Error Processing</a></li>
<li><a href="#variables">Embedded Variables</a></li>
</ul> <p id="summary"> The <code>ngx_http_ssl_module</code> module provides the necessary support for HTTPS. </p>
<p> This module is not built by default, it should be enabled with the <code>--with-http_ssl_module</code> configuration parameter. </p> <blockquote class="note"> This module requires the <a href="http://www.openssl.org">OpenSSL</a> library. </blockquote>
 <h4 id="example">Example Configuration</h4>
<p> To reduce the processor load it is recommended to </p> <ul class="compact"> <li> set the number of <a href="../ngx_core_module#worker_processes">worker processes</a> equal to the number of processors, </li> <li> enable <a href="ngx_http_core_module#keepalive_timeout">keep-alive</a> connections, </li> <li> enable the <a href="#ssl_session_cache_shared">shared</a> session cache, </li> <li> disable the <a href="#ssl_session_cache_builtin">built-in</a> session cache, </li> <li> and possibly increase the session <a href="#ssl_session_timeout">lifetime</a> (by default, 5 minutes): </li> </ul>
 <pre data-language="nginx">
<strong>worker_processes auto;</strong>

http {

    ...

    server {
        listen              443 ssl;
        <strong>keepalive_timeout   70;</strong>

        ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers         AES128-SHA:AES256-SHA:RC4-SHA:DES-CBC3-SHA:RC4-MD5;
        ssl_certificate     /usr/local/nginx/conf/cert.pem;
        ssl_certificate_key /usr/local/nginx/conf/cert.key;
        <strong>ssl_session_cache   shared:SSL:10m;</strong>
        <strong>ssl_session_timeout 10m;</strong>

        ...
    }
</pre>
 <h4 id="directives">Directives</h4>
<div class="directive" id="ssl"><table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl</strong> on | off;</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl off;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table></div>
<p> This directive was made obsolete in version 1.15.0. The <code>ssl</code> parameter of the <a href="ngx_http_core_module#listen">listen</a> directive should be used instead. </p>
<div class="directive" id="ssl_buffer_size">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_buffer_size</strong> <i>size</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_buffer_size 16k;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 1.5.9. </p>
</div>
<p> Sets the size of the buffer used for sending data. </p>
<p> By default, the buffer size is 16k, which corresponds to minimal overhead when sending big responses. To minimize Time To First Byte it may be beneficial to use smaller values, for example: </p> <pre data-language="nginx">
ssl_buffer_size 4k;
</pre>

<div class="directive" id="ssl_certificate"><table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_certificate</strong> <i>file</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> — </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table></div>
<p> Specifies a <code><i>file</i></code> with the certificate in the PEM format for the given virtual server. If intermediate certificates should be specified in addition to a primary certificate, they should be specified in the same file in the following order: the primary certificate comes first, then the intermediate certificates. A secret key in the PEM format may be placed in the same file. </p>
<p> Since version 1.11.0, this directive can be specified multiple times to load certificates of different types, for example, RSA and ECDSA: </p> <pre data-language="nginx">
server {
    listen              443 ssl;
    server_name         example.com;

    ssl_certificate     example.com.rsa.crt;
    ssl_certificate_key example.com.rsa.key;

    ssl_certificate     example.com.ecdsa.crt;
    ssl_certificate_key example.com.ecdsa.key;

    ...
}
</pre>
 <blockquote class="note"> Only OpenSSL 1.0.2 or higher supports separate <a href="configuring_https_servers#chains">certificate chains</a> for different certificates. With older versions, only one certificate chain can be used. </blockquote>

<p> Since version 1.15.9, variables can be used in the <code><i>file</i></code> name when using OpenSSL 1.0.2 or higher: </p> <pre data-language="nginx">
ssl_certificate     $ssl_server_name.crt;
ssl_certificate_key $ssl_server_name.key;
</pre>
<p> Note that using variables implies that a certificate will be loaded for each SSL handshake, and this may have a negative impact on performance. </p>
<p id="ssl_certificate_data"> The value <code>data</code>:<code><i>$variable</i></code> can be specified instead of the <code><i>file</i></code> (1.15.10), which loads a certificate from a variable without using intermediate files. Note that inappropriate use of this syntax may have its security implications, such as writing secret key data to <a href="../ngx_core_module#error_log">error log</a>. </p>
<p> It should be kept in mind that due to the HTTPS protocol limitations for maximum interoperability virtual servers should listen on <a href="configuring_https_servers#name_based_https_servers">different IP addresses</a>. </p>
<div class="directive" id="ssl_certificate_key"><table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_certificate_key</strong> <i>file</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> — </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table></div>
<p> Specifies a <code><i>file</i></code> with the secret key in the PEM format for the given virtual server. </p>
<p> The value <code>engine</code>:<code><i>name</i></code>:<code><i>id</i></code> can be specified instead of the <code><i>file</i></code> (1.7.9), which loads a secret key with a specified <code><i>id</i></code> from the OpenSSL engine <code><i>name</i></code>. </p>
<p id="ssl_certificate_key_data"> The value <code>data</code>:<code><i>$variable</i></code> can be specified instead of the <code><i>file</i></code> (1.15.10), which loads a secret key from a variable without using intermediate files. Note that inappropriate use of this syntax may have its security implications, such as writing secret key data to <a href="../ngx_core_module#error_log">error log</a>. </p>
<p> Since version 1.15.9, variables can be used in the <code><i>file</i></code> name when using OpenSSL 1.0.2 or higher. </p>
<div class="directive" id="ssl_ciphers"><table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_ciphers</strong> <i>ciphers</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_ciphers HIGH:!aNULL:!MD5;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table></div>
<p> Specifies the enabled ciphers. The ciphers are specified in the format understood by the OpenSSL library, for example: </p> <pre data-language="nginx">
ssl_ciphers ALL:!aNULL:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;
</pre>

<p> The full list can be viewed using the “<code>openssl ciphers</code>” command. </p>
 <blockquote class="note"> The previous versions of nginx used <a href="configuring_https_servers#compatibility">different</a> ciphers by default. </blockquote>

<div class="directive" id="ssl_client_certificate"><table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_client_certificate</strong> <i>file</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> — </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table></div>
<p> Specifies a <code><i>file</i></code> with trusted CA certificates in the PEM format used to <a href="#ssl_verify_client">verify</a> client certificates and OCSP responses if <a href="#ssl_stapling">ssl_stapling</a> is enabled. </p>
<p> The list of certificates will be sent to clients. If this is not desired, the <a href="#ssl_trusted_certificate">ssl_trusted_certificate</a> directive can be used. </p>
<div class="directive" id="ssl_conf_command">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_conf_command</strong> <i>command</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> — </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 1.19.4. </p>
</div>
<p> Sets arbitrary OpenSSL configuration <a href="https://www.openssl.org/docs/man1.1.1/man3/SSL_CONF_cmd.html">commands</a>. </p> <blockquote class="note"> The directive is supported when using OpenSSL 1.0.2 or higher. </blockquote>

<p> Several <code>ssl_conf_command</code> directives can be specified on the same level: </p> <pre data-language="nginx">
ssl_conf_command Options PrioritizeChaCha;
ssl_conf_command Ciphersuites TLS_CHACHA20_POLY1305_SHA256;
</pre>
<p> These directives are inherited from the previous configuration level if and only if there are no <code>ssl_conf_command</code> directives defined on the current level. </p>
 <blockquote class="note"> Note that configuring OpenSSL directly might result in unexpected behavior. </blockquote>

<div class="directive" id="ssl_crl">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_crl</strong> <i>file</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> — </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 0.8.7. </p>
</div>
<p> Specifies a <code><i>file</i></code> with revoked certificates (CRL) in the PEM format used to <a href="#ssl_verify_client">verify</a> client certificates. </p>
<div class="directive" id="ssl_dhparam">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_dhparam</strong> <i>file</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> — </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 0.7.2. </p>
</div>
<p> Specifies a <code><i>file</i></code> with DH parameters for DHE ciphers. </p>
<p> By default no parameters are set, and therefore DHE ciphers will not be used. </p> <blockquote class="note"> Prior to version 1.11.0, builtin parameters were used by default. </blockquote>

<div class="directive" id="ssl_early_data">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_early_data</strong> on | off;</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_early_data off;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 1.15.3. </p>
</div>
<p> Enables or disables TLS 1.3 <a href="https://tools.ietf.org/html/rfc8446#section-2.3">early data</a>. </p> <blockquote class="note"> Requests sent within early data are subject to <a href="https://tools.ietf.org/html/rfc8470">replay attacks</a>. To protect against such attacks at the application layer, the <a href="#var_ssl_early_data">$ssl_early_data</a> variable should be used. </blockquote>
 <pre data-language="nginx">
proxy_set_header Early-Data $ssl_early_data;
</pre>
 <blockquote class="note"> The directive is supported when using OpenSSL 1.1.1 or higher (1.15.4) and <a href="https://boringssl.googlesource.com/boringssl/">BoringSSL</a>. </blockquote>

<div class="directive" id="ssl_ecdh_curve">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_ecdh_curve</strong> <i>curve</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_ecdh_curve auto;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table> <p> This directive appeared in versions 1.1.0 and 1.0.6. </p> </div>
<p> Specifies a <code><i>curve</i></code> for ECDHE ciphers. </p>
<p> When using OpenSSL 1.0.2 or higher, it is possible to specify multiple curves (1.11.0), for example: </p> <pre data-language="nginx">
ssl_ecdh_curve prime256v1:secp384r1;
</pre>

<p> The special value <code>auto</code> (1.11.0) instructs nginx to use a list built into the OpenSSL library when using OpenSSL 1.0.2 or higher, or <code>prime256v1</code> with older versions. </p>
 <blockquote class="note"> Prior to version 1.11.0, the <code>prime256v1</code> curve was used by default. </blockquote>

<div class="directive" id="ssl_ocsp">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_ocsp</strong> on |
        off |
        leaf;</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_ocsp off;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 1.19.0. </p>
</div>
<p> Enables OCSP validation of the client certificate chain. The <code>leaf</code> parameter enables validation of the client certificate only. </p>
<p> For the OCSP validation to work, the <a href="#ssl_verify_client">ssl_verify_client</a> directive should be set to <code>on</code> or <code>optional</code>. </p>
<p> To resolve the OCSP responder hostname, the <a href="ngx_http_core_module#resolver">resolver</a> directive should also be specified. </p>
<p> Example: </p> <pre data-language="nginx">
ssl_verify_client on;
ssl_ocsp          on;
resolver          192.0.2.1;
</pre>

<div class="directive" id="ssl_ocsp_cache">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_ocsp_cache</strong> 
    off |
    [shared:<i>name</i>:<i>size</i>];</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_ocsp_cache off;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 1.19.0. </p>
</div>
<p> Sets <code>name</code> and <code>size</code> of the cache that stores client certificates status for OCSP validation. The cache is shared between all worker processes. A cache with the same name can be used in several virtual servers. </p>
<p> The <code>off</code> parameter prohibits the use of the cache. </p>
<div class="directive" id="ssl_ocsp_responder">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_ocsp_responder</strong> <i>url</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> — </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 1.19.0. </p>
</div>
<p> Overrides the URL of the OCSP responder specified in the “<a href="https://tools.ietf.org/html/rfc5280#section-4.2.2.1">Authority Information Access</a>” certificate extension for <a href="#ssl_ocsp">validation</a> of client certificates. </p>
<p> Only “<code>http://</code>” OCSP responders are supported: </p> <pre data-language="nginx">
ssl_ocsp_responder http://ocsp.example.com/;
</pre>

<div class="directive" id="ssl_password_file">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_password_file</strong> <i>file</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> — </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 1.7.3. </p>
</div>
<p> Specifies a <code><i>file</i></code> with passphrases for <a href="#ssl_certificate_key">secret keys</a> where each passphrase is specified on a separate line. Passphrases are tried in turn when loading the key. </p>
<p> Example: </p> <pre data-language="nginx">
http {
    ssl_password_file /etc/keys/global.pass;
    ...

    server {
        server_name www1.example.com;
        ssl_certificate_key /etc/keys/first.key;
    }

    server {
        server_name www2.example.com;

        # named pipe can also be used instead of a file
        ssl_password_file /etc/keys/fifo;
        ssl_certificate_key /etc/keys/second.key;
    }
}
</pre>

<div class="directive" id="ssl_prefer_server_ciphers"><table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_prefer_server_ciphers</strong> on | off;</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_prefer_server_ciphers off;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table></div>
<p> Specifies that server ciphers should be preferred over client ciphers when using the SSLv3 and TLS protocols. </p>
<div class="directive" id="ssl_protocols"><table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_protocols</strong> 
    [SSLv2]
    [SSLv3]
    [TLSv1]
    [TLSv1.1]
    [TLSv1.2]
    [TLSv1.3];</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table></div>
<p> Enables the specified protocols. </p> <blockquote class="note"> The <code>TLSv1.1</code> and <code>TLSv1.2</code> parameters (1.1.13, 1.0.12) work only when OpenSSL 1.0.1 or higher is used. </blockquote>
 <blockquote class="note"> The <code>TLSv1.3</code> parameter (1.13.0) works only when OpenSSL 1.1.1 built with TLSv1.3 support is used. </blockquote>

<div class="directive" id="ssl_reject_handshake">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_reject_handshake</strong> on | off;</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_reject_handshake off;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 1.19.4. </p>
</div>
<p> If enabled, SSL handshakes in the <a href="ngx_http_core_module#server">server</a> block will be rejected. </p>
<p> For example, in the following configuration, SSL handshakes with server names other than <code>example.com</code> are rejected: </p> <pre data-language="nginx">
server {
    listen               443 ssl;
    ssl_reject_handshake on;
}

server {
    listen              443 ssl;
    server_name         example.com;
    ssl_certificate     example.com.crt;
    ssl_certificate_key example.com.key;
}
</pre>

<div class="directive" id="ssl_session_cache"><table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_session_cache</strong> 
    off |
    none |
    [builtin[:<i>size</i>]]
    [shared:<i>name</i>:<i>size</i>];</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_session_cache none;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table></div>
<p> Sets the types and sizes of caches that store session parameters. A cache can be of any of the following types: </p> <dl class="compact"> <dt><code>off</code></dt> <dd> the use of a session cache is strictly prohibited: nginx explicitly tells a client that sessions may not be reused. </dd> <dt><code>none</code></dt> <dd> the use of a session cache is gently disallowed: nginx tells a client that sessions may be reused, but does not actually store session parameters in the cache. </dd> <dt id="ssl_session_cache_builtin"><code>builtin</code></dt> <dd> a cache built in OpenSSL; used by one worker process only. The cache size is specified in sessions. If size is not given, it is equal to 20480 sessions. Use of the built-in cache can cause memory fragmentation. </dd> <dt id="ssl_session_cache_shared"><code>shared</code></dt> <dd> a cache shared between all worker processes. The cache size is specified in bytes; one megabyte can store about 4000 sessions. Each shared cache should have an arbitrary name. A cache with the same name can be used in several virtual servers. </dd> </dl>

<p> Both cache types can be used simultaneously, for example: </p> <pre data-language="nginx">
ssl_session_cache builtin:1000 shared:SSL:10m;
</pre>
<p> but using only shared cache without the built-in cache should be more efficient. </p>
<div class="directive" id="ssl_session_ticket_key">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_session_ticket_key</strong> <i>file</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> — </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 1.5.7. </p>
</div>
<p> Sets a <code><i>file</i></code> with the secret key used to encrypt and decrypt TLS session tickets. The directive is necessary if the same key has to be shared between multiple servers. By default, a randomly generated key is used. </p>
<p> If several keys are specified, only the first key is used to encrypt TLS session tickets. This allows configuring key rotation, for example: </p> <pre data-language="nginx">
ssl_session_ticket_key current.key;
ssl_session_ticket_key previous.key;
</pre>

<p> The <code><i>file</i></code> must contain 80 or 48 bytes of random data and can be created using the following command: </p> <pre data-language="nginx">
openssl rand 80 &gt; ticket.key
</pre>
<p> Depending on the file size either AES256 (for 80-byte keys, 1.11.8) or AES128 (for 48-byte keys) is used for encryption. </p>
<div class="directive" id="ssl_session_tickets">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_session_tickets</strong> on | off;</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_session_tickets on;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 1.5.9. </p>
</div>
<p> Enables or disables session resumption through <a href="https://tools.ietf.org/html/rfc5077">TLS session tickets</a>. </p>
<div class="directive" id="ssl_session_timeout"><table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_session_timeout</strong> <i>time</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_session_timeout 5m;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table></div>
<p> Specifies a time during which a client may reuse the session parameters. </p>
<div class="directive" id="ssl_stapling">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_stapling</strong> on | off;</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_stapling off;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 1.3.7. </p>
</div>
<p> Enables or disables <a href="https://tools.ietf.org/html/rfc6066#section-8">stapling of OCSP responses</a> by the server. Example: </p> <pre data-language="nginx">
ssl_stapling on;
resolver 192.0.2.1;
</pre>

<p> For the OCSP stapling to work, the certificate of the server certificate issuer should be known. If the <a href="#ssl_certificate">ssl_certificate</a> file does not contain intermediate certificates, the certificate of the server certificate issuer should be present in the <a href="#ssl_trusted_certificate">ssl_trusted_certificate</a> file. </p>
<p> For a resolution of the OCSP responder hostname, the <a href="ngx_http_core_module#resolver">resolver</a> directive should also be specified. </p>
<div class="directive" id="ssl_stapling_file">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_stapling_file</strong> <i>file</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> — </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 1.3.7. </p>
</div>
<p> When set, the stapled OCSP response will be taken from the specified <code><i>file</i></code> instead of querying the OCSP responder specified in the server certificate. </p>
<p> The file should be in the DER format as produced by the “<code>openssl ocsp</code>” command. </p>
<div class="directive" id="ssl_stapling_responder">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_stapling_responder</strong> <i>url</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> — </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 1.3.7. </p>
</div>
<p> Overrides the URL of the OCSP responder specified in the “<a href="https://tools.ietf.org/html/rfc5280#section-4.2.2.1">Authority Information Access</a>” certificate extension. </p>
<p> Only “<code>http://</code>” OCSP responders are supported: </p> <pre data-language="nginx">
ssl_stapling_responder http://ocsp.example.com/;
</pre>

<div class="directive" id="ssl_stapling_verify">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_stapling_verify</strong> on | off;</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_stapling_verify off;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 1.3.7. </p>
</div>
<p> Enables or disables verification of OCSP responses by the server. </p>
<p> For verification to work, the certificate of the server certificate issuer, the root certificate, and all intermediate certificates should be configured as trusted using the <a href="#ssl_trusted_certificate">ssl_trusted_certificate</a> directive. </p>
<div class="directive" id="ssl_trusted_certificate">
<table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_trusted_certificate</strong> <i>file</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> — </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table>
<p>This directive appeared in version 1.3.7. </p>
</div>
<p> Specifies a <code><i>file</i></code> with trusted CA certificates in the PEM format used to <a href="#ssl_verify_client">verify</a> client certificates and OCSP responses if <a href="#ssl_stapling">ssl_stapling</a> is enabled. </p>
<p> In contrast to the certificate set by <a href="#ssl_client_certificate">ssl_client_certificate</a>, the list of these certificates will not be sent to clients. </p>
<div class="directive" id="ssl_verify_client"><table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_verify_client</strong> 
    on | off |
    optional | optional_no_ca;</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_verify_client off;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table></div>
<p> Enables verification of client certificates. The verification result is stored in the <a href="#var_ssl_client_verify">$ssl_client_verify</a> variable. </p>
<p> The <code>optional</code> parameter (0.8.7+) requests the client certificate and verifies it if the certificate is present. </p>
<p> The <code>optional_no_ca</code> parameter (1.3.8, 1.2.5) requests the client certificate but does not require it to be signed by a trusted CA certificate. This is intended for the use in cases when a service that is external to nginx performs the actual certificate verification. The contents of the certificate is accessible through the <a href="#var_ssl_client_cert">$ssl_client_cert</a> variable. </p>
<div class="directive" id="ssl_verify_depth"><table cellspacing="0"> <tr> <th> Syntax: </th> <td> <code><strong>ssl_verify_depth</strong> <i>number</i>;</code><br> </td> </tr> <tr> <th> Default: </th> <td> <code>ssl_verify_depth 1;</code> </td> </tr> <tr> <th> Context: </th> <td> <code>http</code>, <code>server</code><br> </td> </tr> </table></div>
<p> Sets the verification depth in the client certificates chain. </p> <h4 id="errors">Error Processing</h4>
<p> The <code>ngx_http_ssl_module</code> module supports several non-standard error codes that can be used for redirects using the <a href="ngx_http_core_module#error_page">error_page</a> directive: </p> <dl class="compact"> <dt>495</dt> <dd> an error has occurred during the client certificate verification; </dd> <dt>496</dt> <dd> a client has not presented the required certificate; </dd> <dt>497</dt> <dd> a regular request has been sent to the HTTPS port. </dd> </dl>

<p> The redirection happens after the request is fully parsed and the variables, such as <code>$request_uri</code>, <code>$uri</code>, <code>$args</code> and others, are available. </p> <h4 id="variables">Embedded Variables</h4>
<p> The <code>ngx_http_ssl_module</code> module supports embedded variables: </p> <dl class="compact"> <dt id="var_ssl_cipher"><code>$ssl_cipher</code></dt> <dd> returns the name of the cipher used for an established SSL connection; </dd> <dt id="var_ssl_ciphers"><code>$ssl_ciphers</code></dt> <dd> returns the list of ciphers supported by the client (1.11.7). Known ciphers are listed by names, unknown are shown in hexadecimal, for example: <pre data-language="nginx">
AES128-SHA:AES256-SHA:0x00ff
</pre> <blockquote class="note"> The variable is fully supported only when using OpenSSL version 1.0.2 or higher. With older versions, the variable is available only for new sessions and lists only known ciphers. </blockquote> </dd> <dt id="var_ssl_client_escaped_cert"><code>$ssl_client_escaped_cert</code></dt> <dd> returns the client certificate in the PEM format (urlencoded) for an established SSL connection (1.13.5); </dd> <dt id="var_ssl_client_cert"><code>$ssl_client_cert</code></dt> <dd> returns the client certificate in the PEM format for an established SSL connection, with each line except the first prepended with the tab character; this is intended for the use in the <a href="ngx_http_proxy_module#proxy_set_header">proxy_set_header</a> directive; <blockquote class="note"> The variable is deprecated, the <code>$ssl_client_escaped_cert</code> variable should be used instead. </blockquote> </dd> <dt id="var_ssl_client_fingerprint"><code>$ssl_client_fingerprint</code></dt> <dd> returns the SHA1 fingerprint of the client certificate for an established SSL connection (1.7.1); </dd> <dt id="var_ssl_client_i_dn"><code>$ssl_client_i_dn</code></dt> <dd> returns the “issuer DN” string of the client certificate for an established SSL connection according to <a href="https://tools.ietf.org/html/rfc2253">RFC 2253</a> (1.11.6); </dd> <dt id="var_ssl_client_i_dn_legacy"><code>$ssl_client_i_dn_legacy</code></dt> <dd> returns the “issuer DN” string of the client certificate for an established SSL connection; <blockquote class="note"> Prior to version 1.11.6, the variable name was <code>$ssl_client_i_dn</code>. </blockquote> </dd> <dt id="var_ssl_client_raw_cert">
<code>$ssl_client_raw_cert</code> </dt> <dd> returns the client certificate in the PEM format for an established SSL connection; </dd> <dt id="var_ssl_client_s_dn"><code>$ssl_client_s_dn</code></dt> <dd> returns the “subject DN” string of the client certificate for an established SSL connection according to <a href="https://tools.ietf.org/html/rfc2253">RFC 2253</a> (1.11.6); </dd> <dt id="var_ssl_client_s_dn_legacy"><code>$ssl_client_s_dn_legacy</code></dt> <dd> returns the “subject DN” string of the client certificate for an established SSL connection; <blockquote class="note"> Prior to version 1.11.6, the variable name was <code>$ssl_client_s_dn</code>. </blockquote> </dd> <dt id="var_ssl_client_serial"><code>$ssl_client_serial</code></dt> <dd> returns the serial number of the client certificate for an established SSL connection; </dd> <dt id="var_ssl_client_v_end"><code>$ssl_client_v_end</code></dt> <dd> returns the end date of the client certificate (1.11.7); </dd> <dt id="var_ssl_client_v_remain"><code>$ssl_client_v_remain</code></dt> <dd> returns the number of days until the client certificate expires (1.11.7); </dd> <dt id="var_ssl_client_v_start"><code>$ssl_client_v_start</code></dt> <dd> returns the start date of the client certificate (1.11.7); </dd> <dt id="var_ssl_client_verify"><code>$ssl_client_verify</code></dt> <dd> returns the result of client certificate verification: “<code>SUCCESS</code>”, “<code>FAILED:</code><code><i>reason</i></code>”, and “<code>NONE</code>” if a certificate was not present; <blockquote class="note"> Prior to version 1.11.7, the “<code>FAILED</code>” result did not contain the <code><i>reason</i></code> string. </blockquote> </dd> <dt id="var_ssl_curves"><code>$ssl_curves</code></dt> <dd> returns the list of curves supported by the client (1.11.7). Known curves are listed by names, unknown are shown in hexadecimal, for example: <pre data-language="nginx">
0x001d:prime256v1:secp521r1:secp384r1
</pre> <blockquote class="note"> The variable is supported only when using OpenSSL version 1.0.2 or higher. With older versions, the variable value will be an empty string. </blockquote> <blockquote class="note"> The variable is available only for new sessions. </blockquote> </dd> <dt id="var_ssl_early_data"><code>$ssl_early_data</code></dt> <dd> returns “<code>1</code>” if TLS 1.3 <a href="#ssl_early_data">early data</a> is used and the handshake is not complete, otherwise “” (1.15.3). </dd> <dt id="var_ssl_protocol"><code>$ssl_protocol</code></dt> <dd> returns the protocol of an established SSL connection; </dd> <dt id="var_ssl_server_name"><code>$ssl_server_name</code></dt> <dd> returns the server name requested through <a href="http://en.wikipedia.org/wiki/Server_Name_Indication">SNI</a> (1.7.0); </dd> <dt id="var_ssl_session_id"><code>$ssl_session_id</code></dt> <dd> returns the session identifier of an established SSL connection; </dd> <dt id="var_ssl_session_reused"><code>$ssl_session_reused</code></dt> <dd> returns “<code>r</code>” if an SSL session was reused, or “<code>.</code>” otherwise (1.5.11). </dd> </dl>
<div class="_attribution">
  <p class="_attribution-p">
    © 2002-2020 Igor Sysoev<br>© 2011-2020 Nginx, Inc.<br>Licensed under the BSD License.<br>
    <a href="https://nginx.org/en/docs/http/ngx_http_ssl_module.html" class="_attribution-link">https://nginx.org/en/docs/http/ngx_http_ssl_module.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
