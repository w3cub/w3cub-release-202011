
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Single Executable Applications - Node.js - W3cubDocs</title>
  
  <meta name="description" content=" Added support for &#34;useSnapshot&#34;. ">
  <meta name="keywords" content="single, executable, applications, node, js">
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/node/single-executable-applications.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-c8f743fc70bb84079c3cf4b71f5f99835529659c30689b2fd6193651a680f383ef1d96896f8966c7ca8a0160ffd557685bb8ad12820ec6002d60143812238086.css">
  <script type="text/javascript" src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js"></script>
  <script src="/json/node.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/node/" class="_nav-link" title="" style="margin-left:0;">Node.js</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _node">
				
				
<h2 id="single-executable-applications">Single executable applications
</h2> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v20.6.0</td> <td><p>Added support for "useSnapshot".</p></td>
</tr> <tr>
<td>v20.6.0</td> <td><p>Added support for "useCodeCache".</p></td>
</tr> <tr>
<td>v19.7.0, v18.16.0</td> <td><p><span>Added in: v19.7.0, v18.16.0</span></p></td>
</tr> </tbody>
</table> </details> </div> 
<div class="api_stability api_stability_1">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 1</a> - Experimental: This feature is being designed and will change.</div>
 <p><strong>Source Code:</strong> <a href="https://github.com/nodejs/node/blob/v20.8.0/src/node_sea.cc">src/node_sea.cc</a></p> <p>This feature allows the distribution of a Node.js application conveniently to a system that does not have Node.js installed.</p> <p>Node.js supports the creation of <a href="https://github.com/nodejs/single-executable">single executable applications</a> by allowing the injection of a blob prepared by Node.js, which can contain a bundled script, into the <code>node</code> binary. During start up, the program checks if anything has been injected. If the blob is found, it executes the script in the blob. Otherwise Node.js operates as it normally does.</p> <p>The single executable application feature currently only supports running a single embedded script using the <a href="modules#modules-commonjs-modules">CommonJS</a> module system.</p> <p>Users can create a single executable application from their bundled script with the <code>node</code> binary itself and any tool which can inject resources into the binary.</p> <p>Here are the steps for creating a single executable application using one such tool, <a href="https://github.com/nodejs/postject">postject</a>:</p> <ol> <li> <p>Create a JavaScript file:</p> <pre data-language="js">echo 'console.log(`Hello, ${process.argv[2]}!`);' &gt; hello.js copy</pre> </li> <li> <p>Create a configuration file building a blob that can be injected into the single executable application (see <a href="#generating-single-executable-preparation-blobs">Generating single executable preparation blobs</a> for details):</p> <pre data-language="js">echo '{ "main": "hello.js", "output": "sea-prep.blob" }' &gt; sea-config.json copy</pre> </li> <li> <p>Generate the blob to be injected:</p> <pre data-language="js">node --experimental-sea-config sea-config.json copy</pre> </li> <li> <p>Create a copy of the <code>node</code> executable and name it according to your needs:</p> <ul> <li>On systems other than Windows:</li> </ul> <pre data-language="js">cp $(command -v node) hello copy</pre> <ul> <li>On Windows:</li> </ul> <pre data-language="js">node -e "require('fs').copyFileSync(process.execPath, 'hello.exe')" copy</pre> <p>The <code>.exe</code> extension is necessary.</p> </li> <li> <p>Remove the signature of the binary (macOS and Windows only):</p> <ul> <li>On macOS:</li> </ul> <pre data-language="js">codesign --remove-signature hello copy</pre> <ul> <li>On Windows (optional):</li> </ul> <p><a href="https://learn.microsoft.com/en-us/windows/win32/seccrypto/signtool">signtool</a> can be used from the installed <a href="https://developer.microsoft.com/en-us/windows/downloads/windows-sdk/">Windows SDK</a>. If this step is skipped, ignore any signature-related warning from postject.</p> <pre data-language="js">signtool remove /s hello.exe copy</pre> </li> <li> <p>Inject the blob into the copied binary by running <code>postject</code> with the following options:</p> <ul> <li>
<code>hello</code> / <code>hello.exe</code> - The name of the copy of the <code>node</code> executable created in step 4.</li> <li>
<code>NODE_SEA_BLOB</code> - The name of the resource / note / section in the binary where the contents of the blob will be stored.</li> <li>
<code>sea-prep.blob</code> - The name of the blob created in step 1.</li> <li>
<code>--sentinel-fuse NODE_SEA_FUSE_fce680ab2cc467b6e072b8b5df1996b2</code> - The <a href="https://www.electronjs.org/docs/latest/tutorial/fuses">fuse</a> used by the Node.js project to detect if a file has been injected.</li> <li>
<code>--macho-segment-name NODE_SEA</code> (only needed on macOS) - The name of the segment in the binary where the contents of the blob will be stored.</li> </ul> <p>To summarize, here is the required command for each platform:</p> <ul> <li> <p>On Linux:</p> <pre data-language="js">npx postject hello NODE_SEA_BLOB sea-prep.blob \
    --sentinel-fuse NODE_SEA_FUSE_fce680ab2cc467b6e072b8b5df1996b2 copy</pre> </li> <li> <p>On Windows - PowerShell:</p> <pre data-language="js">npx postject hello.exe NODE_SEA_BLOB sea-prep.blob `
    --sentinel-fuse NODE_SEA_FUSE_fce680ab2cc467b6e072b8b5df1996b2 copy</pre> </li> <li> <p>On Windows - Command Prompt:</p> <pre data-language="js">npx postject hello.exe NODE_SEA_BLOB sea-prep.blob ^
    --sentinel-fuse NODE_SEA_FUSE_fce680ab2cc467b6e072b8b5df1996b2 copy</pre> </li> <li> <p>On macOS:</p> <pre data-language="js">npx postject hello NODE_SEA_BLOB sea-prep.blob \
    --sentinel-fuse NODE_SEA_FUSE_fce680ab2cc467b6e072b8b5df1996b2 \
    --macho-segment-name NODE_SEA copy</pre> </li> </ul> </li> <li> <p>Sign the binary (macOS and Windows only):</p> <ul> <li>On macOS:</li> </ul> <pre data-language="js">codesign --sign - hello copy</pre> <ul> <li>On Windows (optional):</li> </ul> <p>A certificate needs to be present for this to work. However, the unsigned binary would still be runnable.</p> <pre data-language="js">signtool sign /fd SHA256 hello.exe copy</pre> </li> <li> <p>Run the binary:</p> <ul> <li>On systems other than Windows</li> </ul> <pre data-language="js">$ ./hello world
Hello, world! copy</pre> <ul> <li>On Windows</li> </ul> <pre data-language="js">$ .\hello.exe world
Hello, world! copy</pre> </li> </ol> <section><h3 id="generating-single-executable-preparation-blobs">Generating single executable preparation blobs
</h3> <p>Single executable preparation blobs that are injected into the application can be generated using the <code>--experimental-sea-config</code> flag of the Node.js binary that will be used to build the single executable. It takes a path to a configuration file in JSON format. If the path passed to it isn't absolute, Node.js will use the path relative to the current working directory.</p> <p>The configuration currently reads the following top-level fields:</p> <pre data-language="js">{
  "main": "/path/to/bundled/script.js",
  "output": "/path/to/write/the/generated/blob.blob",
  "disableExperimentalSEAWarning": true, // Default: false
  "useSnapshot": false,  // Default: false
  "useCodeCache": true // Default: false
} copy</pre> <p>If the paths are not absolute, Node.js will use the path relative to the current working directory. The version of the Node.js binary used to produce the blob must be the same as the one to which the blob will be injected.</p> <h4 id="startup-snapshot-support">Startup snapshot support
</h4> <p>The <code>useSnapshot</code> field can be used to enable startup snapshot support. In this case the <code>main</code> script would not be when the final executable is launched. Instead, it would be run when the single executable application preparation blob is generated on the building machine. The generated preparation blob would then include a snapshot capturing the states initialized by the <code>main</code> script. The final executable with the preparation blob injected would deserialize the snapshot at run time.</p> <p>When <code>useSnapshot</code> is true, the main script must invoke the <a href="v8#v8startupsnapshotsetdeserializemainfunctioncallback-data"><code>v8.startupSnapshot.setDeserializeMainFunction()</code></a> API to configure code that needs to be run when the final executable is launched by the users.</p> <p>The typical pattern for an application to use snapshot in a single executable application is:</p> <ol> <li>At build time, on the building machine, the main script is run to initialize the heap to a state that's ready to take user input. The script should also configure a main function with <a href="v8#v8startupsnapshotsetdeserializemainfunctioncallback-data"><code>v8.startupSnapshot.setDeserializeMainFunction()</code></a>. This function will be compiled and serialized into the snapshot, but not invoked at build time.</li> <li>At run time, the main function will be run on top of the deserialized heap on the user machine to process user input and generate output.</li> </ol> <p>The general constraints of the startup snapshot scripts also apply to the main script when it's used to build snapshot for the single executable application, and the main script can use the <a href="v8#startup-snapshot-api"><code>v8.startupSnapshot</code> API</a> to adapt to these constraints. See <a href="cli#--build-snapshot">documentation about startup snapshot support in Node.js</a>.</p> <h4 id="v8-code-cache-support">V8 code cache support
</h4> <p>When <code>useCodeCache</code> is set to <code>true</code> in the configuration, during the generation of the single executable preparation blob, Node.js will compile the <code>main</code> script to generate the V8 code cache. The generated code cache would be part of the preparation blob and get injected into the final executable. When the single executable application is launched, instead of compiling the <code>main</code> script from scratch, Node.js would use the code cache to speed up the compilation, then execute the script, which would improve the startup performance.</p> <p><strong>Note:</strong> <code>import()</code> does not work when <code>useCodeCache</code> is <code>true</code>.</p> </section><section><h3 id="notes">Notes
</h3> <h4 id="requireid-in-the-injected-module-is-not-file-based">
<code>require(id)</code> in the injected module is not file based
</h4> <p><code>require()</code> in the injected module is not the same as the <a href="modules#requireid"><code>require()</code></a> available to modules that are not injected. It also does not have any of the properties that non-injected <a href="modules#requireid"><code>require()</code></a> has except <a href="modules#accessing-the-main-module"><code>require.main</code></a>. It can only be used to load built-in modules. Attempting to load a module that can only be found in the file system will throw an error.</p> <p>Instead of relying on a file based <code>require()</code>, users can bundle their application into a standalone JavaScript file to inject into the executable. This also ensures a more deterministic dependency graph.</p> <p>However, if a file based <code>require()</code> is still needed, that can also be achieved:</p> <pre data-language="js">const { createRequire } = require('node:module');
require = createRequire(__filename); copy</pre> <h4 id="__filename-and-modulefilename-in-the-injected-module">
<code>__filename</code> and <code>module.filename</code> in the injected module
</h4> <p>The values of <code>__filename</code> and <code>module.filename</code> in the injected module are equal to <a href="process#processexecpath"><code>process.execPath</code></a>.</p> <h4 id="__dirname-in-the-injected-module">
<code>__dirname</code> in the injected module
</h4> <p>The value of <code>__dirname</code> in the injected module is equal to the directory name of <a href="process#processexecpath"><code>process.execPath</code></a>.</p> <h4 id="single-executable-application-creation-process">Single executable application creation process
</h4> <p>A tool aiming to create a single executable Node.js application must inject the contents of the blob prepared with <code>--experimental-sea-config"</code> into:</p> <ul> <li>a resource named <code>NODE_SEA_BLOB</code> if the <code>node</code> binary is a <a href="https://en.wikipedia.org/wiki/Portable_Executable">PE</a> file</li> <li>a section named <code>NODE_SEA_BLOB</code> in the <code>NODE_SEA</code> segment if the <code>node</code> binary is a <a href="https://en.wikipedia.org/wiki/Mach-O">Mach-O</a> file</li> <li>a note named <code>NODE_SEA_BLOB</code> if the <code>node</code> binary is an <a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">ELF</a> file</li> </ul> <p>Search the binary for the <code>NODE_SEA_FUSE_fce680ab2cc467b6e072b8b5df1996b2:0</code> <a href="https://www.electronjs.org/docs/latest/tutorial/fuses">fuse</a> string and flip the last character to <code>1</code> to indicate that a resource has been injected.</p> <h4 id="platform-support">Platform support
</h4> <p>Single-executable support is tested regularly on CI only on the following platforms:</p> <ul> <li>Windows</li> <li>macOS</li> <li>Linux (all distributions <a href="https://github.com/nodejs/node/blob/main/BUILDING.md#platform-list">supported by Node.js</a> except Alpine and all architectures <a href="https://github.com/nodejs/node/blob/main/BUILDING.md#platform-list">supported by Node.js</a> except s390x)</li> </ul> <p>This is due to a lack of better tools to generate single-executables that can be used to test this feature on other platforms.</p> <p>Suggestions for other resource injection tools/workflows are welcomed. Please start a discussion at <a href="https://github.com/nodejs/single-executable/discussions">https://github.com/nodejs/single-executable/discussions</a> to help us document them.</p></section><div class="_attribution">
  <p class="_attribution-p">
    © Joyent, Inc. and other Node contributors<br>Licensed under the MIT License.<br>Node.js is a trademark of Joyent, Inc. and is used with its permission.<br>We are not endorsed by or affiliated with Joyent.<br>
    <a href="https://nodejs.org/api/single-executable-applications.html" class="_attribution-link">https://nodejs.org/api/single-executable-applications.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
