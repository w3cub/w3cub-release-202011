
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Modules&#58; Node&#58;module API - Node.js - W3cubDocs</title>
  
  <meta name="description" content="Provides general utility methods when interacting with instances of Module, the module variable often seen in CommonJS modules. Accessed via import &hellip;">
  <meta name="keywords" content="modules, node, module, api, js">
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/node/module.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-c8f743fc70bb84079c3cf4b71f5f99835529659c30689b2fd6193651a680f383ef1d96896f8966c7ca8a0160ffd557685bb8ad12820ec6002d60143812238086.css">
  <script type="text/javascript" src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js"></script>
  <script src="/json/node.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/node/" class="_nav-link" title="" style="margin-left:0;">Node.js</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _node">
				
				
<h2 id="modules-nodemodule-api">Modules: <code>node:module</code> API
</h2> <div class="api_metadata"> <span>Added in: v0.3.7</span> </div> <section><h3 id="the-module-object">The <code>Module</code> object
</h3> <ul> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a></li> </ul> <p>Provides general utility methods when interacting with instances of <code>Module</code>, the <a href="modules#the-module-object"><code>module</code></a> variable often seen in <a href="modules">CommonJS</a> modules. Accessed via <code>import 'node:module'</code> or <code>require('node:module')</code>.</p> <h4 id="modulebuiltinmodules">
<code>module.builtinModules</code>
</h4> <div class="api_metadata"> <span>Added in: v9.3.0, v8.10.0, v6.13.0</span> </div> <ul> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string[]&gt;</a></li> </ul> <p>A list of the names of all modules provided by Node.js. Can be used to verify if a module is maintained by a third party or not.</p> <p><code>module</code> in this context isn't the same object that's provided by the <a href="modules#the-module-wrapper">module wrapper</a>. To access it, require the <code>Module</code> module:</p> <p class="module-type">MJS modules</p>
<pre data-language="js">// module.mjs
// In an ECMAScript module
import { builtinModules as builtin } from 'node:module';</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">// module.cjs
// In a CommonJS module
const builtin = require('node:module').builtinModules;</pre> <h4 id="modulecreaterequirefilename">
<code>module.createRequire(filename)</code>
</h4> <div class="api_metadata"> <span>Added in: v12.2.0</span> </div> <ul> <li>
<code>filename</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="url#the-whatwg-url-api" class="type">&lt;URL&gt;</a> Filename to be used to construct the require function. Must be a file URL object, file URL string, or absolute path string.</li> <li>Returns: <a href="modules#requireid" class="type">&lt;require&gt;</a> Require function</li> </ul> <pre data-language="js">import { createRequire } from 'node:module';
const require = createRequire(import.meta.url);

// sibling-module.js is a CommonJS module.
const siblingModule = require('./sibling-module'); copy</pre> <h4 id="moduleisbuiltinmodulename">
<code>module.isBuiltin(moduleName)</code>
</h4> <div class="api_metadata"> <span>Added in: v18.6.0, v16.17.0</span> </div> <ul> <li>
<code>moduleName</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> name of the module</li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> returns true if the module is builtin else returns false</li> </ul> <pre data-language="js">import { isBuiltin } from 'node:module';
isBuiltin('node:fs'); // true
isBuiltin('fs'); // true
isBuiltin('wss'); // false copy</pre> <h4 id="moduleregisterspecifier-parenturl-options">
<code>module.register(specifier[, parentURL][, options])</code>
</h4> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v20.8.0</td> <td><p>Add support for WHATWG URL instances.</p></td>
</tr> <tr>
<td>v20.6.0</td> <td><p><span>Added in: v20.6.0</span></p></td>
</tr> </tbody>
</table> </details> </div> 
<div class="api_stability api_stability_1">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 1</a>.2 - Release candidate</div>
 <ul> <li>
<code>specifier</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="url#the-whatwg-url-api" class="type">&lt;URL&gt;</a> Customization hooks to be registered; this should be the same string that would be passed to <code>import()</code>, except that if it is relative, it is resolved relative to <code>parentURL</code>.</li> <li>
<code>parentURL</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="url#the-whatwg-url-api" class="type">&lt;URL&gt;</a> If you want to resolve <code>specifier</code> relative to a base URL, such as <code>import.meta.url</code>, you can pass that URL here. <strong>Default:</strong> <code>'data:'</code>
</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>data</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" class="type">&lt;any&gt;</a> Any arbitrary, cloneable JavaScript value to pass into the <a href="#initialize"><code>initialize</code></a> hook.</li> <li>
<code>transferList</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object[]&gt;</a> <a href="worker_threads#portpostmessagevalue-transferlist">transferrable objects</a> to be passed into the <code>initialize</code> hook.</li> </ul> </li> </ul> <p>Register a module that exports <a href="#customization-hooks">hooks</a> that customize Node.js module resolution and loading behavior. See <a href="#customization-hooks">Customization hooks</a>.</p> <h4 id="modulesyncbuiltinesmexports">
<code>module.syncBuiltinESMExports()</code>
</h4> <div class="api_metadata"> <span>Added in: v12.12.0</span> </div> <p>The <code>module.syncBuiltinESMExports()</code> method updates all the live bindings for builtin <a href="esm">ES Modules</a> to match the properties of the <a href="modules">CommonJS</a> exports. It does not add or remove exported names from the <a href="esm">ES Modules</a>.</p> <pre data-language="js">const fs = require('node:fs');
const assert = require('node:assert');
const { syncBuiltinESMExports } = require('node:module');

fs.readFile = newAPI;

delete fs.readFileSync;

function newAPI() {
  // ...
}

fs.newAPI = newAPI;

syncBuiltinESMExports();

import('node:fs').then((esmFS) =&gt; {
  // It syncs the existing readFile property with the new value
  assert.strictEqual(esmFS.readFile, newAPI);
  // readFileSync has been deleted from the required fs
  assert.strictEqual('readFileSync' in fs, false);
  // syncBuiltinESMExports() does not remove readFileSync from esmFS
  assert.strictEqual('readFileSync' in esmFS, true);
  // syncBuiltinESMExports() does not add names
  assert.strictEqual(esmFS.newAPI, undefined);
}); copy</pre>  </section><section><h3 id="customization-hooks">Customization Hooks
</h3> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v20.6.0</td> <td><p>Added <code>initialize</code> hook to replace <code>globalPreload</code>.</p></td>
</tr> <tr>
<td>v18.6.0, v16.17.0</td> <td><p>Add support for chaining loaders.</p></td>
</tr> <tr>
<td>v16.12.0</td> <td><p>Removed <code>getFormat</code>, <code>getSource</code>, <code>transformSource</code>, and <code>globalPreload</code>; added <code>load</code> hook and <code>getGlobalPreload</code> hook.</p></td>
</tr> <tr>
<td>v8.8.0</td> <td><p><span>Added in: v8.8.0</span></p></td>
</tr> </tbody>
</table> </details> </div> 
<div class="api_stability api_stability_1">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 1</a>.2 - Release candidate</div>
  <h4 id="enabling">Enabling
</h4> <p>Module resolution and loading can be customized by registering a file which exports a set of hooks. This can be done using the <a href="#moduleregisterspecifier-parenturl-options"><code>register</code></a> method from <code>node:module</code>, which you can run before your application code by using the <code>--import</code> flag:</p> <pre data-language="js">node --import ./register-hooks.js ./my-app.js copy</pre> <p class="module-type">MJS modules</p>
<pre data-language="js">// register-hooks.js
import { register } from 'node:module';

register('./hooks.mjs', import.meta.url);</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">// register-hooks.js
const { register } = require('node:module');
const { pathToFileURL } = require('node:url');

register('./hooks.mjs', pathToFileURL(__filename));</pre> <p>The file passed to <code>--import</code> can also be an export from a dependency:</p> <pre data-language="js">node --import some-package/register ./my-app.js copy</pre> <p>Where <code>some-package</code> has an <a href="packages#exports"><code>"exports"</code></a> field defining the <code>/register</code> export to map to a file that calls <code>register()</code>, like the following <code>register-hooks.js</code> example.</p> <p>Using <code>--import</code> ensures that the hooks are registered before any application files are imported, including the entry point of the application. Alternatively, <code>register</code> can be called from the entry point, but dynamic <code>import()</code> must be used for any code that should be run after the hooks are registered:</p> <p class="module-type">MJS modules</p>
<pre data-language="js">import { register } from 'node:module';

register('http-to-https', import.meta.url);

// Because this is a dynamic `import()`, the `http-to-https` hooks will run
// to handle `./my-app.js` and any other files it imports or requires.
await import('./my-app.js');</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">const { register } = require('node:module');
const { pathToFileURL } = require('node:url');

register('http-to-https', pathToFileURL(__filename));

// Because this is a dynamic `import()`, the `http-to-https` hooks will run
// to handle `./my-app.js` and any other files it imports or requires.
import('./my-app.js');</pre> <p>In this example, we are registering the <code>http-to-https</code> hooks, but they will only be available for subsequently imported modules—in this case, <code>my-app.js</code> and anything it references via <code>import</code> (and optionally <code>require</code>). If the <code>import('./my-app.js')</code> had instead been a static <code>import './my-app.js'</code>, the app would have <em>already</em> been loaded <strong>before</strong> the <code>http-to-https</code> hooks were registered. This due to the ES modules specification, where static imports are evaluated from the leaves of the tree first, then back to the trunk. There can be static imports <em>within</em> <code>my-app.js</code>, which will not be evaluated until <code>my-app.js</code> is dynamically imported.</p> <p><code>my-app.js</code> can also be CommonJS. Customization hooks will run for any modules that it references via <code>import</code> (and optionally <code>require</code>).</p> <p>Finally, if all you want to do is register hooks before your app runs and you don't want to create a separate file for that purpose, you can pass a <code>data:</code> URL to <code>--import</code>:</p> <pre data-language="js">node --import 'data:text/javascript,import { register } from "node:module"; import { pathToFileURL } from "node:url"; register("http-to-https", pathToFileURL("./"));' ./my-app.js copy</pre> <h4 id="chaining">Chaining
</h4> <p>It's possible to call <code>register</code> more than once:</p> <p class="module-type">MJS modules</p>
<pre data-language="js">// entrypoint.mjs
import { register } from 'node:module';

register('./first.mjs', import.meta.url);
register('./second.mjs', import.meta.url);
await import('./my-app.mjs');</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">// entrypoint.cjs
const { register } = require('node:module');
const { pathToFileURL } = require('node:url');

const parentURL = pathToFileURL(__filename);
register('./first.mjs', parentURL);
register('./second.mjs', parentURL);
import('./my-app.mjs');</pre> <p>In this example, the registered hooks will form chains. If both <code>first.mjs</code> and <code>second.mjs</code> define a <code>resolve</code> hook, both will be called, in the order they were registered. The same applies to all the other hooks.</p> <p>The registered hooks also affect <code>register</code> itself. In this example, <code>second.mjs</code> will be resolved and loaded per the hooks registered by <code>first.mjs</code>. This allows for things like writing hooks in non-JavaScript languages, so long as an earlier registered loader is one that transpiles into JavaScript.</p> <p>The <code>register</code> method cannot be called from within the module that defines the hooks.</p> <h4 id="communication-with-module-customization-hooks">Communication with module customization hooks
</h4> <p>Module customization hooks run on a dedicated thread, separate from the main thread that runs application code. This means mutating global variables won't affect the other thread(s), and message channels must be used to communicate between the threads.</p> <p>The <code>register</code> method can be used to pass data to an <a href="#initialize"><code>initialize</code></a> hook. The data passed to the hook may include transferrable objects like ports.</p> <p class="module-type">MJS modules</p>
<pre data-language="js">import { register } from 'node:module';
import { MessageChannel } from 'node:worker_threads';

// This example demonstrates how a message channel can be used to
// communicate with the hooks, by sending `port2` to the hooks.
const { port1, port2 } = new MessageChannel();

port1.on('message', (msg) =&gt; {
  console.log(msg);
});

register('./my-hooks.mjs', {
  parentURL: import.meta.url,
  data: { number: 1, port: port2 },
  transferList: [port2],
});</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">const { register } = require('node:module');
const { pathToFileURL } = require('node:url');
const { MessageChannel } = require('node:worker_threads');

// This example showcases how a message channel can be used to
// communicate with the hooks, by sending `port2` to the hooks.
const { port1, port2 } = new MessageChannel();

port1.on('message', (msg) =&gt; {
  console.log(msg);
});

register('./my-hooks.mjs', {
  parentURL: pathToFileURL(__filename),
  data: { number: 1, port: port2 },
  transferList: [port2],
});</pre> <h4 id="hooks">Hooks
</h4> <p>The <a href="#moduleregisterspecifier-parenturl-options"><code>register</code></a> method can be used to register a module that exports a set of hooks. The hooks are functions that are called by Node.js to customize the module resolution and loading process. The exported functions must have specific names and signatures, and they must be exported as named exports.</p> <pre data-language="js">export async function initialize({ number, port }) {
  // Receives data from `register`.
}

export async function resolve(specifier, context, nextResolve) {
  // Take an `import` or `require` specifier and resolve it to a URL.
}

export async function load(url, context, nextLoad) {
  // Take a resolved URL and return the source code to be evaluated.
} copy</pre> <p>Hooks are part of a chain, even if that chain consists of only one custom (user-provided) hook and the default hook, which is always present. Hook functions nest: each one must always return a plain object, and chaining happens as a result of each function calling <code>next&lt;hookName&gt;()</code>, which is a reference to the subsequent loader's hook.</p> <p>A hook that returns a value lacking a required property triggers an exception. A hook that returns without calling <code>next&lt;hookName&gt;()</code> <em>and</em> without returning <code>shortCircuit: true</code> also triggers an exception. These errors are to help prevent unintentional breaks in the chain. Return <code>shortCircuit: true</code> from a hook to signal that the chain is intentionally ending at your hook.</p> <p>Hooks are run in a separate thread, isolated from the main thread where application code runs. That means it is a different <a href="https://tc39.es/ecma262/#realm">realm</a>. The hooks thread may be terminated by the main thread at any time, so do not depend on asynchronous operations (like <code>console.log</code>) to complete.</p> <h5 id="initialize">
<code>initialize()</code>
</h5> <div class="api_metadata"> <span>Added in: v20.6.0</span> </div> 
<div class="api_stability api_stability_1">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 1</a>.2 - Release candidate</div>
 <ul> <li>
<code>data</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" class="type">&lt;any&gt;</a> The data from <code>register(loader, import.meta.url, { data })</code>.</li> </ul> <p>The <code>initialize</code> hook provides a way to define a custom function that runs in the hooks thread when the hooks module is initialized. Initialization happens when the hooks module is registered via <a href="#moduleregisterspecifier-parenturl-options"><code>register</code></a>.</p> <p>This hook can receive data from a <a href="#moduleregisterspecifier-parenturl-options"><code>register</code></a> invocation, including ports and other transferrable objects. The return value of <code>initialize</code> can be a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" class="type">&lt;Promise&gt;</a>, in which case it will be awaited before the main application thread execution resumes.</p> <p>Module customization code:</p> <pre data-language="js">// path-to-my-hooks.js

export async function initialize({ number, port }) {
  port.postMessage(`increment: ${number + 1}`);
} copy</pre> <p>Caller code:</p> <p class="module-type">MJS modules</p>
<pre data-language="js">import assert from 'node:assert';
import { register } from 'node:module';
import { MessageChannel } from 'node:worker_threads';

// This example showcases how a message channel can be used to communicate
// between the main (application) thread and the hooks running on the hooks
// thread, by sending `port2` to the `initialize` hook.
const { port1, port2 } = new MessageChannel();

port1.on('message', (msg) =&gt; {
  assert.strictEqual(msg, 'increment: 2');
});

register('./path-to-my-hooks.js', {
  parentURL: import.meta.url,
  data: { number: 1, port: port2 },
  transferList: [port2],
});</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">const assert = require('node:assert');
const { register } = require('node:module');
const { pathToFileURL } = require('node:url');
const { MessageChannel } = require('node:worker_threads');

// This example showcases how a message channel can be used to communicate
// between the main (application) thread and the hooks running on the hooks
// thread, by sending `port2` to the `initialize` hook.
const { port1, port2 } = new MessageChannel();

port1.on('message', (msg) =&gt; {
  assert.strictEqual(msg, 'increment: 2');
});

register('./path-to-my-hooks.js', {
  parentURL: pathToFileURL(__filename),
  data: { number: 1, port: port2 },
  transferList: [port2],
});</pre> <h5 id="resolvespecifier-context-nextresolve">
<code>resolve(specifier, context, nextResolve)</code>
</h5> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v18.6.0, v16.17.0</td> <td><p>Add support for chaining resolve hooks. Each hook must either call <code>nextResolve()</code> or include a <code>shortCircuit</code> property set to <code>true</code> in its return.</p></td>
</tr> <tr>
<td>v17.1.0, v16.14.0</td> <td><p>Add support for import assertions.</p></td>
</tr> </tbody>
</table> </details> </div> 
<div class="api_stability api_stability_1">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 1</a>.2 - Release candidate</div>
 <ul> <li>
<code>specifier</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a>
</li> <li>
<code>context</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>conditions</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string[]&gt;</a> Export conditions of the relevant <code>package.json</code>
</li> <li>
<code>importAssertions</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> An object whose key-value pairs represent the assertions for the module to import</li> <li>
<code>parentURL</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The module importing this one, or undefined if this is the Node.js entry point</li> </ul> </li> <li>
<code>nextResolve</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> The subsequent <code>resolve</code> hook in the chain, or the Node.js default <code>resolve</code> hook after the last user-supplied <code>resolve</code> hook <ul> <li>
<code>specifier</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a>
</li> <li>
<code>context</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a>
</li> </ul> </li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" class="type">&lt;Promise&gt;</a> <ul> <li>
<code>format</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Null_type" class="type">&lt;null&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> A hint to the load hook (it might be ignored) <code>'builtin' | 'commonjs' | 'json' | 'module' | 'wasm'</code>
</li> <li>
<code>importAssertions</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The import assertions to use when caching the module (optional; if excluded the input will be used)</li> <li>
<code>shortCircuit</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> A signal that this hook intends to terminate the chain of <code>resolve</code> hooks. <strong>Default:</strong> <code>false</code>
</li> <li>
<code>url</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The absolute URL to which this input resolves</li> </ul> </li> </ul> <blockquote> <p><strong>Warning</strong> Despite support for returning promises and async functions, calls to <code>resolve</code> may block the main thread which can impact performance.</p> </blockquote> <p>The <code>resolve</code> hook chain is responsible for telling Node.js where to find and how to cache a given <code>import</code> statement or expression, or <code>require</code> call. It can optionally return a format (such as <code>'module'</code>) as a hint to the <code>load</code> hook. If a format is specified, the <code>load</code> hook is ultimately responsible for providing the final <code>format</code> value (and it is free to ignore the hint provided by <code>resolve</code>); if <code>resolve</code> provides a <code>format</code>, a custom <code>load</code> hook is required even if only to pass the value to the Node.js default <code>load</code> hook.</p> <p>Import type assertions are part of the cache key for saving loaded modules into the internal module cache. The <code>resolve</code> hook is responsible for returning an <code>importAssertions</code> object if the module should be cached with different assertions than were present in the source code.</p> <p>The <code>conditions</code> property in <code>context</code> is an array of conditions for <a href="packages#conditional-exports">package exports conditions</a> that apply to this resolution request. They can be used for looking up conditional mappings elsewhere or to modify the list when calling the default resolution logic.</p> <p>The current <a href="packages#conditional-exports">package exports conditions</a> are always in the <code>context.conditions</code> array passed into the hook. To guarantee <em>default Node.js module specifier resolution behavior</em> when calling <code>defaultResolve</code>, the <code>context.conditions</code> array passed to it <em>must</em> include <em>all</em> elements of the <code>context.conditions</code> array originally passed into the <code>resolve</code> hook.</p> <pre data-language="js">export async function resolve(specifier, context, nextResolve) {
  const { parentURL = null } = context;

  if (Math.random() &gt; 0.5) { // Some condition.
    // For some or all specifiers, do some custom logic for resolving.
    // Always return an object of the form {url: &lt;string&gt;}.
    return {
      shortCircuit: true,
      url: parentURL ?
        new URL(specifier, parentURL).href :
        new URL(specifier).href,
    };
  }

  if (Math.random() &lt; 0.5) { // Another condition.
    // When calling `defaultResolve`, the arguments can be modified. In this
    // case it's adding another value for matching conditional exports.
    return nextResolve(specifier, {
      ...context,
      conditions: [...context.conditions, 'another-condition'],
    });
  }

  // Defer to the next hook in the chain, which would be the
  // Node.js default resolve if this is the last user-specified loader.
  return nextResolve(specifier);
} copy</pre> <h5 id="loadurl-context-nextload">
<code>load(url, context, nextLoad)</code>
</h5> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v20.6.0</td> <td><p>Add support for <code>source</code> with format <code>commonjs</code>.</p></td>
</tr> <tr>
<td>v18.6.0, v16.17.0</td> <td><p>Add support for chaining load hooks. Each hook must either call <code>nextLoad()</code> or include a <code>shortCircuit</code> property set to <code>true</code> in its return.</p></td>
</tr> </tbody>
</table> </details> </div> 
<div class="api_stability api_stability_1">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 1</a>.2 - Release candidate</div>
 <ul> <li>
<code>url</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The URL returned by the <code>resolve</code> chain</li> <li>
<code>context</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>conditions</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string[]&gt;</a> Export conditions of the relevant <code>package.json</code>
</li> <li>
<code>format</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Null_type" class="type">&lt;null&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The format optionally supplied by the <code>resolve</code> hook chain</li> <li>
<code>importAssertions</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a>
</li> </ul> </li> <li>
<code>nextLoad</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> The subsequent <code>load</code> hook in the chain, or the Node.js default <code>load</code> hook after the last user-supplied <code>load</code> hook <ul> <li>
<code>specifier</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a>
</li> <li>
<code>context</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a>
</li> </ul> </li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>format</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a>
</li> <li>
<code>shortCircuit</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> A signal that this hook intends to terminate the chain of <code>resolve</code> hooks. <strong>Default:</strong> <code>false</code>
</li> <li>
<code>source</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" class="type">&lt;ArrayBuffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" class="type">&lt;TypedArray&gt;</a> The source for Node.js to evaluate</li> </ul> </li> </ul> <p>The <code>load</code> hook provides a way to define a custom method of determining how a URL should be interpreted, retrieved, and parsed. It is also in charge of validating the import assertion.</p> <p>The final value of <code>format</code> must be one of the following:</p> <table>
<thead><tr>
<th><code>format</code></th>
<th>Description</th>
<th>Acceptable types for <code>source</code> returned by <code>load</code>
</th>
</tr></thead>
<tbody>
<tr>
<td><code>'builtin'</code></td>
<td>Load a Node.js builtin module</td>
<td>Not applicable</td>
</tr>
<tr>
<td><code>'commonjs'</code></td>
<td>Load a Node.js CommonJS module</td>
<td>{ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String"><code>string</code></a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code>ArrayBuffer</code></a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray"><code>TypedArray</code></a>, <code>null</code>, <code>undefined</code> }</td>
</tr>
<tr>
<td><code>'json'</code></td>
<td>Load a JSON file</td>
<td>{ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String"><code>string</code></a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code>ArrayBuffer</code></a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray"><code>TypedArray</code></a> }</td>
</tr>
<tr>
<td><code>'module'</code></td>
<td>Load an ES module</td>
<td>{ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String"><code>string</code></a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code>ArrayBuffer</code></a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray"><code>TypedArray</code></a> }</td>
</tr>
<tr>
<td><code>'wasm'</code></td>
<td>Load a WebAssembly module</td>
<td>{ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code>ArrayBuffer</code></a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray"><code>TypedArray</code></a> }</td>
</tr>
</tbody>
</table> <p>The value of <code>source</code> is ignored for type <code>'builtin'</code> because currently it is not possible to replace the value of a Node.js builtin (core) module.</p> <p>Omitting vs providing a <code>source</code> for <code>'commonjs'</code> has very different effects:</p> <ul> <li>When a <code>source</code> is provided, all <code>require</code> calls from this module will be processed by the ESM loader with registered <code>resolve</code> and <code>load</code> hooks; all <code>require.resolve</code> calls from this module will be processed by the ESM loader with registered <code>resolve</code> hooks; only a subset of the CommonJS API will be available (e.g. no <code>require.extensions</code>, no <code>require.cache</code>, no <code>require.resolve.paths</code>) and monkey-patching on the CommonJS module loader will not apply.</li> <li>If <code>source</code> is undefined or <code>null</code>, it will be handled by the CommonJS module loader and <code>require</code>/<code>require.resolve</code> calls will not go through the registered hooks. This behavior for nullish <code>source</code> is temporary — in the future, nullish <code>source</code> will not be supported.</li> </ul> <p>The Node.js internal <code>load</code> implementation, which is the value of <code>next</code> for the last hook in the <code>load</code> chain, returns <code>null</code> for <code>source</code> when <code>format</code> is <code>'commonjs'</code> for backward compatibility. Here is an example hook that would opt-in to using the non-default behavior:</p> <pre data-language="js">import { readFile } from 'node:fs/promises';

export async function load(url, context, nextLoad) {
  const result = await nextLoad(url, context);
  if (result.format === 'commonjs') {
    result.source ??= await readFile(new URL(result.responseURL ?? url));
  }
  return result;
} copy</pre> <blockquote> <p><strong>Warning</strong>: The ESM <code>load</code> hook and namespaced exports from CommonJS modules are incompatible. Attempting to use them together will result in an empty object from the import. This may be addressed in the future.</p> </blockquote> <blockquote> <p>These types all correspond to classes defined in ECMAScript.</p> </blockquote> <ul> <li>The specific <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code>ArrayBuffer</code></a> object is a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer"><code>SharedArrayBuffer</code></a>.</li> <li>The specific <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray"><code>TypedArray</code></a> object is a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array"><code>Uint8Array</code></a>.</li> </ul> <p>If the source value of a text-based format (i.e., <code>'json'</code>, <code>'module'</code>) is not a string, it is converted to a string using <a href="util#class-utiltextdecoder"><code>util.TextDecoder</code></a>.</p> <p>The <code>load</code> hook provides a way to define a custom method for retrieving the source code of a resolved URL. This would allow a loader to potentially avoid reading files from disk. It could also be used to map an unrecognized format to a supported one, for example <code>yaml</code> to <code>module</code>.</p> <pre data-language="js">export async function load(url, context, nextLoad) {
  const { format } = context;

  if (Math.random() &gt; 0.5) { // Some condition
    /*
      For some or all URLs, do some custom logic for retrieving the source.
      Always return an object of the form {
        format: &lt;string&gt;,
        source: &lt;string|buffer&gt;,
      }.
    */
    return {
      format,
      shortCircuit: true,
      source: '...',
    };
  }

  // Defer to the next hook in the chain.
  return nextLoad(url);
} copy</pre> <p>In a more advanced scenario, this can also be used to transform an unsupported source to a supported one (see <a href="#examples">Examples</a> below).</p> <h5 id="globalpreload">
<code>globalPreload()</code>
</h5> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v18.6.0, v16.17.0</td> <td><p>Add support for chaining globalPreload hooks.</p></td>
</tr> </tbody>
</table> </details> </div> 
<div class="api_stability api_stability_1">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 1</a>.0 - Early development</div>
 <blockquote> <p><strong>Warning:</strong> This hook will be removed in a future version. Use <a href="#initialize"><code>initialize</code></a> instead. When a hooks module has an <code>initialize</code> export, <code>globalPreload</code> will be ignored.</p> </blockquote> <ul> <li>
<code>context</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Information to assist the preload code <ul> <li>
<code>port</code> <a href="worker_threads#class-messageport" class="type">&lt;MessagePort&gt;</a>
</li> </ul> </li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> Code to run before application startup</li> </ul> <p>Sometimes it might be necessary to run some code inside of the same global scope that the application runs in. This hook allows the return of a string that is run as a sloppy-mode script on startup.</p> <p>Similar to how CommonJS wrappers work, the code runs in an implicit function scope. The only argument is a <code>require</code>-like function that can be used to load builtins like "fs": <code>getBuiltin(request: string)</code>.</p> <p>If the code needs more advanced <code>require</code> features, it has to construct its own <code>require</code> using <code>module.createRequire()</code>.</p> <pre data-language="js">export function globalPreload(context) {
  return `\
globalThis.someInjectedProperty = 42;
console.log('I just set some globals!');

const { createRequire } = getBuiltin('module');
const { cwd } = getBuiltin('process');

const require = createRequire(cwd() + '/&lt;preload&gt;');
// [...]
`;
} copy</pre> <p>Another argument is provided to the preload code: <code>port</code>. This is available as a parameter to the hook and inside of the source text returned by the hook. This functionality has been moved to the <code>initialize</code> hook.</p> <p>Care must be taken in order to properly call <a href="worker_threads#portref"><code>port.ref()</code></a> and <a href="worker_threads#portunref"><code>port.unref()</code></a> to prevent a process from being in a state where it won't close normally.</p> <pre data-language="js">/**
 * This example has the application context send a message to the hook
 * and sends the message back to the application context
 */
export function globalPreload({ port }) {
  port.onmessage = (evt) =&gt; {
    port.postMessage(evt.data);
  };
  return `\
    port.postMessage('console.log("I went to the hook and back");');
    port.onmessage = (evt) =&gt; {
      eval(evt.data);
    };
  `;
} copy</pre> <h4 id="examples">Examples
</h4> <p>The various module customization hooks can be used together to accomplish wide-ranging customizations of the Node.js code loading and evaluation behaviors.</p> <h5 id="import-from-https">Import from HTTPS
</h5> <p>In current Node.js, specifiers starting with <code>https://</code> are experimental (see <a href="esm#https-and-http-imports">HTTPS and HTTP imports</a>).</p> <p>The hook below registers hooks to enable rudimentary support for such specifiers. While this may seem like a significant improvement to Node.js core functionality, there are substantial downsides to actually using these hooks: performance is much slower than loading files from disk, there is no caching, and there is no security.</p> <pre data-language="js">// https-hooks.mjs
import { get } from 'node:https';

export function load(url, context, nextLoad) {
  // For JavaScript to be loaded over the network, we need to fetch and
  // return it.
  if (url.startsWith('https://')) {
    return new Promise((resolve, reject) =&gt; {
      get(url, (res) =&gt; {
        let data = '';
        res.setEncoding('utf8');
        res.on('data', (chunk) =&gt; data += chunk);
        res.on('end', () =&gt; resolve({
          // This example assumes all network-provided JavaScript is ES module
          // code.
          format: 'module',
          shortCircuit: true,
          source: data,
        }));
      }).on('error', (err) =&gt; reject(err));
    });
  }

  // Let Node.js handle all other URLs.
  return nextLoad(url);
} copy</pre> <pre data-language="js">// main.mjs
import { VERSION } from 'https://coffeescript.org/browser-compiler-modern/coffeescript.js';

console.log(VERSION); copy</pre> <p>With the preceding hooks module, running <code>node --import 'data:text/javascript,import { register } from "node:module"; import { pathToFileURL } from "node:url"; register(pathToFileURL("./https-hooks.mjs"));' ./main.mjs</code> prints the current version of CoffeeScript per the module at the URL in <code>main.mjs</code>.</p> <h5 id="transpilation">Transpilation
</h5> <p>Sources that are in formats Node.js doesn't understand can be converted into JavaScript using the <a href="#loadurl-context-nextload"><code>load</code> hook</a>.</p> <p>This is less performant than transpiling source files before running Node.js; transpiler hooks should only be used for development and testing purposes.</p> <pre data-language="js">// coffeescript-hooks.mjs
import { readFile } from 'node:fs/promises';
import { dirname, extname, resolve as resolvePath } from 'node:path';
import { cwd } from 'node:process';
import { fileURLToPath, pathToFileURL } from 'node:url';
import coffeescript from 'coffeescript';

const extensionsRegex = /\.(coffee|litcoffee|coffee\.md)$/;

export async function load(url, context, nextLoad) {
  if (extensionsRegex.test(url)) {
    // CoffeeScript files can be either CommonJS or ES modules, so we want any
    // CoffeeScript file to be treated by Node.js the same as a .js file at the
    // same location. To determine how Node.js would interpret an arbitrary .js
    // file, search up the file system for the nearest parent package.json file
    // and read its "type" field.
    const format = await getPackageType(url);

    const { source: rawSource } = await nextLoad(url, { ...context, format });
    // This hook converts CoffeeScript source code into JavaScript source code
    // for all imported CoffeeScript files.
    const transformedSource = coffeescript.compile(rawSource.toString(), url);

    return {
      format,
      shortCircuit: true,
      source: transformedSource,
    };
  }

  // Let Node.js handle all other URLs.
  return nextLoad(url);
}

async function getPackageType(url) {
  // `url` is only a file path during the first iteration when passed the
  // resolved url from the load() hook
  // an actual file path from load() will contain a file extension as it's
  // required by the spec
  // this simple truthy check for whether `url` contains a file extension will
  // work for most projects but does not cover some edge-cases (such as
  // extensionless files or a url ending in a trailing space)
  const isFilePath = !!extname(url);
  // If it is a file path, get the directory it's in
  const dir = isFilePath ?
    dirname(fileURLToPath(url)) :
    url;
  // Compose a file path to a package.json in the same directory,
  // which may or may not exist
  const packagePath = resolvePath(dir, 'package.json');
  // Try to read the possibly nonexistent package.json
  const type = await readFile(packagePath, { encoding: 'utf8' })
    .then((filestring) =&gt; JSON.parse(filestring).type)
    .catch((err) =&gt; {
      if (err?.code !== 'ENOENT') console.error(err);
    });
  // Ff package.json existed and contained a `type` field with a value, voila
  if (type) return type;
  // Otherwise, (if not at the root) continue checking the next directory up
  // If at the root, stop and return false
  return dir.length &gt; 1 &amp;&amp; getPackageType(resolvePath(dir, '..'));
} copy</pre> <pre data-language="js"># main.coffee
import { scream } from './scream.coffee'
console.log scream 'hello, world'

import { version } from 'node:process'
console.log "Brought to you by Node.js version #{version}" copy</pre> <pre data-language="js"># scream.coffee
export scream = (str) -&gt; str.toUpperCase() copy</pre> <p>With the preceding hooks module, running <code>node --import 'data:text/javascript,import { register } from "node:module"; import { pathToFileURL } from "node:url"; register(pathToFileURL("./coffeescript-hooks.mjs"));' ./main.coffee</code> causes <code>main.coffee</code> to be turned into JavaScript after its source code is loaded from disk but before Node.js executes it; and so on for any <code>.coffee</code>, <code>.litcoffee</code> or <code>.coffee.md</code> files referenced via <code>import</code> statements of any loaded file.</p> <h5 id="import-maps">Import maps
</h5> <p>The previous two examples defined <code>load</code> hooks. This is an example of a <code>resolve</code> hook. This hooks module reads an <code>import-map.json</code> file that defines which specifiers to override to other URLs (this is a very simplistic implementation of a small subset of the "import maps" specification).</p> <pre data-language="js">// import-map-hooks.js
import fs from 'node:fs/promises';

const { imports } = JSON.parse(await fs.readFile('import-map.json'));

export async function resolve(specifier, context, nextResolve) {
  if (Object.hasOwn(imports, specifier)) {
    return nextResolve(imports[specifier], context);
  }

  return nextResolve(specifier, context);
} copy</pre> <p>With these files:</p> <pre data-language="js">// main.js
import 'a-module'; copy</pre> <pre data-language="js">// import-map.json
{
  "imports": {
    "a-module": "./some-module.js"
  }
} copy</pre> <pre data-language="js">// some-module.js
console.log('some module!'); copy</pre> <p>Running <code>node --import 'data:text/javascript,import { register } from "node:module"; import { pathToFileURL } from "node:url"; register(pathToFileURL("./import-map-hooks.js"));' main.js</code> should print <code>some module!</code>.</p> </section><section><h3 id="source-map-v3-support">Source map v3 support
</h3> <div class="api_metadata"> <span>Added in: v13.7.0, v12.17.0</span> </div> 
<div class="api_stability api_stability_1">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 1</a> - Experimental</div>
 <p>Helpers for interacting with the source map cache. This cache is populated when source map parsing is enabled and <a href="https://sourcemaps.info/spec.html#h.lmz475t4mvbx">source map include directives</a> are found in a modules' footer.</p> <p>To enable source map parsing, Node.js must be run with the flag <a href="cli#--enable-source-maps"><code>--enable-source-maps</code></a>, or with code coverage enabled by setting <a href="cli#node_v8_coveragedir"><code>NODE_V8_COVERAGE=dir</code></a>.</p> <p class="module-type">MJS modules</p>
<pre data-language="js">// module.mjs
// In an ECMAScript module
import { findSourceMap, SourceMap } from 'node:module';</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">// module.cjs
// In a CommonJS module
const { findSourceMap, SourceMap } = require('node:module');</pre>   <h4 id="modulefindsourcemappath">
<code>module.findSourceMap(path)</code>
</h4> <div class="api_metadata"> <span>Added in: v13.7.0, v12.17.0</span> </div> <ul> <li>
<code>path</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a>
</li> <li>Returns: <a href="module#class-modulesourcemap" class="type">&lt;module.SourceMap&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> Returns <code>module.SourceMap</code> if a source map is found, <code>undefined</code> otherwise.</li> </ul> <p><code>path</code> is the resolved path for the file for which a corresponding source map should be fetched.</p> <h4 id="class-modulesourcemap">Class: <code>module.SourceMap</code>
</h4> <div class="api_metadata"> <span>Added in: v13.7.0, v12.17.0</span> </div> <h5 id="new-sourcemappayload--linelengths-">
<code>new SourceMap(payload[, { lineLengths }])</code>
</h5> <ul> <li>
<code>payload</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a>
</li> <li>
<code>lineLengths</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number[]&gt;</a>
</li> </ul> <p>Creates a new <code>sourceMap</code> instance.</p> <p><code>payload</code> is an object with keys matching the <a href="https://sourcemaps.info/spec.html#h.mofvlxcwqzej">Source map v3 format</a>:</p> <ul> <li>
<code>file</code>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a>
</li> <li>
<code>version</code>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a>
</li> <li>
<code>sources</code>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string[]&gt;</a>
</li> <li>
<code>sourcesContent</code>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string[]&gt;</a>
</li> <li>
<code>names</code>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string[]&gt;</a>
</li> <li>
<code>mappings</code>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a>
</li> <li>
<code>sourceRoot</code>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a>
</li> </ul> <p><code>lineLengths</code> is an optional array of the length of each line in the generated code.</p> <h5 id="sourcemappayload">
<code>sourceMap.payload</code>
</h5> <ul> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a>
</li> </ul> <p>Getter for the payload used to construct the <a href="#class-modulesourcemap"><code>SourceMap</code></a> instance.</p> <h5 id="sourcemapfindentrylineoffset-columnoffset">
<code>sourceMap.findEntry(lineOffset, columnOffset)</code>
</h5> <ul> <li>
<code>lineOffset</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The zero-indexed line number offset in the generated source</li> <li>
<code>columnOffset</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The zero-indexed column number offset in the generated source</li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a>
</li> </ul> <p>Given a line offset and column offset in the generated source file, returns an object representing the SourceMap range in the original file if found, or an empty object if not.</p> <p>The object returned contains the following keys:</p> <ul> <li>generatedLine: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The line offset of the start of the range in the generated source</li> <li>generatedColumn: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The column offset of start of the range in the generated source</li> <li>originalSource: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The file name of the original source, as reported in the SourceMap</li> <li>originalLine: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The line offset of the start of the range in the original source</li> <li>originalColumn: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The column offset of start of the range in the original source</li> <li>name: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a>
</li> </ul> <p>The returned value represents the raw range as it appears in the SourceMap, based on zero-indexed offsets, <em>not</em> 1-indexed line and column numbers as they appear in Error messages and CallSite objects.</p> <p>To get the corresponding 1-indexed line and column numbers from a lineNumber and columnNumber as they are reported by Error stacks and CallSite objects, use <code>sourceMap.findOrigin(lineNumber, columnNumber)</code></p> <h5 id="sourcemapfindoriginlinenumber-columnnumber">
<code>sourceMap.findOrigin(lineNumber, columnNumber)</code>
</h5> <ul> <li>
<code>lineNumber</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The 1-indexed line number of the call site in the generated source</li> <li>
<code>columnOffset</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The 1-indexed column number of the call site in the generated source</li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a>
</li> </ul> <p>Given a 1-indexed lineNumber and columnNumber from a call site in the generated source, find the corresponding call site location in the original source.</p> <p>If the lineNumber and columnNumber provided are not found in any source map, then an empty object is returned. Otherwise, the returned object contains the following keys:</p> <ul> <li>name: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The name of the range in the source map, if one was provided</li> <li>fileName: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The file name of the original source, as reported in the SourceMap</li> <li>lineNumber: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The 1-indexed lineNumber of the corresponding call site in the original source</li> <li>columnNumber: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The 1-indexed columnNumber of the corresponding call site in the original source</li> </ul></section><div class="_attribution">
  <p class="_attribution-p">
    © Joyent, Inc. and other Node contributors<br>Licensed under the MIT License.<br>Node.js is a trademark of Joyent, Inc. and is used with its permission.<br>We are not endorsed by or affiliated with Joyent.<br>
    <a href="https://nodejs.org/api/module.html" class="_attribution-link">https://nodejs.org/api/module.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
